"use client";

import * as React from "react";
import {useEffect, useState} from "react";
import {ColumnConfig, columns} from "@/components/table-config/coder/columns";
import {DataTable} from "@/common/components/table/data-table";
// import CoderApi from "@/api/auto/coder-config";
import {useTranslations} from "next-intl";
import ThreeDotLoading from "@/common/components/ThreeDotLoading";
import {Button} from "@/components/ui/button";
import {TableOperationProps} from "@/common/lib/table/DataTableProperty";
import {getOriginalData} from "@/common/lib/table/TableUtils";


function SaveButton({table}: TableOperationProps<ColumnConfig>) {
    const setData = table.options.meta?.setData;
    return (<div className={"border-1 border-red-700"}><Button onClick={() => {
            const originalData = getOriginalData(table);
            console.log(JSON.stringify(originalData));
        }}>保存</Button>
            <Button onClick={() => {
                const originalData = getOriginalData(table);
                setData(originalData.sort((a, b) => a.sort - b.sort));
            }}>sort</Button></div>
    )
}

export default function ColumnEditor() {
    const errorTranslate = useTranslations("ProjectConfig.ErrorMessage");
    const globalTranslate = useTranslations("GlobalForm");

    const [dataState, setDataState] = useState<ColumnConfig[] | undefined>();
    useEffect(() => {
        // ProjectConfigApi.search({}, errorTranslate).then(
        //     (res) => {
        //         setDataState(res.data)
        //     }
        // ).catch(()=>{});
        const json = "[{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"ID\",\"columnType\":5,\"controlType\":4,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Long\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"id\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":0,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":true,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"id\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"项目ID\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Long\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"projectId\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":1,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"projectId\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"主键\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"primaryKey\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":2,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"primaryKey\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"表名\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"tableName\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":3,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"tableName\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"类名\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"className\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":4,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"className\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"描述\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"description\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":5,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"description\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"是否锁定\",\"columnType\":5,\"controlType\":14,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Boolean\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"locked\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":6,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validator\":{\"allowEmpty\":true,\"clazz\":\"java.lang.Boolean\",\"emptyMessage\":\"\",\"i18nConfig\":{},\"propertyName\":\"\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"是否可勾选\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Integer\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"checkable\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":7,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"checkable\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"是否显示行操作\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Integer\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"rowMenu\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":8,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"rowMenu\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"是否显示列过滤器\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Integer\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"columnFilter\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":9,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"columnFilter\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"是否显示状态命令\",\"columnType\":5,\"controlType\":14,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Boolean\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"statusCommand\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":10,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validator\":{\"allowEmpty\":true,\"clazz\":\"java.lang.Boolean\",\"emptyMessage\":\"\",\"i18nConfig\":{},\"propertyName\":\"\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"列配置\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"columnConfigs\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":11,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"columnConfigs\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"数据源\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"source\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":12,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"source\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"上传源代码\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"sourceCode\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":13,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"sourceCode\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"创建人\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"createUserName\",\"readOnly\":true,\"searchType\":1,\"showInEdit\":false,\"showInList\":true,\"showInSearch\":false,\"sort\":14,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"createUserName\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"创建人ID\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Long\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"createUserId\",\"readOnly\":true,\"searchType\":1,\"showInEdit\":false,\"showInList\":true,\"showInSearch\":false,\"sort\":15,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"createUserId\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"更新人ID\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Long\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"modifiedUserId\",\"readOnly\":true,\"searchType\":1,\"showInEdit\":false,\"showInList\":true,\"showInSearch\":false,\"sort\":16,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"modifiedUserId\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"更新人\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"modifiedUserName\",\"readOnly\":true,\"searchType\":1,\"showInEdit\":false,\"showInList\":true,\"showInSearch\":false,\"sort\":17,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"modifiedUserName\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"创建时间\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Long\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"gmtCreate\",\"readOnly\":true,\"searchType\":1,\"showInEdit\":false,\"showInList\":true,\"showInSearch\":false,\"sort\":18,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"gmtCreate\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"更新时间\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Long\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"gmtModified\",\"readOnly\":true,\"searchType\":1,\"showInEdit\":false,\"showInList\":true,\"showInSearch\":false,\"sort\":19,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"gmtModified\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"是否删除\",\"columnType\":5,\"controlType\":14,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Boolean\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"deleted\",\"readOnly\":true,\"searchType\":1,\"showInEdit\":false,\"showInList\":true,\"showInSearch\":false,\"sort\":20,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validator\":{\"allowEmpty\":true,\"clazz\":\"java.lang.Boolean\",\"emptyMessage\":\"\",\"i18nConfig\":{},\"propertyName\":\"\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"STATUS\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"com.sparrow.protocol.enums.StatusRecord\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"status\",\"readOnly\":true,\"searchType\":1,\"showInEdit\":false,\"showInList\":true,\"showInSearch\":false,\"sort\":21,\"subsidiaryColumns\":\"\",\"tableClassName\":\"TableConfig\",\"validator\":{\"allowEmpty\":true,\"clazz\":\"com.sparrow.protocol.enums.StatusRecord\",\"emptyMessage\":\"\",\"i18nConfig\":{},\"propertyName\":\"\"}}]";
        debugger;
        const data = JSON.parse(json);
        data.sort((a, b) => a.sort - b.sort);
        setDataState(JSON.parse(json));
    }, []);


    if (!dataState) {
        return <ThreeDotLoading/>
    }
    return (
        <div className="w-full border-2 border-gray-200 rounded-md">
            <DataTable
                tableName={"ColumnConfig"}
                primary={"id"}
                i18n={true}
                data={dataState}
                columns={columns}
                setData={setDataState}
                OperationComponent={SaveButton}
            ></DataTable>
        </div>
    );
}

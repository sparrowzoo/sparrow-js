"use client";

import * as React from "react";
import {useEffect, useState} from "react";
import {ColumnConfig, columns} from "@/components/table-config/coder/columns";
import {DataTable} from "@/common/components/table/data-table";
// import CoderApi from "@/api/auto/coder-config";
import {useTranslations} from "next-intl";
import ThreeDotLoading from "@/common/components/ThreeDotLoading";
import {Button} from "@/components/ui/button";
import {MyTableMeta, TableOperationProps} from "@/common/lib/table/DataTableProperty";
import {getOriginalData} from "@/common/lib/table/TableUtils";
import Result, {PagerResult} from "@/common/lib/protocol/Result";


function SaveButton({table}: TableOperationProps<ColumnConfig>) {
    const meta=table.options.meta as MyTableMeta<ColumnConfig>
    const setData = meta.setData;
    return (<div className={"border-1 border-red-700"}><Button onClick={() => {
            const originalData = getOriginalData(table);
            console.log(JSON.stringify(originalData));
        }}>保存</Button>
            <Button onClick={() => {
                const originalData = getOriginalData(table);
                //setData(originalData.sort((a, b) => a.sort - b.sort));
            }}>sort</Button></div>
    )
}

export default function ColumnEditor() {
    const errorTranslate = useTranslations("ProjectConfig.ErrorMessage");
    const globalTranslate = useTranslations("GlobalForm");

    const [dataState, setDataState] = useState<Result<PagerResult<ColumnConfig>> | undefined>();
    useEffect(() => {
        // ProjectConfigApi.search({}, errorTranslate).then(
        //     (res) => {
        //         setDataState(res.data)
        //     }
        // ).catch(()=>{});
const json="{\"code\":\"0\",\"data\":{\"dictionary\":{\"CELL_TYPE\":[{\"key\":1,\"value\":\"CHECK_BOX\"},{\"key\":2,\"value\":\"NORMAL\"},{\"key\":3,\"value\":\"CURRENCY\"},{\"key\":4,\"value\":\"TREE\"},{\"key\":5,\"value\":\"OPERATION\"}],\"COLUMN_TYPE\":[{\"key\":1,\"value\":\"ACTION\"},{\"key\":2,\"value\":\"CHECK\"},{\"key\":3,\"value\":\"FILTER\"},{\"key\":4,\"value\":\"TREE\"},{\"key\":5,\"value\":\"NORMAL\"}],\"HEADER_TYPE\":[{\"key\":1,\"value\":\"CHECK_BOX\"},{\"key\":2,\"value\":\"COLUMN_FILTER\"},{\"key\":3,\"value\":\"NORMAL\"},{\"key\":4,\"value\":\"NORMAL_SORT\"},{\"key\":5,\"value\":\"NORMAL_FILTER\"},{\"key\":6,\"value\":\"NORMAL_SORT_FILTER\"},{\"key\":7,\"value\":\"PLAIN_TEXT\"},{\"key\":8,\"value\":\"EMPTY\"}],\"DATASOURCE_TYPE\":[{\"key\":1,\"value\":\"NULL\"},{\"key\":2,\"value\":\"DICTIONARY\"},{\"key\":3,\"value\":\"API\"},{\"key\":4,\"value\":\"ENUM\"}]},\"lastPageIndex\":3,\"list\":[{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"类名\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"tableClassName\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":0,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"tableClassName\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"属性名\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"propertyName\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":1,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"propertyName\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"中文名\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"chineseName\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":2,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"chineseName\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"附加列\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"subsidiaryColumns\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":3,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"subsidiaryColumns\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"java类型\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"javaType\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":4,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"javaType\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"允许隐藏\",\"columnType\":5,\"controlType\":14,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Boolean\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"enableHidden\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":5,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validator\":{\"allowEmpty\":true,\"clazz\":\"java.lang.Boolean\",\"emptyMessage\":\"\",\"i18nConfig\":{},\"propertyName\":\"\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"默认隐藏\",\"columnType\":5,\"controlType\":14,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Boolean\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"defaultHidden\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":6,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validator\":{\"allowEmpty\":true,\"clazz\":\"java.lang.Boolean\",\"emptyMessage\":\"\",\"i18nConfig\":{},\"propertyName\":\"\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"编辑\",\"columnType\":5,\"controlType\":14,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Boolean\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"showInEdit\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":7,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validator\":{\"allowEmpty\":true,\"clazz\":\"java.lang.Boolean\",\"emptyMessage\":\"\",\"i18nConfig\":{},\"propertyName\":\"\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"列表\",\"columnType\":5,\"controlType\":14,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Boolean\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"showInList\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":8,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validator\":{\"allowEmpty\":true,\"clazz\":\"java.lang.Boolean\",\"emptyMessage\":\"\",\"i18nConfig\":{},\"propertyName\":\"\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"搜索\",\"columnType\":5,\"controlType\":14,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Boolean\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"showInSearch\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":9,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validator\":{\"allowEmpty\":true,\"clazz\":\"java.lang.Boolean\",\"emptyMessage\":\"\",\"i18nConfig\":{},\"propertyName\":\"\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"允许为空\",\"columnType\":5,\"controlType\":14,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Boolean\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"allowNull\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":10,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validator\":{\"allowEmpty\":true,\"clazz\":\"java.lang.Boolean\",\"emptyMessage\":\"\",\"i18nConfig\":{},\"propertyName\":\"\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"提示\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"placeholder\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":11,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"placeholder\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"默认值\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"defaultValue\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":12,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"defaultValue\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"查询方式\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Integer\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"searchType\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":13,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"searchType\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"验证类型\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"validateType\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":14,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"validateType\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"验证器\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"com.sparrowzoo.coder.domain.bo.validate.Validator\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"validator\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":15,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validator\":{\"allowEmpty\":true,\"clazz\":\"com.sparrowzoo.coder.domain.bo.validate.Validator\",\"emptyMessage\":\"\",\"i18nConfig\":{},\"propertyName\":\"\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"数据源类型\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Integer\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"dataSourceType\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":16,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"dataSourceType\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"数据源参数\",\"columnType\":5,\"controlType\":3,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.String\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"dataSourceParams\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":17,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"string\",\"validator\":{\"allowEmpty\":false,\"i18n\":false,\"propertyName\":\"dataSourceParams\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"列类型\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Integer\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"columnType\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":18,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"columnType\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"表头类型\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Integer\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"headerType\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":19,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"headerType\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"单元格类型\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Integer\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"cellType\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":20,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"cellType\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"控件类型\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Integer\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"controlType\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":21,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"controlType\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"排序\",\"columnType\":5,\"controlType\":18,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Integer\",\"number\":true,\"placeholder\":\"\",\"propertyName\":\"sort\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":22,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validateType\":\"digital\",\"validator\":{\"allowEmpty\":false,\"category\":\"INTEGER\",\"i18n\":false,\"i18nConfig\":{},\"propertyName\":\"sort\"}},{\"allowNull\":false,\"cellType\":2,\"chineseName\":\"是否只读\",\"columnType\":5,\"controlType\":14,\"dataSourceParams\":\"\",\"dataSourceType\":1,\"defaultHidden\":false,\"defaultValue\":\"\",\"enableHidden\":true,\"headerType\":3,\"javaType\":\"java.lang.Boolean\",\"number\":false,\"placeholder\":\"\",\"propertyName\":\"readOnly\",\"searchType\":1,\"showInEdit\":true,\"showInList\":true,\"showInSearch\":false,\"sort\":23,\"subsidiaryColumns\":\"\",\"tableClassName\":\"ColumnDef\",\"validator\":{\"allowEmpty\":true,\"clazz\":\"java.lang.Boolean\",\"emptyMessage\":\"\",\"i18nConfig\":{},\"propertyName\":\"\"}}],\"pageNo\":1,\"pageSize\":10,\"recordTotal\":24},\"message\":\"success\",\"success\":true}\n";
        const data = JSON.parse(json) as Result<PagerResult<ColumnConfig>>;
        data.data.list.sort((a, b) => a.sort - b.sort);

        setDataState(JSON.parse(json));
    }, []);


    if (!dataState) {
        return <ThreeDotLoading/>
    }
    return (
        <div className="w-full border-2 border-gray-200 rounded-md">
            <DataTable<ColumnConfig>
                tableName={"ColumnConfig"}
                primary={"id"}
                i18n={true}
                result={dataState}
                columns={columns}
                setData={setDataState}
                OperationComponent={SaveButton}
            ></DataTable>
        </div>
    );
}

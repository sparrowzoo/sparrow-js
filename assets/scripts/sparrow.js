"use strict";function asyncGeneratorStep(e,t,i,n,o,r,s){try{var a=e[r](s),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(n,o)}function _asyncToGenerator(a){return function(){var e=this,s=arguments;return new Promise(function(t,i){var n=a.apply(e,s);function o(e){asyncGeneratorStep(n,t,i,o,r,"next",e)}function r(e){asyncGeneratorStep(n,t,i,o,r,"throw",e)}o(void 0)})}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(e,t){"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("Sparrow requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:void 0,function(window,noGlobal){String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},String.prototype.ltrim=function(){return this.replace(/(^\s*)/g,"")},String.prototype.rtrim=function(){return this.replace(/(\s*$)/g,"")},String.prototype.json=function(){if(""===this||"''"===this||0===this.length)return null;-1!==this.indexOf("error|")&&console.log(this);try{var json=this;return json=json.decodeSplitKey(),eval("("+json.replace(/\r\n/g,"<br/>").replace(/\n/g,"<br/>")+")")}catch(e){return console.log(e)}},String.prototype.firstCharToAscii=function(){return this.charCodeAt(0)},String.prototype.leftAlignWithChar=function(e,t){if(t=t||3,e=e||"0",!(this.length>=t)){for(var i=[],n=t-this.length,o=0;o<n;o++)i.push(e);return i.join("")+this}},String.prototype.getCountByChar=function(e){return this.split(e).length-1},String.prototype.getByteLength=function(){return this.replace(/[^\x00-\xff]/g,"**").length},String.prototype.subString=function(e,t){var i,n=0,o="",r=/[^\x00-\xff]/g,s="",a=this.replace(r,"**").length;for(i=0;i<a&&((s=this.charAt(i).toString()).match(r)?n+=2:n+=1,!(e<n));i+=1)o+=s;return t&&e<a&&(o+=".."),o},String.prototype.decodeSplitKey=function(){var e=this;return e=(e=(e=(e=e.replace(/#colon#/g,":")).replace(/#dot#/g,",")).replace(/#ref#/g,'\\"')).replace(/#limit/g,"#")},String.prototype.decodeHtml=function(){var e=this;return e=(e=(e=(e=(e=e.replace(/&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&quot;/g,'"')).replace(/&nbsp;/g," ")},String.prototype.format=function(){var e=this;if(1<=arguments.length&&"object"===_typeof(arguments[0])){for(var t=/#{(.*?)}/gi,i=null;i=t.exec(this);){var n=i[0],o=i[1],r=arguments[0].value(o);if(1<arguments.length)for(var s=1;s<arguments.length&&!(r=arguments[s].value(o));s++);e=e.replace(n,$.isNullOrEmpty(r)?"-":r)}return e}var a=null;for(s=0;s<arguments.length;s++)a=new RegExp("\\{"+s+"\\}","gm"),e=e.replace(a,$.isNullOrEmpty(arguments[s])?"-":arguments[s]);return e},String.prototype.filterHTML=function(){for(var e=this;-1<e.search(/<([a-z0-9]*?).*?>([\s\S]*?)<\/\1>/gi);)e=e.replace(/<([a-z0-9]*?).*?>([\s\S]*?)<\/\1>/gi,"$2");return e.search(/<input.*>/)&&(e=e.replace(/<input.*>/gi,"")),e.search(/<(script).*?>.*?<\/\1>/)&&(e=e.replace(/<(script).*?>.*?<\/\1>/gi,"")),e.search(/<script.*>/)&&(e=e.replace(/<script.*>/gi,"")),e},String.prototype.firstCharUpperCase=function(){return this.substr(0,1).toUpperCase()+this.substr(1)},String.prototype.join=function(e){return $.isNullOrEmpty(e)?this+"":this+e},String.prototype.toArrayBuffer=function(){var e,t,i=[];e=this.length;for(var n=0;n<e;n++)65536<=(t=this.charCodeAt(n))&&t<=1114111?(i.push(t>>18&7|240),i.push(t>>12&63|128),i.push(t>>6&63|128),i.push(63&t|128)):2048<=t&&t<=65535?(i.push(t>>12&15|224),i.push(t>>6&63|128),i.push(63&t|128)):128<=t&&t<=2047?(i.push(t>>6&31|192),i.push(63&t|128)):i.push(255&t);var o=new Int8Array(i.length);for(var n in i)o[n]=i[n];return o},Array.prototype.clear=function(){for(var e=0;e<this.length;e+=1)this.pop()},Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1},Array.prototype.remove=function(e){var t=this.indexOf(e);-1<t&&this.splice(t,1)},Array.prototype.toUint8Array=function(){for(var e=new Uint8Array(this.length),t=0;t<e.length;t++)e[t]=this[t];return e},Array.prototype.push||(Array.prototype.push=function(){for(var e=0;e<arguments.length;e++)this[this.length]=arguments[e];return this.length}),Array.prototype.pop||(Array.prototype.pop=function(){return lastElement=this[this.length-1],this.length=Math.max(this.length-1,0),lastElement}),Uint8Array.prototype.toString=function(){for(var e=new DataView(this.buffer),t=new Uint8Array(this.buffer.byteLength),i=0;i<t.length;i++)t[i]=e.getUint8(i);var n="",o=t;for(i=0;i<o.length;i++){var r=o[i].toString(2),s=r.match(/^1+?(?=0)/);if(s&&8===r.length){for(var a=s[0].length,l=o[i].toString(2).slice(7-a),c=1;c<a;c++)l+=o[c+i].toString(2).slice(2);n+=String.fromCharCode(parseInt(l,2)),i+=a-1}else n+=String.fromCharCode(o[i])}return n},Number.prototype.toBytes=function(){length=4;for(var e=this,t=[],i=length;t[--i]=255&e,e>>=8,i;);return t},Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e};var Sparrow=function e(t,i,n,o,r){if(window===this||!(this instanceof e)){var s=Array.prototype.slice.call(arguments,0);if(!t)return null;if("function"==typeof t)return t.apply(t,s.slice(1));if("jsonp"===s[0]){var a=document.createElement("script");a.type="text/javascript",a.language="javascript",a.src=s[1],a.id=s[2];var l=document.getElementById(a.id);return null!=l&&document.head.removeChild(l),document.head.appendChild(a),null}if("object"===_typeof(r=t)&&(r="#"+t.id),i=null,n=document,o=!0,2<=s.length&&("boolean"==typeof s[1]?o=s[1]:i=s[1],3<=s.length&&("boolean"==typeof s[2]?o=s[2]:n=s[2]),4===s.length&&(o=s[3])),null!=i&&"object"===_typeof(i)&&(i.id||(i.id="sparrow_"+$.random()),r+="_"+i.id),$.global(r))return $.global(r);return"object"!==_typeof(t)&&-1==["#","!","$","&","*","+","^"].indexOf(t.substring(0,1))?n.getElementById(t):new e(t,i,n,o,r)}var c=[];if(this.selector=t,this.doc=n,"object"===_typeof(t))(c[0]=t).id||(t.id="sparrow_"+$.random()),this.selector="#"+t.id,r=this.selector;else if("string"==typeof t){var d=t.substring(0,1),h=(t=t.substring(1)).split("."),u=0;switch(d){case"#":c[0]=n.getElementById(t);break;case"^":c=n.getElementsByTagName(t);break;case"&":c=n.getElementsByName(t);break;case"+":c[0]=n.createElement(h[0]),2<=h.length?c[0].id=h[1]:c[0].id="sparrow_"+$.random(),this.selector="#"+h[1],r=this.selector,3<=h.length&&("doc"===h[2]?this.doc.body.appendChild(c[0]):this.doc.getElementById(h[2]).appendChild(c[0])),4<=h.length&&(c[0].type=h[3]);break;case"!":var f=[];i||(i=$(h[1]));var p=i.getElementsByTagName(h[0]);for("li"===h[0]&&(i=p[0].parentNode),(this.s=i).id||(i.id="sparrow_"+$.random()),u=0;u<p.length;u++)p[u].parentNode===i&&(f[f.length]=p[u]);c=f;break;case"$":var g=n.getElementsByTagName("label");for(u=0;u<g.length;u++)if(g[u].attributes.for.value===t){c[0]=g[u];break}break;case"*":var m=[],v=n.getElementsByName(h[0]),w=null;for(1<h.length&&(w=h[1]),u=0;u<v.length;u++)v[u].checked&&(m[m.length]=w?v[u].attributes[w].value:v[u].value);c=m}}return t&&((this.length=0)<c.length&&(this.s||(this.s=c[0]),this.s&&this.s.id&&o&&$.global(r,this)),[].push.apply(this,c)),this.interval=[],this},uc,vc,wc,xc,Cf,pf,bf,Qe,De,ve,ie,Wd,Hd,sd,Pc;window.$=window.Sparrow=Sparrow,Sparrow.browser={url:{manage:"default.jsp",logout_url:"/user/logout.json"},cookie:{permission:"permission",call_back_url:"call_back_url",website_name:"website_name",themes:"sparrow.themes",root_domain:$(function(){return window.location.host.substr(window.location.host.indexOf(".")+1)}),domain:window.location.host},ie:$(function(){return-1!==navigator.userAgent.search(/MSIE/gim)}),opera:$(function(){return-1!==navigator.userAgent.search(/Opera/gim)}),firefox:$(function(){return-1!==navigator.userAgent.search(/Firefox/gim)}),google:$(function(){return-1!==navigator.userAgent.search(/Chrome/gim)}),version:$(function(){return-1!==navigator.userAgent.search(/MSIE/gim)?(navigator.userAgent.match(/MSIE\b\s*([0-9\.0-9]+);/gim),RegExp.$1):-1!==navigator.userAgent.search(/Opera/gim)?(navigator.userAgent.match(/Version\/([0-9\.]+)/gim),RegExp.$1):-1!==navigator.userAgent.search(/Firefox/gim)?(navigator.userAgent.match(/Firefox\/([0-9\.]+)/gim),RegExp.$1):-1!==navigator.userAgent.search(/Chrome/gim)?(navigator.userAgent.search(/Chrome\/([0-9\.]+)/gim),RegExp.$1):void 0}),addFavorite:function(e,t){document.all?window.external.AddFavorite(e,t):window.sidebar?window.sidebar.addPanel(t,e,""):alert("对不起，您的浏览器不支持此操作!\n请您使用菜单栏或Ctrl+D收藏本站。")},setHome:function(e,t){try{e.style.behavior="url(#default#homepage)",e.setHomePage(t)}catch(e){if(window.netscape)try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"),Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch).setCharPref("browser.startup.homepage",t)}catch(e){alert("抱歉！您的浏览器不支持直接设为首页。请在浏览器地址栏输入“about:config”并回车然后将[signed.applets.codebase_principal_support]设置为“true”，点击“加入收藏”后忽略安全提示，即可设置成功。")}}},copy:function(e,t){t||(t="成功复制！可以通过ctrl+v进行粘贴操作！");try{if(window.clipboardData)return window.clipboardData.setData("Text",e),void alert(t);try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(e){return alert("您的浏览器设置为不允许复制！\n如果需要此操作，请在浏览器地址栏输入'about:config'并回车\n然后将'signed.applets.codebase_principal_support'设置为'true',再重试复制操作!"),!1}var i=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(!i)return;var n=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!n)return;n.addDataFlavor("text/unicode");var o=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);o.data=e,n.setTransferData("text/unicode",o,e.getByteLength());var r=Components.interfaces.nsIClipboard;if(!i)return!1;i.setData(n,null,r.kGlobalClipboard),alert(t)}catch(e){alert("对不起！您的浏览器不支持该功能")}},setCookie:function(e,t,i,n,o,r){var s=null;0!==i&&i&&(s=new Date).setTime(s.getTime()+1e3*i),document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+(s?"; expires="+s.toGMTString():"")+"; path="+(o||"/")+"; domain="+(n||this.cookie.root_domain)+(r?"; secure":"")},getCookie:function(e){var t=null,i=document.cookie.indexOf(escape(e)+"=");if(-1!==i){var n=i+(escape(e)+"=").length,o=document.cookie.indexOf(";",n);t=-1!==o?decodeURIComponent(document.cookie.substring(n,o)):decodeURIComponent(document.cookie.substring(n))}return null==t||void 0===t||"undefined"===t?null:t},showModalDialog:function(e,t,i,n,o){var r;i=$.randomUrl(i),(r=$.browser.ie?window.showModalDialog(i,o,"dialogHeight:{0}px; dialogWidth:{1}px; status:no; help:no; scroll:auto".format(t,e)):window.open(i,o,"height={0}, width={1},toolbar= no, menubar=no, scrollbars=auto, resizable=no, location=no, status=no,top=100,left=300".format(t,e)))&&n(r)},window:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(e){var t=$.randomUrl(e.url);e.win||(e.win=window);var i=e.target?e.target:"_blank",n=null;$.isNullOrEmpty(e.width)&&(n="height={0}px,width={1}px,toolbar= no, menubar=no, scrollbars=auto, resizable=no, location=no, status=no,top=100,left=300".format(e.height,e.width)),e.win.open(t,i,n)}),close:function(){window.opener=null,window.open("about:blank","_self"),window.close()},getUrlWithoutParameter:function(e){var t=e||window.location.href,i=t.indexOf("?");return i<0&&(i=t.indexOf("#")),-1<i&&(t=t.substring(0,i)),t},getUserId:function(){var e=$.browser.getCookie(this.cookie.permission);return null==e?0:e.split("&")[0].substring("id=".length)},getUserName:function(){var e=$.browser.getCookie(this.cookie.permission);return null==e?null:e.split("&")[1].substring("name=".length)},isLogin:function(){var e=$.browser.getUserId();return!(null==e||0===e||"0"===e||"null"===e||""===e)},logout:function(i,e,n){$.isNullOrEmpty(e)&&(e=this.url.logout_url),$.isNullOrEmpty(n)&&(n=this.url.manage),$.ajax.json($.url.root+e,function(e){var t=e.value;$.isNullOrEmpty(t)&&(t=$.browser.cookie.permission),$.browser.setCookie(t,"0",-1,i),$.url.root+"/"===window.parent.location.href||-1!==window.parent.location.href.indexOf(n)?window.parent.location.href=$.url.root:window.location.href=window.location.href},!0)},getClientHeight:function(){return document.body.clientHeight&&document.documentElement.clientHeight?Math.min(document.body.clientHeight,document.documentElement.clientHeight):Math.max(document.body.clientHeight,document.documentElement.clientHeight)},getScrollHeight:function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)},linkClick:function(e,t){return"boolean"==typeof e?!!e||($.alert(t,"sad"),!1):"javascript:void(0);"!==e.href||($.alert(t,"sad"),!1)}},Sparrow.container={},Sparrow.global=function(e,t){if(void 0===t)return this.container[e];this.container[e]=t},Sparrow.remove=function(e){delete this.container[e]},uc=!(!window.attachEvent||window.opera),vc=/webkit\/(\d+)/i.test(navigator.userAgent)&&RegExp.$1<525,wc=[],xc=function(){for(var e=0;e<wc.length;e++)wc[e]()},document.ready=function(e){if(!uc&&!vc&&document.addEventListener)return document.addEventListener("DOMContentLoaded",e,!1);if(!(1<wc.push(e)))if(uc)!function(){try{document.documentElement.doScroll("left"),xc()}catch(e){setTimeout(arguments.callee,0)}}();else if(vc){var t=null;t=setInterval(function(){/^(loaded|complete)$/.test(document.readyState)&&(clearInterval(t),xc())},0)}},Sparrow.url={root:$(function(){}),_resource:function(e){var n=document.scripts,o=["/scripts/sparrow.js","/scripts/sparrow-min.js","/scripts-dev/sparrow.js"];if(e&&(o=[e]),null==n||0===n.length)return null;for(var r=null,s=0;s<n.length;s++){var a=!1;if(o.forEach(function(){for(var e=0;e<o.length;e++){var t=o[e],i=n[s].src.indexOf(t);-1<i&&(r=n[s].src.substring(0,i),a=!0)}}),a)break}return r},name:$.browser.cookie.domain.split(".")[0]},Sparrow.url.resource=$.url._resource(),Sparrow.url.passport=$(function(){return"http://passport."+$.browser.cookie.root_domain}),Sparrow.website={name:$.browser.getCookie($.browser.cookie.website_name),themes:$(function(){var e=$.browser.getCookie($.browser.cookie.themes);return null==e&&(e="themes_default"),e})},Sparrow.css={menu:{frame:"background:#ffffff;position:absolute;z-index:1000;border:#ccc 1px solid;width:{0}px;height:auto;left:{1}px;top:{2}px;display:none",ul:"width:{0}px;height:auto;overflow:hidden;list-style:none;margin:0px;padding:0px;text-align:left",li:"width:{0}px;overflow:hidden;line-height:20px;margin:0px;border-bottom:#ccc 1px dotted;cursor:pointer;"}},Sparrow.SIDE="SIDE",Sparrow.HORIZONTAL="HORIZONTAL",Sparrow.VERTICAL="VERTICAL",Sparrow.DEFAULT_AVATOR_URL=$.url.resource+"/images/user.png",Sparrow.DEFAULT_RESOURCE_ICO_URL=$.url.resource+"/images/menu.png",Sparrow.indexedDB=function(e){this.support=window.indexedDB,this.instance=null,this.name=e.name,this.config=e,this.userId=localStorage.getItem("userId"),this.initSuccess=!1,this.$initDB=null},Sparrow.indexedDB.prototype={init:(Pc=_asyncToGenerator(regeneratorRuntime.mark(function e(){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.support){e.next=2;break}return e.abrupt("return",this.support);case 2:return this.request=window.indexedDB.open(this.name+this.userId,this.config.version),e.next=5,new Promise(function(n,o){r.request.onsuccess=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.instance=t.target.result,console.log("数据库连接成功"),e.next=4,r.flush();case 4:if(i=e.sent,console.log("数据库flush结果",i),!i){e.next=15;break}if(r.initSuccess=!0,console.log("数据库flush成功"),r.$dbInit)return e.next=12,r.$dbInit();e.next=12;break;case 12:n(r.instance),e.next=16;break;case 15:o("数据库连接失败");case 16:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),r.request.onupgradeneeded=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("首次创建数据库"),r.instance=t.target.result,r._initTables(),r.$dbInit)return e.next=6,r.$dbInit();e.next=6;break;case 6:r.initSuccess=!0,n(r.instance);case 8:case"end":return e.stop()}},e,this)}));return function(e){return t.apply(this,arguments)}}(),r.request.onerror=function(e){console.log("数据库发生错误",e),o("连接indexedDB出错")}});case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)})),function(){return Pc.apply(this,arguments)}),_createTable:function(e,t){this.instance.createObjectStore(e,{keyPath:t})},_initTables:function(){var t=this;this.config.tableNames.forEach(function(e){t._createTable(e.name,e.key)})},_getTableInstance:function(e){return this.instance.transaction(e,"readwrite").objectStore(e)},put:(sd=_asyncToGenerator(regeneratorRuntime.mark(function e(n,o){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.support){e.next=2;break}return e.abrupt("return",this.support);case 2:if(this.initSuccess){e.next=5;break}return e.next=5,this.init();case 5:return e.next=7,new Promise(function(t,i){var e=r._getTableInstance(n).put(o);e.onsuccess=function(e){console.log("put success: TABLE-NAME"+n+" item "+o),t(e.target.result)},e.fail=function(e){i(e.target.result)}});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})),function(e,t){return sd.apply(this,arguments)}),get:(Hd=_asyncToGenerator(regeneratorRuntime.mark(function e(n,o){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.support){e.next=2;break}return e.abrupt("return",this.support);case 2:if(this.initSuccess){e.next=5;break}return e.next=5,this.init();case 5:return e.next=7,new Promise(function(t,i){console.log("GET tableName "+n+", get key:"+o);var e=r._getTableInstance(n).get(o);e.onsuccess=function(e){t(e.target.result)},e.fail=function(e){i(e.target.result)}});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})),function(e,t){return Hd.apply(this,arguments)}),delete:(Wd=_asyncToGenerator(regeneratorRuntime.mark(function e(n,o){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.support){e.next=2;break}return e.abrupt("return",this.support);case 2:if(this.initSuccess){e.next=5;break}return e.next=5,this.init();case 5:return e.next=7,new Promise(function(e,t){var i=r._getTableInstance(n).delete(o);i.onsuccess=function(){console.log("delete success: TABLE-NAME"+n+" ,key "+o),e("tableName "+n+" ,key "+o)},i.fail=function(e){t(e)}});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})),function(e,t){return Wd.apply(this,arguments)}),clear:(ie=_asyncToGenerator(regeneratorRuntime.mark(function e(n){var o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.support){e.next=2;break}return e.abrupt("return",this.support);case 2:return e.next=4,new Promise(function(t,i){var e=o._getTableInstance(n).clear();e.onsuccess=function(e){console.log("clear success: TABLE-NAME",n),t(e.target.result)},e.fail=function(e){i(e.target.result)}});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)})),function(e){return ie.apply(this,arguments)}),flush:(ve=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.support){e.next=2;break}return e.abrupt("return",this.support);case 2:t=0;case 3:if(t<this.config.tableNames.length)return i=this.config.tableNames[t].name,e.next=7,this.clear(i).then(function(){console.log("clear success: TABLE-NAME",i)}).catch(function(e){console.log(e)});e.next=10;break;case 7:t++,e.next=3;break;case 10:return console.log("flush all table success"),e.abrupt("return",!0);case 12:case"end":return e.stop()}},e,this)})),function(){return ve.apply(this,arguments)}),getAll:(De=_asyncToGenerator(regeneratorRuntime.mark(function e(n){var o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.support){e.next=2;break}return e.abrupt("return",this.support);case 2:if(this.initSuccess){e.next=5;break}return e.next=5,this.init();case 5:return e.next=7,new Promise(function(t,i){var e=o._getTableInstance(n).getAll();e.onsuccess=function(e){console.log("getAll success: TABLE-NAME",n),t(e.target.result)},e.fail=function(e){i(e.target.result)}});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})),function(e){return De.apply(this,arguments)}),getAllKeys:(Qe=_asyncToGenerator(regeneratorRuntime.mark(function e(n){var o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.support){e.next=2;break}return e.abrupt("return",this.support);case 2:if(this.initSuccess){e.next=5;break}return e.next=5,this.init();case 5:return e.next=7,new Promise(function(t,i){var e=o._getTableInstance(n).getAllKeys();e.onsuccess=function(e){console.log("getAllKeys success: TABLE-NAME:",n+" ,keys:",e.target.result),t(e.target.result)},e.fail=function(e){i(e.target.result)}});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})),function(e){return Qe.apply(this,arguments)}),count:(bf=_asyncToGenerator(regeneratorRuntime.mark(function e(n){var o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.support){e.next=2;break}return e.abrupt("return",this.support);case 2:if(this.initSuccess){e.next=5;break}return e.next=5,this.init();case 5:return e.next=7,new Promise(function(t,i){var e=o._getTableInstance(n).count();e.onsuccess=function(e){console.log("count success: TABLE-NAME",n),t(e.target.result)},e.fail=function(e){i(e.target.result)}});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})),function(e){return bf.apply(this,arguments)}),openCursor:(pf=_asyncToGenerator(regeneratorRuntime.mark(function e(n){var o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.support){e.next=2;break}return e.abrupt("return",this.support);case 2:if(this.initSuccess){e.next=5;break}return e.next=5,this.init();case 5:return e.next=7,new Promise(function(t,i){var e=o._getTableInstance(n).openCursor();e.onsuccess=function(e){console.log("openCursor success: TABLE-NAME.",n),t(e.target.result)},e.fail=function(e){i(e.target.result)}});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})),function(e){return pf.apply(this,arguments)}),openKeyCursor:(Cf=_asyncToGenerator(regeneratorRuntime.mark(function e(n){var o=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.support){e.next=2;break}return e.abrupt("return",this.support);case 2:if(this.initSuccess){e.next=5;break}return e.next=5,this.init();case 5:return e.next=7,new Promise(function(t,i){var e=o._getTableInstance(n).openKeyCursor();e.onsuccess=function(e){console.log("openKeyCursor success:TABLE-NAME",n),t(e.target.result)},e.fail=function(e){i(e.target.result)}});case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)})),function(e){return Cf.apply(this,arguments)})},Sparrow.ajax={tokenConfig:{},_objPool:[],referWindow:window,url:null,srcElement:null,SUCCESS:"0",_bindReadyStateChange:function(t,i){t.onreadystatechange=function(){if(4===t.readyState){if(200===t.status){if(-1!==t.responseText.indexOf('"login":false')){console.log("login false");var e=t.responseText.json();return document.domain=$.browser.cookie.root_domain,void(e.inFrame?window.parent.location.href=e.url:$.window(e))}if(-1!==t.responseText.indexOf("Access Denied"))return lang.message.accessDenied||(lang.message.accessDenied="Access Denied"),void $.alert(lang.message.accessDenied,"sad");if(i)return void i(t.responseText)}404!==t.status?500!==t.status?12031!==t.status?console.log(t.status+":未知错误"):console.log("服务器未启动"):console.log("服务器错误"):console.log("资源未找到")}}},_getInstance:function(){for(var e=0;e<this._objPool.length;e+=1)if(0===this._objPool[e].readyState||4===this._objPool[e].readyState)return this._objPool[e];return this._objPool[this._objPool.length]=this._createObj(),this._objPool[this._objPool.length-1]},_createObj:function(){var t=null;if(window.XMLHttpRequest)return(t=new XMLHttpRequest).overrideMimeType&&t.overrideMimeType("text/xml"),t;if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}else console.log("浏览器不支持AJAX,请设置浏览器安全级别或更新浏览器");return t},_callback:function(e){var t=e.json();null!=t?t.code!==this.ajax.SUCCESS&&$.message(t.message):$.message("json parse error "+e)},gourl:function(e){this.ajax.referWindow.location.href=e},_findToken:function(e){var t=null;for(var i in this.tokenConfig)if(0===e.indexOf(i)){t=this.tokenConfig[i];break}return t},req:function(e,t,i,n,o){-1===t.indexOf("http://")&&(t=$.url.root+t);var r=this._getInstance();null!=r&&this._bindReadyStateChange(r,i),o&&(this.srcElement=o);try{r.open(e,t,!0),r.setRequestHeader("ajax","true"),r.setRequestHeader("pragma","no-cache"),r.setRequestHeader("cache-control","no-cache");var s=this._findToken(t);if(s)for(var a in s)r.setRequestHeader(a,s[a]());if("GET"===e)return void r.send(null);if("object"===_typeof(n))return r.setRequestHeader("Content-Type","application/json"),void r.send(JSON.stringify(n));if(!n)return void r.send();n=n.replace(/%/g,"%25"),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.send(n)}catch(e){console.log(e)}},json:function(e,t,i,n,o){"function"==typeof t&&(i=t,t=null),$.ajax.req("POST",e,function(e){var t=e.json();null!=t?t.code===$.ajax.SUCCESS&&i?i(t):$.message(t.message,$.ajax.srcElement):$.message("json parse error "+e)},t,n,o)},get:function(e,t){t=t||$.ajax._callback,$.ajax.req("GET",e,t,null,null)},post:function(e,t,i){i=i||$.ajax._callback,$.ajax.req("POST",e,i,t,null)}},Sparrow.v={background_color:"#fff",empty_string:"",index:null,right_message:'<img alt="" src="'+$.url.resource+"/images/"+$.website.themes+'/succeed.gif"/>',reset:function(){$.v.index=null},getErrorLabel:function(e){return e.errorCtrlId?$(e.errorCtrlId.join($.v.index)):null},initPlaceholder:function(e){for(var t in e){var i=e[t],n=$(t);null!=n&&"text"===n.type&&(n.placeholder=i.prompt)}},_setBackground:function(e,t,i){if(i&&!1!==$.v.background_color){t||(t=$.v.background_color);var n=e.parentLevel;if(void 0===n&&(n=1),0<n){var o=i;if(null==o)return;try{for(;"TR"!==o.tagName.toUpperCase()&&"line"!==o.className&&"validate"!==o.className;)o=o.parentNode;o.style.background=t}catch(e){}var r=this.getErrorLabel(e);null!=r&&(r.className="front")}}},showMessage:function(e,t){e=e[t.id];var i=this.getErrorLabel(e);i&&(i.className="prompt",i.innerHTML=e.prompt),this._setBackground(e)},ok:function(e,t){var i=this.getErrorLabel(e);return i&&(i.innerHTML=this.right_message,i.className="prompt"),this._setBackground(e,"#ffffff",t),t&&(t.style.backgroundColor="#ffffff",""===t.value&&e.defaultValue&&(t.value=e.defaultValue)),!0},fail:function(e,t){t||(t=e.setError);var i=this.getErrorLabel(e);return i&&(i.innerHTML="!"+t,i.className="error"),"!"+t},_validate:function(e,t){this._setBackground(e,"#ffffff",t);var i=t.value.trim(),n=this.getErrorLabel(e),o="SELECT"===t.tagName.toUpperCase()&&!0===t.multiple?t.options.length:i.getByteLength();return 0===o&&e.allowNull?this.ok(e):0===o&&void 0!==e.defaultValue?(t.value=e.defaultValue,this.ok(e)):0!==o||e.allowNull?e.maxLength&&o>e.maxLength||e.minLength&&o<e.minLength?this.fail(e,e.lengthError):!n||"error"!==n.className||n.innerHTML!=="!"+e.setError||this.fail(e):this.fail(e,e.nullError)},isUserNameRule:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/^[a-zA-Z0-9_]{6,20}$/)?this.fail(e,e.nameRuleError):this.ok(e,t)},isEmail:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/)?this.fail(e,e.emailError):this.ok(e,t)},isTel:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/)?this.fail(e,e.telError):this.ok(e,t)},isMobile:function(e,t){(e=e[t.id]).minLength=11,e.maxLength=11;var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/^1[\d]{10}$/)?this.fail(e,e.mobileError):this.ok(e,t)},isIdCard:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/^([1-9]([0-9]{16}|[0-9]{13})([0-9]|x|X))$/)?this.fail(e,e.idCardError):this.ok(e,t)},isNull:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:this.ok(e,t)},isChineseCharacters:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:e.allowNull||-1!==t.value.search(/^[\u4e00-\u9fa5]+/)?this.ok(e,t):this.fail(e,e.chineseCharactersError)},isEqual:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:t.value!==$(e.otherCtrlId.join($.v.index)).value.trim()?this.fail(e,e.noEqualError):this.ok(e,t)},allowInputOption:function(e,t){(e=e[t.id]).defaultValue||(e.defaultValue=e.options[0]);for(var i=0;i<e.options.length&&t.value!=e.options[i];i++);i==e.options.length&&(t.value=e.defaultValue),this.ok(e,t)},isDigital:function(e,t){e=e[t.id];var i=t.value,n=this._validate(e,t);if(!0!==n)return n;if(isNaN(i))return this.fail(e,e.digitalError);var o=parseFloat(i),r=e.minValue||0===e.minValue,s=e.maxValue||0===e.maxValue;if(r&&o<e.minValue||s&&o>e.maxValue)return this.fail(e,e.digitalError);this.ok(e,t)},isImgSize:function(e,t){var i=e.value.split("*");2===i.length&&-1!==i[0].search(/^[0-9]+.?[0-9]$/)&&-1!==i[1].search(/^[0-9]+.?[0-9]$/)||(e.value=t)},isFileLength:function(e,t){-1===e.value.toUpperCase().indexOf("M")?-1===e.value.toUpperCase().indexOf("K")?e.value=t:-1!==e.value.toUpperCase().split("K")[0].search(/^[0-9]+.?[0-9]$/)?e.value=e.value.toUpperCase().split("K")[0]+"KB":e.value=t:-1!==e.value.toUpperCase().split("M")[0].search(/^[0-9]+.?[0-9]$/)?e.value=e.value.toUpperCase().split("M")[0]+"MB":e.value=t},updateTxtCount:function(e,t,i,n){var o=$(t);if((n=n||window.event).keyCode<37||40<n.keyCode){var r=i-e.value.getByteLength();r<=0?(o.innerHTML=0,e.value=e.value.subString(i,!1)):o.innerHTML=r}},getValidateResult:function(e,t){var i=[];for(var n in e){var o=e[n];if(o&&"object"===_typeof(o)){var r=null,s=$(n);if(s){var a=this.getErrorLabel(o);a&&"error"===a.className&&(r=a.innerHTML),$.isNullOrEmpty(r)&&(r=$.v.isNull(e,s)),$.v.validate&&(r=$.v.validate()),!0===r||$.isNullOrEmpty(r)||i.push(r)}}}if(0<i.length)return $.message(i.join("<br/>")),!1;if(!1!==t)if("string"==typeof t||void 0===t)$.submit(t);else if("function"==typeof t)t(this);else if("object"===_typeof(t)&&"hidden"===t.s.type){var l=t.attr("new");$.isNullOrEmpty(t.value())||(l=t.attr("update")),$.submit(l)}return!0},init:function(e){for(var t in e){var i=$("#"+t),n=e[t],o=n.event;switch(i.bind("onfocus",function(){$.v.showMessage(e,this)}),o){case"UserNameRuleValidator":i.bind("onblur",function(){$.v.isUserNameRule(e,this)});break;case"AllowOptionsValidator":i.bind("onblur",function(){$.v.isNull(e,this)});break;case"DigitalValidator":i.bind("onblur",function(){$.v.isDigital(e,this)});break;case"EmailValidator":i.bind("onblur",function(){$.v.isEmail(e,this)});break;case"NullValidator":i.bind("onblur",function(){$.v.isNull(e,this)});break;case"EqualValidator":i.bind("onblur",function(){$.v.isEqual(e,this)});break;case"IdCardValidator":i.bind("onblur",function(){$.v.isIdCard(e,this)});break;case"MobileValidator":i.bind("onblur",function(){$.v.isMobile(e,this)});break;case"TelValidator":i.bind("onblur",function(){$.v.isTel(e,this)});break;case"ChineseCharactersValidator":i.bind("onblur",function(){$.v.isChineseCharacters(e,this)});break;case"AllowInputCharLengthValidator":var r=n;$("#"+r.maxCharLengthControlId).html(r.maxAllowCharLength),i.bind("onblur",function(){$.v.allowInputOption(e,this)}),i.bind("onkeyup",function(){$.v.updateTxtCount(this,r.allowCharLengthShowControlId,500)})}}}},Sparrow.page={toTargetPage:function(e,t,i){var n=parseInt($("consumerPageIndex").value),o=parseInt($("spanCurrentPageIndex").innerHTML.trim());n<=0||e<n?$.message("超出页码范围",i):n!==o?window.location.href=t.replace("$pageIndex",n):$.message("当前页即是目标页",i)},consumerAction:null,submit:function(e,t){$("currentPageIndex").value=e,window.location.href="#top",null==this.consumerAction?$.submit(null,t):this.consumerAction(e)},next:function(){for(var e=$("divPage").getElementsByTagName("a"),t=null,i=0;i<e.length;i++)if("下一页"===e[i].innerHTML){t=e[i].href;break}$.isNullOrEmpty(t)?alert("亲，您已经翻到最后了哟"):window.location.href=t}},Sparrow.random=function(){return(Math.random()+"").substring(2)},Sparrow.randomUrl=function(e){return-1!==e.indexOf("t=")&&(e=e.substr(0,e.indexOf("t=")-1)),-1!==e.indexOf("?")?e+="&t="+Math.random():e+="?t="+Math.random(),e},Sparrow.request=function(e){return new RegExp("(^|\\?|&)"+e+"=([^&]*)(\\s|&|$)","i").test(location.href)?unescape(RegExp.$2.replace(/\+/g," ")):""},Sparrow.isNullOrEmpty=function(e){return null==e||void 0===e||"string"==typeof e&&(""===e.trim()||"null"===e.trim())},Sparrow.toString=function(e,t){return t||(t=""),$.isNullOrEmpty(e)?t:e},Sparrow.countDown=function(e,t,i){var n=e-t,o=Math.floor(n/1e3/60/60/24),r=Math.floor(n/1e3/60/60%24),s=Math.floor(n/1e3/60%60),a=Math.floor(n/1e3%60);i.value=(0<o?o+"天":"")+(0<r?r+"时":"")+(0<s?s+"分":"")+(a<0?0:a)+"秒";var l=arguments.callee;(0<o||0<r||0<s||0<a)&&setTimeout(function(){l(e,t+1e3,i)},1e3)},Sparrow.getBeforeTime=function(e){e=new Date(e).valueOf();var t=(new Date).valueOf(),i=[{name:"秒",split:60},{name:"分钟",split:60},{name:"小时",split:24},{name:"天",split:30},{name:"月",split:12},{name:"年",split:100}];return $(function(e,t){return e/i[t].split<1?(parseInt(e)<0?1:parseInt(e))+i[t].name:arguments.callee(e/i[t].split,++t)},(t-e)/1e3,0)},Sparrow.submit=function(e,t){t=t||0,e&&(document.forms[t].action=e),document.forms[t].submit()},Sparrow.jsonKeys=function(e){var t=[];if(!e)return t;if(void 0!==e.length)return e;for(var i in e)t.push(i);return t},Sparrow.clearForm=function(e){for(var t=$.jsonKeys(e),i=0;i<t.length;i++){var n=$(t[i]);if(null!=n){var o="";e[t[i]]&&(o=e[t[i]].defaultValue),n.value=$.toString("",o)}else console.log(t[i]+" not exist!")}},Sparrow.getFormData=function(e){for(var t=[],i=$.jsonKeys(e),n=0;n<i.length;n++){var o=$(i[n]);if(null!=o){if(!$.isNullOrEmpty(o.name)){var r=o.value;t.push(o.name+"="+r)}}else console.log(i[n]+" not exist!")}return t.join("&")},Sparrow.waitRedirect=function(e,t){var i=$("#hdnQueryString").value(),n=$("#"+e);if(null!=n&&null!=n.s){t||(t=1e3);var o=window.setInterval(function(){var e=parseInt(n.html(),10);0==e--?(window.location.target="_self",window.location.href=i,window.clearInterval(o)):n.html(e)},t)}},Sparrow.format=function(txt,compress){var indentChar="    ";if("string"!=typeof txt||!/^\s*$/.test(txt)){var data=null;if("object"===_typeof(txt))data=txt;else try{data=eval("("+txt+")")}catch(e){return void alert("数据源语法错误,格式化失败! 错误信息: "+e.description,"err")}var draw=[],last=!1,This=this,line=compress?"":"\n",nodeCount=0,maxDepth=0,notify=function e(t,i,n,o,r){nodeCount++;for(var s=0,a="";s<o;s++)a+=indentChar;if(a=compress?"":a,maxDepth=++o,i&&i.constructor===Array){draw.push(a+(r?'"'+t+'":':"")+"["+line);for(s=0;s<i.length;s++)e(s,i[s],s===i.length-1,o,!1);draw.push(a+"]"+(n?line:","+line))}else if(i&&"object"===_typeof(i)){draw.push(a+(r?'"'+t+'":':"")+"{"+line);var l=0;s=0;for(var c in i)l++;for(var c in i)e(c,i[c],++s===l,o,!0);draw.push(a+"}"+(n?line:","+line))}else"string"==typeof i&&(i='"'+i+'"'),draw.push(a+(r?'"'+t+'":':"")+i+(n?"":",")+line)},isLast=!0,indent=0;return notify("",data,isLast,indent,!1),draw.join("")}alert("数据为空,无法格式化! ")},Sparrow.bind=function(n,o,r){return function(e){if(-1<o.indexOf("|"))for(var t=o.split("|"),i=0;i<t.length;i++)r?n[t[i]](r,e):n[t[i]](e);else r?n[o](r,e):n[o](e)}},Sparrow.prototype.each=function(e){for(var t=0,i=this.length;t<i;t++)e.call(this[t],t,this)},Sparrow.prototype.attr=function(e,t){if(this.s){if($.isNullOrEmpty(t)){var i=this.s.attributes[e];return i?i.value:this.s.getAttribute(e)}this.s.setAttribute(e,t)}},Sparrow.prototype.html=function(e){if(this.s){if($.isNullOrEmpty(e))return this.s.innerHTML;this.s.innerHTML=e}},Sparrow.prototype.format=function(e,t){this.s&&(null!=$(e)&&(e=$("#"+e).html()),this.s.innerHTML=e.format(t))},Sparrow.prototype.value=function(e){if(this.s)return null==e?this.s.value:void(this.s.value=e)},Sparrow.prototype.check=function(e){for(var t=0;t<this.length;t++)if(this[t].value===e){this[t].checked="checked";break}},Sparrow.prototype.opacity=function(e){if(0<=e)return this.s.style.filter="alpha(opacity="+e+")",this.s.style.opacity=e/100,void this.s.setAttribute("opacity",e);var t=this.s.attributes.opacity;return t?t.value:100},Sparrow.prototype.bind=function(e,t){this.s&&(this.s.attachEvent?this.s.attachEvent(e,t):this.s.addEventListener(e.substring(2),t,!1))},Sparrow.prototype.getAbsoluteTop=function(){for(var e=this.s,t="string"==typeof e?$(e):e,i=t.offsetTop;null!=(t=t.offsetParent);)i+=t.offsetTop;return i},Sparrow.prototype.getAbsoluteLeft=function(){for(var e=this.s,t="string"==typeof e?$(e):e,i=t.offsetLeft;null!=(t=t.offsetParent);)i+=t.offsetLeft;return i},Sparrow.prototype.source=function(){return this.s},Sparrow.prototype.class=function(e){if(!e)return this.s.className;this.s.className=e},Sparrow.prototype.css=function(attribute,value,add){if(Math.abs(value)<1&&(value=value<0?-1:1),"opacity"===attribute)value=Math.ceil(value),add&&(value=parseInt(this.opacity(),10)+value),this.opacity(value);else{var command=null;add?(command='var o=parseInt($("'+this.s.id+'").style.'+attribute+",10);",command+='$("'+this.s.id+'").style.'+attribute+"=(o+"+value+')+"px";'):command='$("'+this.s.id+'").style.'+attribute+'="'+value+'"',eval(command)}return this},Sparrow.prototype.change_check_box_class=function(e,t,i,n){var o=this.s.className;n||(n="_");var r=o.split(n);return i||(i="check"),t||(t=r.length),e?o.indexOf(i)<0&&(r.splice(t,0,i),this.s.className=r.join(n)):0<=o.indexOf(i)&&(r.splice(t,1),this.s.className=r.join(n)),r.splice(t,r.length-t+1),r.join(class_split)},Sparrow.prototype.contains=function(e){for(;null!=e&&void 0!==e.tagName;){if(e===this.s)return!0;e=e.parentNode}return!1},Sparrow.prototype.remove=function(){null!=this&&null!=this.s&&(this.doc.body.removeChild(this.s),this.s=null)},Sparrow.prototype.fix=function(e,t){if(this.s){var i=this.s.offsetWidth;t||(t=this.getAbsoluteLeft()),$.browser.ie&&"6.0"===$.browser.version?(this.doc.documentElement.style.backgroundImage="url(about:blank)",this.doc.documentElement.style.backgroundAttachment="fixed",this.doc.body.style.backgroundImage="url(about:blank)",this.doc.body.style.backgroundAttachment="fixed",this.s.style.position="absolute"):this.s.style.position="fixed",this.s.style.top=e+"px",this.s.style.left=t+"px",this.s.style.width=i+"px"}},Sparrow.prototype.center=function(){if(this.s){var e=(this.doc.body.clientWidth-this.s.offsetWidth)/2,t=this.doc.documentElement.clientHeight>screen.availHeight?screen.availHeight:this.doc.documentElement.clientHeight,i=64+parseInt((t-161-this.s.offsetHeight)/2);this.fix(i,e)}},Sparrow.prototype.loadComplete=function(e){if("IFRAME"===this.s.tagName.toUpperCase())this.s.onload=function(){e(this)};else if("IMG"===this.s.tagName.toUppperCase()){if($.browser.ie)return void(this.s.onreadystatechange=function(){"complete"!==this.s.readyState&&"loaded"!==this.s.readyState||e(this)});this.s.onload=function(){!0===this.s.complete&&e(this)}}},Sparrow.prototype.parent=function(){return $(this.s.parentNode)},Sparrow.prototype.fresh=function(e){$.isNullOrEmpty(this.s.src)&&(this.s.src=e),this.s.src=$.randomUrl(this.s.src)},Sparrow.prototype.enter=function(t){this.s.onkeydown=function(e){13===(e=window.event||e).keyCode&&("string"!=typeof t?t():$(t).onclick(e))}};var _hmt=_hmt||[];function getImgContainer(e,t,i){var n=[],o=$("+div"),r=$.file.getFileName(e).split(".")[0];return o.s.className="",o.s.style.cssText="width:92px;height:90px;float:left;padding:3px;border:#ccc 2px solid;",n.push('<a target="_blank" href="{0}" title="{1}"><img style="width:91px;height:67px;" src="{2}"/></a>'.format(e,$.file.getFileName(t),e)),n.push('<br/><a href="javascript:void(0);" target="_self" onclick="'+i.fullObjName+".attach.deleteOnServer('"+r+'\',this);">删除</a>｜<a href="javascript:void(0);" target="_self" onclick="'+i.fullObjName+".attach.insertEditor('"+$.file.getFileName(t)+"','"+e+'\');">插入</a><input type="hidden" name="'+i.config.attach.fileUUID+'" value="'+r+'"/>'),o.s.innerHTML=n.join(""),o.s}function clearHtmlFrame(){for(var e=0;e<$.editor.editorArray.length;e++)$.editor.editorArray[e].config.currentHtmlId&&(document.getElementById($.editor.editorArray[e].config.currentHtmlId).style.display="none",$.editor.editorArray[e].config.currentHtmlId=null,$.editor.editorArray[e].clear())}return function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?11daae2d559a82e0e8bd4872ad217164";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),Sparrow.prototype.tabs=function(e){e||(e={});var n=e.withIndexClass,t=e.index,i=$("!div."+this.s.id),o=i[0],r=$("!li",o),s=i[1],a=$("!div",s),l=function(t){var e=$("!a",r[t])[0],i=$(e).attr("rev");i&&($("!a",r[r.length-1])[0].href=i);a.each(function(e){if(n&&(r[0].className="pure-menu-item pure-menu-heading"),e==t)return r[e].className="pure-menu-item pure-menu-selected",void(this.className="block");r[e].className="pure-menu-item",this.className="none"})};r.each(function(e){$(this).attr("tab_index",e),0<this.className.indexOf("close")||0<this.className.indexOf("more")||$(this).bind("onclick",function(){var e=$(this).attr("tab_index");l(e)})}),t&&l(t)},Sparrow.win={config:{isInFrame:!1,showHead:!0,titleHeight:45,currentWindow:window,bgsound:$.url.resource+"/media/sound.wav",titleImg:$.url.resource+"/images/"+$.website.themes+"/panel.gif",closeBtnImg:$.url.resource+"/images/"+$.website.themes+"/panel.gif",OKBtnImg:$.url.resource+"/images/"+$.website.themes+"/panel.gif",smileImg:$.url.resource+"/images/"+$.website.themes+"/smile.gif",sadImg:$.url.resource+"/images/"+$.website.themes+"/sad.gif",lockImg:$.url.resource+"/images/"+$.website.themes+"/lock.gif",waitImg:$.url.resource+"/images/"+$.website.themes+"/loading.gif",askImg:$.url.resource+"/images/"+$.website.themes+"/smile.gif",tagArray:["select","object"],jalert:{height:"auto",width:"250px",closeCallBack:function(){}},dialog:{descContainer:null}},getWindow:function(){return this.config.isInFrame?window.parent:window},getScrollTop:function(){return this.getWindow().pageYOffset||this.getWindow().document.documentElement.scrollTop||this.getWindow().document.body.scrollTop},addSound:function(){$("+bgsound.sound.doc",null,this.getWindow().document).s.src=this.config.bgsound},addBackDiv:function(){var e=$("+div.backDiv.doc",null,this.getWindow().document),t=Math.max(this.getWindow().document.body.scrollHeight,this.getWindow().document.documentElement.scrollHeight);e.s.zIndex=1e3,e.opacity(80),e.s.style.position="absolute",e.s.style.width=e.doc.body.offsetWidth+"px",e.s.style.height=t+"px",e.s.style.left="0px",e.s.style.top="0px",e.s.style.backgroundColor="#000000"},addMsgDialog:function(e,t){e||(e=this.config.jalert.width),t||(t=this.config.jalert.height);var i=$("+div.dialog.doc",null,this.getWindow().document);i.s.className="modal",i.s.zIndex=1001,i.s.style.width=e,i.s.style.height=t},addPanel:function(e){var n=$("+div.dialog.doc",null,this.getWindow().document);n.s.zIndex=1001,!(n.s.style.cssText="position:absolute;text-align:center;font-size: 10pt;background:white;")!==this.config.showHead&&this.addTitle(),this.addRightClose();var o=$("+iframe.panel.dialog",null,n.doc);o.s.setAttribute("frameborder","0",0),o.s.scrolling="no",o.s.src=e,o.loadComplete(function(e){var t=parseInt(e.contentWindow.document.body.style.width,10),i=parseInt(e.contentWindow.document.body.style.height,10);o.s.style.width=t-4+"px",o.s.style.height=i-($.win.config.showHead?$.win.config.titleHeight:0)-5+"px",n.s.style.width=t+"px",n.s.style.height=i+"px",$("#dialog",null,n.doc).center(),!1!==$.win.config.showHead&&($("#divleft",null,n.doc).s.innerHTML=e.contentWindow.document.title)})},addTitle:function(e){if(!1!==this.config.showHead){$("+div.divtitle.dialog",null,this.getWindow().document).s.className="modal-header pure-g";var t=$("+div.divleft.divtitle",null,this.getWindow().document);t.css("textAlign","left"),t.s.className="drag-pp pure-u-23-24",t.s.onmousedown=function(e){$.event(e).drags()},t.s.onmouseup=function(e){$.event(e).move_end()},t.html(e||$.website.name+"提醒您:")}},addRightClose:function(){if(this.config.showHead){var e=$("+div.divright.divtitle",null,this.getWindow().document);e.s.className="pure-u-1-24",e.css("cursor","pointer"),e.html("×"),e.s.onclick=function(){$.win.closeClick()}}},addOK:function(){var e=$("+input.btnOK.divfooter",null,this.getWindow().document);e.s.id="btnOK",e.s.type="button",e.s.className="pure-button pure-button-primary",e.s.value="确定",e.s.onclick=function(){$.win.okClick()}},addClose:function(){var e=$("+input.btnclose.divfooter",null,this.getWindow().document);e.s.className="pure-button",e.attr("type","button"),e.s.value="关  闭",e.s.onclick=function(){$.win.closeClick()}},addMsgContent:function(){$("+div.divcontent.dialog",null,this.getWindow().document).s.className="modal-body"},addFooter:function(){$("+div.divfooter.dialog",null,this.getWindow().document).s.className="modal-footer"},okClick:function(){},closeClick:function(){$.showOrHiddenTag(this.config.tagArray,!0,this.getWindow().document),$("#dialog",null,this.getWindow().document).remove(),$("#backDiv",null,this.getWindow().document).remove(),$("#sound",null,this.getWindow().document).remove(),$.win.config.currentWindow.focus(),$.win.config.jalert.closeCallBack&&($.win.config.jalert.closeCallBack(),$.win.config.jalert.closeCallBack=null),$.win.ok=void 0}},Sparrow.alert=function(e,t,i,n,o){var r={};"object"==_typeof(e)&&(e=(r=e).msg.decodeSplitKey(),t=r.type,i=r.title.decodeSplitKey(),r.url&&(n=r.url.decodeSplitKey()),r.wait_message&&(o=r.wait_message.decodeSplitKey())),$.win.addSound(),$.showOrHiddenTag($.win.config.tagArray,!1,$.win.getWindow().document),$.win.addBackDiv(),$.win.addMsgDialog(),$.win.addTitle(i),$.win.addMsgContent();var s=null;switch(t){case"smile":$.win.addFooter(),$.win.addRightClose(),$.win.addClose(),s=$.win.config.smileImg;break;case"sad":$.win.addFooter(),$.win.addRightClose(),$.win.addClose(),s=$.win.config.sadImg;break;case"lock":s=$.win.config.lockImg;break;case"wait":s=$.win.config.waitImg;break;case"ask":$.win.addFooter(),$.win.addRightClose(),$.win.addOK(),$.win.addClose(),s=$.win.config.askImg;break;case void 0:$.win.addFooter(),$.win.addRightClose(),$.win.addClose()}var a="";s&&(a='<br/><img align="absMiddle" src=\''+s+"'/>&nbsp;&nbsp;"),e&&(a+=e,$.isNullOrEmpty(n)||(a+=o.format(n)),$("#divcontent",null,$.win.getWindow().document).s.innerHTML=a,$.waitRedirect("timer")),$.showOrHiddenTag("select",!0,$.win.getWindow().document.getElementById("divcontent")),$("#dialog",null,$.win.getWindow().document).center()},Sparrow.window=function(e){e||(e={}),$.isNullOrEmpty(e.showHead)||($.win.config.showHead=e.showHead),$.isNullOrEmpty(e.inFrame)||($.win.config.isInFrame=e.inFrame),url=e.url,$.win.closeClick(),!1!==e.cache&&(url=$.randomUrl(url)),url.indexOf("http://")<0&&(url=$.url.root+url),$.showOrHiddenTag($.win.config.tagArray,!1,$.win.getWindow().document),e.srcElement&&(e.srcElement.indexOf("#")<0&&(e.srcElement="#"+e.srcElement),$.win.config.toTopHeight=$(e.srcElement).getAbsoluteTop()-height/2),$.win.addBackDiv(),$.win.addPanel(url)},"function"==typeof define&&define.amd&&define("sparrow",[],function(){return Sparrow}),Sparrow.dialog=function(e){e||(e={}),$.showOrHiddenTag($.win.config.tagArray,!1,$.win.getWindow().document),$.win.addBackDiv(),$.win.addMsgDialog(e.width,e.height),$.win.addTitle(e.title),$.win.addMsgContent(),$.win.addOK(),$.win.addClose(),e.content&&($("#divcontent",null,$.win.getWindow().document).s.innerHTML=e.content),e.initialize&&e.initialize($("divcontent")),$("#dialog",null,$.win.getWindow().document).center()},Sparrow.gridView={keyType:"int",id:"grvManageList",resultCtrlId:"hdnGridResult",getTable:function(){return $(this.id)},init:function(){var e=$("#"+this.resultCtrlId);null!=e&&($.isNullOrEmpty(e.attr("gridViewId"))||(this.id=e.attr("gridViewId")),$.isNullOrEmpty(e.attr("keyType"))||(this.keyType=e.attr("keyType")))},getCellIndex:function(e){return e.parentNode.cellIndex},allCheckClick:function(e){for(var t=$("&"+this.id),i=0;i<t.length;i+=1){t[i].checked=e.checked}},recordCheckClick:function(e,t){if(!1!==e.checked){for(var i=!0,n=$("&"+this.id),o=0;o<n.length;o++)!1===n[o].checked&&(i=!1);i&&($(t).checked=!0)}else $(t).checked=!1},mustSelect:function(e){for(var t=[],i=$("&"+this.id),n=null,o=0;o<i.length;o+=1){var r=i[o];"input"===r.tagName.toLowerCase()&&r.checked&&(n=r.id,"string"===this.keyType?t.push("'"+n+"'"):t.push(n))}return 0===t.length?(lang.message.noSelectRecord?$.message(lang.message.noSelectRecord):$.message("please define 'lang.message.noSelectRecord'!"),!1):(1===t.length&&(t.pop(),t.push(n)),e?!!window.confirm(e)&&t:t)},onlyCheckedOne:function(e){for(var t=0,i=null,n=$("name."+this.id),o=1;o<n.length;o++){var r=n[o];r.checked&&(t+=1,i=r.id)}return 0===t?(lang.message.noSelectRecord?$.message(lang.message.noSelectRecord):$.message("please define lang.message.noSelectRecord!"),!1):1!==t?(lang.message.onlySelectOneRecord?$.message(lang.message.onlySelectOneRecord):$.message("please define lang.message.onlySelectOneRecord"),!1):!window.confirm(e)||i},submit:function(e,t,i){var n=i?this.onlyCheckedOne(t):this.mustSelect(t);if(n){if($(this.resultCtrlId).value=n,"return"===e)return!0;$.submit(e)}}},Sparrow.table=function(e){if(!(this instanceof Sparrow.table))return new Sparrow.table(src);e&&(this.id=e,this.t=$(e),this.body=t.getElementsByTagName("tbody")[0],this.tr=[])},Sparrow.table.prototype={_initCell:function(e,t,i){e.style.cssText=this.tr[t].td[i].cssText,e.className=this.tr[t].td[i].className,e.align=this.tr[t].td[i].align,e.innerHTML=this.tr[t].td[i].innerHTML,this.tr[t].td[i].colspan&&e.setAttribute("colspan",this.tr[t].td[i].colspan)},_initRow:function(e,t){e.style.cssText=table.tr[t].cssText,table.tr[t].className&&""!==table.tr[t].className&&(e.className=table.tr[t].className);for(var i=0;i<this.tr[t].td.length;i++){var n=e.insertCell(-1);this._initCell(n,t,i)}},init:function(){for(var e=0;e<this.tr.length;e++)this.body.appendChild(this._initRow(e));$(this.containerId).appendChild(this.t)},appendRow:function(){for(var e=0;e<this.tr.length;e++){var t=this.body.insertRow(-1);this._initRow(t,e)}},insertRow:function(e){for(var t=0;t<this.tr.length;t++){var i=this.body.insertRow(e);this._initRow(i,t)}},updateRow:function(e){for(var t=0;t<this.tr[0].td.length;t++)this.tr[0].td[t].innerHTML&&(this.body.rows[e].cells[t].innerHTML=this.tr[0].td[t].innerHTML)},removeRow:function(e){this.body.deleteRow(e)}},Sparrow.file={isShowProgress:!0,wit:null,clientFileName:null,uploadFrameId:null,uploadCallBack:function(e,t,i){console.info(e),console.info(i),this.clearStatus()},clearStatus:function(){window.clearInterval(this.wit),window.setTimeout(function(){var e=$("divStatus");$.file.isShowProgress&&null!=e&&document.body.removeChild(e)},1e3)},fileSerialNumber:null,validateUploadFile:function(e,t,i){$.file.checkFileType($.file.getFileName(e.value),["jpg","jpeg","gif","png"],"errorImgForumIco")&&$.file.uploadDelegate(t,i)},callbackValidate:function(e){return!!$.isNullOrEmpty(e.error)||($.alert(e.error,"sad"),$.file.clearStatus(),!1)},reset:function(){var e=$(this.uploadFrameId),t=e.src;e.src="about:blank",e.src=t},getUploadFrame:function(){return this.uploadFrameId?$(this.uploadFrameId):$("fileUpload")},getUploadFile:function(e){return e||(e=this.getUploadFrame()),e.contentWindow.document.getElementById("file_upload")},getUploadFileInfo:function(e){return e||(e=this.getUploadFrame()),e.contentWindow.document.getElementById("fileInfo")},getFileSerialNumber:function(){return this.fileSerialNumber},setFileSerialNumber:function(e){this.fileSerialNumber=e},getFullPath:function(e){if(!e)return"";if($.browser.ie){e.select();var t=document.frames[0].document.selection.createRange().text;return document.frames[0].document.selection.empty(),t}return $.browser.firefox&&e.files?e.files.item(0).getAsDataURL():e.value},getExtension:function(e){return(e=$.browser.getUrlWithoutParameter(e)).substring(e.lastIndexOf(".")).toLocaleLowerCase()},getFileName:function(e){return-1!==(e=$.browser.getUrlWithoutParameter(e)).indexOf("\\")?e.substring(e.lastIndexOf("\\")+1):-1!==e.indexOf("/")?e.substring(e.lastIndexOf("/")+1):e},checkFileType:function(e,t,i){for(var n=this.getExtension(e),o=!1,r=0;r<t.length;r+=1)if(t[r].toLocaleLowerCase()===n||"."+t[r].toLocaleLowerCase()===n){o=!0;break}if(o)return $.v.ok(i),o;var s=$("#"+i);return null!=s&&null!=s.source()&&(s.class("error"),s.html("!只支持:"+t+"格式")),$.message("文件格式不正确，只支持以下格式:\n"+t),o},uploadDelegate:function(e,t,i){if(!1!==this.isShowProgress&&$("divStatus"))return $.alert(this.clientFileName+"正在上传中,请稍侯...","sad"),!1;this.uploadFrameId=(t?t.obj:"null")+"."+e;var n=this.getUploadFrame();if(this.clientFileName=this.getUploadFile(n).value,""===this.clientFileName)return $.message("请选择上传文件!",i),!1;var o=this.getUploadFileInfo(n).value.split(".");if(this.setFileSerialNumber(o[2]),!1!==$.file.isShowProgress){if(!$("divStatus")){var r=$(n),s=$("+div");s.s.id="divStatus",s.s.style.cssText="width:260px;height:100px;position:absolute;color:#ffffff;background:#000000;font-size:10pt;border:#ccc 1px solid;text-align:left;",s.html("服务器正在加载文件信息..."),document.body.appendChild(s.s),s.s.style.top=r.getAbsoluteTop()-10+"px",s.s.style.left=r.getAbsoluteLeft()+"px",s.opacity(90)}this.wit=window.setInterval(function(){$.file.getStatus()},1e3)}n.contentWindow.document.forms[0].submit()},progressCallback:function(e){if(null!=e&&"loading"!==e.status&&this.callbackValidate(e)){var t=[],i=Math.ceil(parseFloat(e.readLength)/parseFloat(e.contentLength)*1e6)/1e4+"%";t.push("正在上传文件<br/><span class='highlight'>《"+$.file.getFileName($.file.clientFileName)+"》</span><br/>"),t.push("文件大小:"+e.humanReadableContentLength+"<br/>"),t.push("上传大小:"+e.humanReadableReadLength+"<br/>"),t.push("上传进度:"+i),$("#divStatus",!1).html(t.toString()),"100%"===i&&$.file.clearStatus()}},getStatus:function(){$("jsonp",$.url.upload+"/file-upload?file-serial-number="+this.getFileSerialNumber()+"&t="+Math.random()+"&callback=progressCallback","uploadProgress")},initImageUploadEvent:function(e,n){$.url.upload||(console.error("please config $.url.upload the default config is $.url.root ["+$.url.root+"]"),$.url.upload=$.url.root);var t=$("null."+e);null!=t&&(document.domain=$.browser.cookie.root_domain,n||(n="Cover"),t.src=$.url.upload+"/file-upload?path-key="+e+"&t="+Math.random(),$.file.uploadCallBack=function(e,t,i){console.info(i)},$.file.validateUploadFile=function(e,t,i){var o=n;"object"===_typeof(n)&&(o=n[t]),$.file.checkFileType($.file.getFileName(e.value),["jpg","jpeg","gif","png"],"error"+o)&&($.file.uploadCallBack=function(e){if($.file.clearStatus(),e.fileUrl){var t=$("#div"+o);null!=t&&t.html("<a href='"+e.fileUrl+"' target='_blank'><img src='"+e.fileUrl+"'/></a>");var i=$("#hdn"+o);null!=i&&i.value(e.fileUrl);var n=$("#error"+o);null!=n&&null!=n.s&&(n.class("prompt"),n.html(""))}},$.file.uploadDelegate(t,i))})}},Sparrow.event=function(e){if(!(this instanceof Sparrow.event))return new Sparrow.event(e);e&&(this.originalEvent=e,this.type=e.type,this.e=window.event||this.originalEvent,this.srcElement=this.e.srcElement||this.e.target,this.toElement=this.e.toElement||this.e.relatedTarget)},Sparrow.event.prototype={dragapproved:!1,srcElement:null,eventX:null,eventY:null,srcLeftPos:null,srcRightPos:null,cancelBubble:function(){window.event?window.event.cancelBubble=!0:this.e.stopPropagation()},preventDefault:function(){this.e.preventDefault&&this.e.preventDefault(),window.event&&(window.event.returnValue=!1)},getAbsoluteTop:function(){return this.e.pageY?this.e.pageY:this.e.clientY?this.e.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop):null},getAbsoluteLeft:function(){return this.e.pageX?this.e.pageX:this.e.clientX?this.e.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft):null},move:function(){return!this.dragapproved||null==this.srcElement||(this.srcElement.style.left=this.srcLeftPos+this.clientX-this.eventX,void(this.srcElement.style.top=this.srcRightPos+this.clientY-this.eventY))},move_end:function(){this.dragapproved=!1,this.srcElement.onmousemove=null},drags:function(){try{if(-1!==this.srcElement.className.indexOf("drag")){"drag-p"===this.srcElement.className?this.srcElement=this.srcElement.parentNode:"drag-pp"===this.srcElement.className?this.srcElement=this.srcElement.parentNode.parentNode:this.srcElement=null;var t=$(this.srcElement);this.dragapproved=!0,this.srcLeftPos=t.getAbsoluteLeft(),this.srcRightPos=t.getAbsoluteTop(),this.eventX=e.clientX,this.eventY=e.clientY,this.srcElement.onmousemove=this.move}else this.srcElement=null,this.dragapproved=!1,this.srcElement.onmousemove=null}catch(e){}}},Sparrow.prototype.mousewheel=function(t){var i,e="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],n=Array.prototype.slice,o=function(e){t&&(e=$.event(e),args=n.call(arguments,1),delta=0,deltaX=0,deltaY=0,absDelta=0,e.preventDefault(),"detail"in e.e&&(deltaY=-1*e.e.detail),"wheelDelta"in e.e&&(deltaY=e.e.wheelDelta),"wheelDeltaY"in e.e&&(deltaY=e.e.wheelDeltaY),"wheelDeltaX"in e.e&&(deltaX=-1*e.e.wheelDeltaX),"axis"in e.e&&e.e.axis===e.e.HORIZONTAL_AXIS&&(deltaX=-1*deltaY,deltaY=0),delta=0===deltaY?deltaX:deltaY,"deltaY"in e.e&&(deltaY=-1*e.e.deltaY,delta=deltaY),"deltaX"in e.e&&(deltaX=e.e.deltaX,0===deltaY&&(delta=-1*deltaX)),0===deltaY&&0===deltaX||(absDelta=Math.max(Math.abs(deltaY),Math.abs(deltaX)),(!i||absDelta<i)&&(i=absDelta,absDelta%120==0&&(i/=40)),absDelta%120==0&&(delta/=40,deltaX/=40,deltaY/=40),delta=Math[1<=delta?"floor":"ceil"](delta/i),deltaX=Math[1<=deltaX?"floor":"ceil"](deltaX/i),deltaY=Math[1<=deltaY?"floor":"ceil"](deltaY/i),e.e.deltaX=deltaX,e.e.deltaY=deltaY,e.e.deltaFactor=i,e.e.deltaMode=0,args.unshift(e.e,delta,deltaX,deltaY),t(args)))};if(this.s.addEventListener)for(var r=e.length;r;)this.s.addEventListener(e[--r],o,!1);else this.s.onmousewheel=o},Sparrow.prototype.addItem=function(e,t){if("SELECT"===this.s.tagName.toUpperCase()){$.isNullOrEmpty(t)&&(t=e);var i=new Option(e,t);this.existItem(i)||this.s.options.add(i)}},Sparrow.prototype.existItem=function(e){for(var t=!1,i=0;i<this.s.options.length;i++)e.value===this.s.options[i].value&&(t=!0);return t},Sparrow.prototype.addItemToSelect=function(e){for(var t=$(e),i=0;i<this.s.options.length;i+=1)if(srcSelect.options[i].selected){var n=this.s.options[i].value,o=this.s.options[i].innerHTML,r=new Option(o,n);t.existItem(this.s.options[i])||e.options.add(r)}},Sparrow.prototype.addAllItemToSelect=function(e){for(var t=$(e),i=0;i<srcSelect.options.length;i+=1){var n=srcSelect.options[i].innerHTML,o=srcSelect.options[i].value,r=new Option(n,o);t.existItem(srcSelect.options[i])||e.options.add(r)}},Sparrow.prototype.removeItem=function(e){"string"==typeof srcSelect&&(srcSelect=$(srcSelect));for(var t=!1,i=this.s.options.length-1;0<=i;i-=1)this.s.options[i].selected&&(this.s.options.remove(i),t=!0);!1!==e&&!1===t&&this.s.options.remove(0)},Sparrow.prototype.removeAll=function(){for(var e=this.s.options.length-1;0<=e;e-=1)this.s.options.remove(e)},Sparrow.prototype.upDown=function(e){if(!(this.s.selectedIndex<0)){if(e<0){if(0===this.s.selectedIndex)return}else if(this.s.selectedIndex===this.s.options.length-1)return;var t=this.s.options[this.s.selectedIndex],i=this.s.options[this.s.selectedIndex+e],n=t.text,o=t.value;t.text=i.text,t.value=i.value,i.text=n,i.value=o,this.s.selectedIndex+=e}},Sparrow.prototype.selectAll=function(){for(var e=0;e<this.s.options.length;e++)this.s.options[e].selected=!0},Sparrow.prototype.addJson=function(e,t,i){if("string"==typeof e&&(e=e.json()),null!=e&&0<e.length){for(var n in e)this.addItem(e[n][i],e[n][t]);return!0}},Sparrow.message=function(e,t){var i="div_sparrow_msg",n=$(i);if(n&&n.parentNode.removeChild(n),(n=$("+div."+i)).s.style.cssText="position:absolute;background-color:#cccccc;width:auto;padding:10px;text-align:left;",n.s.innerHTML=e,n.opacity(0),document.body.appendChild(n.s),t){var o=$(t);n.s.style.top=o.getAbsoluteTop()-n.s.offsetHeight+"px",n.s.style.left=o.getAbsoluteLeft()-(n.s.offsetWidth-t.offsetWidth)/2+"px"}else n.center();n.move_end=function(){this.s.parentNode.removeChild(this.s)},n.animation("{opacity:100}",30)},Sparrow.prototype.move=function(e){var a=e.json(),t=function(e,t,i,n,o){if($.isNullOrEmpty(i))return!1;var r=parseInt(i,10)-parseInt(t,10),s=r*n;if(1<n){if(s=0<r?n:-n,Math.abs(r)<=1)return e.css(o,a.start,!1),!1}else s=r*n;return"function"==typeof o?o(e.s,s):e.css(o,s,!0),Math.abs(r)<=1||void 0},i=a.percent;i||(i=.05);var n=t(this,this.s.style.width,a.width,i,"width");n||(n=t(this,this.s.style.height,a.height,i,"height")),n||(n=t(this,this.s.style.left,a.left,i,"left")),n||(n=t(this,this.s.style.top,a.top,i,"top")),n||(n=t(this,this.opacity(),a.opacity,i,"opacity")),n&&($.isNullOrEmpty(a.width)||(this.s.style.width=a.width),$.isNullOrEmpty(a.height)||(this.s.style.height=a.height),$.isNullOrEmpty(a.left)||(this.s.style.left=a.left),$.isNullOrEmpty(a.top)||(this.s.style.top=a.top),$.isNullOrEmpty(a.opacity)||this.opacity(a.opacity),0===parseInt(a.height,10)&&(this.s.style.display="none"),this.stop(),this.move_end(),this.move_end=function(){})},Sparrow.prototype.move_end=function(){},Sparrow.prototype.stop=function(){window.clearInterval(this.interval.pop())},Sparrow.prototype.animation=function(e,t){t||(t=30),this.s.style.display="block",this.stop();var i="$('"+this.selector+"').move(\""+e+'");';console.log("animation"+i),this.interval.push(window.setInterval(i,t))},Sparrow.prototype.interlace=function(t){t||(t=["{width:'0px',height:'0px'}","{top:'0px',height:'{0}',width:'{1}',left:'0px'}".format(this.s.style.height,this.s.style.width),"{width:'{0}',height:'{1}'}".format(this.s.style.width,this.s.style.height),"{top:'{0}',height:'0px',width:'0px',left:'{1}'}".format(this.s.style.height,this.s.style.width)]);var e=this.selector.substring(1);$("!div."+e).each(function(e){this.style.position="absolute",0===e?(this.style.width=this.parentNode.style.width,this.style.height=this.parentNode.style.height):(this.style.width="0px",this.style.height="0px",this.style.display="none",this.style.left=this.parentNode.style.width,this.style.top=this.parentNode.style.height)}),this.s.style.position="relative",this.s.style.overflow="hidden",this.s.onmouseover=function(){$("!div."+this.id).each(function(e){$(this).animation(t[e],1)})},this.s.onmouseout=function(){$("!div."+this.id).each(function(e){$(this).animation(t[e+2],1)})}},Sparrow.prototype.show=function(){this.s.style.overflow="hidden",("none"===this.s.style.display||0===this.s.offsetHeight)&&(void 0===this.height&&(this.s.style.display="block",this.height=this.s.offsetHeight+"px",this.s.style.height="0"),this.animation("{height:'"+this.height+"'}",5))},Sparrow.prototype.hidden=function(){this.s&&(this.height||(this.height=this.s.offsetHeight+"px",this.s.style.height=this.height),0<this.s.offsetHeight&&this.animation("{height:'0px'}",5))},Sparrow.prototype.showHidden=function(e,t,i){if(e||(e=$(this.s.id+"_controlled")),t||(t={showText:"show",hiddenText:"hidden",showIco:"",hiddenIco:""}),i||(i={show:!0,hidden:!0}),e.style.overflow="hidden","none"===e.style.display||0===e.style.height){if(!i.show)return;return"IMG"===this.s.tagName.toUpperCase()?(this.s.src=t.hiddenIco,this.s.alt=t.hiddenText):this.s.innerHTML=t.hiddenText,void $(e).show()}i.hidden&&($(e).hidden(),"img"===this.s.tagName?(this.s.src=t.showIco,this.s.alt=t.showText):this.s.innerHTML=t.showText)},Sparrow.showOrHiddenTag=function(e,t,i){i||(i=document);for(var n=0;n<e.length;n++){var o=e[n],r=$("^"+o,null,i);null!==r&&0!==r.length&&r.each(function(){this.zIndex=-1,this.style.visibility=t?"visible":"hidden"})}},Sparrow.prototype.marque=function(e,t,i,n){var o=null;this.s.parentNode.style.position="relative",this.s.style.position="absolute";var r=this.s.parentNode.offsetHeight,s=this.s.offsetHeight;switch(e){case 0:if(s<=r)return;this.s.innerHTML+=this.s.innerHTML,n||(n=-3),o="{top:'"+(-s+"px")+"',start:"+n+",percent:"+t+"}"}this.animation(o,i)},Sparrow.prototype.progressbar=function(e,t){var i=$("+div");document.body.appendChild(i.s),t.style&&(i.s.style.cssText=t.style);var n=$("+div");i.s.appendChild(n.s),t.progressStyle&&(n.s.style.cssText=t.progressStyle),n.s.style.width="0px",n.it=window.setInterval(function(){e(n)},100),n.end=function(){window.clearInterval(n.it)},n.remove=function(){document.body.removeChild(n.s.parentNode)}},Sparrow.menu=function(e,t,i){this.config={current_menu:null,left_limit:-1,period:3,frameDiv:null,srcElement:null,width:300,position:{},container:null,parent:null,menu:[],list:[],children:[],brothers:[]},this.obj=e,this.menuLink=i,this.id="div"+this.obj.firstCharUpperCase(),this.position=t||"SIDE",$.global(e,this)},Sparrow.menu.prototype.side=function(){this.config.frameDiv=$("+div").s,this.config.frameDiv.onmouseover=function(e){$.event(e).cancelBubble()},document.body.appendChild(this.config.frameDiv),this.config.frameDiv.style.cssText=$.css.menu.frame.format(this.config.width,0,0);var e=[];e.push('<ul style="{0}">'.format($.css.menu.ul.format(this.config.width-2)));for(var t=0;t<this.config.menu.length;t++)e.push('<li style="{0}" {3}><a href="javascript:void(0);" onclick="{1}.itemClick({2});"  style="width:{4}px;display:inline-block;cursor:pointer"><span style="float:left">{5}</span><span  style="float:right;">{6}</span></a></li>'.format($.css.menu.li.format(this.config.width),this.obj,t,this.config.menu[t].more?'onmouseover="{0}.itemMore(this,{1});"'.format(this.obj,t):"",this.config.width,this.config.menu[t].text,this.config.menu[t].more?">>":""));e.push("</ul>"),this.config.frameDiv.innerHTML=e.join("")},Sparrow.menu.prototype.vertical=function(){if($(this.id)){var e=$("!div."+this.id),o=this.obj;e.each(function(e){var i=$.global(o),t=$("!a",this)[0];t.id=i.id+"_"+i.position+"_menu_"+e;var n=$("!ul",this)[0];n&&(n.id=t.id+"_child",i.config.position[n.id]=n.offsetHeight,n.style.display="none",n.style.height="0px",$(n).bind("onmouseover",function(e){$.event(e).cancelBubble()}),$(t).bind("onclick",function(e){$.event(e).cancelBubble();var t=$("#"+this.id+"_child");null==i.config.current_menu&&("block"===(i.config.current_menu=t).s.style.display?(t.move_end=function(){i.config.current_menu=null},t.animation("{height:'0px'}",i.config.period)):(t.s.style.display="block",t.move_end=function(){i.config.current_menu=null},t.animation("{height:'"+i.config.position[t.s.id]+"px'}",i.config.period)))}))});var t=$("#"+this.id);t.bind("onmouseover",function(e){$.event(e).cancelBubble()}),$("#"+this.menuLink).bind("onmouseover",function(e){$.event(e).cancelBubble(),t.css("marginLeft","0px")}),$(document).bind("onmouseover",function(){t.css("marginLeft","-150px")})}},Sparrow.menu.prototype.dispose=function(){this.config.frameDiv&&document.body.removeChild(this.config.frameDiv)},Sparrow.menu.prototype.hidden=function(){if(this.position===$.SIDE){if(!this.config.frameDiv)return;this.config.frameDiv.style.display="none";for(var e=0;e<this.config.children.length;e++)this.config.children[e].hidden()}if(this.position===$.HORIZONTAL){var t=this;if(null==this.config.current_menu)return;$(this.config.current_menu.parentNode).stop(),$(this.config.current_menu.parentNode).move_end=function(){t.config.current_menu=null},$(this.config.current_menu.parentNode).animation("{height:'0px'}",this.config.period)}},Sparrow.menu.prototype.show=function(e,t){this.config.parent=t,this.config.srcElement=e;var i=0;this.config.container&&(i=this.config.container.scrollTop);var n=$(this.config.srcElement).getAbsoluteLeft();this.config.position===this.SIDE&&(n+=this.config.srcElement.offsetWidth);var o=$(this.config.srcElement).getAbsoluteTop()-i;this.config.frameDiv.style.left=n+"px",this.config.frameDiv.style.top=o-2+"px",this.config.frameDiv.style.display="block";for(var r=0;r<this.config.children.length;r++)this.config.children[r].hidden();for(r=0;r<this.config.brothers.length;r++)this.config.brothers[r].hidden()},Sparrow.menu.prototype.itemClick=function(e){alert("click:"+this.config.menu[e].text)},Sparrow.menu.prototype.itemMore=function(e,t){alert("more:"+this.config.menu[t].text)},Sparrow.menu.prototype.horizontal=function(){if($(this.id)){var e=$("!div."+this.id);this.config.menu=$("!li",e[0]),this.config.list=$("!ul",e[1]),this.config.left_limit=$("#"+this.id).getAbsoluteLeft(),null==this.config.position.height&&(this.config.position.height=30);var o=$.global(this.obj);$(document).bind("onmouseover",function(){o.hidden(this)}),this.config.menu.each(function(e){this.id=o.obj+"_"+o.position+"_menu_"+e;var t=$(o.config.list[e]);t.s.style.cssText="height:{0}px;overflow:hidden;width:{1}px;".format(t.s.offsetHeight,t.s.offsetWidth+10),t.s.id=this.id+"_child",t.bind("onmouseover",function(e){$.event(e).cancelBubble()}),$(this).bind("onmouseover",function(e){if((e=$.event(e)).cancelBubble(),"LI"===e.srcElement.tagName){var t=$(e.srcElement.id+"_child");if(null!=o.config.current_menu){if(t===o.config.current_menu)return;$(o.config.current_menu).stop()}(o.config.current_menu=t).parentNode.style.height="0";var i=$(o.id).offsetTop-$.win.getScrollTop();if(i<=0&&(i=0),t.parentNode.style.top=i+o.config.menu[0].offsetHeight-8+"px",0<t.getElementsByTagName("li").length){o.config.list.each(function(){this.style.display="none"}),t.style.display="block";var n=parseInt(e.srcElement.offsetLeft,10)-(parseInt(t.style.width,10)-e.srcElement.offsetWidth)/2;n<o.config.left_limit&&(n=o.config.left_limit),t.style.marginLeft=n+"px",$(t.parentNode).stop(),$(t.parentNode).animation("{height:'"+o.config.position.height+"px'}",o.config.period)}}})})}},Sparrow.menu.prototype.init=function(){this.position===$.SIDE?this.side():this.position===$.VERTICAL?this.vertical():this.position===$.HORIZONTAL&&this.horizontal()},Sparrow.datePicker=function(e){var t=Object();t["yyyy年MM月dd日"]=new RegExp("^(\\d{4})年(\\d{2})月(\\d{2})日$","ig"),t["yyyy-MM-dd"]=new RegExp("^(\\d{4})-(\\d{2})-(\\d{2})$","ig"),t["yyyy年MM月"]=new RegExp("^\\d{4}年\\d{2}月$","ig"),t["yyyy-MM"]=new RegExp("^\\d{4}-\\d{2}$","ig"),this.obj=e,this.currentDate=new Date,this.pickerDiv=null,this.config={format:t,srcElement:null,currentFMT:"yyyy-MM-dd",maxDaysOfMonth:[31,28,31,30,31,30,31,31,30,31,30,31],weekDay:["日","一","二","三","四","五","六"],month:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],minDate:null,allowNull:!1}},Sparrow.datePicker.prototype.isLeapYear=function(e){return 0==e%4&&(e%100!=0||e%400==0)},Sparrow.datePicker.prototype.getMaxDaysOfMonth=function(e,t){-1===t&&(t=11);var i=this.config.maxDaysOfMonth[t];return 1===t&&this.isLeapYear(e)&&(i+=1),i},Sparrow.datePicker.prototype.getFormatDate=function(e,t,i){if(void 0===t||void 0===i){var n=this.config.format[this.config.currentFMT],o=n.exec(this.config.srcElement.value);if(null==o&&(o=n.exec(this.config.srcElement.value)),null!=o){var r=o[2],s=o[3];t||(t=r-1),i||(i=s)}}return t=parseInt(t,10),(t+=1)<10&&(t="0"+t),(i=parseInt(i,10))<10&&(i="0"+i),this.config.currentFMT.replace("yyyy",e).replace("MM",t).replace("dd",i)},Sparrow.datePicker.prototype.init=function(e,t,i){if(!e){var n=this.currentDate;e=n.getFullYear(),t=n.getMonth(),i=n.getDate()}if(!this.pickerDiv){var o=$(this.config.srcElement);this.currentDate=new Date(e,t,i),this.pickerDiv=$("+div"),this.pickerDiv.s.id=this.obj,this.pickerDiv.s.style.cssText="position:absolute;display:none;text-align:center",this.pickerDiv.s.style.left=o.getAbsoluteLeft()+"px",this.pickerDiv.s.style.top=o.getAbsoluteTop()+this.config.srcElement.clientHeight+"px",this.pickerDiv.opacity(100),document.body.appendChild(this.pickerDiv.s),this.pickerDiv.s.onclick=function(e){$.event(e).cancelBubble()},this.config.srcElement.readOnly="readonly";var r=this.obj+".config.srcElement.onclick=function(e){$.event(e).cancelBubble();"+this.obj+".show();};"+this.obj+".config.srcElement.onchange=function(){"+this.obj+".validate();"+this.obj+".init();};";window.setTimeout(r,0)}var s=this.getMaxDaysOfMonth(e,t-1),a=this.getMaxDaysOfMonth(e,t),l=new Date(e,t,1).getDay(),c=s-(0===l?7:l)+1,d=[];d.push('<table class="pure-table pure-table-bordered">'),d.push("<tr>"),d.push('<td><a  href="javascript:void(0);" onclick="{0}.changeMonth(-1)">&lt;<a></td>'.format(this.obj)),d.push('<td colspan="3"><a onclick="{0}.initYear({1});" href="javascript:void(0)">{1}</a>年</td>'.format(this.obj,e)),d.push('<td colspan="2"><a onclick="{0}.initMonth({2},{3});" href="javascript:void(0);">{1}</a></td>'.format(this.obj,this.config.month[t],e,t)),d.push('<td><a  href="javascript:void(0);" onclick="{0}.changeMonth(1)">&gt;<a></td>'.format(this.obj)),d.push("</tr>"),d.push("<tr>");for(var h=0;h<7;h+=1)d.push("<td>{0}</td>".format(this.config.weekDay[h]));d.push("</tr>");var u=0;d.push("<tr>");for(var f=c;f<=s;f+=1)d.push('<td><a  style="color:#ccc;">{0}</a></td>'.format(f)),(u+=1)%7==0&&(d.push("</tr>"),d.push("<tr>"));for(var p=1;p<=a;p+=1)d.push('<td><a href="javascript:void(0);" onclick="{0}.changeDate({1},{2},{3});">{3}</a></td>'.format(this.obj,e,t,p)),(u+=1)%7==0&&(d.push("</tr>"),d.push("<tr>"));for(var g=7-u%7,m=1;m<=g;m+=1)d.push('<td><a  style="color:#ccc;">{0}</a></td>'.format(m)),(u+=1)%7==0&&(d.push("</tr>"),d.push("<tr>"));d.push("</tr>"),this.pickerDiv.s.innerHTML=d.join(""),this.config.srcElement.value=this.getFormatDate(e,t,i)},Sparrow.datePicker.prototype.show=function(){this.pickerDiv.s.style.display="block"},Sparrow.datePicker.prototype.hidden=function(){yyyy=this.currentDate.getFullYear(),MM=this.currentDate.getMonth(),dd=this.currentDate.getDate(),this.config.allowNull||""!==this.config.srcElement.value||(this.config.srcElement.value=this.getFormatDate(yyyy,MM,dd)),this.pickerDiv.s.style.display="none"},Sparrow.datePicker.prototype.initYear=function(e){var t=e-e%10;t<1900&&(t=1900);var i=t+10,n=[];n.push('<table class="pure-table pure-table-bordered">'),n.push("<tr>"),n.push('<td><a href="javascript:void(0);" onclick="{0}.initYear({1})">&lt;<a></td>'.format(this.obj,e-10)),n.push('<td colspan="2">{0}-{1}</td>'.format(t,i-1)),n.push('<td><a href="javascript:void(0);" onclick="{0}.initYear({1})">&gt;<a></td>'.format(this.obj,e<1900?1910:e+10)),n.push("</tr>"),n.push("<tr>");for(var o=0,r=t-1;r<i;r+=1)r===t-1||r===i?n.push('<td style="color:#ccc">{0}</td>'.format(r)):n.push('<td><a href="javascript:void(0);" onclick="{0}.initMonth({1})">{1}</a></td>'.format(this.obj,r)),++o%4==0&&n.push("</tr><tr>");n.push('<td style="color:#ccc">{0}</td>'.format(i)),n.push("</tr>"),n.push("</table>"),this.pickerDiv.s.innerHTML=n.join("")},Sparrow.datePicker.prototype.initMonth=function(e,t){t||(t=this.getCurrentDate().getMonth());var i=[];i.push('<table  class="pure-table pure-table-bordered">'),i.push("<tr>"),i.push('<td><a href="javascript:void(0);" onclick="{0}.initMonth({1},{2})">&lt;<a></td>'.format(this.obj,e-1,t)),i.push('<td style="text-align:center;" colspan="2"><a href="javascript:void(0);" onclick="{0}.initYear({1})">{1}</a></td>'.format(this.obj,e)),i.push('<td><a href="javascript:void(0);" onclick="{0}.initMonth({1},{2})">&gt;<a></td>'.format(this.obj,e+1,t)),i.push("</tr>"),i.push("<tr>");for(var n=0,o=0;o<12;o+=1)i.push('<td><a href="javascript:void(0);" onclick="{0}.init({1},{2},{3})">{4}</a></td>'.format(this.obj,e,o,this.currentDate.getDate(),this.config.month[o])),++n%4==0&&i.push("</tr><tr>");i.push("</tr>"),i.push("</table>"),this.pickerDiv.s.innerHTML=i.join(""),this.config.srcElement.value=this.getFormatDate(e,t)},Sparrow.datePicker.prototype.changeMonth=function(e){var t=this.getCurrentDate(),i=parseInt(t.getMonth(),10)+e,n=parseInt(t.getFullYear(),10),o=parseInt(t.getDate(),10);1===e&&12===i?(i=0,n+=1):-1===e&&-1===i&&(i=11,n-=1),this.config.srcElement.value=this.getFormatDate(n,i,o),this.init(n,i,o)},Sparrow.datePicker.prototype.changeDate=function(e,t,i){this.config.srcElement.value=this.getFormatDate(e,t,i),this.validate(e,t,i)&&(this.currentDate=new Date(e,t,i)),this.hidden()},Sparrow.datePicker.prototype.userValidate=null,Sparrow.datePicker.prototype.getCurrentDate=function(){var e=this.config.format[this.config.currentFMT],t=e.exec(this.config.srcElement.value);return null==t&&(t=e.exec(this.config.srcElement.value)),new Date(t[1],parseInt(t[2],10)-1,t[3])},Sparrow.datePicker.prototype.validate=function(e,t,i){var n;if(""===this.config.srcElement.value.trim())return!!this.config.allowNull;if(-1===this.config.srcElement.value.search(this.config.format[this.config.currentFMT]))return $.message("请按【"+this.config.currentFMT+"】格式输入",this.config.srcElement),!1;if(!e){var o=this.getCurrentDate();e=o.getFullYear(),t=o.getMonth(),i=o.getDate()}if(e<1900||2099<e)return $.m.show("年份超出范围！\n正确年份范围1900-2099",this.config.srcElement),!1;if(t<0||12<t)return $.m.show("月份超出范围!",this.config.srcElement),!1;if(i<0||i>this.getMaxDaysOfMonth(e,t))return $.m.show("日期范围超出!",this.config.srcElement),!1;if(n=new Date(e,t,i),null!=this.config.minDate){var r=new Date(this.config.minDate.getFullYear(),this.config.minDate.getMonth(),this.config.minDate.getDate());if(n<r)return m.show("不允许小于"+this.getFormatDate(r.getFullYear(),r.getMonth(),r.getDate()),this.config.srcElement),!1}return!(this.userValidate&&!this.userValidate())&&(this.currentDate=n,!0)},Sparrow.editor=function(e,t){this.obj=e,this.fullObjName=t?t+"."+e:e,this.frame=null,this.config={cover_key:"Cover",style:null,flash_thumbnail:!0,iframeId:null,titleCtrlId:"txtTitle",contentCtrlId:"hdnContent",wordCount:"spanWordCount",submitButtonId:"btnSubmit",interval:null,currentHtmlId:null,tempNodeAttribute:"i_temp_attribute",container:{id:null,maxWidth:900,minWidth:700},attach:{key:"thread",uploadedJson:"",uploadImgContainerId:e+"_uploadImgContainer",localUploadImgTabId:e+"_localUploadImgTab",index:1,uploadedIndex:0,currentUUID:null,actionUrl:null,fileUUID:e+"_fileUUID",iframeName:e+"_fileUpload",iframeId:e+".{0}",fileRemark:e+"_fileRemark",fileInfoId:e+"_fileInfo",tableId:e+"_tabAttach",formIndex:0,showImageInfo:!0,uploadingFileId:[],maxAllowCount:5},tool:{id:e+"_HtmlEditorToolBar",height:40,position:"top",icon:{backGroundColor:null,containerId:e+"_tdEditorToolBar",path:$.url.resource+"/images/sparrowEditor/"},convertHTML:{isConvert:!0,ctrlId:e+"_tdConvertHTMLID",ctrlWidth:50},adjust:{adjustable:!1,width:120},style:{simple:[2,3,4,13,14,15,16,21,22,23],comment:[21,23,22],list:[21,22,23]},toolBar:[{left:-394,top:-8,width:84,height:24,title:"字号",cmd:"fontsize",htmlFrameId:"font_size",htmlheight:315,htmlwidth:170},{left:-310,top:-8,width:82,height:24,title:"字体",cmd:"fontname",htmlFrameId:"font_family",htmlheight:360,htmlwidth:130},{left:2,top:-8,width:26,height:24,title:"加粗",cmd:"bold"},{left:-28,top:-7,width:26,height:24,title:"斜体",cmd:"italic"},{left:-56,top:-8,width:26,height:24,title:"下划线",cmd:"underline"},{left:-82,top:-8,width:26,height:24,title:"文字颜色",cmd:"forecolor",htmlFrameId:"FColor",htmlheight:308,htmlwidth:364},{left:-114,top:-8,width:26,height:24,title:"背景颜色",cmd:"BackColor",firefoxcmd:"hilitecolor",htmlFrameId:"HColor",htmlheight:308,htmlwidth:364},{split:'<img src="{0}icoBack.gif" style="background:url({0}ico.gif) -940px -8px;width:8px;height:24px;"/>'},{left:-144,top:-8,width:26,height:22,title:"左对齐",cmd:"justifyleft"},{left:-168,top:-8,width:26,height:22,title:"居中对齐",cmd:"justifycenter"},{left:-190,top:-8,width:26,height:22,title:"右对齐",cmd:"justifyright"},{left:-610,top:-8,width:92,height:22,title:"自动对齐",cmd:"justifyfull"},{split:'<img alt="" src="{0}icoBack.gif" style="background:url({0}ico.gif)-940px -8px;width:8px;height:24px;"/>'},{left:-562,top:-8,width:26,height:22,title:"编号",cmd:"InsertOrderedList"},{left:-588,top:-8,width:26,height:22,title:"项目符号",cmd:"InsertUnorderedList"},{left:-504,top:-8,width:26,height:22,title:"减少缩进",cmd:"outdent"},{left:-476,top:-8,width:26,height:22,title:"增加缩进",cmd:"indent"},{split:""},{left:-700,top:-7,width:100,height:22,title:"清除空格",cmd:"clearSpace"},{left:-536,top:-9,width:26,height:20,title:"插入横线",cmd:"inserthorizontalrule"},{left:-273,top:-3,width:34,height:34,title:"插入超链接",cmd:"hyperLink",htmlFrameId:"HyperLink",htmlheight:60,htmlwidth:400,keepStatus:!1},{left:-212,top:-3,width:34,height:34,title:"插入表情",cmd:"face",htmlFrameId:"face",htmlheight:280,htmlwidth:340},{left:-877,top:-3,width:32,height:34,title:"插入视频",cmd:"insertVideo",htmlFrameId:"video",htmlheight:120,htmlwidth:350},{left:-904,top:-3,width:34,height:34,title:"插入图片",cmd:"insertImage",htmlFrameId:"image",htmlheight:260,htmlwidth:520}],font_family:["宋体","黑体","隶书","楷体","幼圆","Arial","Impact","Georgia","Verdana","Courier New","Times New Roman"],font_size:[{size:1,name:"1|8pt"},{size:2,name:"2|10pt"},{size:3,name:"3|12pt"},{size:4,name:"4|14pt"},{size:5,name:"5|18pt"},{size:6,name:"6|24pt"},{size:7,name:"7|36pt"}],face:[{url:$.url.resource+"/images/sparrowEditor/face/01.gif",name:"呲牙"},{url:$.url.resource+"/images/sparrowEditor/face/02.gif",name:"不嘛"},{url:$.url.resource+"/images/sparrowEditor/face/03.gif",name:"哭泣"},{url:$.url.resource+"/images/sparrowEditor/face/04.gif",name:"嘟嘟"},{url:$.url.resource+"/images/sparrowEditor/face/05.gif",name:"嗯嗯"},{url:$.url.resource+"/images/sparrowEditor/face/06.gif",name:"思考下"},{url:$.url.resource+"/images/sparrowEditor/face/07.gif",name:"翻跟斗"},{url:$.url.resource+"/images/sparrowEditor/face/08.gif",name:"我靠"},{url:$.url.resource+"/images/sparrowEditor/face/09.gif",name:"扫射"},{url:$.url.resource+"/images/sparrowEditor/face/10.gif",name:"嘘!"},{url:$.url.resource+"/images/sparrowEditor/face/11.gif",name:"害羞"},{url:$.url.resource+"/images/sparrowEditor/face/12.gif",name:"眯眯"},{url:$.url.resource+"/images/sparrowEditor/face/13.gif",name:"求保佑"},{url:$.url.resource+"/images/sparrowEditor/face/14.gif",name:"晕"},{url:$.url.resource+"/images/sparrowEditor/face/15.gif",name:"来一拳"},{url:$.url.resource+"/images/sparrowEditor/face/16.gif",name:"胜利"},{url:$.url.resource+"/images/sparrowEditor/face/17.gif",name:"嚎叫"},{url:$.url.resource+"/images/sparrowEditor/face/18.gif",name:"BIBI"},{url:$.url.resource+"/images/sparrowEditor/face/19.gif",name:"哼哼"},{url:$.url.resource+"/images/sparrowEditor/face/20.gif",name:"冷汗"},{url:$.url.resource+"/images/sparrowEditor/face/21.gif",name:"泼墨"},{url:$.url.resource+"/images/sparrowEditor/face/22.gif",name:"吐血"},{url:$.url.resource+"/images/sparrowEditor/face/23.gif",name:"扣鼻子"},{url:$.url.resource+"/images/sparrowEditor/face/24.gif",name:"挠挠脸"},{url:$.url.resource+"/images/sparrowEditor/face/25.gif",name:"舔手指"},{url:$.url.resource+"/images/sparrowEditor/face/26.gif",name:"吃饭啦"},{url:$.url.resource+"/images/sparrowEditor/face/27.gif",name:"打哈欠"},{url:$.url.resource+"/images/sparrowEditor/face/28.gif",name:"拜拜"},{url:$.url.resource+"/images/sparrowEditor/face/29.gif",name:"抽一口"},{url:$.url.resource+"/images/sparrowEditor/face/30.gif",name:"杀死"}]}},this.attach={parentObject:null,setParentObject:function(e){this.parentObject=e},loadAttach:function(){var e=this.parentObject;$("#tab"+e.obj).tabs();var t=e.config.attach.uploadedJson.json();if(null!=t&&0<t.length){var i=$(e.config.attach.uploadImgContainerId);if(null==i)e.run("tool_23_"+e.obj);else if(""===i.innerHTML.trim())for(var n=t.length-1;0<=n;n--){var o=t[n].clientFileName,r=t[n].url;i.appendChild(getImgContainer(r,o,e))}}},collectFilePostInfo:function(){var e=this.parentObject;if($(e.config.attach.tableId)){for(var t=$("&"+e.config.attach.fileUUID),i=$("&"+e.config.attach.fileRemark),n=[],o=0;o<t.length;o++)t[o].value&&n.push(t[o].value+":"+i[o].value);return n.join()}return""},validate:function(e,t){return null==t||$.browser.isLogin()?$.v.getValidateResult(e,!1):($.user.login.dialog(t),!1)},_submit:function(){$(this.parentObject.config.attach.fileInfoId).value=this.parentObject.attach.collectFilePostInfo(),this.parentObject.config.attach.actionUrl?$.submit(this.parentObject.config.attach.actionUrl,this.parentObject.config.attach.formIndex):this.parentObject.config.attach.currentUUID?$.submit("update.do",this.parentObject.config.attach.formIndex):$.submit(null,this.parentObject.config.attach.formIndex)},submit:function(e,t){var i=this.parentObject;$(i.config.contentCtrlId).value=i.frame.contentWindow.document.body.innerHTML,this.validate(e,t)?this._submit():$(this.parentObject.config.submitButtonId).disabled=!1},insertEditor:function(e,t){var i=this.parentObject,n='<img title="'+e+'" src="'+t+'"/>';i.createTempNode("span"),i.getTempNode().innerHTML=n,i.removeElementById()},deleteOnServer:function(e,t){var i=this.parentObject;window.confirm($.message.deleteFile)&&$.ajax.json($.url.root+"/attach/delete.json","uuid="+fileUUID,function(e){i.attach.deleteImg($.ajax.srcElement),$.message("删除成功！")},t)},deleteImg:function(e){$(e.parentNode.parentNode.removeChild(e.parentNode)),$.file.wit&&window.clearInterval($.file.wit),$("divState")&&document.body.removeChild($("divState"))}}},Sparrow.editor.editorArray=[],Sparrow.editor.uploadUrl="http://upload.sparrowzoo.com",Sparrow.editor.prototype.$=function(e){return this.frame.contentWindow.document.getElementById(e)},Sparrow.editor.prototype.getTempNode=function(e){var t=this.$(this.config.tempNodeAttribute);if(t)return t;e=e?e.toLowerCase():$.browser.ie||$.browser.opera?"font":"span";for(var i=null,n=this.frame.contentWindow.document.getElementsByTagName(e),o=n.length-1;0<=o;o--){if("font"===e||"span"===e)i=$.browser.ie||$.browser.opera?n[o].face:n[o].style.fontFamily;else if("a"===e)try{i=n[o].href}catch(e){}if(i&&-1!==i.indexOf(this.config.tempNodeAttribute))return n[o].id=this.config.tempNodeAttribute,n[o]}},Sparrow.editor.prototype.replaceTagWithInnerHTML=function(e){if($.browser.firefox){var t=this.getRange();t.setStartBefore(e);var i=t.createContextualFragment(e.innerHTML);e.parentNode.replaceChild(i,e)}else e.outerHTML=e.innerHTML},Sparrow.editor.prototype.removeElementById=function(){var e=this.$(this.config.tempNodeAttribute);this.replaceTagWithInnerHTML(e)},Sparrow.editor.prototype.getBrief=function(){var e=null;return 300<(e=$.browser.ie?this.frame.contentWindow.document.body.innerText.substring(0,300):this.frame.contentWindow.document.body.textContent.length).length&&(e=e.substring(0,300)),e},Sparrow.editor.prototype.getEditorContent=function(){if(this.config.tool.convertHTML.isConvert){var e=document.getElementById(this.config.tool.convertHTML.ctrlId);"HTML"!==e.innerHTML&&(e.innerHTML="HTML",document.getElementById(this.config.tool.icon.containerId).style.display="block",$.browser.ie?this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.innerText:this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.textContent)}return this.clear(),"<br>"===this.frame.contentWindow.document.body.innerHTML||"<br/>"===this.frame.contentWindow.document.body.innerHTML?"":this.frame.contentWindow.document.body.innerHTML},Sparrow.editor.prototype.initContent=function(){var e=$(this.config.contentCtrlId);if(null!=e){var t=e.value;this.setEditorContent(decodeURIComponent(t))}this.attach.setParentObject(this),this.config.attach.uploadedJson=decodeURIComponent("")},Sparrow.editor.prototype.focus=function(){this.frame.contentWindow.document.body.focus()},Sparrow.editor.prototype.setEditorContent=function(e){$(this.config.contentCtrlId).value=e,null!=this.frame&&(this.frame.contentWindow.document.body.innerHTML=e,this.updateWordCount())},Sparrow.editor.prototype.setEditorText=function(e){this.frame.contentWindow.document.body.innerText=e,this.updateWordCount()},Sparrow.editor.prototype.getRange=function(){return this.frame.contentWindow.document.body.focus(),$.browser.ie?this.frame.contentWindow.document.selection.createRange():this.frame.contentWindow.getSelection().getRangeAt(0)},Sparrow.editor.prototype.m_over=function(e){this.config.tool.icon.backGroundColor=e.style.backgroundColor,e.style.backgroundColor="#595959",e.style.cursor="pointer"},Sparrow.editor.prototype.m_out=function(e){e.style.backgroundColor=this.config.tool.icon.backGroundColor},Sparrow.editor.prototype.m_down=function(e){var t=e.id.split("_")[1];e.style.background="url("+this.config.tool.icon.path+"ico.gif) "+(this.config.tool.toolBar[t].left+1)+"px "+(this.config.tool.toolBar[t].top+1)+"px"},Sparrow.editor.prototype.m_up=function(e){var t=e.id.split("_")[1];e.style.background="url("+this.config.tool.icon.path+"ico.gif) "+this.config.tool.toolBar[t].left+"px "+this.config.tool.toolBar[t].top+"px",this.run(e.id)},Sparrow.editor.prototype.clearTag=function(e){for(var t=this.frame.contentWindow.document.getElementsByTagName(e),i=t.length-1;0<=i;i--)""===t[i].innerHTML&&t[i].parentNode.removeChild(t[i])},Sparrow.editor.prototype.clear=function(){this.clearTag("span"),this.clearTag("font"),this.clearTag("div"),this.clearTag("p");try{this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.innerHTML.replace(/&nbsp;+/g," ").replace(/(<br>|<br\/>)+/g,"<br/>")}catch(e){}for(var e=this.getTempNode()||this.getTempNode("a");e;)"a"==e.tagName.toLowerCase()&&-1==e.href.indexOf(this.config.tempNodeAttribute)?e.removeAttribute("id"):this.removeElementById(),e=this.getTempNode()||this.getTempNode("a")},Sparrow.editor.prototype.createTempNode=function(e){e||(e="a");var t=this.getRange();if(""==($.browser.ie?t.text:t)){var i=document.createElement(e);"a"==e?i.href=this.config.tempNodeAttribute:i.id=this.config.tempNodeAttribute,$.browser.ie?(i.innerHTML=t.text,t.pasteHTML(i.outerHTML)):t.surroundContents(i)}else e&&"a"!=e.toLowerCase()?this.frame.contentWindow.document.execCommand("fontname",!1,this.config.tempNodeAttribute):this.frame.contentWindow.document.execCommand("createLink",!1,this.config.tempNodeAttribute)},Sparrow.editor.prototype.findTagNode=function(e){e=e.toLowerCase();var t=null,i=null;try{var n=this.getRange();if($.browser.ie)i=n.item?n.item(0):n.parentElement();else if(n.startContainer.getElementsByTagName){var o=n.startContainer.getElementsByTagName(e);i=0<o.length?o[0]:n.startContainer}else i=n.startContainer}catch(e){}if(i.nodeName.toLowerCase()===e)t=i;else for(;"body"!==i.nodeName.toLowerCase();){if(i.nodeName.toLowerCase()===e){t=i;break}i=i.parentNode}return t&&(t.id=this.config.tempNodeAttribute),t},Sparrow.editor.prototype.run=function(e){var t=$(e);key=t.id.split("_")[1],this.frame.contentWindow.focus(),0==key||1==key||5==key||6==key||20==key||21==key||22==key||23==key||24==key?(clearHtmlFrame(),this.show(t,key,this.config.tool.toolBar[key].htmlwidth,this.config.tool.toolBar[key].htmlheight)):18==key?(this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.innerHTML.replace(/&nbsp;+/g," ").replace(/(<br>|<br\/>)+/g,"<br/>"),this.clear()):this.frame.contentWindow.document.execCommand(this.config.tool.toolBar[key].cmd,!1,void 0),this.frame.contentWindow.focus()},Sparrow.editor.prototype.callBackRun=function(e,t){var i=(t=t||window.event).srcElement||t.target;switch(e){case 21:this.insertHyperLink();break;case 22:this.insertFace(i);break;case 23:if(0==this.insertVideo())return;break;default:var n=i.title,o=this.config.tool.toolBar[e].cmd;this.config.tool.toolBar[e].firefoxcmd&&(o=$.browser.ie?this.config.tool.toolBar[e].cmd:this.config.tool.toolBar[e].firefoxcmd),this.frame.contentWindow.document.execCommand(o,!1,n)}var r=document.getElementById(this.config.currentHtmlId);document.body.removeChild(r),this.config.currentHtmlId=null},Sparrow.editor.prototype.show=function(e,t,i,n){var o=$(e);this.config.currentHtmlId&&(document.getElementById(this.config.currentHtmlId).style.display="none",this.config.currentHtmlId=null);var r=this.obj+"_"+this.config.tool.toolBar[t].htmlFrameId,s=document.getElementById(r);s||((s=document.createElement("DIV")).id=r,document.body.appendChild(s)),s.style.cssText="display:block;position:absolute;width:"+i+"px;height:0px;border:#595959 1px solid;background:#ffffff; padding:1px;text-align:center;",s.onclick=function(e){$.event(e).cancelBubble()};var a=o.getAbsoluteLeft()-(i-e.offsetWidth)/2,l=$(e.parentNode).getAbsoluteLeft();a<l&&(a=l),s.style.left=a+"px",s.style.top=o.getAbsoluteTop()+e.offsetHeight+"px",this.config.interval=window.setInterval(this.fullObjName+".intervalShow("+t+","+n+")",10)},Sparrow.editor.prototype.intervalShow=function(e,t){var i=document.getElementById(this.obj+"_"+this.config.tool.toolBar[e].htmlFrameId),n=i.clientHeight+15;t<=n?(window.clearInterval(this.config.interval),""!=i.innerHTML.trim()&&0!=this.config.tool.toolBar[e].keepStatus||(i.innerHTML=this.getHtml(e)),20==e?$(this.obj+"_txtURL").focus():22==e?$(this.obj+"_txtVideo").focus():23==e&&(this.attach.setParentObject(this),this.attach.loadAttach(this.config.attach.key)),this.config.currentHtmlId=i.id):i.style.height=n+"px"},Sparrow.editor.prototype.getHtml=function(e){var t=[];switch(e){case 0:t.push('<ul style="list-style-type:none;text-align:left;margin:0;padding:0;">');for(var i=0;i<this.config.tool.font_size.length;i++)t.push('<li unselectable="on" onclick="'+this.fullObjName+".callBackRun("+e+',event);" style="border-bottom:#ccc 1px dotted;padding:5px;cursor:pointer;font-size:'+this.config.tool.font_size[i].name.split("|")[1]+';width:auto;" title="'+Math.round(this.config.tool.font_size[i].size)+'">'+this.config.tool.font_size[i].name+"</li>");t.push("</ul>");break;case 1:for(t.push('<ul style="line-height:25px; list-style-type:none;margin:0;padding:0;">'),i=0;i<this.config.tool.font_family.length;i++)t.push('<li unselectable="on" onclick="'+this.fullObjName+".callBackRun("+e+',event);" title="'+this.config.tool.font_family[i]+'" style="border:#ccc 1 dotted;padding:3px;cursor:pointer;font-family:'+this.config.tool.font_family[i]+'">'+this.config.tool.font_family[i]+"</li>");t.push("</ul>");break;case 5:case 6:var n=["00","33","66","99","cc","ff"],o=0;for(i=0;i<6;i+=1)for(var r=0;r<6;r+=1)for(var s=0;s<6;s+=1){var a="#"+n[i]+n[r]+n[s];t.push('<img src="'+this.config.tool.icon.path+'icoBack.gif" onclick="'+this.fullObjName+".callBackRun("+e+',event); " title="'+a+'" style="background:'+a+';width:20px;height:20px;cursor:pointer"/>'),(o+=1)%18==0&&t.push("<br/>")}break;case 20:var l=this.findTagNode("a"),c="",d=!1;null!=l?(c=l.href.substring(7),d=!0):this.createTempNode("a"),t.push('<label>链接地址</label><input class="pure-input-1" onkeyup="if(this.value.substring(0,7)!=\'http://\'){this.value=\'http://\'}" value="http://'+c+'" type="text" id="'+this.obj+'_txtURL" />  <input class="pure-button pure-button-primary" type="button" value="确定" id="ok" onclick="if(document.getElementById(\''+this.obj+"_txtURL').value=='http://'&&"+!d+"){alert('请输入正确的url地址');}else{"+this.fullObjName+'.callBackRun(21,event);}" />');break;case 21:this.createTempNode("span");var h=Math.ceil(this.config.tool.face.length/6);t.push('<table style="width:'+this.config.tool.toolBar[e].htmlwidth+'px; border-collapse:collapse;" id="divFace" cellpadding="1" cellspacing="0">');o=0;for(i=0;i<h;i++){for(t.push("<tr>"),r=0;r<6;r++)o<this.config.tool.face.length?t.push('<td><img style="cursor: pointer;" title="'+this.config.tool.face[o].name+'" src="'+this.config.tool.face[o].url+'" onclick="'+this.fullObjName+'.callBackRun(22,event);" /></td>'):t.push("<td></td>"),o++;t.push("</tr>")}t.push("</table>");break;case 22:this.createTempNode("span"),t.push('<label>FLASH视频URL</label><input class="pure-input-rounded" id="'+this.obj+'_txtVideo" type="text"/><br/><span id="'+this.obj+'_spanVideoErrorMessage"></span><br/>'),t.push('<input value="插入视频" class="pure-button pure-button-primary" type="button" onclick="'+this.fullObjName+'.callBackRun(23,event);"/>');break;case 23:this.createTempNode("span"),t.push('<div  id="tab'+this.obj+'" class="tab">'),t.push('<div class="pure-menu pure-menu-horizontal">'),t.push('<ul class="pure-menu-list" style="width: 100%;">'),t.push('<li class="pure-menu-item pure-menu-selected">'),t.push('<a target="_self" href="javascript:void(0);" class="pure-menu-link">'),t.push("<span>本地图片</span>"),t.push("</a>"),t.push("</li>"),t.push('<li class="pure-menu-item">'),t.push('<a target="_self" href="javascript:void(0);" class="pure-menu-link">'),t.push("<span>网络图片</span>"),t.push("</a>"),t.push("</li>"),t.push("</ul>"),t.push("</div>"),t.push('<div class="tab-content">'),t.push('<div id="'+this.config.attach.key+this.config.attach.localUploadImgTabId+'" class="block">'),t.push('<div style="width:100%;height:auto;overflow:hidden;padding:2px;" id="'+this.config.attach.uploadImgContainerId+'"></div>'),t.push('<iframe name="'+this.config.attach.iframeName+'" id="'+this.config.attach.iframeId.format(this.config.attach.key)+'" class="file-frame" frameborder="0"'),t.push(' src="'+$.editor.uploadUrl+"/file-upload?path-key="+this.config.attach.key+"&editor="+this.fullObjName+'"></iframe><br/>'),t.push("</div>"),t.push('<div class="none">'),t.push('图片URL:<input style="width:300px;" id="'+this.obj+'_txtImage" type="text"/><br/><span id="'+this.obj+'_spanImageErrorMessage"></span><br/>'),t.push('<input value="插入图片" type="button" onclick="'+this.fullObjName+'.insertImage();"/>'),t.push("</div>"),t.push("</div>"),t.push("</div>")}return t.join("")},Sparrow.editor.prototype.adjust=function(t,i){try{if("width"===t){var e=parseInt(i.value);e>this.config.container.maxWidth?(alert("编辑器最大宽度:"+this.config.container.maxWidth+"px"),i.value=this.config.container.maxWidth+"px"):e<this.config.container.minWidth&&(alert("编辑器最小宽度:"+this.config.container.minWidth+"px"),i.value=this.config.container.minWidth+"px"),document.getElementById(this.config.container.id).style.width=i.value;var n=parseInt(i.value)-this.config.tool.convertHTML.ctrlWidth;this.config.tool.adjust.adjustable&&(n-=this.config.tool.adjust.width),document.getElementById(this.config.tool.id).style.width=i.value,document.getElementById(this.config.tool.id).style.width=n}else document.getElementById(this.config.container.id).style.height=i.value}catch(e){i.value="width"===t?document.getElementById(this.config.container.id).style.width:document.getElementById(this.config.container.id).style.height}this.autoAdjust(document.getElementById(this.config.iframeId))},Sparrow.editor.prototype.autoAdjust=function(e){var t=parseInt(document.getElementById(this.config.container.id).style.height),i=document.getElementById(this.config.tool.id).clientHeight+10;e.style.height=t-i},Sparrow.editor.prototype.convertHTML=function(e){this.clear(),"HTML"===e.innerHTML?(e.innerHTML="返回",e.title="返回所见即所得模式",document.getElementById(this.config.tool.icon.containerId).style.display="none",$.browser.ie?this.frame.contentWindow.document.body.innerText=this.frame.contentWindow.document.body.innerHTML:this.frame.contentWindow.document.body.textContent=this.frame.contentWindow.document.body.innerHTML):(e.innerHTML="HTML",document.getElementById(this.config.tool.icon.containerId).style.display="block",$.browser.ie?this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.innerText:this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.textContent)},Sparrow.editor.prototype.insertVideo=function(){var e=!1,t=document.getElementById(this.obj+"_txtVideo").value,i=$(this.obj+"_spanVideoErrorMessage");if(""===t.trim())i.className="error",i.innerHTML="请输入视频地址<br/>例:http://player.youku.com/player.php/sid/sparrow/v.swf";else if(-1===t.search(/^[http:\/\/][^<]*\.swf[^<]*/))i.className="error",i.innerHTML="请输入正确的视频地址。例:http://player.youku.com/player.php/sid/sparrow/v.swf";else{var n,o=this.getTempNode(),r=document.getElementById(this.obj+"_txtVideo").value,s=this;this.config.flash_thumbnail?$.ajax.json($.url.root+"/attach/getFlashThumbnail.json","parameter="+encodeURIComponent(r),function(e){n=e.message,o?(o.innerHTML=n,s.removeElementById()):s.frame.contentWindow.document.body.innerHTML+=n}):(n='<embed src="{0}" quality="high" wmode="opaque" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="500" height="500"/>'.format(r),o?(o.innerHTML=n,this.removeElementById()):this.frame.contentWindow.document.body.innerHTML+=n),e=!0}return e},Sparrow.editor.prototype.insertImage=function(){var t=document.getElementById(this.obj+"_txtImage").value,e=$(this.obj+"_spanImageErrorMessage");if(""===t.trim())e.className="error",e.innerHTML="请输入图片地址<br/>例:"+$.url.resource+"/img.jpg<br/>格式限制:gif|jpg|png";else if(-1==t.search(/^http:\/\/.*?\.(jpg|gif|png)$/))e.className="error",e.innerHTML="请输入图片地址<br/>例:"+$.url.resource+"/img.jpg<br/>格式限制:gif|jpg|png";else{var i=this;$.ajax.json($.url.root+"/attach/downloadInternetPic.json","imageUrl="+t,function(e){$(i.config.attach.uploadImgContainerId).appendChild(getImgContainer(e.message,t,i)),i.attach.insertEditor($.file.getFileName(t),e.message)})}},Sparrow.editor.prototype.insertFace=function(e){var t=this.getTempNode();if(t)return t.innerHTML='<img src="'+e.src+'"/>',$(this.config.titleCtrlId)&&""===$(this.config.titleCtrlId).value&&($(this.config.titleCtrlId).value=e.title),void this.removeElementById();this.frame.contentWindow.document.execCommand("insertImage",!1,e.src)},Sparrow.editor.prototype.insertHyperLink=function(){var e=this.getTempNode("a"),t=document.getElementById(this.obj+"_txtURL").value;e&&("http://"===t?window.confirm("您确认要取消链接吗?")&&this.removeElementById():(""===e.innerHTML&&(e.innerHTML=t),e.removeAttribute("id"),e.setAttribute("target","blank"),e.setAttribute("href",t)))},Sparrow.editor.prototype.initialize=function(e){$.global(this.obj,this),$.editor.editorArray.push(this),this.config.container.id=e;var t="iframe"+$.random();if(this.config.iframeId=t,document.getElementById(e).innerHTML="top"==this.config.tool.position?this.initTool()+this.initEditor(t):this.initEditor(t)+this.initTool(),this.frame=document.getElementById(t),this.frame.contentWindow.document.open(),this.frame.contentWindow.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'),this.frame.contentWindow.document.write('<html><body id="'+this.obj+'" style="width:100%;height:{0}px;" contenteditable="true"></body></html>'.format($(t).offsetHeight)),this.frame.contentWindow.document.close(),$.browser.ie)return this.frame.contentWindow.document.onclick=clearHtmlFrame,void(this.frame.contentWindow.document.onkeyup=this.updateWordCount);try{this.frame.contentWindow.document.addEventListener("click",clearHtmlFrame,!0),this.frame.contentWindow.document.addEventListener("keyup",this.updateWordCount,!0)}catch(e){}},Sparrow.editor.prototype.initTool=function(){var e=0,t=[],i=null;if(t.push('<div class="pure-u-18-24" id="'+this.config.tool.icon.containerId+'" style="text-align:left;">'),null!=this.config.style){"simple"===this.config.style?i=this.config.tool.style.simple:"comment"===this.config.style?i=this.config.tool.style.comment:"thread"===this.config.style&&(i=this.config.tool.style.list);for(var n=0;n<i.length;n++)e=i[n],void 0!==this.config.tool.toolBar[e].split?t.push(this.config.tool.toolBar[e].split.format(this.config.tool.icon.path)):(t.push('<img id="tool_'+e+"_"+this.obj+'" src="'+this.config.tool.icon.path+'icoBack.gif"'),t.push(' title="'+this.config.tool.toolBar[e].title),t.push('" style="background:url(\''+this.config.tool.icon.path+"ico.gif') "),t.push(this.config.tool.toolBar[e].left+"px "+this.config.tool.toolBar[e].top+"px;width:"+this.config.tool.toolBar[e].width+"px;height:"+this.config.tool.toolBar[e].height+'px"'),t.push(' onmouseover="'+this.fullObjName+'.m_over(this);" onmouseout="'+this.fullObjName+'.m_out(this);" onmousedown="'+this.fullObjName+'.m_down(this);" onmouseup="'+this.fullObjName+'.m_up(this);"'),t.push("/>"))}else for(var e in this.config.tool.toolBar)void 0!==this.config.tool.toolBar[e].split?t.push(this.config.tool.toolBar[e].split.format(this.config.tool.icon.path)):(t.push('<img id="tool_'+e+'" src="'+this.config.tool.icon.path+'icoBack.gif"'),t.push(' title="'+this.config.tool.toolBar[e].title),t.push('" style="background:url(\''+this.config.tool.icon.path+"ico.gif') "),t.push(this.config.tool.toolBar[e].left+"px "+this.config.tool.toolBar[e].top+"px;width:"+this.config.tool.toolBar[e].width+"px;height:"+this.config.tool.toolBar[e].height+'px"'),t.push(' onmouseover="'+this.fullObjName+'.m_over(this);" onmouseout="'+this.fullObjName+'.m_out(this);" onmousedown="'+this.fullObjName+'.m_down(this);" onmouseup="'+this.fullObjName+'.m_up(this);"'),t.push("/>"));if(t.push("</div>"),this.config.tool.convertHTML.isConvert&&t.push('<div align="center" id="'+this.config.tool.convertHTML.ctrlId+'" class="pure-u-2-24" " onclick="'+this.fullObjName+'.convertHTML(this);">HTML</div>'),this.config.tool.adjust.adjustable){var o=document.getElementById(this.config.container.id);t.push('<div align="center" title="在此调整编辑器大小。鼠标离开即生效。" class="pure-u-4-24 pure-form pure-form-aligned" '+this.config.tool.adjust.width+'px;"><input onblur="'+this.fullObjName+'.adjust(\'width\',this);" style="height: 30px;" placeholder="width" class="pure-input-rounded pure-input-1" type="text" value="'+o.style.width+'"/><input onblur="'+this.fullObjName+'.adjust(\'height\',this);" style="height: 30px;" placeholder="height" class="pure-input-rounded pure-input-1" type="text" value="'+o.style.height+'"/></div>')}return'<div class="pure-g tool-bar" id="'+this.config.tool.id+'" style="border-bottom:#ccc 1px solid; width:'+document.getElementById(this.config.container.id).style.width+';height:auto;">'+t.join("")+"</div>"},Sparrow.editor.prototype.initEditor=function(e){return document.domain=$.browser.cookie.root_domain,'<iframe onload="'+this.fullObjName+".autoAdjust(this);"+this.fullObjName+'.initContent();" class="'+e+'" id="'+e+'" name="'+e+'" style="background:#ffffff;width: 100%;height:'+(document.getElementById(this.config.container.id).offsetHeight-this.config.tool.height-2)+'px;scrollbar-face-color: #F7F5F4;" frameborder="0" marginheight="0" marginwidth="0" src="about:blank"></iframe>'},Sparrow.editor.prototype.updateWordCount=function(){var e=this.obj||this.body.id,t=$.global(e);$(t.config.wordCount)&&($(t.config.wordCount).innerHTML=t.frame.contentWindow.document.body.innerHTML.length)},$(document).bind("onclick",function(){clearHtmlFrame()}),Sparrow.editor.prototype.initImageUploadEvent=function(n){n||(n=this.config.cover_key),$.file.validateUploadFile=function(e,t,i){$.file.checkFileType($.file.getFileName(e.value),["jpg","jpeg","gif","png","zip"],"error"+n)&&($.file.uploadCallBack=function(e,t){$.file.clearStatus();var i=e.clientFileName;""!==i&&($(t.config.attach.uploadImgContainerId).appendChild(getImgContainer(e.fileUrl,i,t)),t.attach.insertEditor($.file.getFileName(i),e.fileUrl))},$.file.uploadDelegate(t,i))}},Sparrow.treeNode=function(e,t,i,n,o,r,s,a,l,c){this.id=e,this.pid=t,this.name=i,this.url=n,this.title=o,this.target=r,this.showCtrl=a||!0,this.businessEntity=l,this.childCount=s||0,this.icon=c,this.iconOpen=c,this._isOpened=!1,this._isSelected=!1,this._lastOfSameLevel=!1,this._addressIndex=0,this._parentNode,this._hasChild=0<s},Sparrow.tree=function(e,t){this.config={target:"_self",useFolderLinks:!0,useSelection:!0,useCookies:!0,useLines:!0,useIcons:!0,useRootIcon:!0,usePlusMinusIcons:!0,useTreeIdInNodeClass:!1,useLevelInNodeClass:!1,useRadio:!1,useCheckbox:!1,treeNodeClass:null,reBuildTree:null,loadFloatTree:null,floatTreeId:null,descHiddenId:null,descTextBoxId:null,validate:null,validateConfig:null,isdelay:!1,isclientDelay:!1,closeSameLevel:!1,inOrder:!1,showRootIco:!0,showOrder:!1,orderURL:null,treeFrameId:null,loadingString:"londing .....",imageDir:$.url.resource+"/images/treeimg",RESOURCE_TYPE:{1:"[系统菜单]",2:"[系统页面]",3:"[控件事件]"}},this.icon={root:this.config.imageDir+"/base.gif",folder:this.config.imageDir+"/folder.gif",folderOpen:this.config.imageDir+"/folderopen.gif",node:this.config.imageDir+"/page.gif",nolineNode:this.config.imageDir+"/nolinepage.gif",empty:this.config.imageDir+"/empty.gif",line:this.config.imageDir+"/line.gif",join:this.config.imageDir+"/join.gif",joinBottom:this.config.imageDir+"/joinbottom.gif",plus:this.config.imageDir+"/plus.gif",plusBottom:this.config.imageDir+"/plusbottom.gif",minus:this.config.imageDir+"/minus.gif",minusBottom:this.config.imageDir+"/minusbottom.gif",nlPlus:this.config.imageDir+"/nolines_plus.gif",nlMinus:this.config.imageDir+"/nolines_minus.gif"},this.interval=null,this.currentSelectId={},this.floatTreeFrameId=null,this.obj=e,this.parentName=t,this.fullObjName=t?t+"."+e:e,this.aNodes=[],this.aIndent=[],this.root=new Sparrow.treeNode(-1),this.selectedNodeIndex=null,this.selectedFound=!1,this.completed=!1},Sparrow.tree.prototype={resetIcon:function(){this.icon.root=this.config.imageDir+"/base.gif",this.icon.nolineroot=this.config.imageDir+"/nolinebase.gif",this.icon.folder=this.config.imageDir+"/folder.gif",this.icon.folderOpen=this.config.imageDir+"/folderopen.gif",this.icon.node=this.config.imageDir+"/page.gif",this.icon.nolineNode=this.config.imageDir+"/nolinepage.gif",this.icon.empty=this.config.imageDir+"/empty.gif",this.icon.line=this.config.imageDir+"/line.gif",this.icon.join=this.config.imageDir+"/join.gif",this.icon.joinBottom=this.config.imageDir+"/joinbottom.gif",this.icon.plus=this.config.imageDir+"/plus.gif",this.icon.plusBottom=this.config.imageDir+"/plusbottom.gif",this.icon.minus=this.config.imageDir+"/minus.gif",this.icon.minusBottom=this.config.imageDir+"/minusbottom.gif",this.icon.nlPlus=this.config.imageDir+"/nolines_plus.gif",this.icon.nlMinus=this.config.imageDir+"/nolines_minus.gif"},addBusinessEntity:function(e,t,i,n,o,r){this.aNodes[this.aNodes.length]=new Sparrow.treeNode(e,t,i,n,o,"_self",void 0,!0,r)},add:function(e,t,i,n,o,r,s,a,l,c){this.aNodes[this.aNodes.length]=new Sparrow.treeNode(e,t,i,n,o,r,s,a,l,c)},openAll:function(){this.oAll(!0)},closeAll:function(){this.oAll(!1)},toString:function(){var e='<div class="sparrow-tree">';return document.getElementById?(this.config.useCookies&&(this.selectedNodeIndex=this.getSelectedAi()),e+=this.addNode(this.root)):e+="Browser not supported.</div>",this.selectedFound||(this.selectedNodeIndex=null),this.completed=!0,e},deleteClick:function(){alert("deleteClick not defined!")},removeNode:function(e){e||(e=this.aNodes[this.getSelectedAi()]),this.aNodes.splice(e._addressIndex,1),this.clearSelectedNode(),$(this.config.treeFrameId).innerHTML=this.toString(),this.clearFloatFrame()},appendNode:function(e){this.aNodes.push(e),$(this.config.treeFrameId).innerHTML=this.toString()},updateNode:function(e,t){t||(t=this.aNodes[this.getSelectedAi()]),t.pid!==e.pid?(this.removeNode(t),this.appendNode(e)):this.aNodes[this.getSelectedAi()]=e,$(this.config.treeFrameId).innerHTML=this.toString()},showOrder:function(e){if(this.config.showOrder){var t=$("orderDiv");t&&document.body.removeChild(t);var i=$.event(e).srcElement,n=$(i,!1),o=i.id.substring(this.obj.length+1),r=this.aNodes[o];if(-1!==r.pid){t=$("+div.orderDiv"),document.body.appendChild(t.s),t.class("pure-menu pure-order-menu"),t.css("position","absolute"),t.html('<span class="pure-menu-heading pure-menu-link pure-order-menu-heading" onclick="{0}.delete_click({1});{0}.clearFloatFrame();" >删除</span><ul class="pure-menu-list"><li class="pure-menu-item"><a href="#" class="pure-menu-link">当前第<span id="currentOrderNo"></span>位</a></li><li class="pure-menu-item pure-menu-has-children"><a  id="hyperJump" class="pure-menu-link">你可以跳转至</a> <ul id="ulChildrenList" class="pure-menu-children"></ul></li></ul>'.format(this.fullObjName,o)),t.bind("onclick",function(e){$.event(e).cancelBubble()}),$("#hyperJump",!1).bind("onmouseover",function(){$("#ulChildrenList",!1).css("display","block")}),t.css("left",n.getAbsoluteLeft()+i.offsetWidth+"px"),t.css("top",n.getAbsoluteTop()+i.offsetHeight+"px");for(var s=r._parentNode,a=0,l=0,c="",d=0;d<this.aNodes.length;d++)if(this.aNodes[d].pid===s.id)if(this.aNodes[d].id!==r.id){if(a++,c+='<li class="pure-menu-item" onclick="{0}.order({1},{2})"><a href="#" class="pure-menu-link">第<span>{2}</span>位</a></li>'.format(this.fullObjName,o,a),this.aNodes[d]._lastOfSameLevel)break}else l=++a;$("#ulChildrenList",!1).html(c),$("#currentOrderNo",!1).html(l)}else this.clearFloatFrame()}},order:function(r,s){var a=this.aNodes[r],e="id="+a.id+"&target="+s,l=this,c=this.aNodes;$.ajax.json(this.config.orderURL,e,function(e){for(var t=(a=c[r])._parentNode,i=0,n=0,o=0;o<c.length;o++)if(c[o].pid===t.id&&++i===s){c[n=o];break}c.splice(r,1),c.splice(n,0,a),$("#"+l.config.treeFrameId).html(l),l.clearFloatFrame()})},addNode:function(e){var t="",i=0;for(this.config.inOrder&&(i=e._addressIndex);i<this.aNodes.length;i++){var n=this.aNodes[i];if(n&&n.pid===e.id&&((n._parentNode=e).childCount++,n._addressIndex=i,this.setCS(n),!n.target&&this.config.target&&(n.target=this.config.target),n._hasChild&&!n._io&&this.config.useCookies&&(n._isOpened=this.isOpen(n.id)),!this.config.useFolderLinks&&n._hasChild&&(n.url=null),this.config.useSelection&&n.id===this.getSelectedId()&&(n._isSelected=!0,this.selectedNodeIndex=i,this.selectedFound=!0),this.config.showRootIco?t+=this.node(n,i):this.node(n,i),n._lastOfSameLevel))break}return t},select:function(e,t){null!=this.current&&(this.current.className=$(this.current).attr("old")),$(e).attr("old",e.className),e.className="iTreeNodeSelect"+t,this.current=e},node:function(e,t){var i="";this.config.treeNodeClass?i+=this.config.treeNodeClass:this.config.useTreeIdInNodeClass&&(i+=this.obj.substring(0,1).toUpperCase()+this.obj.substring(1)),this.config.useLevelInNodeClass&&(i+=1<this.aIndent.length?3:this.aIndent.length+1);var n='<div onclick="'+this.fullObjName+".select(this,'"+i+"');\"";return(this.config.useRootIcon||e.pid!==this.root.id)&&(n+=' class="iTreeNode'+i+'"'),n+='id="node'+this.obj+t+'"  >'+this.indent(e,t),this.config.useIcons&&(this.config.useLines?(e.icon=this.root.id===e.pid?this.icon.root:e._hasChild?this.icon.folder:this.icon.node,e.iconOpen=this.root.id===e.pid?this.icon.root:e._hasChild?this.icon.folderOpen:this.icon.node):e.icon||(e.iconOpen=e.icon=e._hasChild?this.icon.nolinefolder:this.icon.nolinenode),(this.config.useRootIcon||e.pid!==this.root.id)&&(n+="<img "+(this.config.showOrder?' onmouseover="'+this.fullObjName+'.showOrder(event)"':"")+' id="i'+this.obj+t+'" src="'+(e._isOpened?e.iconOpen:e.icon)+'" alt="" align="absMiddle"/>'),(e.showCtrl&&-1!==e.pid||-1===e.pid&&!0===this.userRootIcon)&&(this.config.useRadio&&(n+='<input style="line-height:15px;height:15px;border:0;" type="radio" name="iTreerdb" id="r{1}{0}" onclick="{1}.getRadioSelected({0});{1}.s({0});" value="{2}"/>'.format(t,this.fullObjName,e.id)),!0===this.config.useCheckbox&&(n+='<input style="line-height:15px;height:15px;border:0;" type="checkbox" name="iTreecbx" id="c{1}{0}" onclick="{1}.selectCheckbox({0});" value="{2}"/>'.format(t,this.fullObjName,e.id)))),e.url?(n+='<a ondblclick="javascript:'+this.fullObjName+".dbs("+t+');" id="s'+this.obj+t+'" class="'+(this.config.useSelection&&e._isSelected?"nodeSel":"node")+'" href="'+e.url+'"',e.title&&(n+=' title="'+e.title+'"'),e.target&&(n+=' target="'+e.target+'"'),this.config.useSelection&&(e._hasChild&&this.config.useFolderLinks||!e._hasChild)&&(n+=' onclick="javascript: '+this.fullObjName+".s("+t+");"),n+=(this.config.usePlusMinusIcons?"":e._hasChild&&-1!==e._parentNode.id?this.fullObjName+".o("+t+")":"")+'">'):this.config.useFolderLinks&&e.url||!e._hasChild||e.pid===this.root.id||(n+='<a href="javascript: '+this.fullObjName+".o("+t+');" class="node">'),n+='<span id="ntext'+this.obj+t+'">'+e.name+"</span>",!e.url&&(this.config.useFolderLinks&&e.url||!e._hasChild)||(n+="</a>"),n+="</div>",e._hasChild&&(n+='<div id="d'+this.obj+t+'" class="clip" style="display:'+(this.root.id===e.pid||e._isOpened?"block":"none")+';">',this.config.isdelay||this.config.isclientDelay?(e._isOpened&&-1!=e.pid||-1==e.pid)&&(n+=this.addNode(e)):n+=this.addNode(e),n+="</div>"),this.aIndent.pop(),n},indent:function(e,t){var i="";if(this.root.id===e.pid)return i;for(var n=0;n<this.aIndent.length;n++)i+='<img src="'+(1===this.aIndent[n]&&this.config.useLines?this.icon.line:this.icon.empty)+'" alt="" />';return e._lastOfSameLevel?this.aIndent.push(0):this.aIndent.push(1),this.config.usePlusMinusIcons?e._hasChild?(i+='<a href="javascript: '+this.fullObjName+".o("+t+');"><img id="j'+this.obj+t+'" src="',this.config.useLines?i+=e._isOpened?e._lastOfSameLevel&&this.config.useLines?this.icon.minusBottom:this.icon.minus:e._lastOfSameLevel&&this.config.useLines?this.icon.plusBottom:this.icon.plus:i+=e._isOpened?this.icon.nlMinus:this.icon.nlPlus,i+='"/></a>'):i+='<img id="j'+this.obj+t+'" src="'+(this.config.useLines?e._lastOfSameLevel?this.icon.joinBottom:this.icon.join:this.icon.empty)+'" alt="" />':i+='<img style="width:0;height:0;" id="j'+this.obj+t+'"/>'},setCS:function(e){var t=null;e._hasChild=!1,e._lastOfSameLevel=!1;for(var i=0;i<this.aNodes.length;i++)!1===this.config.isdelay&&null!=this.aNodes[i]&&this.aNodes[i].pid==e.id&&(e._hasChild=!0),null!=this.aNodes[i]&&this.aNodes[i].pid==e.pid&&(t=this.aNodes[i].id);t===e.id&&(e._lastOfSameLevel=!0)},getAllNameOfNode:function(e,t){e||(e=this.aNodes[this.getSelectedAi()]);for(var i=[];-1!==e.id&&!$.isNullOrEmpty(e.name);)-1!==e.name.indexOf(":")?i.push(e.name.split(":")[1]):i.push(e.name),e=e._parentNode?e._parentNode:this.aNodes[this.getAiById(e.pid)];return t=t||"  ",i.reverse(),i.join(t)},getSelectedAi:function(){return this.getAiById(this.getSelectedId())},getSelectedId:function(){return(!0===this.config.useCookies?this.getCookie("currentSelect"+this.obj):this.currentSelectId["currentSelect"+this.obj])||null},clearSelectedNode:function(){var e=new Date,t=new Date(e.getTime()-864e5);this.setCookie("cs"+this.obj,"cookieValue",t),this.currentSelectId["currentSelect"+this.obj]=null},setCurrentSelectNode:function(e){this.config.useCookies?this.setCookie("currentSelect"+this.obj,e.id):this.currentSelectId["currentSelect"+this.obj]=e.id},s:function(e){if(this.config.useSelection){var t=this.aNodes[e];if(!t._hasChild||this.config.useFolderLinks){if(this.selectedNodeIndex!==e&&((this.selectedNodeIndex||0===this.selectedNodeIndex)&&(eOld=document.getElementById("s"+this.obj+this.selectedNodeIndex),this.aNodes[this.selectedNodeIndex]._isSelected=!1,eOld&&(eOld.className="node")),eNew=document.getElementById("s"+this.obj+e),eNew.className="nodeSel",this.selectedNodeIndex=e,t._isSelected=!0,this.setCurrentSelectNode(t)),document.getElementById("r"+this.obj+e)&&(document.getElementById("r"+this.obj+e).checked=!0,this.getRadioSelected(e)),document.getElementById("c"+this.obj+e)){var i=document.getElementById("c"+this.obj+e);i.checked=!i.checked,this.selectCheckbox(e)}this.config.closeSameLevel&&this.closeLevel(t)}}},delayOpen:function(e){var r=this,s=e,t=e._addressIndex;if(s._isOpened)return!0;var a=document.getElementById("d"+this.obj+t);if(null!=a&&""==a.innerHTML){var i="ay=true&nodeId="+s.id;$("exceptid").value&&(i+="&exceptid="+$("exceptid").value),$.ajax.json(this.config.ajaxURL,i,function(e){alert(e);var t=xmlHttpRequest.responseText.json();openNodeCallBack(t);for(var i=s,n=[];-1!=i.pid;)n[n.length]=i._lastOfSameLevel?0:1,i=i._parentNode;for(var o=n.length-1;0<=o;o--)r.aIndent.push(n[o]);a.innerHTML=r.addNode(s);for(o=0;o<n.length;o++)r.aIndent.pop()})}},clientDelayOpen:function(e,t){var i=e,n=e._addressIndex;if(0==i._isOpened||t){var o=document.getElementById("d"+this.obj+n);if(null!=o&&""==o.innerHTML||t){for(var r=i,s=[];r._parentNode.id!=this.root.id;)s[s.length]=r._lastOfSameLevel?0:1,r=r._parentNode;for(var a=s.length-1;0<=a;a--)this.aIndent.push(s[a]);o.innerHTML=this.addNode(i);for(a=0;a<s.length;a++)this.aIndent.pop()}}},o:function(e){var t=this.aNodes[e];this.config.isdelay&&this.delayOpen(t),this.config.isclientDelay&&this.clientDelayOpen(t),this.nodeStatus(!t._isOpened,e,t._lastOfSameLevel),t._isOpened=!t._isOpened,this.config.closeSameLevel&&this.closeLevel(t),this.config.useCookies&&this.updateCookie()},oAll:function(e){for(var t=0;t<this.aNodes.length;t++)null!=this.aNodes[t]&&this.aNodes[t]._hasChild&&this.aNodes[t].pid!=this.root.id&&(this.nodeStatus(e,t,this.aNodes[t]._lastOfSameLevel),this.aNodes[t]._isOpened=e);this.config.useCookies&&this.updateCookie()},getAiById:function(e){for(var t=0;t<this.aNodes.length;t++)if(null!=this.aNodes[t]&&this.aNodes[t].id==e)return t;return null},openTo:function(e,t){if(t||(e=this.getAiById(e)),null!==e){var i=this.aNodes[e];if(this.config.delay)for(var n=[];-1!=i._parentNode.pid;)n.push(i),i=i._parentNode;else i.pid!=this.root.id&&i._parentNode&&(i._isOpened=!0,this.completed&&i._hasChild&&this.nodeStatus(!0,i._addressIndex,i._lastOfSameLevel),this.openTo(i._parentNode._addressIndex,!0))}},closeLevel:function(e){for(var t=0;t<this.aNodes.length;t++)null!=this.aNodes[t]&&this.aNodes[t].pid==e.pid&&this.aNodes[t].id!=e.id&&this.aNodes[t]._hasChild&&(this.nodeStatus(!1,t,this.aNodes[t]._lastOfSameLevel),this.aNodes[t]._isOpened=!1,this.closeAllChildren(this.aNodes[t]))},closeAllChildren:function(e){for(var t=0;t<this.aNodes.length;t++)null!=this.aNodes[t]&&this.aNodes[t].pid==e.id&&this.aNodes[t]._hasChild&&(this.aNodes[t]._isOpened&&this.nodeStatus(!1,t,this.aNodes[t]._lastOfSameLevel),this.aNodes[t]._isOpened=!1,this.closeAllChildren(this.aNodes[t]))},nodeStatus:function(e,t,i){eDiv=document.getElementById("d"+this.obj+t),eJoin=document.getElementById("j"+this.obj+t),this.config.usePlusMinusIcons?(eIcon=document.getElementById("i"+this.obj+t),this.config.useIcons&&(eIcon.src=e?this.aNodes[t].iconOpen:this.aNodes[t].icon),eJoin.src=this.config.useLines?e?i?this.icon.minusBottom:this.icon.minus:i?this.icon.plusBottom:this.icon.plus:e?this.icon.nlMinus:this.icon.nlPlus):eJoin.src=this.icon.empty,eDiv.style.display=e?"block":"none"},clearCookie:function(){var e=new Date,t=new Date(e.getTime()-864e5);this.setCookie("co"+this.obj,"cookieValue",t),this.setCookie("cs"+this.obj,"cookieValue",t)},setCookie:function(e,t,i,n,o,r){document.cookie=escape(e)+"="+escape(t)+(i?"; expires="+i.toGMTString():"")+(n?"; path="+n:"")+(o?"; domain="+o:"")+(r?"; secure":"")},getCookie:function(e){var t="",i=document.cookie.indexOf(escape(e)+"=");if(-1!=i){var n=i+(escape(e)+"=").length,o=document.cookie.indexOf(";",n);t=-1!=o?unescape(document.cookie.substring(n,o)):unescape(document.cookie.substring(n))}return t},updateCookie:function(){for(var e="",t=0;t<this.aNodes.length;t++)null!=this.aNodes[t]&&this.aNodes[t]._isOpened&&this.aNodes[t].pid!=this.root.id&&(e&&(e+="."),e+=this.aNodes[t].id);this.setCookie("currentOpen"+this.obj,e)},isOpen:function(e){for(var t=this.getCookie("currentOpen"+this.obj).split("."),i=0;i<t.length;i++)if(t[i]==e)return!0;return!1},getAllId:function(){for(var e=[],t=0;t<this.aNodes.length;t++)e.push(this.aNodes[t].id);return e},getAllParentNode:function(){var e=this.aNodes[this.getSelectedAi()],t=[];if(e)for(;-1!=e.id;)t.push(e.id),e=e._parentNode;else t.push(0);return t},selectChilds:function(e,t,i){pids=[];for(var n=0;n<i;n++)-1!=e.indexOf(this.aNodes[n].pid)&&0!=this.aNodes[n].showCtrl&&(document.getElementById("c"+this.obj+n).checked=t,pids.push(this.aNodes[n].id));0!=pids.length&&this.selectChilds(pids,t,i)},getRadioSelected:function(){return null},selectCheckbox:function(e){var t=this.aNodes[e],i=null;if(null==t.selectChild||1==t.selectChild){if(i=document.getElementById("c"+this.obj+e).checked)for(var n,o=t;-1!=o.id;)(n=document.getElementById("c"+this.obj+o._addressIndex))&&(n.checked=!0),o=o._parentNode;for(var r=this.aNodes.length,s=[],a=0;a<r;a++)a!=e&&null!=this.aNodes[a]&&this.aNodes[a].pid==t.id&&0!=this.aNodes[a].showCtrl&&(document.getElementById("c"+this.obj+a).checked=i,s.push(this.aNodes[a].id));0!=s.length&&this.selectChilds(s,i,r)}this.checkBoxClick&&this.checkBoxClick(t.id,i)},setChecked:function(e){"string"==typeof e&&(e=e.split(","));for(var t=document.getElementsByName("iTreecbx"),i=0;i<t.length;i++){var n=parseInt(t[i].value,10);-1!==e.indexOf(n)&&(t[i].checked=!0)}},getAllCheckedTitle:function(){for(var e=[],t=document.getElementsByName("iTreecbx"),i=0;i<t.length;i++)!0===t[i].checked&&(arrayIndex=t[i].id.replace("c"+this.obj,""),e.push(this.aNodes[arrayIndex].title));return e},getAllChecked:function(){for(var e=[],t=document.getElementsByName("iTreecbx"),i=0;i<t.length;i++)!0===t[i].checked&&(arrayIndex=t[i].id.replace("c"+this.obj,""),e.push(this.aNodes[arrayIndex]));return e},getAllCheckedId:function(){for(var e=[],t=document.getElementsByName("iTreecbx"),i=0;i<t.length;i++)!0===t[i].checked&&e.push(t[i].value);return e.join()},show:function(e,t,i){if(!this.floatTreeFrameId){this.config.reBuildTree&&this.config.reBuildTree(),""==$(this.config.floatTreeId).innerHTML.trim()&&void 0!==this.config.loadFloatTree&&this.config.loadFloatTree();var n=$.event(e).srcElement,o=$(n),r=document.createElement("DIV");r.id=this.config.floatTreeId+"Frame",r.style.cssText="position:absolute;width:"+t+"px;height:0px;border:#ccc 1px solid;background:#ffffff; padding:1px;text-align:left;overflow:auto;",r.innerHTML=this.config.loadingString,document.body.appendChild(r),r.onclick=function(e){$.event(e).cancelBubble()},r.style.left=o.getAbsoluteLeft()+1+"px",r.style.top=o.getAbsoluteTop()+n.offsetHeight+"px",this.interval=window.setInterval(this.fullObjName+".intervalShow("+i+")",10)}},intervalShow:function(e){var t=this.config.floatTreeId+"Frame",i=$(t).clientHeight+15;if(e<=i){if(this.floatTreeFrameId=t,$(this.config.floatTreeId)&&""!=$(this.config.floatTreeId).innerHTML){var n=$(this.config.floatTreeId);$(t).innerHTML="",n.style.display="block",$(t).appendChild(n),window.clearInterval(this.interval)}}else $(t).style.height=i+"px"},clearFloatFrame:function(){if(this.floatTreeFrameId){var e=$(this.floatTreeFrameId);if(!this.config.reBuildTree){var t=$(this.config.floatTreeId);t.style.display="none",document.body.appendChild(t)}document.body.removeChild(e),this.floatTreeFrameId=null,window.clearInterval(this.interval)}$("orderDiv")&&document.body.removeChild($("orderDiv"))},initResourceTree:function(e,t){t||(t=$.url.root+"/resource/load-all");var n=this;this.config.loadFloatTree=function(){$.ajax.json(t,e,function(e){var t=e.data||e.message;n.aNodes=[],n.resetIcon(),n.config.usePlusMinusIcons=!1,n.config.useRootIcon=!1,n.add(t[0].parentId,-1,""),n.resetIcon();for(var i=0;i<t.length;i++)$.isNullOrEmpty(t[i].icoUrl)&&(t[i].icoUrl=$.DEFAULT_RESOURCE_ICO_URL),n.add(t[i].id,t[i].parentId,t[i].name,"javascript:"+n.fullObjName+".codeNodeClick("+(i+1)+");",t[i].name,void 0,void 0,void 0,t[i],t[i].icoUrl);$(n.config.floatTreeId).innerHTML=n})}},initCodeTooltip:function initCodeTooltip(codePrefix,ajaxUrl){var htmlEvents="$('#'+{0}.config.descTextBoxId).bind('onchange',function(){if($({0}.config.descTextBoxId).value==''){$({0}.config.descHiddenId).value='';if(typeof({0}.config.valueTextBoxId)!='undefined'){$({0}.config.valueTextBoxId).value='';$({0}.config.valueTextBoxId).readOnly='readonly';}}});".format(this.fullObjName);eval(htmlEvents);var treeObject=this;if(null==$(treeObject.config.floatTreeId)){var floatTree=$("+div").s;floatTree.id=treeObject.config.floatTreeId,floatTree.className="floatTree",document.body.appendChild(floatTree)}ajaxUrl||(ajaxUrl=$.url.root+"/code/load"),this.dbs=function(e){var t=this.aNodes[e].businessEntity;if(null!=this.config.descHiddenId&&($(this.config.descHiddenId).value=t.id),null!=this.config.descTextBoxId){var i=$(this.config.descTextBoxId);"text"===i.type?i.value=this.getAllNameOfNode(this.aNodes[e],"/"):i.innerHTML=this.getAllNameOfNode(this.aNodes[e],"/")}null!=this.config.valueTextBoxId&&($(this.config.valueTextBoxId).value=t.value),this.codeNodeCallBack&&this.codeNodeCallBack(this.aNodes[e]),this.clearFloatFrame(),this.config.validate?this.config.validate():this.config.validateConfig&&$.v.isNull(this.config.validateConfig,i)},treeObject.config.loadFloatTree=function(){$.ajax.json(ajaxUrl,"prefix="+codePrefix,function(e){var t=e.data||e.message;treeObject.aNodes=[],treeObject.resetIcon(),treeObject.config.usePlusMinusIcons=!1,treeObject.config.useRootIcon=!1,treeObject.add(t[0].parentId,-1,"");for(var i=0;i<t.length;i++)treeObject.add(t[i].id,t[i].parentId,t[i].name,"javascript:"+treeObject.fullObjName+".codeNodeClick("+(i+1)+");",t[i].code+"|"+t[i].name,void 0,void 0,void 0,t[i]);$(treeObject.config.floatTreeId).innerHTML=treeObject})}},codeNodeClick:function(e){0===this.aNodes[e].childCount&&this.dbs(e)}},Sparrow.dispatcher={builder:{id:"id",delegate:"delegate",api:"api",strategy:"strategy",eventName:"eventName"},commandAdapter:{},ctrlIdEventMap:{},eventRegistry:[],register:function(e){this.eventRegistry.push(e)},dispatcher:function(e,t){var i=t.id+"_"+t.value,n=this.commandAdapter[i],o=null;null!=n&&(o=n.delegate),null==o&&null!=(n=this.commandAdapter[t.id])&&(o=n.delegate),null!=n&&null!=o&&(n.api?$.ajax.json(n.api,n.parameter,o,t):o(e,t))},bind:function(){for(var e=0;e<this.eventRegistry.length;e++){var t=this.eventRegistry[e],i=t.strategy,n=t.eventName,o=t.id+(i?"_"+i:"");this.commandAdapter[o]=t,this.ctrlIdEventMap[t.id]=n||"onclick"}for(ctrlId in this.ctrlIdEventMap)$("#"+ctrlId).bind(this.ctrlIdEventMap[ctrlId],function(e){Sparrow.dispatcher.dispatcher(e,$.event(e).srcElement)})}},Sparrow.metricChart=function(e,t,i){this.container=e,this.chartId=t,this.config=i},Sparrow.metricChart.prototype.init=function(e){var t=document.getElementById(this.chartId);null==t&&((t=document.createElement("div")).id=this.chartId,t.style.height=this.config.height,this.container.appendChild(t));var i=e.init(t),n={title:{text:""},tooltip:{trigger:"axis"},legend:{data:[]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value"},series:[]};n.title.text=this.config.title,n.legend.data=this.config.legend,n.series=this.config.data,n.xAxis.data=this.config.x,i.setOption(n,!0),Sparrow.metricChart.containers,Sparrow.metricChart.charts[this.chartId]=i,Sparrow.metricChart.options[this.chartId]=n},Sparrow.metricChart.charts={},Sparrow.metricChart.options={},Sparrow.metricChart.changeType=function(e,t){for(var i=Sparrow.metricChart.charts[e],n=Sparrow.metricChart.options[e],o=0;o<n.series.length;o++)n.series[o].type=t;i.setOption(n,!0)},Sparrow.user={authorMap:null,author:null,login:{dialog:function(e,t){var i=$.url.passport+"/login-dialog?register=false&callback-ns="+e;$.isNullOrEmpty(t)||(i+="&parameter="+t),document.domain=$.browser.cookie.root_domain,$.window({url:i,showHead:!1})},ns_callback:{publish:"thread.publish",attention:"user.attention",cancel_attention:"user.attention.cancel",comment:"thread.comment",upload:"upload",like_thread:"thread.like"}},getZone:function(e){return $.url.root+"/zone-"+e},getAvatar:function(e){return e||$.DEFAULT_AVATOR_URL},editable:function(e){var t=$.browser.getUserId();return!(t<=0)&&e===t},initLoginBar:function(){if($("divAccount")){if($.browser.isLogin()){$("divAccount").style.display="block",$("divLogin").style.display="none";var e=$("hyperUser");return $(e).html($.browser.getUserName()),e.title=$.browser.getUserName(),void(e.href=$.user.getZone($.browser.getUserId()))}$("divAccount").style.display="none",$("divLogin").style.display="block"}},popup:function(e,t){var i=null==this.authorMap?this.author:this.authorMap[t],n=$("divUserInfo");null==n&&((n=$("+div.divUserInfo")).s.style.cssText="border: #ccc 1px solid; position: absolute; width:300px; height:120px; background: #ffffff;overflow: hidden;",n.s.onmouseover=function(e){console.log("user info  mouse over ..."),$.event(e).cancelBubble()},document.body.appendChild(n.s)),$("divUserInfo").style.top=$(e).getAbsoluteTop()-2+"px",$("divUserInfo").style.left=$(e).getAbsoluteLeft()-2+"px";var o=[];o.push('<table style="border: 0;background:#fff;" cellpadding="0" cellspacing="0">'),o.push("<tr>"),o.push('<td style="border: 0; width:60px;" valign="top">'),o.push('<a href="{0}" target="_blank"><img style="width:50px; height: 50px; border: 2px #EDEDED solid;" src="{1}" /></a>'.format(this.getZone(i.id),this.getAvatar(i.avatar))),o.push("</td>"),o.push('<td style="border: 0; width: 240px; line-height: 25px;text-align:left;">'),o.push('昵称:<a href="{2}" target="_blank"><span>{0}</span></a>{1}<br />'.format(i.name,"attention",this.getZone(i.id))),o.push("性别:<span>{0}</span><br />".format(i.gender)),i.createTime&&o.push("注册日期:<span>{0}</span><br />".format(i.createTime)),i.lastLoginTime&&o.push("最后登陆:<span>{0}</span><br />".format(i.lastLoginTime)),$.isNullOrEmpty(i.status)||o.push("状态：<span>{0}</span><br />".format(i.status)),$("divUserInfo").innerHTML=o.join(""),$("#divUserInfo").show(),document.onmouseover=function(e){$("#divUserInfo").hidden()}},json:function(e){var t=$(e);return null!=t&&(e=t.value.json()),e},initAuthor:function(e){this.author=this.json(e)},initAuthorMap:function(e){this.authorMap=this.json(e)},attention:function(){return!1},getToken:function(){var e=Sparrow.request("token");return Sparrow.isNullOrEmpty(e)?localStorage.getItem("token"):(localStorage.setItem("token",e),e)}},Sparrow.share={config:{icon:$.url.resource+"/images/share.png",share:[{url:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?style=202&width=80&height=31&showcount=1&url={0}&title={1}&pics={2}&desc={3}&summary={4}&site="+encodeURIComponent($.browser.getCookie($.browser.cookie.website_name))+"&otype=share",position:{left:160,top:0},title:"分享到QQ空间"},{url:"http://service.weibo.com/share/share.php?appkey=318168823&url={0}&title={1}&pic={2}&ralateUid=3199233727",position:{left:0,top:0},title:"分享到新浪微博"}]},init:function(){for(var e=document.getElementsByName("share"),t=[],i=0;i<this.config.share.length;i++)t.push('<a target="_blank" style="height:32px;width:32px;display:inline-block;background:url({0}) {1}px {2}px;" title="{3}" href="{4}"></a>'.format(this.config.icon,this.config.share[i].position.left,this.config.share[i].position.top,this.config.share[i].title,this.config.share[i].url));shareTemplate=t.join("");for(var n=e.length-1;0<=n;n--){var o=e[n].value.json();e[n].parentNode.innerHTML=shareTemplate.format(encodeURIComponent(o.url),encodeURIComponent(o.title),encodeURIComponent(o.pic),encodeURIComponent(o.comment),encodeURIComponent(o.summary))}}},Sparrow.webSocket=function(e,t){this.url=e,this.token=t,this.onMsgCallback=null,this.heartTime=1e4,this.heartTimeout=2e4,this.reconnectTime=500,this.timeoutTimer=null,this.serverTimeoutTimer=null,this.ws=null,this.lastHeartTime=0,this.reconnectionAlarmTimer=null,this.reconnectionAlarmCallback=null,this.userId=null},Sparrow.webSocket.prototype.connect=function(e,t){try{"WebSocket"in window&&(this.ws=new WebSocket(this.url,[this.token]),this._onOpen(),this._onMsg(e,t),this._onClose(t),this._onError(t))}catch(e){console.log(e),this.reconnectWebSocket()}},Sparrow.webSocket.prototype.close=function(){this.ws.close()},Sparrow.webSocket.prototype.reconnectWebSocket=function(){var e=this;new Date-this.lastHeartTime>2*this.heartTimeout?(console.log("发起重连"),this.reconnectionAlarmTimer=setInterval(function(){e.reconnectionAlarmCallback&&e.reconnectionAlarmCallback(),console.log("连接断开，请刷新浏览器！")},1e4),this.closeHeartBeat()):console.log("服务器顶替逻辑，不重连!")},Sparrow.webSocket.prototype._onOpen=function(){var t=this;this.ws.onopen=function(e){console.log(e.currentTarget.protocol),console.log("连接成功"+e),t.closeHeartBeat(),t.startHeartBeat()}},Sparrow.webSocket.prototype._onMsg=function(t){var i=this;this.ws.onmessage=function(e){if(console.log("收到消息"+e.data),"string"==typeof e.data){if("PONG"===e.data)return void(i.lastHeartTime=(new Date).getTime());if("offline"===e.data)return i.lastHeartTime=(new Date).getTime(),void(i.onMsgCallback&&i.onMsgCallback({offline:!0}));if(-1<e.data.indexOf("USER."))return i.userInfo=e.data.substring(5),void t(i.userInfo)}i.onMsgCallback(e.data)}},Sparrow.webSocket.prototype._onClose=function(t){var i=this;this.ws.onclose=function(e){console.log("close 事件"),e.wasClean?console.log("不重连"):i.reconnectWebSocket(),t(e)}},Sparrow.webSocket.prototype._onError=function(t){var i=this;this.onerror=function(e){console.log("连接出错"+e),i.reconnectWebSocket(),t(e)}},Sparrow.webSocket.prototype.startHeartBeat=function(){var e=this;this.timeoutTimer=setInterval(function(){try{e.ws.send("PING")}catch(e){console.log("heart beat error:"+e)}console.log("heart beat: "+(new Date).getSeconds()+" timer id:"+e.timeoutTimer)},this.heartTime),this.serverTimeoutTimer=setInterval(function(){(new Date).getTime()-e.lastHeartTime>2*e.heartTime&&e.reconnectWebSocket()},this.heartTimeout)},Sparrow.webSocket.prototype.closeHeartBeat=function(){clearTimeout(this.timeoutTimer),clearTimeout(this.serverTimeoutTimer)},Sparrow.webSocket.prototype.sendMessage=function(e){this.ws.send(e.toBytes())},"function"==typeof define&&define.amd&&define("Sparrow",[],function(){return Sparrow}),noGlobal||(window.Sparrow=window.$=Sparrow),Sparrow});
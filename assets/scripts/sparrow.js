"use strict";function asyncGeneratorStep(t,e,i,o,n,r,s){try{var a=t[r](s),l=a.value}catch(t){return void i(t)}a.done?e(l):Promise.resolve(l).then(o,n)}function _asyncToGenerator(a){return function(){var t=this,s=arguments;return new Promise(function(e,i){var o=a.apply(t,s);function n(t){asyncGeneratorStep(o,e,i,n,r,"next",t)}function r(t){asyncGeneratorStep(o,e,i,n,r,"throw",t)}n(void 0)})}}function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(t,e){"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?module.exports=t.document?e(t,!0):function(t){if(!t.document)throw new Error("Sparrow requires a window with a document");return e(t)}:e(t)}("undefined"!=typeof window?window:void 0,function(window,noGlobal){String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},String.prototype.ltrim=function(){return this.replace(/(^\s*)/g,"")},String.prototype.rtrim=function(){return this.replace(/(\s*$)/g,"")},String.prototype.json=function(){if(""===this||"''"===this||0===this.length)return null;-1!==this.indexOf("error|")&&console.log(this);try{var json=this;return json=json.decodeSplitKey(),eval("("+json.replace(/\r\n/g,"<br/>").replace(/\n/g,"<br/>")+")")}catch(t){return console.log(t)}},String.prototype.firstCharToAscii=function(){return this.charCodeAt(0)},String.prototype.leftAlignWithChar=function(t,e){if(e=e||3,t=t||"0",!(this.length>=e)){for(var i=[],o=e-this.length,n=0;n<o;n++)i.push(t);return i.join("")+this}},String.prototype.getCountByChar=function(t){return this.split(t).length-1},String.prototype.getByteLength=function(){return this.replace(/[^\x00-\xff]/g,"**").length},String.prototype.subString=function(t,e){var i,o=0,n="",r=/[^\x00-\xff]/g,s="",a=this.replace(r,"**").length;for(i=0;i<a&&((s=this.charAt(i).toString()).match(r)?o+=2:o+=1,!(t<o));i+=1)n+=s;return e&&t<a&&(n+=".."),n},String.prototype.decodeSplitKey=function(){var t=this;return t=(t=(t=(t=t.replace(/#colon#/g,":")).replace(/#dot#/g,",")).replace(/#ref#/g,'\\"')).replace(/#limit/g,"#")},String.prototype.decodeHtml=function(){var t=this;return t=(t=(t=(t=(t=t.replace(/&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&quot;/g,'"')).replace(/&nbsp;/g," ")},String.prototype.format=function(){var t=this;if(1<=arguments.length&&"object"===_typeof(arguments[0])){for(var e=/#{(.*?)}/gi,i=null;i=e.exec(this);){var o=i[0],n=i[1],r=arguments[0].value(n);if(1<arguments.length)for(var s=1;s<arguments.length&&!(r=arguments[s].value(n));s++);t=t.replace(o,$.isNullOrEmpty(r)?"-":r)}return t}var a=null;for(s=0;s<arguments.length;s++)a=new RegExp("\\{"+s+"\\}","gm"),t=t.replace(a,$.isNullOrEmpty(arguments[s])?"-":arguments[s]);return t},String.prototype.filterHTML=function(){for(var t=this;-1<t.search(/<([a-z0-9]*?).*?>([\s\S]*?)<\/\1>/gi);)t=t.replace(/<([a-z0-9]*?).*?>([\s\S]*?)<\/\1>/gi,"$2");return t.search(/<input.*>/)&&(t=t.replace(/<input.*>/gi,"")),t.search(/<(script).*?>.*?<\/\1>/)&&(t=t.replace(/<(script).*?>.*?<\/\1>/gi,"")),t.search(/<script.*>/)&&(t=t.replace(/<script.*>/gi,"")),t},String.prototype.firstCharUpperCase=function(){return this.substr(0,1).toUpperCase()+this.substr(1)},String.prototype.join=function(t){return $.isNullOrEmpty(t)?this+"":this+t},String.prototype.toArrayBuffer=function(){var t,e,i=[];t=this.length;for(var o=0;o<t;o++)65536<=(e=this.charCodeAt(o))&&e<=1114111?(i.push(e>>18&7|240),i.push(e>>12&63|128),i.push(e>>6&63|128),i.push(63&e|128)):2048<=e&&e<=65535?(i.push(e>>12&15|224),i.push(e>>6&63|128),i.push(63&e|128)):128<=e&&e<=2047?(i.push(e>>6&31|192),i.push(63&e|128)):i.push(255&e);var n=new Int8Array(i.length);for(var o in i)n[o]=i[o];return n},Array.prototype.clear=function(){for(var t=0;t<this.length;t+=1)this.pop()},Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1},Array.prototype.remove=function(t){var e=this.indexOf(t);-1<e&&this.splice(e,1)},Array.prototype.toUint8Array=function(){for(var t=new Uint8Array(this.length),e=0;e<t.length;e++)t[e]=this[e];return t},Array.prototype.push||(Array.prototype.push=function(){for(var t=0;t<arguments.length;t++)this[this.length]=arguments[t];return this.length}),Array.prototype.pop||(Array.prototype.pop=function(){return lastElement=this[this.length-1],this.length=Math.max(this.length-1,0),lastElement}),Uint8Array.prototype.toString=function(){for(var t=new DataView(this.buffer),e=new Uint8Array(this.buffer.byteLength),i=0;i<e.length;i++)e[i]=t.getUint8(i);var o="",n=e;for(i=0;i<n.length;i++){var r=n[i].toString(2),s=r.match(/^1+?(?=0)/);if(s&&8===r.length){for(var a=s[0].length,l=n[i].toString(2).slice(7-a),c=1;c<a;c++)l+=n[c+i].toString(2).slice(2);o+=String.fromCharCode(parseInt(l,2)),i+=a-1}else o+=String.fromCharCode(n[i])}return o},Number.prototype.toBytes=function(){length=4;for(var t=this,e=[],i=length;e[--i]=255&t,t>>=8,i;);return e},Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var i in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),e)new RegExp("("+i+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[i]:("00"+e[i]).substr((""+e[i]).length)));return t};var Sparrow=function t(e,i,o,n,r){if(window===this||!(this instanceof t)){var s=Array.prototype.slice.call(arguments,0);if(!e)return null;if("function"==typeof e)return e.apply(e,s.slice(1));if("jsonp"===s[0]){var a=document.createElement("script");a.type="text/javascript",a.language="javascript",a.src=s[1],a.id=s[2];var l=document.getElementById(a.id);return null!=l&&document.head.removeChild(l),document.head.appendChild(a),null}if("object"===_typeof(r=e)&&(r="#"+e.id),i=null,o=document,n=!0,2<=s.length&&("boolean"==typeof s[1]?n=s[1]:i=s[1],3<=s.length&&("boolean"==typeof s[2]?n=s[2]:o=s[2]),4===s.length&&(n=s[3])),null!=i&&"object"===_typeof(i)&&(i.id||(i.id="sparrow_"+$.random()),r+="_"+i.id),$.global(r))return $.global(r);return"object"!==_typeof(e)&&-1==["#","!","$","&","*","+","^"].indexOf(e.substring(0,1))?o.getElementById(e):new t(e,i,o,n,r)}var c=[];if(this.selector=e,this.doc=o,"object"===_typeof(e))(c[0]=e).id||(e.id="sparrow_"+$.random()),this.selector="#"+e.id,r=this.selector;else if("string"==typeof e){var h=e.substring(0,1),d=(e=e.substring(1)).split("."),u=0;switch(h){case"#":c[0]=o.getElementById(e);break;case"^":c=o.getElementsByTagName(e);break;case"&":c=o.getElementsByName(e);break;case"+":c[0]=o.createElement(d[0]),2<=d.length?c[0].id=d[1]:c[0].id="sparrow_"+$.random(),this.selector="#"+d[1],r=this.selector,3<=d.length&&("doc"===d[2]?this.doc.body.appendChild(c[0]):this.doc.getElementById(d[2]).appendChild(c[0])),4<=d.length&&(c[0].type=d[3]);break;case"!":var f=[];i||(i=$(d[1]));var p=i.getElementsByTagName(d[0]);for("li"===d[0]&&(i=p[0].parentNode),(this.s=i).id||(i.id="sparrow_"+$.random()),u=0;u<p.length;u++)p[u].parentNode===i&&(f[f.length]=p[u]);c=f;break;case"$":var g=o.getElementsByTagName("label");for(u=0;u<g.length;u++)if(g[u].attributes.for.value===e){c[0]=g[u];break}break;case"*":var m=[],v=o.getElementsByName(d[0]),w=null;for(1<d.length&&(w=d[1]),u=0;u<v.length;u++)v[u].checked&&(m[m.length]=w?v[u].attributes[w].value:v[u].value);c=m}}return e&&((this.length=0)<c.length&&(this.s||(this.s=c[0]),this.s&&this.s.id&&n&&$.global(r,this)),[].push.apply(this,c)),this.interval=[],this},zc,Ac,Bc,Cc,If,vf,hf,We,Je,Be,oe,ae,Nd,yd,Vc;window.$=window.Sparrow=Sparrow,Sparrow.browser={visibility:!1,url:{manage:"default.jsp",logout_url:"/user/logout.json"},cookie:{permission:"PERMISSION",call_back_url:"call_back_url",website_name:"website_name",themes:"sparrow.themes",root_domain:$(function(){return window.location.host.substr(window.location.host.indexOf(".")+1)}),domain:window.location.host},ie:$(function(){return-1!==navigator.userAgent.search(/MSIE/gim)}),opera:$(function(){return-1!==navigator.userAgent.search(/Opera/gim)}),firefox:$(function(){return-1!==navigator.userAgent.search(/Firefox/gim)}),google:$(function(){return-1!==navigator.userAgent.search(/Chrome/gim)}),version:$(function(){return-1!==navigator.userAgent.search(/MSIE/gim)?(navigator.userAgent.match(/MSIE\b\s*([0-9\.0-9]+);/gim),RegExp.$1):-1!==navigator.userAgent.search(/Opera/gim)?(navigator.userAgent.match(/Version\/([0-9\.]+)/gim),RegExp.$1):-1!==navigator.userAgent.search(/Firefox/gim)?(navigator.userAgent.match(/Firefox\/([0-9\.]+)/gim),RegExp.$1):-1!==navigator.userAgent.search(/Chrome/gim)?(navigator.userAgent.search(/Chrome\/([0-9\.]+)/gim),RegExp.$1):void 0}),addFavorite:function(t,e){document.all?window.external.AddFavorite(t,e):window.sidebar?window.sidebar.addPanel(e,t,""):alert("对不起，您的浏览器不支持此操作!\n请您使用菜单栏或Ctrl+D收藏本站。")},setHome:function(t,e){try{t.style.behavior="url(#default#homepage)",t.setHomePage(e)}catch(t){if(window.netscape)try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"),Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch).setCharPref("browser.startup.homepage",e)}catch(t){alert("抱歉！您的浏览器不支持直接设为首页。请在浏览器地址栏输入“about:config”并回车然后将[signed.applets.codebase_principal_support]设置为“true”，点击“加入收藏”后忽略安全提示，即可设置成功。")}}},copy:function(t,e){e||(e="成功复制！可以通过ctrl+v进行粘贴操作！");try{if(window.clipboardData)return window.clipboardData.setData("Text",t),void alert(e);try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(t){return alert("您的浏览器设置为不允许复制！\n如果需要此操作，请在浏览器地址栏输入'about:config'并回车\n然后将'signed.applets.codebase_principal_support'设置为'true',再重试复制操作!"),!1}var i=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(!i)return;var o=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!o)return;o.addDataFlavor("text/unicode");var n=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);n.data=t,o.setTransferData("text/unicode",n,t.getByteLength());var r=Components.interfaces.nsIClipboard;if(!i)return!1;i.setData(o,null,r.kGlobalClipboard),alert(e)}catch(t){alert("对不起！您的浏览器不支持该功能")}},setCookie:function(t,e,i,o,n,r){var s=null;0!==i&&i&&(s=new Date).setTime(s.getTime()+1e3*i),document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+(s?"; expires="+s.toGMTString():"")+"; path="+(n||"/")+"; domain="+(o||this.cookie.root_domain)+(r?"; secure":"")},getCookie:function(t){var e=null,i=document.cookie.indexOf(escape(t)+"=");if(-1!==i){var o=i+(escape(t)+"=").length,n=document.cookie.indexOf(";",o);e=-1!==n?decodeURIComponent(document.cookie.substring(o,n)):decodeURIComponent(document.cookie.substring(o))}return null==e||void 0===e||"undefined"===e?null:e},showModalDialog:function(t,e,i,o,n){var r;i=$.randomUrl(i),(r=$.browser.ie?window.showModalDialog(i,n,"dialogHeight:{0}px; dialogWidth:{1}px; status:no; help:no; scroll:auto".format(e,t)):window.open(i,n,"height={0}, width={1},toolbar= no, menubar=no, scrollbars=auto, resizable=no, location=no, status=no,top=100,left=300".format(e,t)))&&o(r)},window:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(t){var e=$.randomUrl(t.url);t.win||(t.win=window);var i=t.target?t.target:"_blank",o=null;$.isNullOrEmpty(t.width)&&(o="height={0}px,width={1}px,toolbar= no, menubar=no, scrollbars=auto, resizable=no, location=no, status=no,top=100,left=300".format(t.height,t.width)),t.win.open(e,i,o)}),close:function(){window.opener=null,window.open("about:blank","_self"),window.close()},getUrlWithoutParameter:function(t){var e=t||window.location.href,i=e.indexOf("?");return i<0&&(i=e.indexOf("#")),-1<i&&(e=e.substring(0,i)),e},getUserId:function(){var t=$.browser.getCookie(this.cookie.permission);return null==t?0:t.split("&")[0].substring("id=".length)},getUserName:function(){var t=$.browser.getCookie(this.cookie.permission);return null==t?null:t.split("&")[1].substring("name=".length)},isLogin:function(){var t=$.browser.getUserId();return!(null==t||0===t||"0"===t||"null"===t||""===t)},logout:function(i,t,o){$.isNullOrEmpty(t)&&(t=this.url.logout_url),$.isNullOrEmpty(o)&&(o=this.url.manage),$.ajax.json($.url.root+t,function(t){var e=t.value;$.isNullOrEmpty(e)&&(e=$.browser.cookie.permission),$.browser.setCookie(e,"0",-1,i),$.url.root+"/"===window.parent.location.href||-1!==window.parent.location.href.indexOf(o)?window.parent.location.href=$.url.root:window.location.href=window.location.href},!0)},getClientHeight:function(){return document.body.clientHeight&&document.documentElement.clientHeight?Math.min(document.body.clientHeight,document.documentElement.clientHeight):Math.max(document.body.clientHeight,document.documentElement.clientHeight)},getScrollHeight:function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)},linkClick:function(t,e){return"boolean"==typeof t?!!t||($.alert(e,"sad"),!1):"javascript:void(0);"!==t.href||($.alert(e,"sad"),!1)},bindVisibilityChangeEventListener:function(){var t="hidden"in document?"hidden":"webkitHidden"in document?"webkitHidden":"mozHidden"in document?"mozHidden":null,e=t.replace(/hidden/i,"visibilitychange");document.addEventListener(e,function(){document[t]?Sparrow.browser.visibility=!0:Sparrow.browser.visibility=!1})}},Sparrow.container={},Sparrow.global=function(t,e){if(void 0===e)return this.container[t];this.container[t]=e},Sparrow.remove=function(t){delete this.container[t]},zc=!(!window.attachEvent||window.opera),Ac=/webkit\/(\d+)/i.test(navigator.userAgent)&&RegExp.$1<525,Bc=[],Cc=function(){for(var t=0;t<Bc.length;t++)Bc[t]()},document.ready=function(t){if(!zc&&!Ac&&document.addEventListener)return document.addEventListener("DOMContentLoaded",t,!1);if(!(1<Bc.push(t)))if(zc)!function(){try{document.documentElement.doScroll("left"),Cc()}catch(t){setTimeout(arguments.callee,0)}}();else if(Ac){var e=null;e=setInterval(function(){/^(loaded|complete)$/.test(document.readyState)&&(clearInterval(e),Cc())},0)}},Sparrow.url={root:$(function(){"/"===window.location.pathname||window.location.pathname.split("/")[1];return window.location.protocol+"//"+window.location.host}),_resource:function(t){var o=document.scripts,n=["/scripts/sparrow.js","/scripts/sparrow-min.js","/scripts-dev/sparrow.js"];if(t&&(n=[t]),null==o||0===o.length)return null;for(var r=null,s=0;s<o.length;s++){var a=!1;if(n.forEach(function(){for(var t=0;t<n.length;t++){var e=n[t],i=o[s].src.indexOf(e);-1<i&&(r=o[s].src.substring(0,i),a=!0)}}),a)break}return r},name:$.browser.cookie.domain.split(".")[0]},Sparrow.url.resource=$.url._resource(),Sparrow.url.passport=$(function(){return"http://passport."+$.browser.cookie.root_domain}),Sparrow.website={name:$.browser.getCookie($.browser.cookie.website_name),themes:$(function(){var t=$.browser.getCookie($.browser.cookie.themes);return null==t&&(t="themes_default"),t})},Sparrow.css={menu:{frame:"background:#ffffff;position:absolute;z-index:1000;border:#ccc 1px solid;width:{0}px;height:auto;left:{1}px;top:{2}px;display:none",ul:"width:{0}px;height:auto;overflow:hidden;list-style:none;margin:0px;padding:0px;text-align:left",li:"width:{0}px;overflow:hidden;line-height:20px;margin:0px;border-bottom:#ccc 1px dotted;cursor:pointer;"}},Sparrow.SIDE="SIDE",Sparrow.HORIZONTAL="HORIZONTAL",Sparrow.VERTICAL="VERTICAL",Sparrow.DEFAULT_AVATOR_URL=$.url.resource+"/images/user.png",Sparrow.DEFAULT_RESOURCE_ICO_URL=$.url.resource+"/images/menu.png",Sparrow.indexedDB=function(t){this.support=window.indexedDB,this.instance=null,this.name=t.name,this.config=t,this.userId=localStorage.getItem("userId"),this.initSuccess=!1,this.$initDB=null},Sparrow.indexedDB.prototype={init:(Vc=_asyncToGenerator(regeneratorRuntime.mark(function t(){var r=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.support){t.next=2;break}return t.abrupt("return",this.support);case 2:return this.request=window.indexedDB.open(this.name+this.userId,this.config.version),t.next=5,new Promise(function(o,n){r.request.onsuccess=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){var i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r.instance=e.target.result,console.log("数据库连接成功"),t.next=4,r.flush();case 4:if(i=t.sent,console.log("数据库flush结果",i),!i){t.next=15;break}if(r.initSuccess=!0,console.log("数据库flush成功"),r.$dbInit)return t.next=12,r.$dbInit();t.next=12;break;case 12:o(r.instance),t.next=16;break;case 15:n("数据库连接失败");case 16:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}(),r.request.onupgradeneeded=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function t(e){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("首次创建数据库"),r.instance=e.target.result,r._initTables(),r.$dbInit)return t.next=6,r.$dbInit();t.next=6;break;case 6:r.initSuccess=!0,o(r.instance);case 8:case"end":return t.stop()}},t,this)}));return function(t){return e.apply(this,arguments)}}(),r.request.onerror=function(t){console.log("数据库发生错误",t),n("连接indexedDB出错")}});case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}},t,this)})),function(){return Vc.apply(this,arguments)}),_createTable:function(t,e){this.instance.createObjectStore(t,{keyPath:e})},_initTables:function(){var e=this;this.config.tableNames.forEach(function(t){e._createTable(t.name,t.key)})},_getTableInstance:function(t){return this.instance.transaction(t,"readwrite").objectStore(t)},put:(yd=_asyncToGenerator(regeneratorRuntime.mark(function t(o,n){var r=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.support){t.next=2;break}return t.abrupt("return",this.support);case 2:if(this.initSuccess){t.next=5;break}return t.next=5,this.init();case 5:return t.next=7,new Promise(function(e,i){var t=r._getTableInstance(o).put(n);t.onsuccess=function(t){console.log("put success: TABLE-NAME"+o+" item "+n),e(t.target.result)},t.fail=function(t){i(t.target.result)}});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)})),function(t,e){return yd.apply(this,arguments)}),get:(Nd=_asyncToGenerator(regeneratorRuntime.mark(function t(o,n){var r=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.support){t.next=2;break}return t.abrupt("return",this.support);case 2:if(this.initSuccess){t.next=5;break}return t.next=5,this.init();case 5:return t.next=7,new Promise(function(e,i){console.log("GET tableName "+o+", get key:"+n);var t=r._getTableInstance(o).get(n);t.onsuccess=function(t){e(t.target.result)},t.fail=function(t){i(t.target.result)}});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)})),function(t,e){return Nd.apply(this,arguments)}),delete:(ae=_asyncToGenerator(regeneratorRuntime.mark(function t(o,n){var r=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.support){t.next=2;break}return t.abrupt("return",this.support);case 2:if(this.initSuccess){t.next=5;break}return t.next=5,this.init();case 5:return t.next=7,new Promise(function(t,e){var i=r._getTableInstance(o).delete(n);i.onsuccess=function(){console.log("delete success: TABLE-NAME"+o+" ,key "+n),t("tableName "+o+" ,key "+n)},i.fail=function(t){e(t)}});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)})),function(t,e){return ae.apply(this,arguments)}),clear:(oe=_asyncToGenerator(regeneratorRuntime.mark(function t(o){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.support){t.next=2;break}return t.abrupt("return",this.support);case 2:return t.next=4,new Promise(function(e,i){var t=n._getTableInstance(o).clear();t.onsuccess=function(t){console.log("clear success: TABLE-NAME",o),e(t.target.result)},t.fail=function(t){i(t.target.result)}});case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t,this)})),function(t){return oe.apply(this,arguments)}),flush:(Be=_asyncToGenerator(regeneratorRuntime.mark(function t(){var e,i;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.support){t.next=2;break}return t.abrupt("return",this.support);case 2:e=0;case 3:if(e<this.config.tableNames.length)return i=this.config.tableNames[e].name,t.next=7,this.clear(i).then(function(){console.log("clear success: TABLE-NAME",i)}).catch(function(t){console.log(t)});t.next=10;break;case 7:e++,t.next=3;break;case 10:return console.log("flush all table success"),t.abrupt("return",!0);case 12:case"end":return t.stop()}},t,this)})),function(){return Be.apply(this,arguments)}),getAll:(Je=_asyncToGenerator(regeneratorRuntime.mark(function t(o){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.support){t.next=2;break}return t.abrupt("return",this.support);case 2:if(this.initSuccess){t.next=5;break}return t.next=5,this.init();case 5:return t.next=7,new Promise(function(e,i){var t=n._getTableInstance(o).getAll();t.onsuccess=function(t){console.log("getAll success: TABLE-NAME",o),e(t.target.result)},t.fail=function(t){i(t.target.result)}});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)})),function(t){return Je.apply(this,arguments)}),getAllKeys:(We=_asyncToGenerator(regeneratorRuntime.mark(function t(o){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.support){t.next=2;break}return t.abrupt("return",this.support);case 2:if(this.initSuccess){t.next=5;break}return t.next=5,this.init();case 5:return t.next=7,new Promise(function(e,i){var t=n._getTableInstance(o).getAllKeys();t.onsuccess=function(t){console.log("getAllKeys success: TABLE-NAME:",o+" ,keys:",t.target.result),e(t.target.result)},t.fail=function(t){i(t.target.result)}});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)})),function(t){return We.apply(this,arguments)}),count:(hf=_asyncToGenerator(regeneratorRuntime.mark(function t(o){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.support){t.next=2;break}return t.abrupt("return",this.support);case 2:if(this.initSuccess){t.next=5;break}return t.next=5,this.init();case 5:return t.next=7,new Promise(function(e,i){var t=n._getTableInstance(o).count();t.onsuccess=function(t){console.log("count success: TABLE-NAME",o),e(t.target.result)},t.fail=function(t){i(t.target.result)}});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)})),function(t){return hf.apply(this,arguments)}),openCursor:(vf=_asyncToGenerator(regeneratorRuntime.mark(function t(o){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.support){t.next=2;break}return t.abrupt("return",this.support);case 2:if(this.initSuccess){t.next=5;break}return t.next=5,this.init();case 5:return t.next=7,new Promise(function(e,i){var t=n._getTableInstance(o).openCursor();t.onsuccess=function(t){console.log("openCursor success: TABLE-NAME.",o),e(t.target.result)},t.fail=function(t){i(t.target.result)}});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)})),function(t){return vf.apply(this,arguments)}),openKeyCursor:(If=_asyncToGenerator(regeneratorRuntime.mark(function t(o){var n=this;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.support){t.next=2;break}return t.abrupt("return",this.support);case 2:if(this.initSuccess){t.next=5;break}return t.next=5,this.init();case 5:return t.next=7,new Promise(function(e,i){var t=n._getTableInstance(o).openKeyCursor();t.onsuccess=function(t){console.log("openKeyCursor success:TABLE-NAME",o),e(t.target.result)},t.fail=function(t){i(t.target.result)}});case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)})),function(t){return If.apply(this,arguments)})},Sparrow.ajax={tokenConfig:{},_objPool:[],referWindow:window,url:null,srcElement:null,SUCCESS:"0",_bindReadyStateChange:function(e,i){e.onreadystatechange=function(){if(4===e.readyState){if(200===e.status){if(-1!==e.responseText.indexOf('"login":false')){console.log("login false");var t=e.responseText.json();return document.domain=$.browser.cookie.root_domain,void(t.inFrame?window.parent.location.href=t.url:$.window(t))}if(-1!==e.responseText.indexOf("Access Denied"))return lang.message.accessDenied||(lang.message.accessDenied="Access Denied"),void $.alert(lang.message.accessDenied,"sad");if(i)return void i(e.responseText)}404!==e.status?500!==e.status?12031!==e.status?console.log(e.status+":未知错误"):console.log("服务器未启动"):console.log("服务器错误"):console.log("资源未找到")}}},_getInstance:function(){for(var t=0;t<this._objPool.length;t+=1)if(0===this._objPool[t].readyState||4===this._objPool[t].readyState)return this._objPool[t];return this._objPool[this._objPool.length]=this._createObj(),this._objPool[this._objPool.length-1]},_createObj:function(){var e=null;if(window.XMLHttpRequest)return(e=new XMLHttpRequest).overrideMimeType&&e.overrideMimeType("text/xml"),e;if(window.ActiveXObject)try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}else console.log("浏览器不支持AJAX,请设置浏览器安全级别或更新浏览器");return e},_callback:function(t){var e=t.json();null!=e?e.code!==this.ajax.SUCCESS&&$.message(e.message):$.message("json parse error "+t)},gourl:function(t){this.ajax.referWindow.location.href=t},_findToken:function(t){var e=null;for(var i in this.tokenConfig)if(0===t.indexOf(i)){e=this.tokenConfig[i];break}return e},req:function(t,e,i,o,n){-1===e.indexOf("http://")&&(e=$.url.root+e);var r=this._getInstance();null!=r&&this._bindReadyStateChange(r,i),n&&(this.srcElement=n);try{r.open(t,e,!0),r.setRequestHeader("ajax","true"),r.setRequestHeader("pragma","no-cache"),r.setRequestHeader("cache-control","no-cache");var s=this._findToken(e);if(s)for(var a in s)r.setRequestHeader(a,s[a]());if("GET"===t)return void r.send(null);if("object"===_typeof(o))return r.setRequestHeader("Content-Type","application/json"),void r.send(JSON.stringify(o));if(!o)return void r.send();o=o.replace(/%/g,"%25"),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.send(o)}catch(t){console.log(t)}},get:function(t,e){e=e||$.ajax._callback,$.ajax.req("GET",t,e,null,null)},post:function(t,e,i){i=i||$.ajax._callback,$.ajax.req("POST",t,i,e,null)}};var tokenConfig={};tokenConfig[$.url.root]={"login-token":function(){return Sparrow.browser.getCookie("PERMISSION")}},Sparrow.ajax.tokenConfig=tokenConfig,Sparrow.http={post:function(t,e,i,o){"function"==typeof e&&(i=e,e=null),$.ajax.req("POST",t,function(t){var e=t.json();null!=e?e.code==Sparrow.ajax.SUCCESS?i?i(e):Sparrow.message(e.message,Sparrow.ajax.srcElement):$.message(e.message,Sparrow.ajax.srcElement):Sparrow.message("json parse error "+t)},e,o)},get:function(t,i){Sparrow.ajax.get(t,function(t){var e=t.json();null!=e?e.code==Sparrow.ajax.SUCCESS&&i?i(e):Sparrow.message(e.message,Sparrow.ajax.srcElement):Sparrow.message("json parse error "+t)})},syncPost:function(t,e,n){return new Promise(function(i,o){Sparrow.ajax.post(t,e,function(t){var e=t.json();null!=e?(n||(n=$.ajax.SUCCESS),e.code==n?i(e):o(e)):o(t)})})},syncGet:function(t,n){return new Promise(function(i,o){Sparrow.ajax.get(t,function(t){var e=t.json();null!=e?(n||(n=$.ajax.SUCCESS),e.code==n?i(e):o(e)):o(t)})})}},Sparrow.v={background_color:"#fff",empty_string:"",index:null,right_message:'<img alt="" src="'+$.url.resource+"/images/"+$.website.themes+'/succeed.gif"/>',reset:function(){$.v.index=null},getErrorLabel:function(t){return t.errorCtrlId?$(t.errorCtrlId.join($.v.index)):null},initPlaceholder:function(t){for(var e in t){var i=t[e],o=$(e);null!=o&&"text"===o.type&&(o.placeholder=i.prompt)}},_setBackground:function(t,e,i){if(i&&!1!==$.v.background_color){e||(e=$.v.background_color);var o=t.parentLevel;if(void 0===o&&(o=1),0<o){var n=i;if(null==n)return;try{for(;"TR"!==n.tagName.toUpperCase()&&"line"!==n.className&&"validate"!==n.className;)n=n.parentNode;n.style.background=e}catch(t){}var r=this.getErrorLabel(t);null!=r&&(r.className="front")}}},showMessage:function(t,e){t=t[e.id];var i=this.getErrorLabel(t);i&&(i.className="prompt",i.innerHTML=t.prompt),this._setBackground(t)},ok:function(t,e){var i=this.getErrorLabel(t);return i&&(i.innerHTML=this.right_message,i.className="prompt"),this._setBackground(t,"#ffffff",e),e&&(e.style.backgroundColor="#ffffff",""===e.value&&t.defaultValue&&(e.value=t.defaultValue)),!0},fail:function(t,e){e||(e=t.setError);var i=this.getErrorLabel(t);return i&&(i.innerHTML="!"+e,i.className="error"),"!"+e},_validate:function(t,e){this._setBackground(t,"#ffffff",e);var i=e.value.trim(),o=this.getErrorLabel(t),n="SELECT"===e.tagName.toUpperCase()&&!0===e.multiple?e.options.length:i.getByteLength();return 0===n&&t.allowNull?this.ok(t):0===n&&void 0!==t.defaultValue?(e.value=t.defaultValue,this.ok(t)):0!==n||t.allowNull?t.maxLength&&n>t.maxLength||t.minLength&&n<t.minLength?this.fail(t,t.lengthError):!o||"error"!==o.className||o.innerHTML!=="!"+t.setError||this.fail(t):this.fail(t,t.nullError)},isUserNameRule:function(t,e){t=t[e.id];var i=this._validate(t,e);return!0!==i?i:-1===e.value.search(/^[a-zA-Z0-9_]{6,20}$/)?this.fail(t,t.nameRuleError):this.ok(t,e)},isEmail:function(t,e){t=t[e.id];var i=this._validate(t,e);return!0!==i?i:-1===e.value.search(/\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/)?this.fail(t,t.emailError):this.ok(t,e)},isTel:function(t,e){t=t[e.id];var i=this._validate(t,e);return!0!==i?i:-1===e.value.search(/^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/)?this.fail(t,t.telError):this.ok(t,e)},isMobile:function(t,e){(t=t[e.id]).minLength=11,t.maxLength=11;var i=this._validate(t,e);return!0!==i?i:-1===e.value.search(/^1[\d]{10}$/)?this.fail(t,t.mobileError):this.ok(t,e)},isIdCard:function(t,e){t=t[e.id];var i=this._validate(t,e);return!0!==i?i:-1===e.value.search(/^([1-9]([0-9]{16}|[0-9]{13})([0-9]|x|X))$/)?this.fail(t,t.idCardError):this.ok(t,e)},isNull:function(t,e){t=t[e.id];var i=this._validate(t,e);return!0!==i?i:this.ok(t,e)},isChineseCharacters:function(t,e){t=t[e.id];var i=this._validate(t,e);return!0!==i?i:t.allowNull||-1!==e.value.search(/^[\u4e00-\u9fa5]+/)?this.ok(t,e):this.fail(t,t.chineseCharactersError)},isEqual:function(t,e){t=t[e.id];var i=this._validate(t,e);return!0!==i?i:e.value!==$(t.otherCtrlId.join($.v.index)).value.trim()?this.fail(t,t.noEqualError):this.ok(t,e)},allowInputOption:function(t,e){(t=t[e.id]).defaultValue||(t.defaultValue=t.options[0]);for(var i=0;i<t.options.length&&e.value!=t.options[i];i++);i==t.options.length&&(e.value=t.defaultValue),this.ok(t,e)},isDigital:function(t,e){t=t[e.id];var i=e.value,o=this._validate(t,e);if(!0!==o)return o;if(isNaN(i))return this.fail(t,t.digitalError);var n=parseFloat(i),r=t.minValue||0===t.minValue,s=t.maxValue||0===t.maxValue;if(r&&n<t.minValue||s&&n>t.maxValue)return this.fail(t,t.digitalError);this.ok(t,e)},isImgSize:function(t,e){var i=t.value.split("*");2===i.length&&-1!==i[0].search(/^[0-9]+.?[0-9]$/)&&-1!==i[1].search(/^[0-9]+.?[0-9]$/)||(t.value=e)},isFileLength:function(t,e){-1===t.value.toUpperCase().indexOf("M")?-1===t.value.toUpperCase().indexOf("K")?t.value=e:-1!==t.value.toUpperCase().split("K")[0].search(/^[0-9]+.?[0-9]$/)?t.value=t.value.toUpperCase().split("K")[0]+"KB":t.value=e:-1!==t.value.toUpperCase().split("M")[0].search(/^[0-9]+.?[0-9]$/)?t.value=t.value.toUpperCase().split("M")[0]+"MB":t.value=e},updateTxtCount:function(t,e,i,o){var n=$(e);if((o=o||window.event).keyCode<37||40<o.keyCode){var r=i-t.value.getByteLength();r<=0?(n.innerHTML=0,t.value=t.value.subString(i,!1)):n.innerHTML=r}},getValidateResult:function(t,e){var i=[];for(var o in t){var n=t[o];if(n&&"object"===_typeof(n)){var r=null,s=$(o);if(s){var a=this.getErrorLabel(n);a&&"error"===a.className&&(r=a.innerHTML),$.isNullOrEmpty(r)&&(r=$.v.isNull(t,s)),$.v.validate&&(r=$.v.validate()),!0===r||$.isNullOrEmpty(r)||i.push(r)}}}if(0<i.length)return $.message(i.join("<br/>")),!1;if(!1!==e)if("string"==typeof e||void 0===e)$.submit(e);else if("function"==typeof e)e(this);else if("object"===_typeof(e)&&"hidden"===e.s.type){var l=e.attr("new");$.isNullOrEmpty(e.value())||(l=e.attr("update")),$.submit(l)}return!0},init:function(t){for(var e in t){var i=$("#"+e),o=t[e],n=o.event;switch(i.bind("onfocus",function(){$.v.showMessage(t,this)}),n){case"UserNameRuleValidator":i.bind("onblur",function(){$.v.isUserNameRule(t,this)});break;case"AllowOptionsValidator":i.bind("onblur",function(){$.v.isNull(t,this)});break;case"DigitalValidator":i.bind("onblur",function(){$.v.isDigital(t,this)});break;case"EmailValidator":i.bind("onblur",function(){$.v.isEmail(t,this)});break;case"NullValidator":i.bind("onblur",function(){$.v.isNull(t,this)});break;case"EqualValidator":i.bind("onblur",function(){$.v.isEqual(t,this)});break;case"IdCardValidator":i.bind("onblur",function(){$.v.isIdCard(t,this)});break;case"MobileValidator":i.bind("onblur",function(){$.v.isMobile(t,this)});break;case"TelValidator":i.bind("onblur",function(){$.v.isTel(t,this)});break;case"ChineseCharactersValidator":i.bind("onblur",function(){$.v.isChineseCharacters(t,this)});break;case"AllowInputCharLengthValidator":var r=o;$("#"+r.maxCharLengthControlId).html(r.maxAllowCharLength),i.bind("onblur",function(){$.v.allowInputOption(t,this)}),i.bind("onkeyup",function(){$.v.updateTxtCount(this,r.allowCharLengthShowControlId,500)})}}}},Sparrow.page={toTargetPage:function(t,e,i){var o=parseInt($("consumerPageIndex").value),n=parseInt($("spanCurrentPageIndex").innerHTML.trim());o<=0||t<o?$.message("超出页码范围",i):o!==n?window.location.href=e.replace("$pageIndex",o):$.message("当前页即是目标页",i)},consumerAction:null,submit:function(t,e){$("currentPageIndex").value=t,window.location.href="#top",null==this.consumerAction?$.submit(null,e):this.consumerAction(t)},next:function(){for(var t=$("divPage").getElementsByTagName("a"),e=null,i=0;i<t.length;i++)if("下一页"===t[i].innerHTML){e=t[i].href;break}$.isNullOrEmpty(e)?alert("亲，您已经翻到最后了哟"):window.location.href=e}},Sparrow.random=function(){return(Math.random()+"").substring(2)},Sparrow.randomUrl=function(t){return-1!==t.indexOf("t=")&&(t=t.substr(0,t.indexOf("t=")-1)),-1!==t.indexOf("?")?t+="&t="+Math.random():t+="?t="+Math.random(),t},Sparrow.request=function(t){return new RegExp("(^|\\?|&)"+t+"=([^&]*)(\\s|&|$)","i").test(location.href)?unescape(RegExp.$2.replace(/\+/g," ")):""},Sparrow.isNullOrEmpty=function(t){return null==t||void 0===t||"string"==typeof t&&(""===t.trim()||"null"===t.trim())},Sparrow.toString=function(t,e){return e||(e=""),$.isNullOrEmpty(t)?e:t},Sparrow.countDown=function(t,e,i){var o=t-e,n=Math.floor(o/1e3/60/60/24),r=Math.floor(o/1e3/60/60%24),s=Math.floor(o/1e3/60%60),a=Math.floor(o/1e3%60);i.value=(0<n?n+"天":"")+(0<r?r+"时":"")+(0<s?s+"分":"")+(a<0?0:a)+"秒";var l=arguments.callee;(0<n||0<r||0<s||0<a)&&setTimeout(function(){l(t,e+1e3,i)},1e3)},Sparrow.getBeforeTime=function(t){t=new Date(t).valueOf();var e=(new Date).valueOf(),i=[{name:"秒",split:60},{name:"分钟",split:60},{name:"小时",split:24},{name:"天",split:30},{name:"月",split:12},{name:"年",split:100}];return $(function(t,e){return t/i[e].split<1?(parseInt(t)<0?1:parseInt(t))+i[e].name:arguments.callee(t/i[e].split,++e)},(e-t)/1e3,0)},Sparrow.submit=function(t,e){e=e||0,t&&(document.forms[e].action=t),document.forms[e].submit()},Sparrow.jsonKeys=function(t){var e=[];if(!t)return e;if(void 0!==t.length)return t;for(var i in t)e.push(i);return e},Sparrow.clearForm=function(t){for(var e=$.jsonKeys(t),i=0;i<e.length;i++){var o=$(e[i]);if(null!=o){var n="";t[e[i]]&&(n=t[e[i]].defaultValue),o.value=$.toString("",n)}else console.log(e[i]+" not exist!")}},Sparrow.getFormData=function(t){for(var e=[],i=$.jsonKeys(t),o=0;o<i.length;o++){var n=$(i[o]);if(null!=n){if(!$.isNullOrEmpty(n.name)){var r=n.value;e.push(n.name+"="+r)}}else console.log(i[o]+" not exist!")}return e.join("&")},Sparrow.waitRedirect=function(t,e){var i=$("#hdnQueryString").value(),o=$("#"+t);if(null!=o&&null!=o.s){e||(e=1e3);var n=window.setInterval(function(){var t=parseInt(o.html(),10);0==t--?(window.location.target="_self",window.location.href=i,window.clearInterval(n)):o.html(t)},e)}},Sparrow.format=function(txt,compress){var indentChar="    ";if("string"!=typeof txt||!/^\s*$/.test(txt)){var data=null;if("object"===_typeof(txt))data=txt;else try{data=eval("("+txt+")")}catch(t){return void alert("数据源语法错误,格式化失败! 错误信息: "+t.description,"err")}var draw=[],last=!1,This=this,line=compress?"":"\n",nodeCount=0,maxDepth=0,notify=function t(e,i,o,n,r){nodeCount++;for(var s=0,a="";s<n;s++)a+=indentChar;if(a=compress?"":a,maxDepth=++n,i&&i.constructor===Array){draw.push(a+(r?'"'+e+'":':"")+"["+line);for(s=0;s<i.length;s++)t(s,i[s],s===i.length-1,n,!1);draw.push(a+"]"+(o?line:","+line))}else if(i&&"object"===_typeof(i)){draw.push(a+(r?'"'+e+'":':"")+"{"+line);var l=0;s=0;for(var c in i)l++;for(var c in i)t(c,i[c],++s===l,n,!0);draw.push(a+"}"+(o?line:","+line))}else"string"==typeof i&&(i='"'+i+'"'),draw.push(a+(r?'"'+e+'":':"")+i+(o?"":",")+line)},isLast=!0,indent=0;return notify("",data,isLast,indent,!1),draw.join("")}alert("数据为空,无法格式化! ")},Sparrow.bind=function(o,n,r){return function(t){if(-1<n.indexOf("|"))for(var e=n.split("|"),i=0;i<e.length;i++)r?o[e[i]](r,t):o[e[i]](t);else r?o[n](r,t):o[n](t)}},Sparrow.prototype.each=function(t){for(var e=0,i=this.length;e<i;e++)t.call(this[e],e,this)},Sparrow.prototype.attr=function(t,e){if(this.s){if($.isNullOrEmpty(e)){var i=this.s.attributes[t];return i?i.value:this.s.getAttribute(t)}this.s.setAttribute(t,e)}},Sparrow.prototype.html=function(t){if(this.s){if($.isNullOrEmpty(t))return this.s.innerHTML;this.s.innerHTML=t}},Sparrow.prototype.format=function(t,e){this.s&&(null!=$(t)&&(t=$("#"+t).html()),this.s.innerHTML=t.format(e))},Sparrow.prototype.value=function(t){if(this.s)return null==t?this.s.value:void(this.s.value=t)},Sparrow.prototype.check=function(t){for(var e=0;e<this.length;e++)if(this[e].value===t){this[e].checked="checked";break}},Sparrow.prototype.opacity=function(t){if(0<=t)return this.s.style.filter="alpha(opacity="+t+")",this.s.style.opacity=t/100,void this.s.setAttribute("opacity",t);var e=this.s.attributes.opacity;return e?e.value:100},Sparrow.prototype.bind=function(t,e){this.s&&(this.s.attachEvent?this.s.attachEvent(t,e):this.s.addEventListener(t.substring(2),e,!1))},Sparrow.prototype.getAbsoluteTop=function(){for(var t=this.s,e="string"==typeof t?$(t):t,i=e.offsetTop;null!=(e=e.offsetParent);)i+=e.offsetTop;return i},Sparrow.prototype.getAbsoluteLeft=function(){for(var t=this.s,e="string"==typeof t?$(t):t,i=e.offsetLeft;null!=(e=e.offsetParent);)i+=e.offsetLeft;return i},Sparrow.prototype.source=function(){return this.s},Sparrow.prototype.class=function(t){if(!t)return this.s.className;this.s.className=t},Sparrow.prototype.css=function(attribute,value,add){if(Math.abs(value)<1&&(value=value<0?-1:1),"opacity"===attribute)value=Math.ceil(value),add&&(value=parseInt(this.opacity(),10)+value),this.opacity(value);else{var command=null;add?(command='var o=parseInt($("'+this.s.id+'").style.'+attribute+",10);",command+='$("'+this.s.id+'").style.'+attribute+"=(o+"+value+')+"px";'):command='$("'+this.s.id+'").style.'+attribute+'="'+value+'"',eval(command)}return this},Sparrow.prototype.change_check_box_class=function(t,e,i,o){var n=this.s.className;o||(o="_");var r=n.split(o);return i||(i="check"),e||(e=r.length),t?n.indexOf(i)<0&&(r.splice(e,0,i),this.s.className=r.join(o)):0<=n.indexOf(i)&&(r.splice(e,1),this.s.className=r.join(o)),r.splice(e,r.length-e+1),r.join(class_split)},Sparrow.prototype.contains=function(t){for(;null!=t&&void 0!==t.tagName;){if(t===this.s)return!0;t=t.parentNode}return!1},Sparrow.prototype.remove=function(){null!=this&&null!=this.s&&(this.doc.body.removeChild(this.s),this.s=null)},Sparrow.prototype.fix=function(t,e){if(this.s){var i=this.s.offsetWidth;e||(e=this.getAbsoluteLeft()),$.browser.ie&&"6.0"===$.browser.version?(this.doc.documentElement.style.backgroundImage="url(about:blank)",this.doc.documentElement.style.backgroundAttachment="fixed",this.doc.body.style.backgroundImage="url(about:blank)",this.doc.body.style.backgroundAttachment="fixed",this.s.style.position="absolute"):this.s.style.position="fixed",this.s.style.top=t+"px",this.s.style.left=e+"px",this.s.style.width=i+"px"}},Sparrow.prototype.center=function(){if(this.s){var t=(this.doc.body.clientWidth-this.s.offsetWidth)/2,e=this.doc.documentElement.clientHeight>screen.availHeight?screen.availHeight:this.doc.documentElement.clientHeight,i=64+parseInt((e-161-this.s.offsetHeight)/2);this.fix(i,t)}},Sparrow.prototype.loadComplete=function(t){if("IFRAME"===this.s.tagName.toUpperCase())this.s.onload=function(){t(this)};else if("IMG"===this.s.tagName.toUppperCase()){if($.browser.ie)return void(this.s.onreadystatechange=function(){"complete"!==this.s.readyState&&"loaded"!==this.s.readyState||t(this)});this.s.onload=function(){!0===this.s.complete&&t(this)}}},Sparrow.prototype.parent=function(){return $(this.s.parentNode)},Sparrow.prototype.fresh=function(t){$.isNullOrEmpty(this.s.src)&&(this.s.src=t),this.s.src=$.randomUrl(this.s.src)},Sparrow.prototype.enter=function(e){this.s.onkeydown=function(t){13===(t=window.event||t).keyCode&&("string"!=typeof e?e():$(e).onclick(t))}};var _hmt=_hmt||[];function getImgContainer(t,e,i){var o=[],n=$("+div"),r=$.file.getFileName(t).split(".")[0];return n.s.className="",n.s.style.cssText="width:92px;height:90px;float:left;padding:3px;border:#ccc 2px solid;",o.push('<a target="_blank" href="{0}" title="{1}"><img style="width:91px;height:67px;" src="{2}"/></a>'.format(t,$.file.getFileName(e),t)),o.push('<br/><a href="javascript:void(0);" target="_self" onclick="'+i.fullObjName+".attach.deleteOnServer('"+r+'\',this);">删除</a>｜<a href="javascript:void(0);" target="_self" onclick="'+i.fullObjName+".attach.insertEditor('"+$.file.getFileName(e)+"','"+t+'\');">插入</a><input type="hidden" name="'+i.config.attach.fileUUID+'" value="'+r+'"/>'),n.s.innerHTML=o.join(""),n.s}function clearHtmlFrame(){for(var t=0;t<$.editor.editorArray.length;t++)$.editor.editorArray[t].config.currentHtmlId&&(document.getElementById($.editor.editorArray[t].config.currentHtmlId).style.display="none",$.editor.editorArray[t].config.currentHtmlId=null,$.editor.editorArray[t].clear())}return function(){var t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?11daae2d559a82e0e8bd4872ad217164";var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)}(),Sparrow.prototype.tabs=function(t){t||(t={});var o=t.tabClickCallback,n=t.withIndexClass,e=t.index,i=$("!div."+this.s.id),r=i[0],s=$("!li",r),a=i[1],l=$("!div",a),c=function(e){o&&o(e);var t=$("!a",s[e])[0],i=$(t).attr("rev");i&&($("!a",s[s.length-1])[0].href=i);l.each(function(t){if(n&&(s[0].className="pure-menu-item pure-menu-heading"),t==e)return s[t].className="pure-menu-item pure-menu-selected",void(this.className="block");s[t].className="pure-menu-item",this.className="none"})};s.each(function(t){$(this).attr("tab_index",t),0<this.className.indexOf("close")||0<this.className.indexOf("more")||$(this).bind("onclick",function(){var t=$(this).attr("tab_index");c(t)})}),e&&c(e)},Sparrow.win={config:{isInFrame:!1,showHead:!0,titleHeight:45,currentWindow:window,bgsound:$.url.resource+"/media/sound.wav",titleImg:$.url.resource+"/images/"+$.website.themes+"/panel.gif",closeBtnImg:$.url.resource+"/images/"+$.website.themes+"/panel.gif",OKBtnImg:$.url.resource+"/images/"+$.website.themes+"/panel.gif",smileImg:$.url.resource+"/images/"+$.website.themes+"/smile.gif",sadImg:$.url.resource+"/images/"+$.website.themes+"/sad.gif",lockImg:$.url.resource+"/images/"+$.website.themes+"/lock.gif",waitImg:$.url.resource+"/images/"+$.website.themes+"/loading.gif",askImg:$.url.resource+"/images/"+$.website.themes+"/smile.gif",tagArray:["select","object"],jalert:{height:"auto",width:"250px",closeCallBack:function(){}},dialog:{descContainer:null}},getWindow:function(){return this.config.isInFrame?window.parent:window},getScrollTop:function(){return this.getWindow().pageYOffset||this.getWindow().document.documentElement.scrollTop||this.getWindow().document.body.scrollTop},addSound:function(){$("+bgsound.sound.doc",null,this.getWindow().document).s.src=this.config.bgsound},addBackDiv:function(){var t=$("+div.backDiv.doc",null,this.getWindow().document),e=Math.max(this.getWindow().document.body.scrollHeight,this.getWindow().document.documentElement.scrollHeight);t.s.zIndex=1e3,t.opacity(80),t.s.style.position="absolute",t.s.style.width=t.doc.body.offsetWidth+"px",t.s.style.height=e+"px",t.s.style.left="0px",t.s.style.top="0px",t.s.style.backgroundColor="#000000"},addMsgDialog:function(t,e){t||(t=this.config.jalert.width),e||(e=this.config.jalert.height);var i=$("+div.dialog.doc",null,this.getWindow().document);i.s.className="modal",i.s.zIndex=1001,i.s.style.width=t,i.s.style.height=e},addPanel:function(t){var o=$("+div.dialog.doc",null,this.getWindow().document);o.s.zIndex=1001,!(o.s.style.cssText="position:absolute;text-align:center;font-size: 10pt;background:white;")!==this.config.showHead&&this.addTitle(),this.addRightClose();var n=$("+iframe.panel.dialog",null,o.doc);n.s.setAttribute("frameborder","0",0),n.s.scrolling="no",n.s.src=t,n.loadComplete(function(t){var e=parseInt(t.contentWindow.document.body.style.width,10),i=parseInt(t.contentWindow.document.body.style.height,10);n.s.style.width=e-4+"px",n.s.style.height=i-($.win.config.showHead?$.win.config.titleHeight:0)-5+"px",o.s.style.width=e+"px",o.s.style.height=i+"px",$("#dialog",null,o.doc).center(),!1!==$.win.config.showHead&&($("#divleft",null,o.doc).s.innerHTML=t.contentWindow.document.title)})},addTitle:function(t){if(!1!==this.config.showHead){$("+div.divtitle.dialog",null,this.getWindow().document).s.className="modal-header pure-g";var e=$("+div.divleft.divtitle",null,this.getWindow().document);e.css("textAlign","left"),e.s.className="drag-pp pure-u-23-24",e.s.onmousedown=function(t){$.event(t).drags()},e.s.onmouseup=function(t){$.event(t).move_end()},e.html(t||$.website.name+"提醒您:")}},addRightClose:function(){if(this.config.showHead){var t=$("+div.divright.divtitle",null,this.getWindow().document);t.s.className="pure-u-1-24",t.css("cursor","pointer"),t.html("×"),t.s.onclick=function(){$.win.closeClick()}}},addOK:function(){var t=$("+input.btnOK.divfooter",null,this.getWindow().document);t.s.id="btnOK",t.s.type="button",t.s.className="pure-button pure-button-primary",t.s.value="确定",t.s.onclick=function(){$.win.okClick()}},addClose:function(){var t=$("+input.btnclose.divfooter",null,this.getWindow().document);t.s.className="pure-button",t.attr("type","button"),t.s.value="关  闭",t.s.onclick=function(){$.win.closeClick()}},addMsgContent:function(){$("+div.divcontent.dialog",null,this.getWindow().document).s.className="modal-body"},addFooter:function(){$("+div.divfooter.dialog",null,this.getWindow().document).s.className="modal-footer"},okClick:function(){},closeClick:function(){$.showOrHiddenTag(this.config.tagArray,!0,this.getWindow().document),$("#dialog",null,this.getWindow().document).remove(),$("#backDiv",null,this.getWindow().document).remove(),$("#sound",null,this.getWindow().document).remove(),$.win.config.currentWindow.focus(),$.win.config.jalert.closeCallBack&&($.win.config.jalert.closeCallBack(),$.win.config.jalert.closeCallBack=null),$.win.ok=void 0}},Sparrow.alert=function(t,e,i,o,n){var r={};"object"==_typeof(t)&&(t=(r=t).msg.decodeSplitKey(),e=r.type,i=r.title.decodeSplitKey(),r.url&&(o=r.url.decodeSplitKey()),r.wait_message&&(n=r.wait_message.decodeSplitKey())),$.win.addSound(),$.showOrHiddenTag($.win.config.tagArray,!1,$.win.getWindow().document),$.win.addBackDiv(),$.win.addMsgDialog(),$.win.addTitle(i),$.win.addMsgContent();var s=null;switch(e){case"smile":$.win.addFooter(),$.win.addRightClose(),$.win.addClose(),s=$.win.config.smileImg;break;case"sad":$.win.addFooter(),$.win.addRightClose(),$.win.addClose(),s=$.win.config.sadImg;break;case"lock":s=$.win.config.lockImg;break;case"wait":s=$.win.config.waitImg;break;case"ask":$.win.addFooter(),$.win.addRightClose(),$.win.addOK(),$.win.addClose(),s=$.win.config.askImg;break;case void 0:$.win.addFooter(),$.win.addRightClose(),$.win.addClose()}var a="";s&&(a='<br/><img align="absMiddle" src=\''+s+"'/>&nbsp;&nbsp;"),t&&(a+=t,$.isNullOrEmpty(o)||(a+=n.format(o)),$("#divcontent",null,$.win.getWindow().document).s.innerHTML=a,$.waitRedirect("timer")),$.showOrHiddenTag("select",!0,$.win.getWindow().document.getElementById("divcontent")),$("#dialog",null,$.win.getWindow().document).center()},Sparrow.window=function(t){t||(t={}),$.isNullOrEmpty(t.showHead)||($.win.config.showHead=t.showHead),$.isNullOrEmpty(t.inFrame)||($.win.config.isInFrame=t.inFrame),url=t.url,$.win.closeClick(),!1!==t.cache&&(url=$.randomUrl(url)),url.indexOf("http://")<0&&(url=$.url.root+url),$.showOrHiddenTag($.win.config.tagArray,!1,$.win.getWindow().document),t.srcElement&&(t.srcElement.indexOf("#")<0&&(t.srcElement="#"+t.srcElement),$.win.config.toTopHeight=$(t.srcElement).getAbsoluteTop()-height/2),$.win.addBackDiv(),$.win.addPanel(url)},"function"==typeof define&&define.amd&&define("sparrow",[],function(){return Sparrow}),Sparrow.dialog=function(t){t||(t={}),$.showOrHiddenTag($.win.config.tagArray,!1,$.win.getWindow().document),$.win.addBackDiv(),$.win.addMsgDialog(t.width,t.height),$.win.addTitle(t.title),$.win.addMsgContent(),$.win.addOK(),$.win.addClose(),t.content&&($("#divcontent",null,$.win.getWindow().document).s.innerHTML=t.content),t.initialize&&t.initialize($("divcontent")),$("#dialog",null,$.win.getWindow().document).center()},Sparrow.gridView={keyType:"int",id:"grvManageList",resultCtrlId:"hdnGridResult",getTable:function(){return $(this.id)},init:function(){var t=$("#"+this.resultCtrlId);null!=t&&($.isNullOrEmpty(t.attr("gridViewId"))||(this.id=t.attr("gridViewId")),$.isNullOrEmpty(t.attr("keyType"))||(this.keyType=t.attr("keyType")))},getCellIndex:function(t){return t.parentNode.cellIndex},allCheckClick:function(t){for(var e=$("&"+this.id),i=0;i<e.length;i+=1){e[i].checked=t.checked}},recordCheckClick:function(t,e){if(!1!==t.checked){for(var i=!0,o=$("&"+this.id),n=0;n<o.length;n++)!1===o[n].checked&&(i=!1);i&&($(e).checked=!0)}else $(e).checked=!1},mustSelect:function(t){for(var e=[],i=$("&"+this.id),o=null,n=0;n<i.length;n+=1){var r=i[n];"input"===r.tagName.toLowerCase()&&r.checked&&(o=r.id,"string"===this.keyType?e.push("'"+o+"'"):e.push(o))}return 0===e.length?(lang.message.noSelectRecord?$.message(lang.message.noSelectRecord):$.message("please define 'lang.message.noSelectRecord'!"),!1):(1===e.length&&(e.pop(),e.push(o)),t?!!window.confirm(t)&&e:e)},onlyCheckedOne:function(t){for(var e=0,i=null,o=$("name."+this.id),n=1;n<o.length;n++){var r=o[n];r.checked&&(e+=1,i=r.id)}return 0===e?(lang.message.noSelectRecord?$.message(lang.message.noSelectRecord):$.message("please define lang.message.noSelectRecord!"),!1):1!==e?(lang.message.onlySelectOneRecord?$.message(lang.message.onlySelectOneRecord):$.message("please define lang.message.onlySelectOneRecord"),!1):!window.confirm(t)||i},submit:function(t,e,i){var o=i?this.onlyCheckedOne(e):this.mustSelect(e);if(o){if($(this.resultCtrlId).value=o,"return"===t)return!0;$.submit(t)}}},Sparrow.table=function(e){if(!(this instanceof Sparrow.table))return new Sparrow.table(src);e&&(this.id=e,this.t=$(e),this.body=t.getElementsByTagName("tbody")[0],this.tr=[])},Sparrow.table.prototype={_initCell:function(t,e,i){t.style.cssText=this.tr[e].td[i].cssText,t.className=this.tr[e].td[i].className,t.align=this.tr[e].td[i].align,t.innerHTML=this.tr[e].td[i].innerHTML,this.tr[e].td[i].colspan&&t.setAttribute("colspan",this.tr[e].td[i].colspan)},_initRow:function(t,e){t.style.cssText=table.tr[e].cssText,table.tr[e].className&&""!==table.tr[e].className&&(t.className=table.tr[e].className);for(var i=0;i<this.tr[e].td.length;i++){var o=t.insertCell(-1);this._initCell(o,e,i)}},init:function(){for(var t=0;t<this.tr.length;t++)this.body.appendChild(this._initRow(t));$(this.containerId).appendChild(this.t)},appendRow:function(){for(var t=0;t<this.tr.length;t++){var e=this.body.insertRow(-1);this._initRow(e,t)}},insertRow:function(t){for(var e=0;e<this.tr.length;e++){var i=this.body.insertRow(t);this._initRow(i,e)}},updateRow:function(t){for(var e=0;e<this.tr[0].td.length;e++)this.tr[0].td[e].innerHTML&&(this.body.rows[t].cells[e].innerHTML=this.tr[0].td[e].innerHTML)},removeRow:function(t){this.body.deleteRow(t)}},Sparrow.file={isShowProgress:!0,wit:null,clientFileName:null,uploadFrameId:null,uploadCallBack:function(t,e,i){console.info(t),console.info(i),this.clearStatus()},clearStatus:function(){window.clearInterval(this.wit),window.setTimeout(function(){var t=$("divStatus");$.file.isShowProgress&&null!=t&&document.body.removeChild(t)},1e3)},fileSerialNumber:null,validateUploadFile:function(t,e,i){var o=$.file.getFileName(t.value);$.file.clientFileName=o;$.file.checkFileType(o,["jpg","jpeg","gif","png"],"errorImgForumIco")&&$.file.uploadDelegate(e,i)},callbackValidate:function(t){if($.isNullOrEmpty(t.error))return!0;$.alert(t.error,"sad","上传出错"),window.location.href=window.location.href},reset:function(){var t=$(this.uploadFrameId),e=t.src;t.src="about:blank",t.src=e},getUploadFrame:function(){return this.uploadFrameId?$(this.uploadFrameId):$("fileUpload")},getUploadFile:function(t){return t||(t=this.getUploadFrame()),t.contentWindow.document.getElementById("file_upload")},getUploadFileInfo:function(t){return t||(t=this.getUploadFrame()),t.contentWindow.document.getElementById("fileInfo")},getFileSerialNumber:function(){return this.fileSerialNumber},setFileSerialNumber:function(t){this.fileSerialNumber=t},getFullPath:function(t){if(!t)return"";if($.browser.ie){t.select();var e=document.frames[0].document.selection.createRange().text;return document.frames[0].document.selection.empty(),e}return $.browser.firefox&&t.files?t.files.item(0).getAsDataURL():t.value},getExtension:function(t){return(t=$.browser.getUrlWithoutParameter(t)).substring(t.lastIndexOf(".")).toLocaleLowerCase()},getFileName:function(t){return-1!==(t=$.browser.getUrlWithoutParameter(t)).indexOf("\\")?t.substring(t.lastIndexOf("\\")+1):-1!==t.indexOf("/")?t.substring(t.lastIndexOf("/")+1):t},checkFileType:function(t,e,i){for(var o=this.getExtension(t),n=!1,r=0;r<e.length;r+=1){var s=e[r].toLocaleLowerCase(),a="."+e[r].toLocaleLowerCase();if(s===o||a===o){n=!0;break}}if(n)return $.v.ok(i),n;var l=$("#"+i);return null!=l&&null!=l.source()&&(l.class("error"),l.html("!只支持:"+e+"格式")),$.message("文件格式不正确，只支持以下格式:\n"+e),n},uploadDelegate:function(t,e,i){if(!1!==this.isShowProgress&&$("divStatus"))return $.alert(this.clientFileName+"正在上传中,请稍侯...","sad"),!1;this.uploadFrameId=(e?e.obj:"null")+"."+t;var o=$(this.uploadFrameId),n=this.getUploadFileInfo(o).value.split(".");if(this.setFileSerialNumber(n[2]),!1!==$.file.isShowProgress){if(!$("divStatus")){var r=$(o),s=$("+div");s.s.id="divStatus",s.s.style.cssText="width:260px;height:100px;position:absolute;color:#ffffff;background:#000000;font-size:10pt;border:#ccc 1px solid;text-align:left;",s.html("服务器正在加载文件信息..."),document.body.appendChild(s.s),s.s.style.top=r.getAbsoluteTop()-10+"px",s.s.style.left=r.getAbsoluteLeft()+"px",s.opacity(90)}this.wit=window.setInterval(function(){$.file.getStatus()},1e3)}o.contentWindow.document.forms[0].submit()},progressCallback:function(t){if(null!=t&&"loading"!==t.status&&this.callbackValidate(t)){var e=[],i=Math.ceil(parseFloat(t.readLength)/parseFloat(t.contentLength)*1e6)/1e4+"%";e.push("正在上传文件<br/><span class='highlight'>《"+$.file.getFileName($.file.clientFileName)+"》</span><br/>"),e.push("文件大小:"+t.humanReadableContentLength+"<br/>"),e.push("上传大小:"+t.humanReadableReadLength+"<br/>"),e.push("上传进度:"+i),$("#divStatus",!1).html(e.toString()),"100%"===i&&$.file.clearStatus()}},getStatus:function(){$("jsonp",$.url.upload+"/file-upload?file-serial-number="+this.getFileSerialNumber()+"&t="+Math.random()+"&callback=progressCallback","uploadProgress")},initImageUploadEvent:function(t,o){$.url.upload||(console.error("please config $.url.upload the default config is $.url.root ["+$.url.root+"]"),$.url.upload=$.url.root);var e=$("null."+t);null!=e&&(document.domain=$.browser.cookie.root_domain,o||(o="Cover"),e.src=$.url.upload+"/file-upload?path-key="+t+"&t="+Math.random(),$.file.validateUploadFile=function(t,e,i){$.file.clientFileName=t.value;var r=o;"object"===_typeof(o)&&(r=o[e]),$.file.checkFileType($.file.getFileName(t.value),["jpg","jpeg","gif","png"],"error"+r)&&($.file.uploadCallBack=function(t){if($.file.clearStatus(),t.fileUrl){var e=$("#div"+r);null!=e&&e.html("<a href='"+t.fileUrl+"' target='_blank'><img src='"+t.fileUrl+"'/></a>");var i=$("img"+r);null!=i&&(i.src=t.fileUrl);var o=$("#hdn"+r);null!=o&&o.value(t.fileUrl),$.file.imagePreviewCallback&&$.file.imagePreviewCallback(t.fileUrl);var n=$("#error"+r);null!=n&&null!=n.s&&(n.class("prompt"),n.html(""))}},$.file.uploadDelegate(e,i))})}},Sparrow.event=function(t){if(!(this instanceof Sparrow.event))return new Sparrow.event(t);t&&(this.originalEvent=t,this.type=t.type,this.e=window.event||this.originalEvent,this.srcElement=this.e.srcElement||this.e.target,this.toElement=this.e.toElement||this.e.relatedTarget)},Sparrow.event.prototype={dragapproved:!1,srcElement:null,eventX:null,eventY:null,srcLeftPos:null,srcRightPos:null,cancelBubble:function(){window.event?window.event.cancelBubble=!0:this.e.stopPropagation()},preventDefault:function(){this.e.preventDefault&&this.e.preventDefault(),window.event&&(window.event.returnValue=!1)},getAbsoluteTop:function(){return this.e.pageY?this.e.pageY:this.e.clientY?this.e.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop):null},getAbsoluteLeft:function(){return this.e.pageX?this.e.pageX:this.e.clientX?this.e.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft):null},move:function(){return!this.dragapproved||null==this.srcElement||(this.srcElement.style.left=this.srcLeftPos+this.clientX-this.eventX,void(this.srcElement.style.top=this.srcRightPos+this.clientY-this.eventY))},move_end:function(){this.dragapproved=!1,this.srcElement.onmousemove=null},drags:function(){try{if(-1!==this.srcElement.className.indexOf("drag")){"drag-p"===this.srcElement.className?this.srcElement=this.srcElement.parentNode:"drag-pp"===this.srcElement.className?this.srcElement=this.srcElement.parentNode.parentNode:this.srcElement=null;var t=$(this.srcElement);this.dragapproved=!0,this.srcLeftPos=t.getAbsoluteLeft(),this.srcRightPos=t.getAbsoluteTop(),this.eventX=e.clientX,this.eventY=e.clientY,this.srcElement.onmousemove=this.move}else this.srcElement=null,this.dragapproved=!1,this.srcElement.onmousemove=null}catch(t){}}},Sparrow.prototype.mousewheel=function(e){var i,t="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],o=Array.prototype.slice,n=function(t){e&&(t=$.event(t),args=o.call(arguments,1),delta=0,deltaX=0,deltaY=0,absDelta=0,t.preventDefault(),"detail"in t.e&&(deltaY=-1*t.e.detail),"wheelDelta"in t.e&&(deltaY=t.e.wheelDelta),"wheelDeltaY"in t.e&&(deltaY=t.e.wheelDeltaY),"wheelDeltaX"in t.e&&(deltaX=-1*t.e.wheelDeltaX),"axis"in t.e&&t.e.axis===t.e.HORIZONTAL_AXIS&&(deltaX=-1*deltaY,deltaY=0),delta=0===deltaY?deltaX:deltaY,"deltaY"in t.e&&(deltaY=-1*t.e.deltaY,delta=deltaY),"deltaX"in t.e&&(deltaX=t.e.deltaX,0===deltaY&&(delta=-1*deltaX)),0===deltaY&&0===deltaX||(absDelta=Math.max(Math.abs(deltaY),Math.abs(deltaX)),(!i||absDelta<i)&&(i=absDelta,absDelta%120==0&&(i/=40)),absDelta%120==0&&(delta/=40,deltaX/=40,deltaY/=40),delta=Math[1<=delta?"floor":"ceil"](delta/i),deltaX=Math[1<=deltaX?"floor":"ceil"](deltaX/i),deltaY=Math[1<=deltaY?"floor":"ceil"](deltaY/i),t.e.deltaX=deltaX,t.e.deltaY=deltaY,t.e.deltaFactor=i,t.e.deltaMode=0,args.unshift(t.e,delta,deltaX,deltaY),e(args)))};if(this.s.addEventListener)for(var r=t.length;r;)this.s.addEventListener(t[--r],n,!1);else this.s.onmousewheel=n},Sparrow.prototype.addItem=function(t,e){if("SELECT"===this.s.tagName.toUpperCase()){$.isNullOrEmpty(e)&&(e=t);var i=new Option(t,e);this.existItem(i)||this.s.options.add(i)}},Sparrow.prototype.existItem=function(t){for(var e=!1,i=0;i<this.s.options.length;i++)t.value===this.s.options[i].value&&(e=!0);return e},Sparrow.prototype.addItemToSelect=function(t){for(var e=$(t),i=0;i<this.s.options.length;i+=1)if(srcSelect.options[i].selected){var o=this.s.options[i].value,n=this.s.options[i].innerHTML,r=new Option(n,o);e.existItem(this.s.options[i])||t.options.add(r)}},Sparrow.prototype.addAllItemToSelect=function(t){for(var e=$(t),i=0;i<srcSelect.options.length;i+=1){var o=srcSelect.options[i].innerHTML,n=srcSelect.options[i].value,r=new Option(o,n);e.existItem(srcSelect.options[i])||t.options.add(r)}},Sparrow.prototype.removeItem=function(t){"string"==typeof srcSelect&&(srcSelect=$(srcSelect));for(var e=!1,i=this.s.options.length-1;0<=i;i-=1)this.s.options[i].selected&&(this.s.options.remove(i),e=!0);!1!==t&&!1===e&&this.s.options.remove(0)},Sparrow.prototype.removeAll=function(){for(var t=this.s.options.length-1;0<=t;t-=1)this.s.options.remove(t)},Sparrow.prototype.upDown=function(t){if(!(this.s.selectedIndex<0)){if(t<0){if(0===this.s.selectedIndex)return}else if(this.s.selectedIndex===this.s.options.length-1)return;var e=this.s.options[this.s.selectedIndex],i=this.s.options[this.s.selectedIndex+t],o=e.text,n=e.value;e.text=i.text,e.value=i.value,i.text=o,i.value=n,this.s.selectedIndex+=t}},Sparrow.prototype.selectAll=function(){for(var t=0;t<this.s.options.length;t++)this.s.options[t].selected=!0},Sparrow.prototype.addJson=function(t,e,i){if("string"==typeof t&&(t=t.json()),null!=t&&0<t.length){for(var o in t)this.addItem(t[o][i],t[o][e]);return!0}},Sparrow.message=function(t,e){var i="div_sparrow_msg",o=$(i);if(o&&o.parentNode.removeChild(o),(o=$("+div."+i)).s.style.cssText="position:absolute;background-color:#cccccc;width:auto;padding:10px;text-align:left;",o.s.innerHTML=t,o.opacity(0),document.body.appendChild(o.s),e){var n=$(e);o.s.style.top=n.getAbsoluteTop()-o.s.offsetHeight+"px",o.s.style.left=n.getAbsoluteLeft()-(o.s.offsetWidth-e.offsetWidth)/2+"px"}else o.center();o.move_end=function(){this.s.parentNode.removeChild(this.s)},o.animation("{opacity:100}",30)},Sparrow.prototype.move=function(t){var a=t.json(),e=function(t,e,i,o,n){if($.isNullOrEmpty(i))return!1;var r=parseInt(i,10)-parseInt(e,10),s=r*o;if(1<o){if(s=0<r?o:-o,Math.abs(r)<=1)return t.css(n,a.start,!1),!1}else s=r*o;return"function"==typeof n?n(t.s,s):t.css(n,s,!0),Math.abs(r)<=1||void 0},i=a.percent;i||(i=.05);var o=e(this,this.s.style.width,a.width,i,"width");o||(o=e(this,this.s.style.height,a.height,i,"height")),o||(o=e(this,this.s.style.left,a.left,i,"left")),o||(o=e(this,this.s.style.top,a.top,i,"top")),o||(o=e(this,this.opacity(),a.opacity,i,"opacity")),o&&($.isNullOrEmpty(a.width)||(this.s.style.width=a.width),$.isNullOrEmpty(a.height)||(this.s.style.height=a.height),$.isNullOrEmpty(a.left)||(this.s.style.left=a.left),$.isNullOrEmpty(a.top)||(this.s.style.top=a.top),$.isNullOrEmpty(a.opacity)||this.opacity(a.opacity),0===parseInt(a.height,10)&&(this.s.style.display="none"),this.stop(),this.move_end(),this.move_end=function(){})},Sparrow.prototype.move_end=function(){},Sparrow.prototype.stop=function(){window.clearInterval(this.interval.pop())},Sparrow.prototype.animation=function(t,e){e||(e=30),this.s.style.display="block",this.stop();var i="$('"+this.selector+"').move(\""+t+'");';console.log("animation"+i),this.interval.push(window.setInterval(i,e))},Sparrow.prototype.interlace=function(e){e||(e=["{width:'0px',height:'0px'}","{top:'0px',height:'{0}',width:'{1}',left:'0px'}".format(this.s.style.height,this.s.style.width),"{width:'{0}',height:'{1}'}".format(this.s.style.width,this.s.style.height),"{top:'{0}',height:'0px',width:'0px',left:'{1}'}".format(this.s.style.height,this.s.style.width)]);var t=this.selector.substring(1);$("!div."+t).each(function(t){this.style.position="absolute",0===t?(this.style.width=this.parentNode.style.width,this.style.height=this.parentNode.style.height):(this.style.width="0px",this.style.height="0px",this.style.display="none",this.style.left=this.parentNode.style.width,this.style.top=this.parentNode.style.height)}),this.s.style.position="relative",this.s.style.overflow="hidden",this.s.onmouseover=function(){$("!div."+this.id).each(function(t){$(this).animation(e[t],1)})},this.s.onmouseout=function(){$("!div."+this.id).each(function(t){$(this).animation(e[t+2],1)})}},Sparrow.prototype.show=function(){this.s.style.overflow="hidden",("none"===this.s.style.display||0===this.s.offsetHeight)&&(void 0===this.height&&(this.s.style.display="block",this.height=this.s.offsetHeight+"px",this.s.style.height="0"),this.animation("{height:'"+this.height+"'}",5))},Sparrow.prototype.hidden=function(){this.s&&(this.height||(this.height=this.s.offsetHeight+"px",this.s.style.height=this.height),0<this.s.offsetHeight&&this.animation("{height:'0px'}",5))},Sparrow.prototype.showHidden=function(t,e,i){if(t||(t=$(this.s.id+"_controlled")),e||(e={showText:"show",hiddenText:"hidden",showIco:"",hiddenIco:""}),i||(i={show:!0,hidden:!0}),t.style.overflow="hidden","none"===t.style.display||0===t.style.height){if(!i.show)return;return"IMG"===this.s.tagName.toUpperCase()?(this.s.src=e.hiddenIco,this.s.alt=e.hiddenText):this.s.innerHTML=e.hiddenText,void $(t).show()}i.hidden&&($(t).hidden(),"img"===this.s.tagName?(this.s.src=e.showIco,this.s.alt=e.showText):this.s.innerHTML=e.showText)},Sparrow.showOrHiddenTag=function(t,e,i){i||(i=document);for(var o=0;o<t.length;o++){var n=t[o],r=$("^"+n,null,i);null!==r&&0!==r.length&&r.each(function(){this.zIndex=-1,this.style.visibility=e?"visible":"hidden"})}},Sparrow.prototype.marque=function(t,e,i,o){var n=null;this.s.parentNode.style.position="relative",this.s.style.position="absolute";var r=this.s.parentNode.offsetHeight,s=this.s.offsetHeight;switch(t){case 0:if(s<=r)return;this.s.innerHTML+=this.s.innerHTML,o||(o=-3),n="{top:'"+(-s+"px")+"',start:"+o+",percent:"+e+"}"}this.animation(n,i)},Sparrow.prototype.progressbar=function(t,e){var i=$("+div");document.body.appendChild(i.s),e.style&&(i.s.style.cssText=e.style);var o=$("+div");i.s.appendChild(o.s),e.progressStyle&&(o.s.style.cssText=e.progressStyle),o.s.style.width="0px",o.it=window.setInterval(function(){t(o)},100),o.end=function(){window.clearInterval(o.it)},o.remove=function(){document.body.removeChild(o.s.parentNode)}},Sparrow.menu=function(t,e,i){this.config={current_menu:null,left_limit:-1,period:3,frameDiv:null,srcElement:null,width:300,position:{},container:null,parent:null,menu:[],list:[],children:[],brothers:[]},this.obj=t,this.menuLink=i,this.id="div"+this.obj.firstCharUpperCase(),this.position=e||"SIDE",$.global(t,this)},Sparrow.menu.prototype.side=function(){this.config.frameDiv=$("+div").s,this.config.frameDiv.onmouseover=function(t){$.event(t).cancelBubble()},document.body.appendChild(this.config.frameDiv),this.config.frameDiv.style.cssText=$.css.menu.frame.format(this.config.width,0,0);var t=[];t.push('<ul style="{0}">'.format($.css.menu.ul.format(this.config.width-2)));for(var e=0;e<this.config.menu.length;e++)t.push('<li style="{0}" {3}><a href="javascript:void(0);" onclick="{1}.itemClick({2});"  style="width:{4}px;display:inline-block;cursor:pointer"><span style="float:left">{5}</span><span  style="float:right;">{6}</span></a></li>'.format($.css.menu.li.format(this.config.width),this.obj,e,this.config.menu[e].more?'onmouseover="{0}.itemMore(this,{1});"'.format(this.obj,e):"",this.config.width,this.config.menu[e].text,this.config.menu[e].more?">>":""));t.push("</ul>"),this.config.frameDiv.innerHTML=t.join("")},Sparrow.menu.prototype.vertical=function(){if($(this.id)){var t=$("!div."+this.id),n=this.obj;t.each(function(t){var i=$.global(n),e=$("!a",this)[0];e.id=i.id+"_"+i.position+"_menu_"+t;var o=$("!ul",this)[0];o&&(o.id=e.id+"_child",i.config.position[o.id]=o.offsetHeight,o.style.display="none",o.style.height="0px",$(o).bind("onmouseover",function(t){$.event(t).cancelBubble()}),$(e).bind("onclick",function(t){$.event(t).cancelBubble();var e=$("#"+this.id+"_child");null==i.config.current_menu&&("block"===(i.config.current_menu=e).s.style.display?(e.move_end=function(){i.config.current_menu=null},e.animation("{height:'0px'}",i.config.period)):(e.s.style.display="block",e.move_end=function(){i.config.current_menu=null},e.animation("{height:'"+i.config.position[e.s.id]+"px'}",i.config.period)))}))});var e=$("#"+this.id);e.bind("onmouseover",function(t){$.event(t).cancelBubble()}),$("#"+this.menuLink).bind("onmouseover",function(t){$.event(t).cancelBubble(),e.css("marginLeft","0px")}),$(document).bind("onmouseover",function(){e.css("marginLeft","-150px")})}},Sparrow.menu.prototype.dispose=function(){this.config.frameDiv&&document.body.removeChild(this.config.frameDiv)},Sparrow.menu.prototype.hidden=function(){if(this.position===$.SIDE){if(!this.config.frameDiv)return;this.config.frameDiv.style.display="none";for(var t=0;t<this.config.children.length;t++)this.config.children[t].hidden()}if(this.position===$.HORIZONTAL){var e=this;if(null==this.config.current_menu)return;$(this.config.current_menu.parentNode).stop(),$(this.config.current_menu.parentNode).move_end=function(){e.config.current_menu=null},$(this.config.current_menu.parentNode).animation("{height:'0px'}",this.config.period)}},Sparrow.menu.prototype.show=function(t,e){this.config.parent=e,this.config.srcElement=t;var i=0;this.config.container&&(i=this.config.container.scrollTop);var o=$(this.config.srcElement).getAbsoluteLeft();this.config.position===this.SIDE&&(o+=this.config.srcElement.offsetWidth);var n=$(this.config.srcElement).getAbsoluteTop()-i;this.config.frameDiv.style.left=o+"px",this.config.frameDiv.style.top=n-2+"px",this.config.frameDiv.style.display="block";for(var r=0;r<this.config.children.length;r++)this.config.children[r].hidden();for(r=0;r<this.config.brothers.length;r++)this.config.brothers[r].hidden()},Sparrow.menu.prototype.itemClick=function(t){alert("click:"+this.config.menu[t].text)},Sparrow.menu.prototype.itemMore=function(t,e){alert("more:"+this.config.menu[e].text)},Sparrow.menu.prototype.horizontal=function(){if($(this.id)){var t=$("!div."+this.id);this.config.menu=$("!li",t[0]),this.config.list=$("!ul",t[1]),this.config.left_limit=$("#"+this.id).getAbsoluteLeft(),null==this.config.position.height&&(this.config.position.height=30);var n=$.global(this.obj);$(document).bind("onmouseover",function(){n.hidden(this)}),this.config.menu.each(function(t){this.id=n.obj+"_"+n.position+"_menu_"+t;var e=$(n.config.list[t]);e.s.style.cssText="height:{0}px;overflow:hidden;width:{1}px;".format(e.s.offsetHeight,e.s.offsetWidth+10),e.s.id=this.id+"_child",e.bind("onmouseover",function(t){$.event(t).cancelBubble()}),$(this).bind("onmouseover",function(t){if((t=$.event(t)).cancelBubble(),"LI"===t.srcElement.tagName){var e=$(t.srcElement.id+"_child");if(null!=n.config.current_menu){if(e===n.config.current_menu)return;$(n.config.current_menu).stop()}(n.config.current_menu=e).parentNode.style.height="0";var i=$(n.id).offsetTop-$.win.getScrollTop();if(i<=0&&(i=0),e.parentNode.style.top=i+n.config.menu[0].offsetHeight-8+"px",0<e.getElementsByTagName("li").length){n.config.list.each(function(){this.style.display="none"}),e.style.display="block";var o=parseInt(t.srcElement.offsetLeft,10)-(parseInt(e.style.width,10)-t.srcElement.offsetWidth)/2;o<n.config.left_limit&&(o=n.config.left_limit),e.style.marginLeft=o+"px",$(e.parentNode).stop(),$(e.parentNode).animation("{height:'"+n.config.position.height+"px'}",n.config.period)}}})})}},Sparrow.menu.prototype.init=function(){this.position===$.SIDE?this.side():this.position===$.VERTICAL?this.vertical():this.position===$.HORIZONTAL&&this.horizontal()},Sparrow.ImageCropper=function(t,e,i){if(this.preview="string"==typeof t?$(t):t,this.size={width:this.preview.offsetWidth,height:this.preview.offsetHeight},this.config={width:150,height:150,left:30,top:30,locked:!1,lockRate:!1,rate:0},this.result={x:this.config.left,y:this.config.top,w:this.config.width,h:this.config.height},e)for(var o in e)this.config[o]=e[o];if(this.selectSize={width:this.config.width,height:this.config.height},this.offset={x:0,y:0},this.draging=this.moving=!1,i&&"function"==typeof i)this.onComplete=i;else{var n=this;this.onComplete=function(t,e,i,o){n.result={x:t,y:e,w:i,h:o}}}},Sparrow.ImageCropper.prototype={init:function(){var t=this.getPosition(this.preview);this.position={x:t.left,y:t.top},this.dragElement=null,this.dragIndex=0,!this.config.rate&&this.config.lockRate&&(this.config.rate=this.config.height/this.config.width),this.config.left+=this.position.x,this.config.top+=this.position.y;var e=this.master=document.createElement("div");e.style.color="#ca151d",e.style.position="absolute",e.style.width=this.size.width+"px",e.style.height=this.size.height+"px",e.style.left=this.position.left+"px",e.style.top=this.position.top+"px",e.style.backgroundColor="#FFFFFF",e.style.filter="alpha(opacity=50)",e.style.opacity="0.5",document.body.appendChild(e);var i=this.content=document.createElement("div");i.style.color="blue",i.style.position="absolute",i.style.width=this.config.width+"px",i.style.height=this.config.height+"px",i.style.top=this.config.top+"px",i.style.left=this.config.left+"px",i.style.background="url("+this.preview.src+")",i.style.backgroundRepeat="no-repeat",i.style.backgroundPosition=-(this.config.left-this.position.x)+"px "+-(this.config.top-this.position.y)+"px",i.style.filter="alpha(opacity=100)",i.style.opacity="1",i.style.border="#000 1px solid",document.body.appendChild(i);for(var o=[{top:"0%",left:"0%",marginLeft:"1",marginTop:"1",cursor:"nw-resize"},{top:"0%",left:"50%",marginLeft:"-4",marginTop:"1",cursor:"s-resize"},{top:"0%",left:"100%",marginLeft:"-8",marginTop:"1",cursor:"sw-resize"},{top:"50%",left:"0%",marginLeft:"1",marginTop:"-4",cursor:"w-resize"},{top:"50%",left:"100%",marginLeft:"-8",marginTop:"-4",cursor:"w-resize"},{top:"100%",left:"0%",marginLeft:"1",marginTop:"-8",cursor:"sw-resize"},{top:"100%",left:"50%",marginLeft:"-4",marginTop:"-8",cursor:"s-resize"},{top:"100%",left:"100%",marginLeft:"-20",marginTop:"-20",cursor:"nw-resize"}],n=7;n<o.length;n++){var r=document.createElement("div");r.style.height="20px",r.style.width="20px",r.style.top=o[n].top,r.style.left=o[n].left,r.style.position="absolute",r.style.marginLeft=o[n].marginLeft+"px",r.style.marginTop=o[n].marginTop+"px",r.style.background="url("+$.url.resource+"/images/drag.png)",r.style.cursor=o[n].cursor,r.onmousedown=$.bind(this,"dragStart",{element:r,index:n+1}),r.onmousemove=$.bind(this,"dragMoving"),r.onmouseout=$.bind(this,"dragStop"),i.appendChild(r)}var s=this.dragDiv=document.createElement("div");s.style.left="7px",s.style.top="7px",s.style.height=this.config.height-14+"px",s.style.width=this.config.width-14+"px",s.style.position="absolute",s.style.cursor="move",i.appendChild(s),s.onmousedown=$.bind(this,"moveStart"),i.onmousemove=$.bind(this,"onMoving"),i.onmouseup=$.bind(this,"moveStop"),i.onmouseout=$.bind(this,"moveStop")},moveStart:function(t){console.info("拖动位置开始 moving"+this.moving),this.moving=!0;var e=this.getPosition(this.content);e&&(this.offset.x=(t?t.pageX:event.clientX+document.body.scrollLeft)-e.left,this.offset.y=(t?t.pageY:event.clientY+document.body.scrollTop)-e.top),this.content.setCapture?this.content.setCapture():this.content.onmouseout=$.bind(this,"moveStop")},onMoving:function(t){if(console.info("拖动改变显示层位置 moving"+this.moving),this.moving){var e=(t?t.pageX:event.clientX+document.body.scrollLeft)-this.offset.x,i=(t?t.pageY:event.clientY+document.body.scrollTop)-this.offset.y,o=this.position.x,n=this.position.y,r=this.size.height,s=this.size.width;e=(e=e>s+o-this.config.width?s+o-this.config.width:e)<o?o:e,i=(i=i>r+n-this.config.height?r+n-this.config.height:i)<n?n:i,this.config.left=e,this.config.top=i,this.onResize()}},moveStop:function(){console.info("拖动位置结束 moving"+!this.moving),this.moving&&(this.moving=!1,this.content.releaseCapture&&this.content.releaseCapture(),this.complete())},dragStart:function(t,e){if(console.info("拖动尺寸开始,初始化一些数据."+this.config.locked),!this.config.locked){this.draging=!0,this.dragElement=t.element,this.dragIndex=t.index;var i=this.getPosition(this.dragElement);i&&(this.offset.x=(e?e.pageX:event.clientX+document.body.scrollLeft)-i.left,this.offset.y=(e?e.pageY:event.clientY+document.body.scrollTop)-i.top),this.dragElement.setCapture?this.dragElement.setCapture():this.dragElement.onmouseup=$.bind(this,"dragStop")}},dragStop:function(){console.info("拖动尺寸结束."+!this.draging),this.draging&&(this.draging=!1,this.dragElement.releaseCapture&&this.dragElement.releaseCapture(),this.complete())},onResize:function(){console.info("设置拖动时产生的尺寸和位置到dom元素上."+this.config.left+"|"+this.config.top),this.content.style.left=this.config.left+"px",this.content.style.top=this.config.top+"px",this.content.style.width=this.config.width+"px",this.content.style.height=this.config.height+"px",this.dragDiv.style.width=this.config.width-14+"px",this.dragDiv.style.height=this.config.height-14+"px",this.content.style.backgroundPosition=-(this.config.left-this.position.x)+"px "+-(this.config.top-this.position.y)+"px"},dragMoving:function(t){if(this.draging&&!this.config.locked)switch(this.dragIndex){case 1:var e=this.getPosition(this.dragElement),i={left:t?t.pageX:event.clientX+document.body.scrollLeft,top:t?t.pageY:event.clientY+document.body.scrollTop},o=e.left-i.left+this.offset.x,n=e.top-i.top+this.offset.y;if(this.config.lockRate&&(n=(this.config.width+o)*this.config.rate-this.config.height),this.config.left-o<this.position.x||this.config.top-n<this.position.y||this.config.width+o<this.selectSize.width||this.config.height+n<this.selectSize.height)return;this.config.left-=o,this.config.top-=n,this.config.width+=o,this.config.height+=n,this.onResize();break;case 2:e=this.getPosition(this.dragElement);console.info(document.body.scrollLeft),console.info(document.body.scrollTop);i={left:t?t.pageX:event.clientX+document.body.scrollLeft,top:t?t.pageY:event.clientY+document.body.scrollTop},n=e.top-i.top+this.offset.y;if(this.config.top-n<this.position.y)return void console.info("2 return ");if(console.info("stepY"+n),this.config.lockRate){o=this.config.height/this.config.rate-this.config.width;if(this.config.left-o/2<this.position.x||this.config.left+o/2+this.config.width>this.position.x+this.size.width||this.config.width+o<this.selectSize.width)return void console.info("2 return lockRate");this.config.width+=o,this.config.left-=o/2}if(this.config.height+n<this.selectSize.height)return;this.config.top-=n,this.config.height+=n,this.onResize();break;case 3:e=this.getPosition(this.dragElement),i={left:t?t.pageX:event.clientX+document.body.scrollLeft,top:t?t.pageY:event.clientY+document.body.scrollTop},n=e.top-i.top+this.offset.y,o=i.left-e.left-this.offset.x;if(this.config.top-n<this.position.y)return;if(this.config.lockRate&&(o=(this.config.height+n)/this.config.rate-this.config.width),this.config.left+o+this.config.width>this.position.x+this.size.width||this.config.width+o<this.selectSize.width||this.config.height+n<this.selectSize.height)return;this.config.width+=o,this.config.top-=n,this.config.height+=n,this.onResize();break;case 4:e=this.getPosition(this.dragElement),i={left:t?t.pageX:event.clientX+document.body.scrollLeft,top:t?t.pageY:event.clientY+document.body.scrollTop},o=e.left-i.left+this.offset.x;if(this.config.left-o<this.position.x)return;if(this.config.lockRate){n=this.config.width*this.config.rate-this.config.height;if(this.config.top-n/2<this.position.y||this.config.height+this.config.top-n/2>this.size.height+this.position.y||this.config.height+n<this.selectSize.height)return;this.config.height+=n,this.config.top-=n/2}if(this.config.width+o<this.selectSize.width)return;this.config.left-=o,this.config.width+=o,this.onResize();break;case 5:e=this.getPosition(this.dragElement),o=(i={left:t?t.pageX:event.clientX+document.body.scrollLeft,top:t?t.pageY:event.clientY+document.body.scrollTop}).left-e.left-this.offset.x;if(this.config.left+this.config.width+o>this.position.x+this.size.width)return;if(this.config.lockRate){n=(this.config.width+o)*this.config.rate-this.config.height;if(this.config.top-n/2<this.position.y||this.config.height+this.config.top+n/2>this.position.y+this.size.height||this.config.height+n<this.selectSize.height)return;this.config.height+=n,this.config.top-=n/2}if(this.config.width+o<this.selectSize.width)return;this.config.width+=o,this.onResize();break;case 6:e=this.getPosition(this.dragElement),i={left:t?t.pageX:event.clientX+document.body.scrollLeft,top:t?t.pageY:event.clientY+document.body.scrollTop},o=e.left-i.left+this.offset.x,n=i.top-e.top-this.offset.y;if(this.config.lockRate&&(n=(this.config.width+o)*this.config.rate-this.config.height),this.config.left-o<this.position.x||this.config.top+n+this.config.height>this.position.y+this.size.height||this.config.width+o<this.selectSize.width||this.config.height+n<this.selectSize.height)return;this.config.left-=o,this.config.width+=o,this.config.height+=n,this.onResize();break;case 7:e=this.getPosition(this.dragElement),n=(i={left:t?t.pageX:event.clientX+document.body.scrollLeft,top:t?t.pageY:event.clientY+document.body.scrollTop}).top-e.top-this.offset.y;if(this.config.top+n+this.config.height>this.position.y+this.size.height)return;if(this.config.lockRate){o=(this.config.height+n)/this.config.rate-this.config.width;if(this.config.left-o/2<this.position.x||this.config.left+o+this.config.width>this.position.x+this.size.width||this.config.width+o<this.selectSize.width)return;this.config.width+=o,this.config.left-=o/2}if(this.config.height+n<this.selectSize.height)return;this.config.height+=n,this.onResize();break;case 8:e=this.getPosition(this.dragElement),o=(i={left:t?t.pageX:event.clientX+document.body.scrollLeft,top:t?t.pageY:event.clientY+document.body.scrollTop}).left-e.left-this.offset.x,n=i.top-e.top-this.offset.y;if(this.config.lockRate&&(n=(this.config.width+o)*this.config.rate-this.config.height),this.config.left+o+this.config.width>this.position.x+this.size.width||this.config.top+n+this.config.height>this.position.y+this.size.height||this.config.width+o<this.selectSize.width||this.config.height+n<this.selectSize.height)return;this.config.width+=o,this.config.height+=n,this.onResize()}},getPosition:function(t){var e={top:0,left:0};for(e.left=t.offsetLeft,e.top=t.offsetTop;t=t.offsetParent;)e.top+=t.offsetTop,e.left+=t.offsetLeft;return e},release:function(){this.master.parentNode.removeChild(this.master),this.content.parentNode.removeChild(this.content),this.dragDiv.parentNode.removeChild(this.dragDiv)},resetImage:function(t){this.preview.src=t,this.content.style.background="url("+t+")"},complete:function(){this.onComplete(this.config.left-this.position.x,this.config.top-this.position.y,this.config.width,this.config.height)},onComplete:function(t,e,i,o){}},Sparrow.datePicker=function(t){var e=Object();e["yyyy年MM月dd日"]=new RegExp("^(\\d{4})年(\\d{2})月(\\d{2})日$","ig"),e["yyyy-MM-dd"]=new RegExp("^(\\d{4})-(\\d{2})-(\\d{2})$","ig"),e["yyyy年MM月"]=new RegExp("^\\d{4}年\\d{2}月$","ig"),e["yyyy-MM"]=new RegExp("^\\d{4}-\\d{2}$","ig"),this.obj=t,this.currentDate=new Date,this.pickerDiv=null,this.config={format:e,srcElement:null,currentFMT:"yyyy-MM-dd",maxDaysOfMonth:[31,28,31,30,31,30,31,31,30,31,30,31],weekDay:["日","一","二","三","四","五","六"],month:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],minDate:null,allowNull:!1}},Sparrow.datePicker.prototype.isLeapYear=function(t){return 0==t%4&&(t%100!=0||t%400==0)},Sparrow.datePicker.prototype.getMaxDaysOfMonth=function(t,e){-1===e&&(e=11);var i=this.config.maxDaysOfMonth[e];return 1===e&&this.isLeapYear(t)&&(i+=1),i},Sparrow.datePicker.prototype.getFormatDate=function(t,e,i){if(void 0===e||void 0===i){var o=this.config.format[this.config.currentFMT],n=o.exec(this.config.srcElement.value);if(null==n&&(n=o.exec(this.config.srcElement.value)),null!=n){var r=n[2],s=n[3];e||(e=r-1),i||(i=s)}}return e=parseInt(e,10),(e+=1)<10&&(e="0"+e),(i=parseInt(i,10))<10&&(i="0"+i),this.config.currentFMT.replace("yyyy",t).replace("MM",e).replace("dd",i)},Sparrow.datePicker.prototype.init=function(t,e,i){if(!t){var o=this.currentDate;t=o.getFullYear(),e=o.getMonth(),i=o.getDate()}if(!this.pickerDiv){var n=$(this.config.srcElement);this.currentDate=new Date(t,e,i),this.pickerDiv=$("+div"),this.pickerDiv.s.id=this.obj,this.pickerDiv.s.style.cssText="position:absolute;display:none;text-align:center",this.pickerDiv.s.style.left=n.getAbsoluteLeft()+"px",this.pickerDiv.s.style.top=n.getAbsoluteTop()+this.config.srcElement.clientHeight+"px",this.pickerDiv.opacity(100),document.body.appendChild(this.pickerDiv.s),this.pickerDiv.s.onclick=function(t){$.event(t).cancelBubble()},this.config.srcElement.readOnly="readonly";var r=this.obj+".config.srcElement.onclick=function(e){$.event(e).cancelBubble();"+this.obj+".show();};"+this.obj+".config.srcElement.onchange=function(){"+this.obj+".validate();"+this.obj+".init();};";window.setTimeout(r,0)}var s=this.getMaxDaysOfMonth(t,e-1),a=this.getMaxDaysOfMonth(t,e),l=new Date(t,e,1).getDay(),c=s-(0===l?7:l)+1,h=[];h.push('<table class="pure-table pure-table-bordered">'),h.push("<tr>"),h.push('<td><a  href="javascript:void(0);" onclick="{0}.changeMonth(-1)">&lt;<a></td>'.format(this.obj)),h.push('<td colspan="3"><a onclick="{0}.initYear({1});" href="javascript:void(0)">{1}</a>年</td>'.format(this.obj,t)),h.push('<td colspan="2"><a onclick="{0}.initMonth({2},{3});" href="javascript:void(0);">{1}</a></td>'.format(this.obj,this.config.month[e],t,e)),h.push('<td><a  href="javascript:void(0);" onclick="{0}.changeMonth(1)">&gt;<a></td>'.format(this.obj)),h.push("</tr>"),h.push("<tr>");for(var d=0;d<7;d+=1)h.push("<td>{0}</td>".format(this.config.weekDay[d]));h.push("</tr>");var u=0;h.push("<tr>");for(var f=c;f<=s;f+=1)h.push('<td><a  style="color:#ccc;">{0}</a></td>'.format(f)),(u+=1)%7==0&&(h.push("</tr>"),h.push("<tr>"));for(var p=1;p<=a;p+=1)h.push('<td><a href="javascript:void(0);" onclick="{0}.changeDate({1},{2},{3});">{3}</a></td>'.format(this.obj,t,e,p)),(u+=1)%7==0&&(h.push("</tr>"),h.push("<tr>"));for(var g=7-u%7,m=1;m<=g;m+=1)h.push('<td><a  style="color:#ccc;">{0}</a></td>'.format(m)),(u+=1)%7==0&&(h.push("</tr>"),h.push("<tr>"));h.push("</tr>"),this.pickerDiv.s.innerHTML=h.join(""),this.config.srcElement.value=this.getFormatDate(t,e,i)},Sparrow.datePicker.prototype.show=function(){this.pickerDiv.s.style.display="block"},Sparrow.datePicker.prototype.hidden=function(){yyyy=this.currentDate.getFullYear(),MM=this.currentDate.getMonth(),dd=this.currentDate.getDate(),this.config.allowNull||""!==this.config.srcElement.value||(this.config.srcElement.value=this.getFormatDate(yyyy,MM,dd)),this.pickerDiv.s.style.display="none"},Sparrow.datePicker.prototype.initYear=function(t){var e=t-t%10;e<1900&&(e=1900);var i=e+10,o=[];o.push('<table class="pure-table pure-table-bordered">'),o.push("<tr>"),o.push('<td><a href="javascript:void(0);" onclick="{0}.initYear({1})">&lt;<a></td>'.format(this.obj,t-10)),o.push('<td colspan="2">{0}-{1}</td>'.format(e,i-1)),o.push('<td><a href="javascript:void(0);" onclick="{0}.initYear({1})">&gt;<a></td>'.format(this.obj,t<1900?1910:t+10)),o.push("</tr>"),o.push("<tr>");for(var n=0,r=e-1;r<i;r+=1)r===e-1||r===i?o.push('<td style="color:#ccc">{0}</td>'.format(r)):o.push('<td><a href="javascript:void(0);" onclick="{0}.initMonth({1})">{1}</a></td>'.format(this.obj,r)),++n%4==0&&o.push("</tr><tr>");o.push('<td style="color:#ccc">{0}</td>'.format(i)),o.push("</tr>"),o.push("</table>"),this.pickerDiv.s.innerHTML=o.join("")},Sparrow.datePicker.prototype.initMonth=function(t,e){e||(e=this.getCurrentDate().getMonth());var i=[];i.push('<table  class="pure-table pure-table-bordered">'),i.push("<tr>"),i.push('<td><a href="javascript:void(0);" onclick="{0}.initMonth({1},{2})">&lt;<a></td>'.format(this.obj,t-1,e)),i.push('<td style="text-align:center;" colspan="2"><a href="javascript:void(0);" onclick="{0}.initYear({1})">{1}</a></td>'.format(this.obj,t)),i.push('<td><a href="javascript:void(0);" onclick="{0}.initMonth({1},{2})">&gt;<a></td>'.format(this.obj,t+1,e)),i.push("</tr>"),i.push("<tr>");for(var o=0,n=0;n<12;n+=1)i.push('<td><a href="javascript:void(0);" onclick="{0}.init({1},{2},{3})">{4}</a></td>'.format(this.obj,t,n,this.currentDate.getDate(),this.config.month[n])),++o%4==0&&i.push("</tr><tr>");i.push("</tr>"),i.push("</table>"),this.pickerDiv.s.innerHTML=i.join(""),this.config.srcElement.value=this.getFormatDate(t,e)},Sparrow.datePicker.prototype.changeMonth=function(t){var e=this.getCurrentDate(),i=parseInt(e.getMonth(),10)+t,o=parseInt(e.getFullYear(),10),n=parseInt(e.getDate(),10);1===t&&12===i?(i=0,o+=1):-1===t&&-1===i&&(i=11,o-=1),this.config.srcElement.value=this.getFormatDate(o,i,n),this.init(o,i,n)},Sparrow.datePicker.prototype.changeDate=function(t,e,i){this.config.srcElement.value=this.getFormatDate(t,e,i),this.validate(t,e,i)&&(this.currentDate=new Date(t,e,i)),this.hidden()},Sparrow.datePicker.prototype.userValidate=null,Sparrow.datePicker.prototype.getCurrentDate=function(){var t=this.config.format[this.config.currentFMT],e=t.exec(this.config.srcElement.value);return null==e&&(e=t.exec(this.config.srcElement.value)),new Date(e[1],parseInt(e[2],10)-1,e[3])},Sparrow.datePicker.prototype.validate=function(t,e,i){var o;if(""===this.config.srcElement.value.trim())return!!this.config.allowNull;if(-1===this.config.srcElement.value.search(this.config.format[this.config.currentFMT]))return $.message("请按【"+this.config.currentFMT+"】格式输入",this.config.srcElement),!1;if(!t){var n=this.getCurrentDate();t=n.getFullYear(),e=n.getMonth(),i=n.getDate()}if(t<1900||2099<t)return $.m.show("年份超出范围！\n正确年份范围1900-2099",this.config.srcElement),!1;if(e<0||12<e)return $.m.show("月份超出范围!",this.config.srcElement),!1;if(i<0||i>this.getMaxDaysOfMonth(t,e))return $.m.show("日期范围超出!",this.config.srcElement),!1;if(o=new Date(t,e,i),null!=this.config.minDate){var r=new Date(this.config.minDate.getFullYear(),this.config.minDate.getMonth(),this.config.minDate.getDate());if(o<r)return m.show("不允许小于"+this.getFormatDate(r.getFullYear(),r.getMonth(),r.getDate()),this.config.srcElement),!1}return!(this.userValidate&&!this.userValidate())&&(this.currentDate=o,!0)},Sparrow.editor=function(t,e){this.obj=t,this.fullObjName=e?e+"."+t:t,this.frame=null,this.config={cover_key:"Cover",style:null,flash_thumbnail:!0,iframeId:null,titleCtrlId:"txtTitle",contentCtrlId:"hdnContent",wordCount:"spanWordCount",submitButtonId:"btnSubmit",interval:null,currentHtmlId:null,tempNodeAttribute:"i_temp_attribute",container:{id:null,maxWidth:900,minWidth:700},attach:{key:"thread",uploadedJson:"",uploadImgContainerId:t+"_uploadImgContainer",localUploadImgTabId:t+"_localUploadImgTab",index:1,uploadedIndex:0,currentUUID:null,actionUrl:null,fileUUID:t+"_fileUUID",iframeName:t+"_fileUpload",iframeId:t+".{0}",fileRemark:t+"_fileRemark",fileInfoId:t+"_fileInfo",tableId:t+"_tabAttach",formIndex:0,showImageInfo:!0,uploadingFileId:[],maxAllowCount:5},tool:{id:t+"_HtmlEditorToolBar",height:40,position:"top",icon:{backGroundColor:null,containerId:t+"_tdEditorToolBar",path:$.url.resource+"/images/sparrowEditor/"},convertHTML:{isConvert:!0,ctrlId:t+"_tdConvertHTMLID",ctrlWidth:50},adjust:{adjustable:!1,width:120},style:{simple:[2,3,4,13,14,15,16,21,22,23],comment:[21,23,22],list:[21,22,23]},toolBar:[{left:-394,top:-8,width:84,height:24,title:"字号",cmd:"fontsize",htmlFrameId:"font_size",htmlheight:315,htmlwidth:170},{left:-310,top:-8,width:82,height:24,title:"字体",cmd:"fontname",htmlFrameId:"font_family",htmlheight:360,htmlwidth:130},{left:2,top:-8,width:26,height:24,title:"加粗",cmd:"bold"},{left:-28,top:-7,width:26,height:24,title:"斜体",cmd:"italic"},{left:-56,top:-8,width:26,height:24,title:"下划线",cmd:"underline"},{left:-82,top:-8,width:26,height:24,title:"文字颜色",cmd:"forecolor",htmlFrameId:"FColor",htmlheight:308,htmlwidth:364},{left:-114,top:-8,width:26,height:24,title:"背景颜色",cmd:"BackColor",firefoxcmd:"hilitecolor",htmlFrameId:"HColor",htmlheight:308,htmlwidth:364},{split:'<img src="{0}icoBack.gif" style="background:url({0}ico.gif) -940px -8px;width:8px;height:24px;"/>'},{left:-144,top:-8,width:26,height:22,title:"左对齐",cmd:"justifyleft"},{left:-168,top:-8,width:26,height:22,title:"居中对齐",cmd:"justifycenter"},{left:-190,top:-8,width:26,height:22,title:"右对齐",cmd:"justifyright"},{left:-610,top:-8,width:92,height:22,title:"自动对齐",cmd:"justifyfull"},{split:'<img alt="" src="{0}icoBack.gif" style="background:url({0}ico.gif)-940px -8px;width:8px;height:24px;"/>'},{left:-562,top:-8,width:26,height:22,title:"编号",cmd:"InsertOrderedList"},{left:-588,top:-8,width:26,height:22,title:"项目符号",cmd:"InsertUnorderedList"},{left:-504,top:-8,width:26,height:22,title:"减少缩进",cmd:"outdent"},{left:-476,top:-8,width:26,height:22,title:"增加缩进",cmd:"indent"},{split:""},{left:-700,top:-7,width:100,height:22,title:"清除空格",cmd:"clearSpace"},{left:-536,top:-9,width:26,height:20,title:"插入横线",cmd:"inserthorizontalrule"},{left:-273,top:-3,width:34,height:34,title:"插入超链接",cmd:"hyperLink",htmlFrameId:"HyperLink",htmlheight:60,htmlwidth:400,keepStatus:!1},{left:-212,top:-3,width:34,height:34,title:"插入表情",cmd:"face",htmlFrameId:"face",htmlheight:280,htmlwidth:340},{left:-877,top:-3,width:32,height:34,title:"插入视频",cmd:"insertVideo",htmlFrameId:"video",htmlheight:120,htmlwidth:350},{left:-904,top:-3,width:34,height:34,title:"插入图片",cmd:"insertImage",htmlFrameId:"image",htmlheight:260,htmlwidth:520}],font_family:["宋体","黑体","隶书","楷体","幼圆","Arial","Impact","Georgia","Verdana","Courier New","Times New Roman"],font_size:[{size:1,name:"1|8pt"},{size:2,name:"2|10pt"},{size:3,name:"3|12pt"},{size:4,name:"4|14pt"},{size:5,name:"5|18pt"},{size:6,name:"6|24pt"},{size:7,name:"7|36pt"}],face:[{url:$.url.resource+"/images/sparrowEditor/face/01.gif",name:"呲牙"},{url:$.url.resource+"/images/sparrowEditor/face/02.gif",name:"不嘛"},{url:$.url.resource+"/images/sparrowEditor/face/03.gif",name:"哭泣"},{url:$.url.resource+"/images/sparrowEditor/face/04.gif",name:"嘟嘟"},{url:$.url.resource+"/images/sparrowEditor/face/05.gif",name:"嗯嗯"},{url:$.url.resource+"/images/sparrowEditor/face/06.gif",name:"思考下"},{url:$.url.resource+"/images/sparrowEditor/face/07.gif",name:"翻跟斗"},{url:$.url.resource+"/images/sparrowEditor/face/08.gif",name:"我靠"},{url:$.url.resource+"/images/sparrowEditor/face/09.gif",name:"扫射"},{url:$.url.resource+"/images/sparrowEditor/face/10.gif",name:"嘘!"},{url:$.url.resource+"/images/sparrowEditor/face/11.gif",name:"害羞"},{url:$.url.resource+"/images/sparrowEditor/face/12.gif",name:"眯眯"},{url:$.url.resource+"/images/sparrowEditor/face/13.gif",name:"求保佑"},{url:$.url.resource+"/images/sparrowEditor/face/14.gif",name:"晕"},{url:$.url.resource+"/images/sparrowEditor/face/15.gif",name:"来一拳"},{url:$.url.resource+"/images/sparrowEditor/face/16.gif",name:"胜利"},{url:$.url.resource+"/images/sparrowEditor/face/17.gif",name:"嚎叫"},{url:$.url.resource+"/images/sparrowEditor/face/18.gif",name:"BIBI"},{url:$.url.resource+"/images/sparrowEditor/face/19.gif",name:"哼哼"},{url:$.url.resource+"/images/sparrowEditor/face/20.gif",name:"冷汗"},{url:$.url.resource+"/images/sparrowEditor/face/21.gif",name:"泼墨"},{url:$.url.resource+"/images/sparrowEditor/face/22.gif",name:"吐血"},{url:$.url.resource+"/images/sparrowEditor/face/23.gif",name:"扣鼻子"},{url:$.url.resource+"/images/sparrowEditor/face/24.gif",name:"挠挠脸"},{url:$.url.resource+"/images/sparrowEditor/face/25.gif",name:"舔手指"},{url:$.url.resource+"/images/sparrowEditor/face/26.gif",name:"吃饭啦"},{url:$.url.resource+"/images/sparrowEditor/face/27.gif",name:"打哈欠"},{url:$.url.resource+"/images/sparrowEditor/face/28.gif",name:"拜拜"},{url:$.url.resource+"/images/sparrowEditor/face/29.gif",name:"抽一口"},{url:$.url.resource+"/images/sparrowEditor/face/30.gif",name:"杀死"}]}},this.attach={parentObject:null,setParentObject:function(t){this.parentObject=t},loadAttach:function(){var t=this.parentObject;$("#tab"+t.obj).tabs();var e=t.config.attach.uploadedJson.json();if(null!=e&&0<e.length){var i=$(t.config.attach.uploadImgContainerId);if(null==i)t.run("tool_23_"+t.obj);else if(""===i.innerHTML.trim())for(var o=e.length-1;0<=o;o--){var n=e[o].clientFileName,r=e[o].url;i.appendChild(getImgContainer(r,n,t))}}},collectFilePostInfo:function(){var t=this.parentObject;if($(t.config.attach.tableId)){for(var e=$("&"+t.config.attach.fileUUID),i=$("&"+t.config.attach.fileRemark),o=[],n=0;n<e.length;n++)e[n].value&&o.push(e[n].value+":"+i[n].value);return o.join()}return""},validate:function(t,e){return null==e||$.browser.isLogin()?$.v.getValidateResult(t,!1):($.user.login.dialog(e),!1)},_submit:function(){$(this.parentObject.config.attach.fileInfoId).value=this.parentObject.attach.collectFilePostInfo(),this.parentObject.config.attach.actionUrl?$.submit(this.parentObject.config.attach.actionUrl,this.parentObject.config.attach.formIndex):this.parentObject.config.attach.currentUUID?$.submit("update.do",this.parentObject.config.attach.formIndex):$.submit(null,this.parentObject.config.attach.formIndex)},submit:function(t,e){var i=this.parentObject;$(i.config.contentCtrlId).value=i.frame.contentWindow.document.body.innerHTML,this.validate(t,e)?this._submit():$(this.parentObject.config.submitButtonId).disabled=!1},insertEditor:function(t,e){var i=this.parentObject,o='<img title="'+t+'" src="'+e+'"/>';i.createTempNode("span"),i.getTempNode().innerHTML=o,i.removeElementById()},deleteOnServer:function(t,e){var i=this.parentObject;window.confirm($.message.deleteFile)&&$.ajax.json($.url.root+"/attach/delete.json","uuid="+fileUUID,function(t){i.attach.deleteImg($.ajax.srcElement),$.message("删除成功！")},e)},deleteImg:function(t){$(t.parentNode.parentNode.removeChild(t.parentNode)),$.file.wit&&window.clearInterval($.file.wit),$("divState")&&document.body.removeChild($("divState"))}}},Sparrow.editor.editorArray=[],Sparrow.editor.uploadUrl="http://upload.sparrowzoo.com",Sparrow.editor.prototype.$=function(t){return this.frame.contentWindow.document.getElementById(t)},Sparrow.editor.prototype.getTempNode=function(t){var e=this.$(this.config.tempNodeAttribute);if(e)return e;t=t?t.toLowerCase():$.browser.ie||$.browser.opera?"font":"span";for(var i=null,o=this.frame.contentWindow.document.getElementsByTagName(t),n=o.length-1;0<=n;n--){if("font"===t||"span"===t)i=$.browser.ie||$.browser.opera?o[n].face:o[n].style.fontFamily;else if("a"===t)try{i=o[n].href}catch(t){}if(i&&-1!==i.indexOf(this.config.tempNodeAttribute))return o[n].id=this.config.tempNodeAttribute,o[n]}},Sparrow.editor.prototype.replaceTagWithInnerHTML=function(t){if($.browser.firefox){var e=this.getRange();e.setStartBefore(t);var i=e.createContextualFragment(t.innerHTML);t.parentNode.replaceChild(i,t)}else t.outerHTML=t.innerHTML},Sparrow.editor.prototype.removeElementById=function(){var t=this.$(this.config.tempNodeAttribute);this.replaceTagWithInnerHTML(t)},Sparrow.editor.prototype.getBrief=function(){var t=null;return 300<(t=$.browser.ie?this.frame.contentWindow.document.body.innerText.substring(0,300):this.frame.contentWindow.document.body.textContent.length).length&&(t=t.substring(0,300)),t},Sparrow.editor.prototype.getEditorContent=function(){if(this.config.tool.convertHTML.isConvert){var t=document.getElementById(this.config.tool.convertHTML.ctrlId);"HTML"!==t.innerHTML&&(t.innerHTML="HTML",document.getElementById(this.config.tool.icon.containerId).style.display="block",$.browser.ie?this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.innerText:this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.textContent)}return this.clear(),"<br>"===this.frame.contentWindow.document.body.innerHTML||"<br/>"===this.frame.contentWindow.document.body.innerHTML?"":this.frame.contentWindow.document.body.innerHTML},Sparrow.editor.prototype.initContent=function(){var t=$(this.config.contentCtrlId);if(null!=t){var e=t.value;this.setEditorContent(decodeURIComponent(e))}this.attach.setParentObject(this),this.config.attach.uploadedJson=decodeURIComponent("")},Sparrow.editor.prototype.focus=function(){this.frame.contentWindow.document.body.focus()},Sparrow.editor.prototype.setEditorContent=function(t){$(this.config.contentCtrlId).value=t,null!=this.frame&&(this.frame.contentWindow.document.body.innerHTML=t,this.updateWordCount())},Sparrow.editor.prototype.setEditorText=function(t){this.frame.contentWindow.document.body.innerText=t,this.updateWordCount()},Sparrow.editor.prototype.getRange=function(){return this.frame.contentWindow.document.body.focus(),$.browser.ie?this.frame.contentWindow.document.selection.createRange():this.frame.contentWindow.getSelection().getRangeAt(0)},Sparrow.editor.prototype.m_over=function(t){this.config.tool.icon.backGroundColor=t.style.backgroundColor,t.style.backgroundColor="#595959",t.style.cursor="pointer"},Sparrow.editor.prototype.m_out=function(t){t.style.backgroundColor=this.config.tool.icon.backGroundColor},Sparrow.editor.prototype.m_down=function(t){var e=t.id.split("_")[1];t.style.background="url("+this.config.tool.icon.path+"ico.gif) "+(this.config.tool.toolBar[e].left+1)+"px "+(this.config.tool.toolBar[e].top+1)+"px"},Sparrow.editor.prototype.m_up=function(t){var e=t.id.split("_")[1];t.style.background="url("+this.config.tool.icon.path+"ico.gif) "+this.config.tool.toolBar[e].left+"px "+this.config.tool.toolBar[e].top+"px",this.run(t.id)},Sparrow.editor.prototype.clearTag=function(t){for(var e=this.frame.contentWindow.document.getElementsByTagName(t),i=e.length-1;0<=i;i--)""===e[i].innerHTML&&e[i].parentNode.removeChild(e[i])},Sparrow.editor.prototype.clear=function(){this.clearTag("span"),this.clearTag("font"),this.clearTag("div"),this.clearTag("p");try{this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.innerHTML.replace(/&nbsp;+/g," ").replace(/(<br>|<br\/>)+/g,"<br/>")}catch(t){}for(var t=this.getTempNode()||this.getTempNode("a");t;)"a"==t.tagName.toLowerCase()&&-1==t.href.indexOf(this.config.tempNodeAttribute)?t.removeAttribute("id"):this.removeElementById(),t=this.getTempNode()||this.getTempNode("a")},Sparrow.editor.prototype.createTempNode=function(t){t||(t="a");var e=this.getRange();if(""==($.browser.ie?e.text:e)){var i=document.createElement(t);"a"==t?i.href=this.config.tempNodeAttribute:i.id=this.config.tempNodeAttribute,$.browser.ie?(i.innerHTML=e.text,e.pasteHTML(i.outerHTML)):e.surroundContents(i)}else t&&"a"!=t.toLowerCase()?this.frame.contentWindow.document.execCommand("fontname",!1,this.config.tempNodeAttribute):this.frame.contentWindow.document.execCommand("createLink",!1,this.config.tempNodeAttribute)},Sparrow.editor.prototype.findTagNode=function(t){t=t.toLowerCase();var e=null,i=null;try{var o=this.getRange();if($.browser.ie)i=o.item?o.item(0):o.parentElement();else if(o.startContainer.getElementsByTagName){var n=o.startContainer.getElementsByTagName(t);i=0<n.length?n[0]:o.startContainer}else i=o.startContainer}catch(t){}if(i.nodeName.toLowerCase()===t)e=i;else for(;"body"!==i.nodeName.toLowerCase();){if(i.nodeName.toLowerCase()===t){e=i;break}i=i.parentNode}return e&&(e.id=this.config.tempNodeAttribute),e},Sparrow.editor.prototype.run=function(t){var e=$(t);key=e.id.split("_")[1],this.frame.contentWindow.focus(),0==key||1==key||5==key||6==key||20==key||21==key||22==key||23==key||24==key?(clearHtmlFrame(),this.show(e,key,this.config.tool.toolBar[key].htmlwidth,this.config.tool.toolBar[key].htmlheight)):18==key?(this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.innerHTML.replace(/&nbsp;+/g," ").replace(/(<br>|<br\/>)+/g,"<br/>"),this.clear()):this.frame.contentWindow.document.execCommand(this.config.tool.toolBar[key].cmd,!1,void 0),this.frame.contentWindow.focus()},Sparrow.editor.prototype.callBackRun=function(t,e){var i=(e=e||window.event).srcElement||e.target;switch(t){case 21:this.insertHyperLink();break;case 22:this.insertFace(i);break;case 23:if(0==this.insertVideo())return;break;default:var o=i.title,n=this.config.tool.toolBar[t].cmd;this.config.tool.toolBar[t].firefoxcmd&&(n=$.browser.ie?this.config.tool.toolBar[t].cmd:this.config.tool.toolBar[t].firefoxcmd),this.frame.contentWindow.document.execCommand(n,!1,o)}var r=document.getElementById(this.config.currentHtmlId);document.body.removeChild(r),this.config.currentHtmlId=null},Sparrow.editor.prototype.show=function(t,e,i,o){var n=$(t);this.config.currentHtmlId&&(document.getElementById(this.config.currentHtmlId).style.display="none",this.config.currentHtmlId=null);var r=this.obj+"_"+this.config.tool.toolBar[e].htmlFrameId,s=document.getElementById(r);s||((s=document.createElement("DIV")).id=r,document.body.appendChild(s)),s.style.cssText="display:block;position:absolute;width:"+i+"px;height:0px;border:#595959 1px solid;background:#ffffff; padding:1px;text-align:center;",s.onclick=function(t){$.event(t).cancelBubble()};var a=n.getAbsoluteLeft()-(i-t.offsetWidth)/2,l=$(t.parentNode).getAbsoluteLeft();a<l&&(a=l),s.style.left=a+"px",s.style.top=n.getAbsoluteTop()+t.offsetHeight+"px",this.config.interval=window.setInterval(this.fullObjName+".intervalShow("+e+","+o+")",10)},Sparrow.editor.prototype.intervalShow=function(t,e){var i=document.getElementById(this.obj+"_"+this.config.tool.toolBar[t].htmlFrameId),o=i.clientHeight+15;e<=o?(window.clearInterval(this.config.interval),""!=i.innerHTML.trim()&&0!=this.config.tool.toolBar[t].keepStatus||(i.innerHTML=this.getHtml(t)),20==t?$(this.obj+"_txtURL").focus():22==t?$(this.obj+"_txtVideo").focus():23==t&&(this.attach.setParentObject(this),this.attach.loadAttach(this.config.attach.key)),this.config.currentHtmlId=i.id):i.style.height=o+"px"},Sparrow.editor.prototype.getHtml=function(t){var e=[];switch(t){case 0:e.push('<ul style="list-style-type:none;text-align:left;margin:0;padding:0;">');for(var i=0;i<this.config.tool.font_size.length;i++)e.push('<li unselectable="on" onclick="'+this.fullObjName+".callBackRun("+t+',event);" style="border-bottom:#ccc 1px dotted;padding:5px;cursor:pointer;font-size:'+this.config.tool.font_size[i].name.split("|")[1]+';width:auto;" title="'+Math.round(this.config.tool.font_size[i].size)+'">'+this.config.tool.font_size[i].name+"</li>");e.push("</ul>");break;case 1:for(e.push('<ul style="line-height:25px; list-style-type:none;margin:0;padding:0;">'),i=0;i<this.config.tool.font_family.length;i++)e.push('<li unselectable="on" onclick="'+this.fullObjName+".callBackRun("+t+',event);" title="'+this.config.tool.font_family[i]+'" style="border:#ccc 1 dotted;padding:3px;cursor:pointer;font-family:'+this.config.tool.font_family[i]+'">'+this.config.tool.font_family[i]+"</li>");e.push("</ul>");break;case 5:case 6:var o=["00","33","66","99","cc","ff"],n=0;for(i=0;i<6;i+=1)for(var r=0;r<6;r+=1)for(var s=0;s<6;s+=1){var a="#"+o[i]+o[r]+o[s];e.push('<img src="'+this.config.tool.icon.path+'icoBack.gif" onclick="'+this.fullObjName+".callBackRun("+t+',event); " title="'+a+'" style="background:'+a+';width:20px;height:20px;cursor:pointer"/>'),(n+=1)%18==0&&e.push("<br/>")}break;case 20:var l=this.findTagNode("a"),c="",h=!1;null!=l?(c=l.href.substring(7),h=!0):this.createTempNode("a"),e.push('<label>链接地址</label><input class="pure-input-1" onkeyup="if(this.value.substring(0,7)!=\'http://\'){this.value=\'http://\'}" value="http://'+c+'" type="text" id="'+this.obj+'_txtURL" />  <input class="pure-button pure-button-primary" type="button" value="确定" id="ok" onclick="if(document.getElementById(\''+this.obj+"_txtURL').value=='http://'&&"+!h+"){alert('请输入正确的url地址');}else{"+this.fullObjName+'.callBackRun(21,event);}" />');break;case 21:this.createTempNode("span");var d=Math.ceil(this.config.tool.face.length/6);e.push('<table style="width:'+this.config.tool.toolBar[t].htmlwidth+'px; border-collapse:collapse;" id="divFace" cellpadding="1" cellspacing="0">');n=0;for(i=0;i<d;i++){for(e.push("<tr>"),r=0;r<6;r++)n<this.config.tool.face.length?e.push('<td><img style="cursor: pointer;" title="'+this.config.tool.face[n].name+'" src="'+this.config.tool.face[n].url+'" onclick="'+this.fullObjName+'.callBackRun(22,event);" /></td>'):e.push("<td></td>"),n++;e.push("</tr>")}e.push("</table>");break;case 22:this.createTempNode("span"),e.push('<label>FLASH视频URL</label><input class="pure-input-rounded" id="'+this.obj+'_txtVideo" type="text"/><br/><span id="'+this.obj+'_spanVideoErrorMessage"></span><br/>'),e.push('<input value="插入视频" class="pure-button pure-button-primary" type="button" onclick="'+this.fullObjName+'.callBackRun(23,event);"/>');break;case 23:this.createTempNode("span"),e.push('<div  id="tab'+this.obj+'" class="tab">'),e.push('<div class="pure-menu pure-menu-horizontal">'),e.push('<ul class="pure-menu-list" style="width: 100%;">'),e.push('<li class="pure-menu-item pure-menu-selected">'),e.push('<a target="_self" href="javascript:void(0);" class="pure-menu-link">'),e.push("<span>本地图片</span>"),e.push("</a>"),e.push("</li>"),e.push('<li class="pure-menu-item">'),e.push('<a target="_self" href="javascript:void(0);" class="pure-menu-link">'),e.push("<span>网络图片</span>"),e.push("</a>"),e.push("</li>"),e.push("</ul>"),e.push("</div>"),e.push('<div class="tab-content">'),e.push('<div id="'+this.config.attach.key+this.config.attach.localUploadImgTabId+'" class="block">'),e.push('<div style="width:100%;height:auto;overflow:hidden;padding:2px;" id="'+this.config.attach.uploadImgContainerId+'"></div>'),e.push('<iframe name="'+this.config.attach.iframeName+'" id="'+this.config.attach.iframeId.format(this.config.attach.key)+'" class="file-frame" frameborder="0"'),e.push(' src="'+$.editor.uploadUrl+"/file-upload?path-key="+this.config.attach.key+"&editor="+this.fullObjName+'"></iframe><br/>'),e.push("</div>"),e.push('<div class="none">'),e.push('图片URL:<input style="width:300px;" id="'+this.obj+'_txtImage" type="text"/><br/><span id="'+this.obj+'_spanImageErrorMessage"></span><br/>'),e.push('<input value="插入图片" type="button" onclick="'+this.fullObjName+'.insertImage();"/>'),e.push("</div>"),e.push("</div>"),e.push("</div>")}return e.join("")},Sparrow.editor.prototype.adjust=function(e,i){try{if("width"===e){var t=parseInt(i.value);t>this.config.container.maxWidth?(alert("编辑器最大宽度:"+this.config.container.maxWidth+"px"),i.value=this.config.container.maxWidth+"px"):t<this.config.container.minWidth&&(alert("编辑器最小宽度:"+this.config.container.minWidth+"px"),i.value=this.config.container.minWidth+"px"),document.getElementById(this.config.container.id).style.width=i.value;var o=parseInt(i.value)-this.config.tool.convertHTML.ctrlWidth;this.config.tool.adjust.adjustable&&(o-=this.config.tool.adjust.width),document.getElementById(this.config.tool.id).style.width=i.value,document.getElementById(this.config.tool.id).style.width=o}else document.getElementById(this.config.container.id).style.height=i.value}catch(t){i.value="width"===e?document.getElementById(this.config.container.id).style.width:document.getElementById(this.config.container.id).style.height}this.autoAdjust(document.getElementById(this.config.iframeId))},Sparrow.editor.prototype.autoAdjust=function(t){var e=parseInt(document.getElementById(this.config.container.id).style.height),i=document.getElementById(this.config.tool.id).clientHeight+10;t.style.height=e-i},Sparrow.editor.prototype.convertHTML=function(t){this.clear(),"HTML"===t.innerHTML?(t.innerHTML="返回",t.title="返回所见即所得模式",document.getElementById(this.config.tool.icon.containerId).style.display="none",$.browser.ie?this.frame.contentWindow.document.body.innerText=this.frame.contentWindow.document.body.innerHTML:this.frame.contentWindow.document.body.textContent=this.frame.contentWindow.document.body.innerHTML):(t.innerHTML="HTML",document.getElementById(this.config.tool.icon.containerId).style.display="block",$.browser.ie?this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.innerText:this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.textContent)},Sparrow.editor.prototype.insertVideo=function(){var t=!1,e=document.getElementById(this.obj+"_txtVideo").value,i=$(this.obj+"_spanVideoErrorMessage");if(""===e.trim())i.className="error",i.innerHTML="请输入视频地址<br/>例:http://player.youku.com/player.php/sid/sparrow/v.swf";else if(-1===e.search(/^[http:\/\/][^<]*\.swf[^<]*/))i.className="error",i.innerHTML="请输入正确的视频地址。例:http://player.youku.com/player.php/sid/sparrow/v.swf";else{var o,n=this.getTempNode(),r=document.getElementById(this.obj+"_txtVideo").value,s=this;this.config.flash_thumbnail?$.ajax.json($.url.root+"/attach/getFlashThumbnail.json","parameter="+encodeURIComponent(r),function(t){o=t.message,n?(n.innerHTML=o,s.removeElementById()):s.frame.contentWindow.document.body.innerHTML+=o}):(o='<embed src="{0}" quality="high" wmode="opaque" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="500" height="500"/>'.format(r),n?(n.innerHTML=o,this.removeElementById()):this.frame.contentWindow.document.body.innerHTML+=o),t=!0}return t},Sparrow.editor.prototype.insertImage=function(){var e=document.getElementById(this.obj+"_txtImage").value,t=$(this.obj+"_spanImageErrorMessage");if(""===e.trim())t.className="error",t.innerHTML="请输入图片地址<br/>例:"+$.url.resource+"/img.jpg<br/>格式限制:gif|jpg|png";else if(-1==e.search(/^http:\/\/.*?\.(jpg|gif|png)$/))t.className="error",t.innerHTML="请输入图片地址<br/>例:"+$.url.resource+"/img.jpg<br/>格式限制:gif|jpg|png";else{var i=this;$.ajax.json($.url.root+"/attach/downloadInternetPic.json","imageUrl="+e,function(t){$(i.config.attach.uploadImgContainerId).appendChild(getImgContainer(t.message,e,i)),i.attach.insertEditor($.file.getFileName(e),t.message)})}},Sparrow.editor.prototype.insertFace=function(t){var e=this.getTempNode();if(e)return e.innerHTML='<img src="'+t.src+'"/>',$(this.config.titleCtrlId)&&""===$(this.config.titleCtrlId).value&&($(this.config.titleCtrlId).value=t.title),void this.removeElementById();this.frame.contentWindow.document.execCommand("insertImage",!1,t.src)},Sparrow.editor.prototype.insertHyperLink=function(){var t=this.getTempNode("a"),e=document.getElementById(this.obj+"_txtURL").value;t&&("http://"===e?window.confirm("您确认要取消链接吗?")&&this.removeElementById():(""===t.innerHTML&&(t.innerHTML=e),t.removeAttribute("id"),t.setAttribute("target","blank"),t.setAttribute("href",e)))},Sparrow.editor.prototype.initialize=function(t){$.global(this.obj,this),$.editor.editorArray.push(this),this.config.container.id=t;var e="iframe"+$.random();if(this.config.iframeId=e,document.getElementById(t).innerHTML="top"==this.config.tool.position?this.initTool()+this.initEditor(e):this.initEditor(e)+this.initTool(),this.frame=document.getElementById(e),this.frame.contentWindow.document.open(),this.frame.contentWindow.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'),this.frame.contentWindow.document.write('<html><body id="'+this.obj+'" style="width:100%;height:{0}px;" contenteditable="true"></body></html>'.format($(e).offsetHeight)),this.frame.contentWindow.document.close(),$.browser.ie)return this.frame.contentWindow.document.onclick=clearHtmlFrame,void(this.frame.contentWindow.document.onkeyup=this.updateWordCount);try{this.frame.contentWindow.document.addEventListener("click",clearHtmlFrame,!0),this.frame.contentWindow.document.addEventListener("keyup",this.updateWordCount,!0)}catch(t){}},Sparrow.editor.prototype.initTool=function(){var t=0,e=[],i=null;if(e.push('<div class="pure-u-18-24" id="'+this.config.tool.icon.containerId+'" style="text-align:left;">'),null!=this.config.style){"simple"===this.config.style?i=this.config.tool.style.simple:"comment"===this.config.style?i=this.config.tool.style.comment:"thread"===this.config.style&&(i=this.config.tool.style.list);for(var o=0;o<i.length;o++)t=i[o],void 0!==this.config.tool.toolBar[t].split?e.push(this.config.tool.toolBar[t].split.format(this.config.tool.icon.path)):(e.push('<img id="tool_'+t+"_"+this.obj+'" src="'+this.config.tool.icon.path+'icoBack.gif"'),e.push(' title="'+this.config.tool.toolBar[t].title),e.push('" style="background:url(\''+this.config.tool.icon.path+"ico.gif') "),e.push(this.config.tool.toolBar[t].left+"px "+this.config.tool.toolBar[t].top+"px;width:"+this.config.tool.toolBar[t].width+"px;height:"+this.config.tool.toolBar[t].height+'px"'),e.push(' onmouseover="'+this.fullObjName+'.m_over(this);" onmouseout="'+this.fullObjName+'.m_out(this);" onmousedown="'+this.fullObjName+'.m_down(this);" onmouseup="'+this.fullObjName+'.m_up(this);"'),e.push("/>"))}else for(var t in this.config.tool.toolBar)void 0!==this.config.tool.toolBar[t].split?e.push(this.config.tool.toolBar[t].split.format(this.config.tool.icon.path)):(e.push('<img id="tool_'+t+'" src="'+this.config.tool.icon.path+'icoBack.gif"'),e.push(' title="'+this.config.tool.toolBar[t].title),e.push('" style="background:url(\''+this.config.tool.icon.path+"ico.gif') "),e.push(this.config.tool.toolBar[t].left+"px "+this.config.tool.toolBar[t].top+"px;width:"+this.config.tool.toolBar[t].width+"px;height:"+this.config.tool.toolBar[t].height+'px"'),e.push(' onmouseover="'+this.fullObjName+'.m_over(this);" onmouseout="'+this.fullObjName+'.m_out(this);" onmousedown="'+this.fullObjName+'.m_down(this);" onmouseup="'+this.fullObjName+'.m_up(this);"'),e.push("/>"));if(e.push("</div>"),this.config.tool.convertHTML.isConvert&&e.push('<div align="center" id="'+this.config.tool.convertHTML.ctrlId+'" class="pure-u-2-24" " onclick="'+this.fullObjName+'.convertHTML(this);">HTML</div>'),this.config.tool.adjust.adjustable){var n=document.getElementById(this.config.container.id);e.push('<div align="center" title="在此调整编辑器大小。鼠标离开即生效。" class="pure-u-4-24 pure-form pure-form-aligned" '+this.config.tool.adjust.width+'px;"><input onblur="'+this.fullObjName+'.adjust(\'width\',this);" style="height: 30px;" placeholder="width" class="pure-input-rounded pure-input-1" type="text" value="'+n.style.width+'"/><input onblur="'+this.fullObjName+'.adjust(\'height\',this);" style="height: 30px;" placeholder="height" class="pure-input-rounded pure-input-1" type="text" value="'+n.style.height+'"/></div>')}return'<div class="pure-g tool-bar" id="'+this.config.tool.id+'" style="border-bottom:#ccc 1px solid; width:'+document.getElementById(this.config.container.id).style.width+';height:auto;">'+e.join("")+"</div>"},Sparrow.editor.prototype.initEditor=function(t){return document.domain=$.browser.cookie.root_domain,'<iframe onload="'+this.fullObjName+".autoAdjust(this);"+this.fullObjName+'.initContent();" class="'+t+'" id="'+t+'" name="'+t+'" style="background:#ffffff;width: 100%;height:'+(document.getElementById(this.config.container.id).offsetHeight-this.config.tool.height-2)+'px;scrollbar-face-color: #F7F5F4;" frameborder="0" marginheight="0" marginwidth="0" src="about:blank"></iframe>'},Sparrow.editor.prototype.updateWordCount=function(){var t=this.obj||this.body.id,e=$.global(t);$(e.config.wordCount)&&($(e.config.wordCount).innerHTML=e.frame.contentWindow.document.body.innerHTML.length)},$(document).bind("onclick",function(){clearHtmlFrame()}),Sparrow.editor.prototype.initImageUploadEvent=function(o){o||(o=this.config.cover_key),$.file.validateUploadFile=function(t,e,i){$.file.checkFileType($.file.getFileName(t.value),["jpg","jpeg","gif","png","zip"],"error"+o)&&($.file.uploadCallBack=function(t,e){$.file.clearStatus();var i=t.clientFileName;""!==i&&($(e.config.attach.uploadImgContainerId).appendChild(getImgContainer(t.fileUrl,i,e)),e.attach.insertEditor($.file.getFileName(i),t.fileUrl))},$.file.uploadDelegate(e,i))}},Sparrow.treeNode=function(t,e,i,o,n,r,s,a,l,c){this.id=t,this.pid=e,this.name=i,this.url=o,this.title=n,this.target=r,this.showCtrl=a||!0,this.businessEntity=l,this.childCount=s||0,this.icon=c,this.iconOpen=c,this._isOpened=!1,this._isSelected=!1,this._lastOfSameLevel=!1,this._addressIndex=0,this._parentNode,this._hasChild=0<s},Sparrow.tree=function(t,e){this.config={target:"_self",useFolderLinks:!0,useSelection:!0,useCookies:!0,useLines:!0,useIcons:!0,useRootIcon:!0,usePlusMinusIcons:!0,useTreeIdInNodeClass:!1,useLevelInNodeClass:!1,useRadio:!1,useCheckbox:!1,treeNodeClass:null,reBuildTree:null,loadFloatTree:null,floatTreeId:null,descHiddenId:null,descTextBoxId:null,validate:null,validateConfig:null,isdelay:!1,isclientDelay:!1,closeSameLevel:!1,inOrder:!1,showRootIco:!0,showOrder:!1,orderURL:null,treeFrameId:null,loadingString:"londing .....",imageDir:$.url.resource+"/images/treeimg",RESOURCE_TYPE:{1:"[系统菜单]",2:"[系统页面]",3:"[控件事件]"}},this.icon={root:this.config.imageDir+"/base.gif",folder:this.config.imageDir+"/folder.gif",folderOpen:this.config.imageDir+"/folderopen.gif",node:this.config.imageDir+"/page.gif",nolineNode:this.config.imageDir+"/nolinepage.gif",empty:this.config.imageDir+"/empty.gif",line:this.config.imageDir+"/line.gif",join:this.config.imageDir+"/join.gif",joinBottom:this.config.imageDir+"/joinbottom.gif",plus:this.config.imageDir+"/plus.gif",plusBottom:this.config.imageDir+"/plusbottom.gif",minus:this.config.imageDir+"/minus.gif",minusBottom:this.config.imageDir+"/minusbottom.gif",nlPlus:this.config.imageDir+"/nolines_plus.gif",nlMinus:this.config.imageDir+"/nolines_minus.gif"},this.interval=null,this.currentSelectId={},this.floatTreeFrameId=null,this.obj=t,this.parentName=e,this.fullObjName=e?e+"."+t:t,this.aNodes=[],this.aIndent=[],this.root=new Sparrow.treeNode(-1),this.selectedNodeIndex=null,this.selectedFound=!1,this.completed=!1},Sparrow.tree.prototype={resetIcon:function(){this.icon.root=this.config.imageDir+"/base.gif",this.icon.nolineroot=this.config.imageDir+"/nolinebase.gif",this.icon.folder=this.config.imageDir+"/folder.gif",this.icon.folderOpen=this.config.imageDir+"/folderopen.gif",this.icon.node=this.config.imageDir+"/page.gif",this.icon.nolineNode=this.config.imageDir+"/nolinepage.gif",this.icon.empty=this.config.imageDir+"/empty.gif",this.icon.line=this.config.imageDir+"/line.gif",this.icon.join=this.config.imageDir+"/join.gif",this.icon.joinBottom=this.config.imageDir+"/joinbottom.gif",this.icon.plus=this.config.imageDir+"/plus.gif",this.icon.plusBottom=this.config.imageDir+"/plusbottom.gif",this.icon.minus=this.config.imageDir+"/minus.gif",this.icon.minusBottom=this.config.imageDir+"/minusbottom.gif",this.icon.nlPlus=this.config.imageDir+"/nolines_plus.gif",this.icon.nlMinus=this.config.imageDir+"/nolines_minus.gif"},addBusinessEntity:function(t,e,i,o,n,r){this.aNodes[this.aNodes.length]=new Sparrow.treeNode(t,e,i,o,n,"_self",void 0,!0,r)},add:function(t,e,i,o,n,r,s,a,l,c){this.aNodes[this.aNodes.length]=new Sparrow.treeNode(t,e,i,o,n,r,s,a,l,c)},openAll:function(){this.oAll(!0)},closeAll:function(){this.oAll(!1)},toString:function(){var t='<div class="sparrow-tree">';return document.getElementById?(this.config.useCookies&&(this.selectedNodeIndex=this.getSelectedAi()),t+=this.addNode(this.root)):t+="Browser not supported.</div>",this.selectedFound||(this.selectedNodeIndex=null),this.completed=!0,t},deleteClick:function(){alert("deleteClick not defined!")},removeNode:function(t){t||(t=this.aNodes[this.getSelectedAi()]),this.aNodes.splice(t._addressIndex,1),this.clearSelectedNode(),$(this.config.treeFrameId).innerHTML=this.toString(),this.clearFloatFrame()},appendNode:function(t){this.aNodes.push(t),$(this.config.treeFrameId).innerHTML=this.toString()},updateNode:function(t,e){e||(e=this.aNodes[this.getSelectedAi()]),e.pid!==t.pid?(this.removeNode(e),this.appendNode(t)):this.aNodes[this.getSelectedAi()]=t,$(this.config.treeFrameId).innerHTML=this.toString()},showOrder:function(t){if(this.config.showOrder){var e=$("orderDiv");e&&document.body.removeChild(e);var i=$.event(t).srcElement,o=$(i,!1),n=i.id.substring(this.obj.length+1),r=this.aNodes[n];if(-1!==r.pid){e=$("+div.orderDiv"),document.body.appendChild(e.s),e.class("pure-menu pure-order-menu"),e.css("position","absolute"),e.html('<span class="pure-menu-heading pure-menu-link pure-order-menu-heading" onclick="{0}.delete_click({1});{0}.clearFloatFrame();" >删除</span><ul class="pure-menu-list"><li class="pure-menu-item"><a href="#" class="pure-menu-link">当前第<span id="currentOrderNo"></span>位</a></li><li class="pure-menu-item pure-menu-has-children"><a  id="hyperJump" class="pure-menu-link">你可以跳转至</a> <ul id="ulChildrenList" class="pure-menu-children"></ul></li></ul>'.format(this.fullObjName,n)),e.bind("onclick",function(t){$.event(t).cancelBubble()}),$("#hyperJump",!1).bind("onmouseover",function(){$("#ulChildrenList",!1).css("display","block")}),e.css("left",o.getAbsoluteLeft()+i.offsetWidth+"px"),e.css("top",o.getAbsoluteTop()+i.offsetHeight+"px");for(var s=r._parentNode,a=0,l=0,c="",h=0;h<this.aNodes.length;h++)if(this.aNodes[h].pid===s.id)if(this.aNodes[h].id!==r.id){if(a++,c+='<li class="pure-menu-item" onclick="{0}.order({1},{2})"><a href="#" class="pure-menu-link">第<span>{2}</span>位</a></li>'.format(this.fullObjName,n,a),this.aNodes[h]._lastOfSameLevel)break}else l=++a;$("#ulChildrenList",!1).html(c),$("#currentOrderNo",!1).html(l)}else this.clearFloatFrame()}},order:function(r,s){var a=this.aNodes[r],t="id="+a.id+"&target="+s,l=this,c=this.aNodes;$.ajax.json(this.config.orderURL,t,function(t){for(var e=(a=c[r])._parentNode,i=0,o=0,n=0;n<c.length;n++)if(c[n].pid===e.id&&++i===s){c[o=n];break}c.splice(r,1),c.splice(o,0,a),$("#"+l.config.treeFrameId).html(l),l.clearFloatFrame()})},addNode:function(t){var e="",i=0;for(this.config.inOrder&&(i=t._addressIndex);i<this.aNodes.length;i++){var o=this.aNodes[i];if(o&&o.pid===t.id&&((o._parentNode=t).childCount++,o._addressIndex=i,this.setCS(o),!o.target&&this.config.target&&(o.target=this.config.target),o._hasChild&&!o._io&&this.config.useCookies&&(o._isOpened=this.isOpen(o.id)),!this.config.useFolderLinks&&o._hasChild&&(o.url=null),this.config.useSelection&&o.id===this.getSelectedId()&&(o._isSelected=!0,this.selectedNodeIndex=i,this.selectedFound=!0),this.config.showRootIco?e+=this.node(o,i):this.node(o,i),o._lastOfSameLevel))break}return e},select:function(t,e){null!=this.current&&(this.current.className=$(this.current).attr("old")),$(t).attr("old",t.className),t.className="iTreeNodeSelect"+e,this.current=t},node:function(t,e){var i="";this.config.treeNodeClass?i+=this.config.treeNodeClass:this.config.useTreeIdInNodeClass&&(i+=this.obj.substring(0,1).toUpperCase()+this.obj.substring(1)),this.config.useLevelInNodeClass&&(i+=1<this.aIndent.length?3:this.aIndent.length+1);var o='<div onclick="'+this.fullObjName+".select(this,'"+i+"');\"";return(this.config.useRootIcon||t.pid!==this.root.id)&&(o+=' class="iTreeNode'+i+'"'),o+='id="node'+this.obj+e+'"  >'+this.indent(t,e),this.config.useIcons&&(this.config.useLines?(t.icon=this.root.id===t.pid?this.icon.root:t._hasChild?this.icon.folder:this.icon.node,t.iconOpen=this.root.id===t.pid?this.icon.root:t._hasChild?this.icon.folderOpen:this.icon.node):t.icon||(t.iconOpen=t.icon=t._hasChild?this.icon.nolinefolder:this.icon.nolinenode),(this.config.useRootIcon||t.pid!==this.root.id)&&(o+="<img "+(this.config.showOrder?' onmouseover="'+this.fullObjName+'.showOrder(event)"':"")+' id="i'+this.obj+e+'" src="'+(t._isOpened?t.iconOpen:t.icon)+'" alt="" align="absMiddle"/>'),(t.showCtrl&&-1!==t.pid||-1===t.pid&&!0===this.userRootIcon)&&(this.config.useRadio&&(o+='<input style="line-height:15px;height:15px;border:0;" type="radio" name="iTreerdb" id="r{1}{0}" onclick="{1}.getRadioSelected({0});{1}.s({0});" value="{2}"/>'.format(e,this.fullObjName,t.id)),!0===this.config.useCheckbox&&(o+='<input style="line-height:15px;height:15px;border:0;" type="checkbox" name="iTreecbx" id="c{1}{0}" onclick="{1}.selectCheckbox({0});" value="{2}"/>'.format(e,this.fullObjName,t.id)))),t.url?(o+='<a ondblclick="javascript:'+this.fullObjName+".dbs("+e+');" id="s'+this.obj+e+'" class="'+(this.config.useSelection&&t._isSelected?"nodeSel":"node")+'" href="'+t.url+'"',t.title&&(o+=' title="'+t.title+'"'),t.target&&(o+=' target="'+t.target+'"'),this.config.useSelection&&(t._hasChild&&this.config.useFolderLinks||!t._hasChild)&&(o+=' onclick="javascript: '+this.fullObjName+".s("+e+");"),o+=(this.config.usePlusMinusIcons?"":t._hasChild&&-1!==t._parentNode.id?this.fullObjName+".o("+e+")":"")+'">'):this.config.useFolderLinks&&t.url||!t._hasChild||t.pid===this.root.id||(o+='<a href="javascript: '+this.fullObjName+".o("+e+');" class="node">'),o+='<span id="ntext'+this.obj+e+'">'+t.name+"</span>",!t.url&&(this.config.useFolderLinks&&t.url||!t._hasChild)||(o+="</a>"),o+="</div>",t._hasChild&&(o+='<div id="d'+this.obj+e+'" class="clip" style="display:'+(this.root.id===t.pid||t._isOpened?"block":"none")+';">',this.config.isdelay||this.config.isclientDelay?(t._isOpened&&-1!=t.pid||-1==t.pid)&&(o+=this.addNode(t)):o+=this.addNode(t),o+="</div>"),this.aIndent.pop(),o},indent:function(t,e){var i="";if(this.root.id===t.pid)return i;for(var o=0;o<this.aIndent.length;o++)i+='<img src="'+(1===this.aIndent[o]&&this.config.useLines?this.icon.line:this.icon.empty)+'" alt="" />';return t._lastOfSameLevel?this.aIndent.push(0):this.aIndent.push(1),this.config.usePlusMinusIcons?t._hasChild?(i+='<a href="javascript: '+this.fullObjName+".o("+e+');"><img id="j'+this.obj+e+'" src="',this.config.useLines?i+=t._isOpened?t._lastOfSameLevel&&this.config.useLines?this.icon.minusBottom:this.icon.minus:t._lastOfSameLevel&&this.config.useLines?this.icon.plusBottom:this.icon.plus:i+=t._isOpened?this.icon.nlMinus:this.icon.nlPlus,i+='"/></a>'):i+='<img id="j'+this.obj+e+'" src="'+(this.config.useLines?t._lastOfSameLevel?this.icon.joinBottom:this.icon.join:this.icon.empty)+'" alt="" />':i+='<img style="width:0;height:0;" id="j'+this.obj+e+'"/>'},setCS:function(t){var e=null;t._hasChild=!1,t._lastOfSameLevel=!1;for(var i=0;i<this.aNodes.length;i++)!1===this.config.isdelay&&null!=this.aNodes[i]&&this.aNodes[i].pid==t.id&&(t._hasChild=!0),null!=this.aNodes[i]&&this.aNodes[i].pid==t.pid&&(e=this.aNodes[i].id);e===t.id&&(t._lastOfSameLevel=!0)},getAllNameOfNode:function(t,e){t||(t=this.aNodes[this.getSelectedAi()]);for(var i=[];-1!==t.id&&!$.isNullOrEmpty(t.name);)-1!==t.name.indexOf(":")?i.push(t.name.split(":")[1]):i.push(t.name),t=t._parentNode?t._parentNode:this.aNodes[this.getAiById(t.pid)];return e=e||"  ",i.reverse(),i.join(e)},getSelectedAi:function(){return this.getAiById(this.getSelectedId())},getSelectedId:function(){return(!0===this.config.useCookies?this.getCookie("currentSelect"+this.obj):this.currentSelectId["currentSelect"+this.obj])||null},clearSelectedNode:function(){var t=new Date,e=new Date(t.getTime()-864e5);this.setCookie("cs"+this.obj,"cookieValue",e),this.currentSelectId["currentSelect"+this.obj]=null},setCurrentSelectNode:function(t){this.config.useCookies?this.setCookie("currentSelect"+this.obj,t.id):this.currentSelectId["currentSelect"+this.obj]=t.id},s:function(t){if(this.config.useSelection){var e=this.aNodes[t];if(!e._hasChild||this.config.useFolderLinks){if(this.selectedNodeIndex!==t&&((this.selectedNodeIndex||0===this.selectedNodeIndex)&&(eOld=document.getElementById("s"+this.obj+this.selectedNodeIndex),this.aNodes[this.selectedNodeIndex]._isSelected=!1,eOld&&(eOld.className="node")),eNew=document.getElementById("s"+this.obj+t),eNew.className="nodeSel",this.selectedNodeIndex=t,e._isSelected=!0,this.setCurrentSelectNode(e)),document.getElementById("r"+this.obj+t)&&(document.getElementById("r"+this.obj+t).checked=!0,this.getRadioSelected(t)),document.getElementById("c"+this.obj+t)){var i=document.getElementById("c"+this.obj+t);i.checked=!i.checked,this.selectCheckbox(t)}this.config.closeSameLevel&&this.closeLevel(e)}}},delayOpen:function(t){var r=this,s=t,e=t._addressIndex;if(s._isOpened)return!0;var a=document.getElementById("d"+this.obj+e);if(null!=a&&""==a.innerHTML){var i="ay=true&nodeId="+s.id;$("exceptid").value&&(i+="&exceptid="+$("exceptid").value),$.ajax.json(this.config.ajaxURL,i,function(t){alert(t);var e=xmlHttpRequest.responseText.json();openNodeCallBack(e);for(var i=s,o=[];-1!=i.pid;)o[o.length]=i._lastOfSameLevel?0:1,i=i._parentNode;for(var n=o.length-1;0<=n;n--)r.aIndent.push(o[n]);a.innerHTML=r.addNode(s);for(n=0;n<o.length;n++)r.aIndent.pop()})}},clientDelayOpen:function(t,e){var i=t,o=t._addressIndex;if(0==i._isOpened||e){var n=document.getElementById("d"+this.obj+o);if(null!=n&&""==n.innerHTML||e){for(var r=i,s=[];r._parentNode.id!=this.root.id;)s[s.length]=r._lastOfSameLevel?0:1,r=r._parentNode;for(var a=s.length-1;0<=a;a--)this.aIndent.push(s[a]);n.innerHTML=this.addNode(i);for(a=0;a<s.length;a++)this.aIndent.pop()}}},o:function(t){var e=this.aNodes[t];this.config.isdelay&&this.delayOpen(e),this.config.isclientDelay&&this.clientDelayOpen(e),this.nodeStatus(!e._isOpened,t,e._lastOfSameLevel),e._isOpened=!e._isOpened,this.config.closeSameLevel&&this.closeLevel(e),this.config.useCookies&&this.updateCookie()},oAll:function(t){for(var e=0;e<this.aNodes.length;e++)null!=this.aNodes[e]&&this.aNodes[e]._hasChild&&this.aNodes[e].pid!=this.root.id&&(this.nodeStatus(t,e,this.aNodes[e]._lastOfSameLevel),this.aNodes[e]._isOpened=t);this.config.useCookies&&this.updateCookie()},getAiById:function(t){for(var e=0;e<this.aNodes.length;e++)if(null!=this.aNodes[e]&&this.aNodes[e].id==t)return e;return null},openTo:function(t,e){if(e||(t=this.getAiById(t)),null!==t){var i=this.aNodes[t];if(this.config.delay)for(var o=[];-1!=i._parentNode.pid;)o.push(i),i=i._parentNode;else i.pid!=this.root.id&&i._parentNode&&(i._isOpened=!0,this.completed&&i._hasChild&&this.nodeStatus(!0,i._addressIndex,i._lastOfSameLevel),this.openTo(i._parentNode._addressIndex,!0))}},closeLevel:function(t){for(var e=0;e<this.aNodes.length;e++)null!=this.aNodes[e]&&this.aNodes[e].pid==t.pid&&this.aNodes[e].id!=t.id&&this.aNodes[e]._hasChild&&(this.nodeStatus(!1,e,this.aNodes[e]._lastOfSameLevel),this.aNodes[e]._isOpened=!1,this.closeAllChildren(this.aNodes[e]))},closeAllChildren:function(t){for(var e=0;e<this.aNodes.length;e++)null!=this.aNodes[e]&&this.aNodes[e].pid==t.id&&this.aNodes[e]._hasChild&&(this.aNodes[e]._isOpened&&this.nodeStatus(!1,e,this.aNodes[e]._lastOfSameLevel),this.aNodes[e]._isOpened=!1,this.closeAllChildren(this.aNodes[e]))},nodeStatus:function(t,e,i){eDiv=document.getElementById("d"+this.obj+e),eJoin=document.getElementById("j"+this.obj+e),this.config.usePlusMinusIcons?(eIcon=document.getElementById("i"+this.obj+e),this.config.useIcons&&(eIcon.src=t?this.aNodes[e].iconOpen:this.aNodes[e].icon),eJoin.src=this.config.useLines?t?i?this.icon.minusBottom:this.icon.minus:i?this.icon.plusBottom:this.icon.plus:t?this.icon.nlMinus:this.icon.nlPlus):eJoin.src=this.icon.empty,eDiv.style.display=t?"block":"none"},clearCookie:function(){var t=new Date,e=new Date(t.getTime()-864e5);this.setCookie("co"+this.obj,"cookieValue",e),this.setCookie("cs"+this.obj,"cookieValue",e)},setCookie:function(t,e,i,o,n,r){document.cookie=escape(t)+"="+escape(e)+(i?"; expires="+i.toGMTString():"")+(o?"; path="+o:"")+(n?"; domain="+n:"")+(r?"; secure":"")},getCookie:function(t){var e="",i=document.cookie.indexOf(escape(t)+"=");if(-1!=i){var o=i+(escape(t)+"=").length,n=document.cookie.indexOf(";",o);e=-1!=n?unescape(document.cookie.substring(o,n)):unescape(document.cookie.substring(o))}return e},updateCookie:function(){for(var t="",e=0;e<this.aNodes.length;e++)null!=this.aNodes[e]&&this.aNodes[e]._isOpened&&this.aNodes[e].pid!=this.root.id&&(t&&(t+="."),t+=this.aNodes[e].id);this.setCookie("currentOpen"+this.obj,t)},isOpen:function(t){for(var e=this.getCookie("currentOpen"+this.obj).split("."),i=0;i<e.length;i++)if(e[i]==t)return!0;return!1},getAllId:function(){for(var t=[],e=0;e<this.aNodes.length;e++)t.push(this.aNodes[e].id);return t},getAllParentNode:function(){var t=this.aNodes[this.getSelectedAi()],e=[];if(t)for(;-1!=t.id;)e.push(t.id),t=t._parentNode;else e.push(0);return e},selectChilds:function(t,e,i){pids=[];for(var o=0;o<i;o++)-1!=t.indexOf(this.aNodes[o].pid)&&0!=this.aNodes[o].showCtrl&&(document.getElementById("c"+this.obj+o).checked=e,pids.push(this.aNodes[o].id));0!=pids.length&&this.selectChilds(pids,e,i)},getRadioSelected:function(){return null},selectCheckbox:function(t){var e=this.aNodes[t],i=null;if(null==e.selectChild||1==e.selectChild){if(i=document.getElementById("c"+this.obj+t).checked)for(var o,n=e;-1!=n.id;)(o=document.getElementById("c"+this.obj+n._addressIndex))&&(o.checked=!0),n=n._parentNode;for(var r=this.aNodes.length,s=[],a=0;a<r;a++)a!=t&&null!=this.aNodes[a]&&this.aNodes[a].pid==e.id&&0!=this.aNodes[a].showCtrl&&(document.getElementById("c"+this.obj+a).checked=i,s.push(this.aNodes[a].id));0!=s.length&&this.selectChilds(s,i,r)}this.checkBoxClick&&this.checkBoxClick(e.id,i)},setChecked:function(t){"string"==typeof t&&(t=t.split(","));for(var e=document.getElementsByName("iTreecbx"),i=0;i<e.length;i++){var o=parseInt(e[i].value,10);-1!==t.indexOf(o)&&(e[i].checked=!0)}},getAllCheckedTitle:function(){for(var t=[],e=document.getElementsByName("iTreecbx"),i=0;i<e.length;i++)!0===e[i].checked&&(arrayIndex=e[i].id.replace("c"+this.obj,""),t.push(this.aNodes[arrayIndex].title));return t},getAllChecked:function(){for(var t=[],e=document.getElementsByName("iTreecbx"),i=0;i<e.length;i++)!0===e[i].checked&&(arrayIndex=e[i].id.replace("c"+this.obj,""),t.push(this.aNodes[arrayIndex]));return t},getAllCheckedId:function(){for(var t=[],e=document.getElementsByName("iTreecbx"),i=0;i<e.length;i++)!0===e[i].checked&&t.push(e[i].value);return t.join()},show:function(t,e,i){if(!this.floatTreeFrameId){this.config.reBuildTree&&this.config.reBuildTree(),""==$(this.config.floatTreeId).innerHTML.trim()&&void 0!==this.config.loadFloatTree&&this.config.loadFloatTree();var o=$.event(t).srcElement,n=$(o),r=document.createElement("DIV");r.id=this.config.floatTreeId+"Frame",r.style.cssText="position:absolute;width:"+e+"px;height:0px;border:#ccc 1px solid;background:#ffffff; padding:1px;text-align:left;overflow:auto;",r.innerHTML=this.config.loadingString,document.body.appendChild(r),r.onclick=function(t){$.event(t).cancelBubble()},r.style.left=n.getAbsoluteLeft()+1+"px",r.style.top=n.getAbsoluteTop()+o.offsetHeight+"px",this.interval=window.setInterval(this.fullObjName+".intervalShow("+i+")",10)}},intervalShow:function(t){var e=this.config.floatTreeId+"Frame",i=$(e).clientHeight+15;if(t<=i){if(this.floatTreeFrameId=e,$(this.config.floatTreeId)&&""!=$(this.config.floatTreeId).innerHTML){var o=$(this.config.floatTreeId);$(e).innerHTML="",o.style.display="block",$(e).appendChild(o),window.clearInterval(this.interval)}}else $(e).style.height=i+"px"},clearFloatFrame:function(){if(this.floatTreeFrameId){var t=$(this.floatTreeFrameId);if(!this.config.reBuildTree){var e=$(this.config.floatTreeId);e.style.display="none",document.body.appendChild(e)}document.body.removeChild(t),this.floatTreeFrameId=null,window.clearInterval(this.interval)}$("orderDiv")&&document.body.removeChild($("orderDiv"))},initResourceTree:function(t,e){e||(e=$.url.root+"/resource/load-all");var o=this;this.config.loadFloatTree=function(){$.ajax.json(e,t,function(t){var e=t.data||t.message;o.aNodes=[],o.resetIcon(),o.config.usePlusMinusIcons=!1,o.config.useRootIcon=!1,o.add(e[0].parentId,-1,""),o.resetIcon();for(var i=0;i<e.length;i++)$.isNullOrEmpty(e[i].icoUrl)&&(e[i].icoUrl=$.DEFAULT_RESOURCE_ICO_URL),o.add(e[i].id,e[i].parentId,e[i].name,"javascript:"+o.fullObjName+".codeNodeClick("+(i+1)+");",e[i].name,void 0,void 0,void 0,e[i],e[i].icoUrl);$(o.config.floatTreeId).innerHTML=o})}},initCodeTooltip:function initCodeTooltip(codePrefix,ajaxUrl){var htmlEvents="$('#'+{0}.config.descTextBoxId).bind('onchange',function(){if($({0}.config.descTextBoxId).value==''){$({0}.config.descHiddenId).value='';if(typeof({0}.config.valueTextBoxId)!='undefined'){$({0}.config.valueTextBoxId).value='';$({0}.config.valueTextBoxId).readOnly='readonly';}}});".format(this.fullObjName);eval(htmlEvents);var treeObject=this;if(null==$(treeObject.config.floatTreeId)){var floatTree=$("+div").s;floatTree.id=treeObject.config.floatTreeId,floatTree.className="floatTree",document.body.appendChild(floatTree)}ajaxUrl||(ajaxUrl=$.url.root+"/code/load"),this.dbs=function(t){var e=this.aNodes[t].businessEntity;if(null!=this.config.descHiddenId&&($(this.config.descHiddenId).value=e.id),null!=this.config.descTextBoxId){var i=$(this.config.descTextBoxId);"text"===i.type?i.value=this.getAllNameOfNode(this.aNodes[t],"/"):i.innerHTML=this.getAllNameOfNode(this.aNodes[t],"/")}null!=this.config.valueTextBoxId&&($(this.config.valueTextBoxId).value=e.value),this.codeNodeCallBack&&this.codeNodeCallBack(this.aNodes[t]),this.clearFloatFrame(),this.config.validate?this.config.validate():this.config.validateConfig&&$.v.isNull(this.config.validateConfig,i)},treeObject.config.loadFloatTree=function(){$.ajax.json(ajaxUrl,"prefix="+codePrefix,function(t){var e=t.data||t.message;treeObject.aNodes=[],treeObject.resetIcon(),treeObject.config.usePlusMinusIcons=!1,treeObject.config.useRootIcon=!1,treeObject.add(e[0].parentId,-1,"");for(var i=0;i<e.length;i++)treeObject.add(e[i].id,e[i].parentId,e[i].name,"javascript:"+treeObject.fullObjName+".codeNodeClick("+(i+1)+");",e[i].code+"|"+e[i].name,void 0,void 0,void 0,e[i]);$(treeObject.config.floatTreeId).innerHTML=treeObject})}},codeNodeClick:function(t){0===this.aNodes[t].childCount&&this.dbs(t)}},Sparrow.dispatcher={builder:{id:"id",delegate:"delegate",api:"api",strategy:"strategy",eventName:"eventName"},commandAdapter:{},ctrlIdEventMap:{},eventRegistry:[],register:function(t){this.eventRegistry.push(t)},dispatcher:function(t,e){var i=e.id+"_"+e.value,o=this.commandAdapter[i],n=null;null!=o&&(n=o.delegate),null==n&&null!=(o=this.commandAdapter[e.id])&&(n=o.delegate),null!=o&&null!=n&&(o.api?$.ajax.json(o.api,o.parameter,n,e):n(t,e))},bind:function(){for(var t=0;t<this.eventRegistry.length;t++){var e=this.eventRegistry[t],i=e.strategy,o=e.eventName,n=e.id+(i?"_"+i:"");this.commandAdapter[n]=e,this.ctrlIdEventMap[e.id]=o||"onclick"}for(ctrlId in this.ctrlIdEventMap)$("#"+ctrlId).bind(this.ctrlIdEventMap[ctrlId],function(t){Sparrow.dispatcher.dispatcher(t,$.event(t).srcElement)})}},Sparrow.metricChart=function(t,e,i){this.container=t,this.chartId=e,this.config=i},Sparrow.metricChart.prototype.init=function(t){var e=document.getElementById(this.chartId);null==e&&((e=document.createElement("div")).id=this.chartId,e.style.height=this.config.height,this.container.appendChild(e));var i=t.init(e),o={title:{text:""},tooltip:{trigger:"axis"},legend:{data:[]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value"},series:[]};o.title.text=this.config.title,o.legend.data=this.config.legend,o.series=this.config.data,o.xAxis.data=this.config.x,i.setOption(o,!0),Sparrow.metricChart.containers,Sparrow.metricChart.charts[this.chartId]=i,Sparrow.metricChart.options[this.chartId]=o},Sparrow.metricChart.charts={},Sparrow.metricChart.options={},Sparrow.metricChart.changeType=function(t,e){for(var i=Sparrow.metricChart.charts[t],o=Sparrow.metricChart.options[t],n=0;n<o.series.length;n++)o.series[n].type=e;i.setOption(o,!0)},Sparrow.user={authorMap:null,author:null,login:{dialog:function(t,e){var i=$.url.passport+"/login-dialog?register=false&callback-ns="+t;$.isNullOrEmpty(e)||(i+="&parameter="+e),document.domain=$.browser.cookie.root_domain,$.window({url:i,showHead:!1})},ns_callback:{publish:"thread.publish",attention:"user.attention",cancel_attention:"user.attention.cancel",comment:"thread.comment",upload:"upload",like_thread:"thread.like"}},getZone:function(t){return $.url.root+"/zone-"+t},getAvatar:function(t){return t||$.DEFAULT_AVATOR_URL},editable:function(t){var e=$.browser.getUserId();return!(e<=0)&&t===e},initLoginBar:function(){if($("divAccount")){if($.browser.isLogin()){$("divAccount").style.display="block",$("divLogin").style.display="none";var t=$("hyperUser");return $(t).html($.browser.getUserName()),t.title=$.browser.getUserName(),void(t.href=$.user.getZone($.browser.getUserId()))}$("divAccount").style.display="none",$("divLogin").style.display="block"}},popup:function(t,e){var i=null==this.authorMap?this.author:this.authorMap[e],o=$("divUserInfo");null==o&&((o=$("+div.divUserInfo")).s.style.cssText="border: #ccc 1px solid; position: absolute; width:300px; height:120px; background: #ffffff;overflow: hidden;",o.s.onmouseover=function(t){console.log("user info  mouse over ..."),$.event(t).cancelBubble()},document.body.appendChild(o.s)),$("divUserInfo").style.top=$(t).getAbsoluteTop()-2+"px",$("divUserInfo").style.left=$(t).getAbsoluteLeft()-2+"px";var n=[];n.push('<table style="border: 0;background:#fff;" cellpadding="0" cellspacing="0">'),n.push("<tr>"),n.push('<td style="border: 0; width:60px;" valign="top">'),n.push('<a href="{0}" target="_blank"><img style="width:50px; height: 50px; border: 2px #EDEDED solid;" src="{1}" /></a>'.format(this.getZone(i.id),this.getAvatar(i.avatar))),n.push("</td>"),n.push('<td style="border: 0; width: 240px; line-height: 25px;text-align:left;">'),n.push('昵称:<a href="{2}" target="_blank"><span>{0}</span></a>{1}<br />'.format(i.name,"attention",this.getZone(i.id))),n.push("性别:<span>{0}</span><br />".format(i.gender)),i.createTime&&n.push("注册日期:<span>{0}</span><br />".format(i.createTime)),i.lastLoginTime&&n.push("最后登陆:<span>{0}</span><br />".format(i.lastLoginTime)),$.isNullOrEmpty(i.status)||n.push("状态：<span>{0}</span><br />".format(i.status)),$("divUserInfo").innerHTML=n.join(""),$("#divUserInfo").show(),document.onmouseover=function(t){$("#divUserInfo").hidden()}},json:function(t){var e=$(t);return null!=e&&(t=e.value.json()),t},initAuthor:function(t){this.author=this.json(t)},initAuthorMap:function(t){this.authorMap=this.json(t)},attention:function(){return!1},getToken:function(){var t=Sparrow.request("token");return Sparrow.isNullOrEmpty(t)?(t=localStorage.getItem("token"),Sparrow.isNullOrEmpty(t)?null!=(t=Sparrow.browser.getCookie(Sparrow.browser.cookie.permission))?t:void 0:t):t}},Sparrow.share={config:{icon:$.url.resource+"/images/share.png",share:[{url:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?style=202&width=80&height=31&showcount=1&url={0}&title={1}&pics={2}&desc={3}&summary={4}&site="+encodeURIComponent($.browser.getCookie($.browser.cookie.website_name))+"&otype=share",position:{left:160,top:0},title:"分享到QQ空间"},{url:"http://service.weibo.com/share/share.php?appkey=318168823&url={0}&title={1}&pic={2}&ralateUid=3199233727",position:{left:0,top:0},title:"分享到新浪微博"}]},init:function(){for(var t=document.getElementsByName("share"),e=[],i=0;i<this.config.share.length;i++)e.push('<a target="_blank" style="height:32px;width:32px;display:inline-block;background:url({0}) {1}px {2}px;" title="{3}" href="{4}"></a>'.format(this.config.icon,this.config.share[i].position.left,this.config.share[i].position.top,this.config.share[i].title,this.config.share[i].url));shareTemplate=e.join("");for(var o=t.length-1;0<=o;o--){var n=t[o].value.json();t[o].parentNode.innerHTML=shareTemplate.format(encodeURIComponent(n.url),encodeURIComponent(n.title),encodeURIComponent(n.pic),encodeURIComponent(n.comment),encodeURIComponent(n.summary))}}},Sparrow.webSocket=function(t,e){this.url=t,this.token=e,this.onMsgCallback=null,this.heartTime=2e3,this.heartTimeout=5e3,this.reconnectTime=500,this.timeoutTimer=null,this.serverTimeoutTimer=null,this.ws=null,this.lastHeartTime=0,this.reconnectionAlarmTimer=null,this.reconnectionAlarmCallback=null,this.userId=null,this.statusBarId},Sparrow.webSocket.prototype.connect=function(t,e){try{"WebSocket"in window&&(this.ws=new WebSocket(this.url,[this.token]),this._onOpen(),this._onMsg(t,e),this._onClose(e),this._onError(e))}catch(t){console.log(t),this.reconnectWebSocket()}},Sparrow.webSocket.prototype.close=function(){this.ws.close()},Sparrow.webSocket.prototype.showPingStatus=function(t){null!=$("#"+this.statusBarId).s&&$("#"+this.statusBarId).html(t)},Sparrow.webSocket.prototype.reconnectWebSocket=function(){var t=this;new Date-this.lastHeartTime>2*this.heartTimeout?(console.log("发起重连"),this.reconnectionAlarmTimer=setInterval(function(){t.reconnectionAlarmCallback&&t.reconnectionAlarmCallback(),t.showPingStatus("服务器断了，如果您想继续聊，刷一下呗~~~")},1e3),this.closeHeartBeat()):console.log("服务器顶替逻辑，不重连!")},Sparrow.webSocket.prototype._onOpen=function(){var e=this;this.ws.onopen=function(t){console.log(t.currentTarget.protocol),console.log("连接成功"+t),e.showPingStatus("连接成功..."),e.closeHeartBeat(),e.startHeartBeat()}},Sparrow.webSocket.prototype._onMsg=function(e){var i=this;this.ws.onmessage=function(t){if("string"==typeof t.data){if("PONG"===t.data)return i.lastHeartTime=(new Date).getTime(),void i.showPingStatus("服务器健康 最后心跳时间:<span style='color:red'>"+(new Date).format("mm:ss")+"</span>");if("offline"===t.data)return i.lastHeartTime=(new Date).getTime(),void(i.onMsgCallback&&i.onMsgCallback({offline:!0}));if(-1<t.data.indexOf("USER."))return i.userInfo=t.data.substring(5),void e(i.userInfo)}i.onMsgCallback(t.data)}},Sparrow.webSocket.prototype._onClose=function(e){var i=this;this.ws.onclose=function(t){console.log("close 事件"),t.wasClean?(i.showPingStatus("服务器休息了，稍侯再试哈...."),console.log("不重连")):i.reconnectWebSocket(),e(t)}},Sparrow.webSocket.prototype._onError=function(e){var i=this;this.onerror=function(t){console.log("连接出错"+t),i.showPingStatus("连接出错啦~~~"),i.reconnectWebSocket(),e(t)}},Sparrow.webSocket.prototype.startHeartBeat=function(){var t=this;this.timeoutTimer=setInterval(function(){try{t.ws.send("PING")}catch(t){console.log("heart beat error:"+t)}console.log("heart beat: "+(new Date).getSeconds()+" timer id:"+t.timeoutTimer)},this.heartTime),this.serverTimeoutTimer=setInterval(function(){(new Date).getTime()-t.lastHeartTime>2*t.heartTime&&t.reconnectWebSocket()},this.heartTimeout)},Sparrow.webSocket.prototype.closeHeartBeat=function(){clearTimeout(this.timeoutTimer),clearTimeout(this.serverTimeoutTimer)},Sparrow.webSocket.prototype.sendMessage=function(t){this.ws.send(t.toBytes())},"function"==typeof define&&define.amd&&define("Sparrow",[],function(){return Sparrow}),noGlobal||(window.Sparrow=window.$=Sparrow),Sparrow});
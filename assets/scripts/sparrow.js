!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("Sparrow requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(window,noGlobal){String.prototype.trim=function(){return this.replace(/(^\s*)|(\s*$)/g,"")},String.prototype.ltrim=function(){return this.replace(/(^\s*)/g,"")},String.prototype.rtrim=function(){return this.replace(/(\s*$)/g,"")},String.prototype.json=function(){if(""===this||"''"===this||0===this.length)return null;-1!==this.indexOf("error|")&&console.log(this);try{var json=this;return json=json.decodeSplitKey(),eval("("+json.replace(/\r\n/g,"<br/>").replace(/\n/g,"<br/>")+")")}catch(e){return console.log(e)}},String.prototype.firstCharToAscii=function(){return this.charCodeAt(0)},String.prototype.leftAlignWithChar=function(e,t){if(t=t||3,e=e||"0",!(this.length>=t)){for(var i=[],o=t-this.length,n=0;n<o;n++)i.push(e);return i.join("")+this}},String.prototype.getCountByChar=function(e){return this.split(e).length-1},String.prototype.getByteLength=function(){return this.replace(/[^\x00-\xff]/g,"**").length},String.prototype.subString=function(e,t){var i,o=0,n="",r=/[^\x00-\xff]/g,s="",a=this.replace(r,"**").length;for(i=0;i<a&&((s=this.charAt(i).toString()).match(r)?o+=2:o+=1,!(e<o));i+=1)n+=s;return t&&e<a&&(n+=".."),n},String.prototype.decodeSplitKey=function(){var e=this;return e=(e=(e=(e=e.replace(/#colon#/g,":")).replace(/#dot#/g,",")).replace(/#ref#/g,'\\"')).replace(/#limit/g,"#")},String.prototype.decodeHtml=function(){var e=this;return e=(e=(e=(e=(e=e.replace(/&amp;/g,"&")).replace(/&lt;/g,"<")).replace(/&gt;/g,">")).replace(/&quot;/g,'"')).replace(/&nbsp;/g," ")},String.prototype.format=function(){var e=this;if(1<=arguments.length&&"object"==typeof arguments[0]){for(var t=/#{(.*?)}/gi;r=t.exec(this);){var i=r[0],o=r[1],n=arguments[0].value(o);if(1<arguments.length)for(var s=1;s<arguments.length&&!(n=arguments[s].value(o));s++);e=e.replace(i,$.isNullOrEmpty(n)?"-":n)}return e}var a=null;for(s=0;s<arguments.length;s++)a=new RegExp("\\{"+s+"\\}","gm"),e=e.replace(a,$.isNullOrEmpty(arguments[s])?"-":arguments[s]);return e},String.prototype.filterHTML=function(){for(var e=this;-1<e.search(/<([a-z0-9]*?).*?>([\s\S]*?)<\/\1>/gi);)e=e.replace(/<([a-z0-9]*?).*?>([\s\S]*?)<\/\1>/gi,"$2");return e.search(/<input.*>/)&&(e=e.replace(/<input.*>/gi,"")),e.search(/<(script).*?>.*?<\/\1>/)&&(e=e.replace(/<(script).*?>.*?<\/\1>/gi,"")),e.search(/<script.*>/)&&(e=e.replace(/<script.*>/gi,"")),e},String.prototype.firstCharUpperCase=function(){return this.substr(0,1).toUpperCase()+this.substr(1)},String.prototype.join=function(e){return $.isNullOrEmpty(e)?this+"":this+e},Array.prototype.clear=function(){for(var e=0;e<this.length;e+=1)this.pop()},Array.prototype.indexOf=function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1},Array.prototype.remove=function(e){var t=this.indexOf(e);-1<t&&this.splice(t,1)},Array.prototype.push||(Array.prototype.push=function(){for(var e=0;e<arguments.length;e++)this[this.length]=arguments[e];return this.length}),Array.prototype.pop||(Array.prototype.pop=function(){return lastElement=this[this.length-1],this.length=Math.max(this.length-1,0),lastElement}),Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[i]:("00"+t[i]).substr((""+t[i]).length)));return e};var Sparrow=function(e,t,i,o,n){if(window===this){var r=Array.prototype.slice.call(arguments,0);if(!e)return null;if("function"==typeof e)return e.apply(e,r.slice(1));if("jsonp"===r[0]){var s=document.createElement("script");s.type="text/javascript",s.language="javascript",s.src=r[1],s.id=r[2];var a=document.getElementById(s.id);return null!=a&&document.head.removeChild(a),document.head.appendChild(s),null}if("object"==typeof(n=e)&&(n="#"+e.id),t=null,i=document,o=!0,2<=r.length&&("boolean"==typeof r[1]?o=r[1]:t=r[1],3<=r.length&&("boolean"==typeof r[2]?o=r[2]:i=r[2]),4===r.length&&(o=r[3])),null!=t&&"object"==typeof t&&(t.id||(t.id="sparrow_"+$.random()),n+="_"+t.id),$.global(n))return $.global(n);return"object"!=typeof e&&-1==["#","!","$","&","*","+","^"].indexOf(e.substring(0,1))?i.getElementById(e):new Sparrow(e,t,i,o,n)}var l=[];if(this.selector=e,this.doc=i,"object"==typeof e)(l[0]=e).id||(e.id="sparrow_"+$.random()),this.selector="#"+e.id,n=this.selector;else if("string"==typeof e){var c=e.substring(0,1),d=(e=e.substring(1)).split("."),h=0;switch(c){case"#":l[0]=i.getElementById(e);break;case"^":l=i.getElementsByTagName(e);break;case"&":l=i.getElementsByName(e);break;case"+":l[0]=i.createElement(d[0]),2<=d.length?l[0].id=d[1]:l[0].id="sparrow_"+$.random(),this.selector="#"+d[1],n=this.selector,3<=d.length&&("doc"===d[2]?this.doc.body.appendChild(l[0]):this.doc.getElementById(d[2]).appendChild(l[0])),4<=d.length&&(l[0].type=d[3]);break;case"!":var u=[];t||(t=$(d[1]));var f=t.getElementsByTagName(d[0]);for("li"===d[0]&&(t=f[0].parentNode),(this.s=t).id||(t.id="sparrow_"+$.random()),h=0;h<f.length;h++)f[h].parentNode===t&&(u[u.length]=f[h]);l=u;break;case"$":var p=i.getElementsByTagName("label");for(h=0;h<p.length;h++)if(p[h].attributes.for.value===e){l[0]=p[h];break}break;case"*":var g=[],m=i.getElementsByName(d[0]),v=null;for(1<d.length&&(v=d[1]),h=0;h<m.length;h++)m[h].checked&&(g[g.length]=v?m[h].attributes[v].value:m[h].value);l=g}}return e&&((this.length=0)<l.length&&(this.s||(this.s=l[0]),this.s&&this.s.id&&o&&$.global(n,this)),[].push.apply(this,l)),this.interval=[],this},jb,kb,lb,mb;window.$=window.Sparrow=Sparrow,Sparrow.browser={url:{manage:"default.jsp",logout_url:"/user/logout.json"},cookie:{permission:"permission",call_back_url:"call_back_url",website_name:"website_name",themes:"sparrow.themes",root_domain:$(function(){return window.location.host.substr(window.location.host.indexOf(".")+1)}),domain:window.location.host},ie:$(function(){return-1!=navigator.userAgent.search(/MSIE/gim)}),opera:$(function(){return-1!==navigator.userAgent.search(/Opera/gim)}),firefox:$(function(){return-1!==navigator.userAgent.search(/Firefox/gim)}),google:$(function(){return-1!==navigator.userAgent.search(/Chrome/gim)}),version:$(function(){return-1!==navigator.userAgent.search(/MSIE/gim)?(navigator.userAgent.match(/MSIE\b\s*([0-9\.0-9]+);/gim),RegExp.$1):-1!==navigator.userAgent.search(/Opera/gim)?(navigator.userAgent.match(/Version\/([0-9\.]+)/gim),RegExp.$1):-1!==navigator.userAgent.search(/Firefox/gim)?(navigator.userAgent.match(/Firefox\/([0-9\.]+)/gim),RegExp.$1):-1!==navigator.userAgent.search(/Chrome/gim)?(navigator.userAgent.search(/Chrome\/([0-9\.]+)/gim),RegExp.$1):void 0}),addFavorite:function(e,t){document.all?window.external.AddFavorite(e,t):window.sidebar?window.sidebar.addPanel(t,e,""):alert("对不起，您的浏览器不支持此操作!\n请您使用菜单栏或Ctrl+D收藏本站。")},setHome:function(e,t){try{e.style.behavior="url(#default#homepage)",e.setHomePage(t)}catch(e){if(window.netscape)try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect"),Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch).setCharPref("browser.startup.homepage",t)}catch(e){alert("抱歉！您的浏览器不支持直接设为首页。请在浏览器地址栏输入“about:config”并回车然后将[signed.applets.codebase_principal_support]设置为“true”，点击“加入收藏”后忽略安全提示，即可设置成功。")}}},copy:function(e,t){t||(t="成功复制！可以通过ctrl+v进行粘贴操作！");try{if(window.clipboardData)window.clipboardData.setData("Text",e),alert(t);else{try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(e){return alert("您的浏览器设置为不允许复制！\n如果需要此操作，请在浏览器地址栏输入'about:config'并回车\n然后将'signed.applets.codebase_principal_support'设置为'true',再重试复制操作!"),!1}var i=Components.classes["@mozilla.org/widget/clipboard;1"].createInstance(Components.interfaces.nsIClipboard);if(!i)return;var o=Components.classes["@mozilla.org/widget/transferable;1"].createInstance(Components.interfaces.nsITransferable);if(!o)return;o.addDataFlavor("text/unicode");var n=Components.classes["@mozilla.org/supports-string;1"].createInstance(Components.interfaces.nsISupportsString);n.data=e,o.setTransferData("text/unicode",n,e.getByteLength());var r=Components.interfaces.nsIClipboard;if(!i)return!1;i.setData(o,null,r.kGlobalClipboard),alert(t)}}catch(e){alert("对不起！您的浏览器不支持该功能")}},setCookie:function(e,t,i,o,n,r){var s=null;0!==i&&i&&(s=new Date).setTime(s.getTime()+1e3*i),document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+(s?"; expires="+s.toGMTString():"")+"; path="+(n||"/")+"; domain="+(o||this.cookie.root_domain)+(r?"; secure":"")},getCookie:function(e){var t=null,i=document.cookie.indexOf(escape(e)+"=");if(-1!==i){var o=i+(escape(e)+"=").length,n=document.cookie.indexOf(";",o);t=-1!==n?decodeURIComponent(document.cookie.substring(o,n)):decodeURIComponent(document.cookie.substring(o))}return null==t||void 0===t||"undefined"===t?null:t},showModalDialog:function(e,t,i,o,n){var r;i=$.randomUrl(i),(r=$.browser.ie?window.showModalDialog(i,n,"dialogHeight:{0}px; dialogWidth:{1}px; status:no; help:no; scroll:auto".format(t,e)):window.open(i,n,"height={0}, width={1},toolbar= no, menubar=no, scrollbars=auto, resizable=no, location=no, status=no,top=100,left=300".format(t,e)))&&o(r)},window:function(e){var t=$.randomUrl(e.url);e.win||(e.win=window);var i=e.target?e.target:"_blank",o=null;$.isNullOrEmpty(e.width)&&(o="height={0}px,width={1}px,toolbar= no, menubar=no, scrollbars=auto, resizable=no, location=no, status=no,top=100,left=300".format(e.height,e.width)),e.win.open(t,i,o)},close:function(){window.opener=null,window.open("about:blank","_self"),window.close()},getUrlWithoutParameter:function(e){var t=e||window.location.href,i=t.indexOf("?");return i<0&&(i=t.indexOf("#")),-1<i&&(t=t.substring(0,i)),t},getUserId:function(){var e=$.browser.getCookie(this.cookie.permission);return null==e?0:e.split("&")[0].substring("id=".length)},getUserName:function(){var e=$.browser.getCookie(this.cookie.permission);return null==e?null:e.split("&")[1].substring("name=".length)},isLogin:function(){var e=$.browser.getUserId();return!(null==e||0===e||"0"===e||"null"===e||""===e)},logout:function(i,e,o){$.isNullOrEmpty(e)&&(e=this.url.logout_url),$.isNullOrEmpty(o)&&(o=this.url.manage),$.ajax.json($.url.root+e,function(e){var t=e.value;$.isNullOrEmpty(t)&&(t=$.browser.cookie.permission),$.browser.setCookie(t,"0",-1,i),$.url.root+"/"===window.parent.location.href||-1!==window.parent.location.href.indexOf(o)?window.parent.location.href=$.url.root:window.location.href=window.location.href},!0)},getClientHeight:function(){return document.body.clientHeight&&document.documentElement.clientHeight?Math.min(document.body.clientHeight,document.documentElement.clientHeight):Math.max(document.body.clientHeight,document.documentElement.clientHeight)},getScrollHeight:function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)},linkClick:function(e,t){return"boolean"==typeof e?!!e||($.alert(t,"sad"),!1):"javascript:void(0);"!==e.href||($.alert(t,"sad"),!1)}},Sparrow.container={},Sparrow.global=function(e,t){if(void 0===t)return this.container[e];this.container[e]=t},Sparrow.remove=function(e){delete this.container[e]},jb=!(!window.attachEvent||window.opera),kb=/webkit\/(\d+)/i.test(navigator.userAgent)&&RegExp.$1<525,lb=[],mb=function(){for(var e=0;e<lb.length;e++)lb[e]()},document.ready=function(e){if(!jb&&!kb&&document.addEventListener)return document.addEventListener("DOMContentLoaded",e,!1);if(!(1<lb.push(e)))if(jb)!function(){try{document.documentElement.doScroll("left"),mb()}catch(e){setTimeout(arguments.callee,0)}}();else if(kb){var t=null;t=setInterval(function(){/^(loaded|complete)$/.test(document.readyState)&&(clearInterval(t),mb())},0)}},Sparrow.url={root:$(function(){return pathName="/"===window.location.pathname?"":"/"+window.location.pathname.split("/")[1],window.location.protocol+"//"+window.location.host}),_resource:function(e){var i=document.scripts,t=["/scripts/sparrow.js","/scripts/sparrow-min.js","/scripts-dev/sparrow.js"];e&&(t=[e]);var o=null;for(var n in i){var r=!1;if(t.forEach(function(e){var t=i[n].src.indexOf(e);-1<t&&(o=i[n].src.substring(0,t),r=!0)}),r)break}return o},name:$.browser.cookie.domain.split(".")[0]},Sparrow.url.resource=$.url._resource(),Sparrow.url.passport=$(function(){return"passport."+$.browser.cookie.root_domain}),Sparrow.website={name:$.browser.getCookie($.browser.cookie.website_name),themes:$(function(){var e=$.browser.getCookie($.browser.cookie.themes);return null==e&&(e="themes_default"),e})},Sparrow.css={menu:{frame:"background:#ffffff;position:absolute;z-index:1000;border:#ccc 1px solid;width:{0}px;height:auto;left:{1}px;top:{2}px;display:none",ul:"width:{0}px;height:auto;overflow:hidden;list-style:none;margin:0px;padding:0px;text-align:left",li:"width:{0}px;overflow:hidden;line-height:20px;margin:0px;border-bottom:#ccc 1px dotted;cursor:pointer;"}},Sparrow.SIDE="SIDE",Sparrow.HORIZONTAL="HORIZONTAL",Sparrow.VERTICAL="VERTICAL",Sparrow.DEFAULT_AVATOR_URL=$.url.resource+"/images/user.png",Sparrow.DEFAULT_RESOURCE_ICO_URL=$.url.resource+"/images/menu.png",Sparrow.ajax={_objPool:[],referWindow:window,url:null,srcElement:null,SUCCESS:"0",_getInstance:function(){for(var e=0;e<this._objPool.length;e+=1)if(0===this._objPool[e].readyState||4===this._objPool[e].readyState)return this._objPool[e];return this._objPool[this._objPool.length]=this._createObj(),this._objPool[this._objPool.length-1]},_createObj:function(){var t=null;if(window.XMLHttpRequest)(t=new XMLHttpRequest).overrideMimeType&&t.overrideMimeType("text/xml");else if(window.ActiveXObject)try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}return null===t&&console.log("浏览器不支持AJAX,请设置浏览器安全级别或更新浏览器"),t},_callback:function(e){var t=e.responseText.json();null!=t?t.code!==this.ajax.SUCCESS&&$.message(t.message):$.message("json parse error "+e.responseText)},gourl:function(e){this.ajax.referWindow.location.href=e},req:function(e,t,i,o,n){-1===t.indexOf("http://")&&(t=$.url.root+t);var r=this._getInstance();n&&(this.srcElement=n);try{r.open(e,t,!0),r.setRequestHeader("pragma","no-cache"),r.setRequestHeader("cache-control","no-cache"),"GET"===e?r.send(null):(null!=o&&(o=o.replace(/%/g,"%25"),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8")),r.send(o)),r.onreadystatechange=function(){if(4===r.readyState)if(200===r.status)if(-1!==r.responseText.indexOf('"login":false')){console.log("login false");var e=r.responseText.json();document.domain=$.browser.cookie.root_domain,e.inFrame?window.parent.location.href=e.url:$.window(e)}else-1!==r.responseText.indexOf("Access Denied")?(lang.message.accessDenied||(lang.message.accessDenied="Access Denied"),$.alert(lang.message.accessDenied,"sad")):i&&i(r.responseText);else 404===r.status?console.log("资源未找到"):500===r.status?console.log("服务器错误"):12031===r.status?console.log("服务器未启动"):console.log(r.status+":未知错误")}}catch(e){console.log(e)}},json:function(e,t,i,o){"function"==typeof t&&(i=t,t=null),$.ajax.req("POST",e,function(e){var t=e.json();null!=t?t.code===$.ajax.SUCCESS?i?i(t):$.message(t.data,$.ajax.srcElement):$.message(t.message,$.ajax.srcElement):$.message("json parse error "+e)},t,o)},get:function(e){$.ajax.req("GET",e,$.ajax._callback)},post:function(e,t){$.ajax.req("POST",e,$.ajax._callback,t)}},Sparrow.v={background_color:"#fff",empty_string:"",index:null,right_message:'<img alt="" src="'+$.url.resource+"/images/"+$.website.themes+'/succeed.gif"/>',reset:function(){$.v.index=null},getErrorLabel:function(e){return e.errorCtrlId?$(e.errorCtrlId.join($.v.index)):null},initPlaceholder:function(e){for(var t in e){var i=e[t],o=$(t);null!=o&&"text"===o.type&&(o.placeholder=i.prompt)}},_setBackground:function(e,t,i){if(i&&!1!==$.v.background_color){t||(t=$.v.background_color);var o=e.parentLevel;if(void 0===o&&(o=1),0<o){var n=i;if(null==n)return;try{for(;"TR"!==n.tagName.toUpperCase()&&"line"!==n.className&&"validate"!==n.className;)n=n.parentNode;n.style.background=t}catch(e){}var r=this.getErrorLabel(e);null!=r&&(r.className="front")}}},showMessage:function(e,t){e=e[t.id];var i=this.getErrorLabel(e);i&&(i.className="prompt",i.innerHTML=e.prompt),this._setBackground(e)},ok:function(e,t){var i=this.getErrorLabel(e);return i&&(i.innerHTML=this.right_message,i.className="prompt"),this._setBackground(e,"#ffffff",t),t&&(t.style.backgroundColor="#ffffff",""===t.value&&e.defaultValue&&(t.value=e.defaultValue)),!0},fail:function(e,t){t||(t=e.setError);var i=this.getErrorLabel(e);return i&&(i.innerHTML="!"+t,i.className="error"),"!"+t},_validate:function(e,t){this._setBackground(e,"#ffffff",t);var i=t.value.trim(),o=this.getErrorLabel(e),n="SELECT"===t.tagName.toUpperCase()&&!0===t.multiple?t.options.length:i.getByteLength();return 0===n&&e.allowNull?this.ok(e):0===n&&void 0!==e.defaultValue?(t.value=e.defaultValue,this.ok(e)):0!==n||e.allowNull?e.maxLength&&n>e.maxLength||e.minLength&&n<e.minLength?this.fail(e,e.lengthError):!o||"error"!==o.className||o.innerHTML!=="!"+e.setError||this.fail(e):this.fail(e,e.nullError)},isUserNameRule:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/^[a-zA-Z0-9_]{6,20}$/)?this.fail(e,e.nameRuleError):this.ok(e,t)},isEmail:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/)?this.fail(e,e.emailError):this.ok(e,t)},isTel:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/^(0[0-9]{2,3}\-)?([2-9][0-9]{6,7})+(\-[0-9]{1,4})?$/)?this.fail(e,e.telError):this.ok(e,t)},isMobile:function(e,t){(e=e[t.id]).minLength=11,e.maxLength=11;var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/^1[\d]{10}$/)?this.fail(e,e.mobileError):this.ok(e,t)},isIdCard:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/^([1-9]([0-9]{16}|[0-9]{13})([0-9]|x|X))$/)?this.fail(e,e.idCardError):this.ok(e,t)},isNull:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:this.ok(e,t)},isWord:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:-1===t.value.search(/^[\u4e00-\u9fa5]$/)?this.fail(e,e.wordError):this.ok(e,t)},isEqual:function(e,t){e=e[t.id];var i=this._validate(e,t);return!0!==i?i:t.value!==$(e.otherCtrlId.join($.v.index)).value.trim()?this.fail(e,e.noEqualError):this.ok(e,t)},allowInputOption:function(e,t){(e=e[t.id]).defaultValue||(e.defaultValue=e.options[0]);for(var i=0;i<e.options.length&&t.value!=e.options[i];i++);i==e.options.length&&(t.value=e.defaultValue),this.ok(e,t)},isDigital:function(e,t){e=e[t.id];var i=t.value,o=this._validate(e,t);if(!0!==o)return o;if(isNaN(i))return this.fail(e,e.digitalError);var n=parseFloat(i),r=e.minValue||0===e.minValue,s=e.maxValue||0===e.maxValue;if(r&&n<e.minValue||s&&n>e.maxValue)return this.fail(e,e.digitalError);this.ok(e,t)},isImgSize:function(e,t){var i=e.value.split("*");2===i.length&&-1!==i[0].search(/^[0-9]+.?[0-9]$/)&&-1!==i[1].search(/^[0-9]+.?[0-9]$/)||(e.value=t)},isFileLength:function(e,t){-1!==e.value.toUpperCase().indexOf("M")?-1!==e.value.toUpperCase().split("M")[0].search(/^[0-9]+.?[0-9]$/)?e.value=e.value.toUpperCase().split("M")[0]+"MB":e.value=t:(-1!==e.value.toUpperCase().indexOf("K")&&-1!==e.value.toUpperCase().split("K")[0].search(/^[0-9]+.?[0-9]$/)&&(e.value=e.value.toUpperCase().split("K")[0]+"KB"),e.value=t)},updateTxtCount:function(e,t,i,o){var n=$(t);if((o=o||window.event).keyCode<37||40<o.keyCode){var r=i-e.value.getByteLength();r<=0?(n.innerHTML=0,e.value=e.value.subString(i,!1)):n.innerHTML=r}},getValidateResult:function(e,t){var i=[];for(var o in e){var n=e[o];if(n&&"object"==typeof n){var r=null,s=$(o);if(s){var a=this.getErrorLabel(n);a&&"error"===a.className&&(r=a.innerHTML),$.isNullOrEmpty(r)&&(r=$.v.isNull(e,s)),$.v.validate&&(r=$.v.validate()),!0===r||$.isNullOrEmpty(r)||i.push(r)}}}if(0<i.length)return $.message(i.join("<br/>")),!1;if(!1!==t)if("string"==typeof t||void 0===t)$.submit(t);else if("function"==typeof t)t(this);else if("object"==typeof t&&"hidden"===t.s.type){var l=t.attr("new");$.isNullOrEmpty(t.value())||(l=t.attr("update")),$.submit(l)}return!0}},Sparrow.page={toTargetPage:function(e,t,i){var o=parseInt($("consumerPageIndex").value),n=parseInt($("spanCurrentPageIndex").innerHTML.trim());o<=0||e<o?$.message("超出页码范围",i):o!==n?window.location.href=t.replace("$pageIndex",o):$.message("当前页即是目标页",i)},consumerAction:null,submit:function(e,t){$("currentPageIndex").value=e,window.location.href="#top",null==this.consumerAction?$.submit(null,t):this.consumerAction(e)},next:function(){for(var e=$("divPage").getElementsByTagName("a"),t=null,i=0;i<e.length;i++)if("下一页"===e[i].innerHTML){t=e[i].href;break}$.isNullOrEmpty(t)?alert("亲，您已经翻到最后了哟"):window.location.href=t}},Sparrow.random=function(){return(Math.random()+"").substring(2)},Sparrow.randomUrl=function(e){return-1!==e.indexOf("t=")&&(e=e.substr(0,e.indexOf("t=")-1)),-1!==e.indexOf("?")?e+="&t="+Math.random():e+="?t="+Math.random(),e},Sparrow.request=function(e){return new RegExp("(^|\\?|&)"+e+"=([^&]*)(\\s|&|$)","i").test(location.href)?unescape(RegExp.$2.replace(/\+/g," ")):""},Sparrow.isNullOrEmpty=function(e){return null==e||void 0===e||"string"==typeof e&&(""===e.trim()||"null"===e.trim())},Sparrow.toString=function(e,t){return t||(t=""),$.isNullOrEmpty(e)?t:e},Sparrow.countDown=function(e,t,i){var o=e-t,n=Math.floor(o/1e3/60/60/24),r=Math.floor(o/1e3/60/60%24),s=Math.floor(o/1e3/60%60),a=Math.floor(o/1e3%60);i.value=(0<n?n+"天":"")+(0<r?r+"时":"")+(0<s?s+"分":"")+(a<0?0:a)+"秒";var l=arguments.callee;(0<n||0<r||0<s||0<a)&&setTimeout(function(){l(e,t+1e3,i)},1e3)},Sparrow.getBeforeTime=function(e){e=new Date(e).valueOf();var t=(new Date).valueOf(),i=[{name:"秒",split:60},{name:"分钟",split:60},{name:"小时",split:24},{name:"天",split:30},{name:"月",split:12},{name:"年",split:100}];return $(function(e,t){return e/i[t].split<1?(parseInt(e)<0?1:parseInt(e))+i[t].name:arguments.callee(e/i[t].split,++t)},(t-e)/1e3,0)},Sparrow.submit=function(e,t){t=t||0,e&&(document.forms[t].action=e),document.forms[t].submit()},Sparrow.jsonKeys=function(e){var t=[];if(!e)return t;if(void 0!==e.length)return e;for(var i in e)t.push(i);return t},Sparrow.clearForm=function(e){for(var t=$.jsonKeys(e),i=0;i<t.length;i++){var o=$(t[i]);if(null!=o){var n="";e[t[i]]&&(n=e[t[i]].defaultValue),o.value=$.toString("",n)}else console.log(t[i]+" not exist!")}},Sparrow.getFormData=function(e){for(var t=[],i=$.jsonKeys(e),o=0;o<i.length;o++){var n=$(i[o]);if(null!=n){if(!$.isNullOrEmpty(n.name)){var r=n.value;t.push(n.name+"="+r)}}else console.log(i[o]+" not exist!")}return t.join("&")},Sparrow.waitRedirect=function(e,t){var i=$("#"+e);if(null!=i&&null!=i.s){t||(t=1e3);var o=window.setInterval(function(){var e=parseInt(i.html(),10);0==e--?(window.location.target="_self",window.location.href=i.attr("url"),window.clearInterval(o)):i.html(e)},t)}},Sparrow.format=function(txt,compress){var indentChar="    ";if("string"!=typeof txt||!/^\s*$/.test(txt)){var data=null;if("object"==typeof txt)data=txt;else try{data=eval("("+txt+")")}catch(e){return void alert("数据源语法错误,格式化失败! 错误信息: "+e.description,"err")}var draw=[],last=!1,This=this,line=compress?"":"\n",nodeCount=0,maxDepth=0,notify=function(e,t,i,o,n){nodeCount++;for(var r=0,s="";r<o;r++)s+=indentChar;if(s=compress?"":s,maxDepth=++o,t&&t.constructor===Array){draw.push(s+(n?'"'+e+'":':"")+"["+line);for(r=0;r<t.length;r++)notify(r,t[r],r===t.length-1,o,!1);draw.push(s+"]"+(i?line:","+line))}else if(t&&"object"==typeof t){draw.push(s+(n?'"'+e+'":':"")+"{"+line);var a=0;r=0;for(var l in t)a++;for(var l in t)notify(l,t[l],++r===a,o,!0);draw.push(s+"}"+(i?line:","+line))}else"string"==typeof t&&(t='"'+t+'"'),draw.push(s+(n?'"'+e+'":':"")+t+(i?"":",")+line)},isLast=!0,indent=0;return notify("",data,isLast,indent,!1),draw.join("")}alert("数据为空,无法格式化! ")},Sparrow.bind=function(o,n,r){return function(e){if(-1<n.indexOf("|"))for(var t=n.split("|"),i=0;i<t.length;i++)r?o[t[i]](r,e):o[t[i]](e);else r?o[n](r,e):o[n](e)}},Sparrow.prototype.each=function(e){for(var t=0,i=this.length;t<i;t++)e.call(this[t],t,this)},Sparrow.prototype.attr=function(e,t){if(this.s){if($.isNullOrEmpty(t)){var i=this.s.attributes[e];return i?i.value:this.s.getAttribute(e)}this.s.setAttribute(e,t)}},Sparrow.prototype.html=function(e){if(this.s){if($.isNullOrEmpty(e))return this.s.innerHTML;this.s.innerHTML=e}},Sparrow.prototype.format=function(e,t){this.s&&(null!=$(e)&&(e=$("#"+e).html()),this.s.innerHTML=e.format(t))},Sparrow.prototype.value=function(e){if(this.s)return null==e?this.s.value:void(this.s.value=e)},Sparrow.prototype.check=function(e){for(var t=0;t<this.length;t++)if(this[t].value===e){this[t].checked="checked";break}},Sparrow.prototype.opacity=function(e){if(0<=e)return this.s.style.filter="alpha(opacity="+e+")",this.s.style.opacity=e/100,void this.s.setAttribute("opacity",e);var t=this.s.attributes.opacity;return t?t.value:100},Sparrow.prototype.bind=function(e,t){this.s&&(this.s.attachEvent?this.s.attachEvent(e,t):this.s.addEventListener(e.substring(2),t,!1))},Sparrow.prototype.getAbsoluteTop=function(){for(var e=this.s,t="string"==typeof e?$(e):e,i=t.offsetTop;null!=(t=t.offsetParent);)i+=t.offsetTop;return i},Sparrow.prototype.getAbsoluteLeft=function(){for(var e=this.s,t="string"==typeof e?$(e):e,i=t.offsetLeft;null!=(t=t.offsetParent);)i+=t.offsetLeft;return i},Sparrow.prototype.source=function(){return this.s},Sparrow.prototype.class=function(e){if(!e)return this.s.className;this.s.className=e},Sparrow.prototype.css=function(attribute,value,add){if(Math.abs(value)<1&&(value=value<0?-1:1),"opacity"===attribute)value=Math.ceil(value),add&&(value=parseInt(this.opacity(),10)+value),this.opacity(value);else{var command=null;add?(command='var o=parseInt($("'+this.s.id+'").style.'+attribute+",10);",command+='$("'+this.s.id+'").style.'+attribute+"=(o+"+value+')+"px";'):command='$("'+this.s.id+'").style.'+attribute+'="'+value+'"',eval(command)}return this},Sparrow.prototype.change_check_box_class=function(e,t,i,o){var n=this.s.className;o||(o="_");var r=n.split(o);return i||(i="check"),t||(t=r.length),e?n.indexOf(i)<0&&(r.splice(t,0,i),this.s.className=r.join(o)):0<=n.indexOf(i)&&(r.splice(t,1),this.s.className=r.join(o)),r.splice(t,r.length-t+1),r.join(class_split)},Sparrow.prototype.contains=function(e){for(;null!=e&&void 0!==e.tagName;){if(e===this.s)return!0;e=e.parentNode}return!1},Sparrow.prototype.remove=function(){null!=this&&null!=this.s&&(this.doc.body.removeChild(this.s),this.s=null)},Sparrow.prototype.fix=function(e,t){if(this.s){var i=this.s.offsetWidth;t||(t=this.getAbsoluteLeft()),$.browser.ie&&"6.0"===$.browser.version?(this.doc.documentElement.style.backgroundImage="url(about:blank)",this.doc.documentElement.style.backgroundAttachment="fixed",this.doc.body.style.backgroundImage="url(about:blank)",this.doc.body.style.backgroundAttachment="fixed",this.s.style.position="absolute"):this.s.style.position="fixed",this.s.style.top=e+"px",this.s.style.left=t+"px",this.s.style.width=i+"px"}},Sparrow.prototype.center=function(){if(this.s){var e=(this.doc.body.clientWidth-this.s.offsetWidth)/2,t=this.doc.documentElement.clientHeight>screen.availHeight?screen.availHeight:this.doc.documentElement.clientHeight,i=64+parseInt((t-161-this.s.offsetHeight)/2);this.fix(i,e)}},Sparrow.prototype.loadComplete=function(e){if("IFRAME"===this.s.tagName.toUpperCase())this.s.onload=function(){e(this)};else if("IMG"===this.s.tagName.toUppperCase()){if($.browser.ie)return void(this.s.onreadystatechange=function(){"complete"!==this.s.readyState&&"loaded"!==this.s.readyState||e(this)});this.s.onload=function(){!0===this.s.complete&&e(this)}}},Sparrow.prototype.parent=function(){return $(this.s.parentNode)},Sparrow.prototype.fresh=function(e){$.isNullOrEmpty(this.s.src)&&(this.s.src=e),this.s.src=$.randomUrl(this.s.src)},Sparrow.prototype.enter=function(t){this.s.onkeydown=function(e){if(13===(e=window.event||e).keyCode){if("string"==typeof t)return void $(t).onclick(e);t()}}},String.prototype.toArrayBuffer=function(){var e,t,i=[];e=this.length;for(var o=0;o<e;o++)65536<=(t=this.charCodeAt(o))&&t<=1114111?(i.push(t>>18&7|240),i.push(t>>12&63|128),i.push(t>>6&63|128),i.push(63&t|128)):2048<=t&&t<=65535?(i.push(t>>12&15|224),i.push(t>>6&63|128),i.push(63&t|128)):128<=t&&t<=2047?(i.push(t>>6&31|192),i.push(63&t|128)):i.push(255&t);var n=new Int8Array(i.length);for(var o in i)n[o]=i[o];return n},Int8Array.prototype.toString=function(){for(var e=new DataView(this.buffer),t=new Uint8Array(this.buffer.byteLength),i=0;i<t.length;i++)t[i]=e.getUint8(i);var o="",n=t;for(i=0;i<n.length;i++){var r=n[i].toString(2),s=r.match(/^1+?(?=0)/);if(s&&8==r.length){for(var a=s[0].length,l=n[i].toString(2).slice(7-a),c=1;c<a;c++)l+=n[c+i].toString(2).slice(2);o+=String.fromCharCode(parseInt(l,2)),i+=a-1}else o+=String.fromCharCode(n[i])}return o};var _hmt=_hmt||[];function getImgContainer(e,t,i){var o=[],n=$("+div"),r=$.file.getFileName(e).split(".")[0];return n.s.className="",n.s.style.cssText="width:92px;height:90px;float:left;padding:3px;border:#ccc 2px solid;",o.push('<a target="_blank" href="{0}" title="{1}"><img style="width:91px;height:67px;" src="{2}"/></a>'.format(e,$.file.getFileName(t),e)),o.push('<br/><a href="javascript:void(0);" target="_self" onclick="'+i.fullObjName+".attach.deleteOnServer('"+r+'\',this);">删除</a>｜<a href="javascript:void(0);" target="_self" onclick="'+i.fullObjName+".attach.insertEditor('"+$.file.getFileName(t)+"','"+e+'\');">插入</a><input type="hidden" name="'+i.config.attach.fileUUID+'" value="'+r+'"/>'),n.s.innerHTML=o.join(""),n.s}function clearHtmlFrame(){for(var e=0;e<$.editor.editorArray.length;e++)$.editor.editorArray[e].config.currentHtmlId&&(document.getElementById($.editor.editorArray[e].config.currentHtmlId).style.display="none",$.editor.editorArray[e].config.currentHtmlId=null,$.editor.editorArray[e].clear())}return function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?11daae2d559a82e0e8bd4872ad217164";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),Sparrow.prototype.tabs=function(e){e||(e={});var o=e.withIndexClass,t=e.index,i=$("!div."+this.s.id),n=i[0],r=$("!li",n),s=i[1],a=$("!div",s),l=function(t){var e=$("!a",r[t])[0],i=$(e).attr("rev");i&&($("!a",r[r.length-1])[0].href=i);a.each(function(e){if(o&&(r[0].className="pure-menu-item pure-menu-heading"),e==t)return r[e].className="pure-menu-item pure-menu-selected",void(this.className="block");r[e].className="pure-menu-item",this.className="none"})};r.each(function(e){$(this).attr("tab_index",e),0<this.className.indexOf("close")||0<this.className.indexOf("more")||$(this).bind("onclick",function(){var e=$(this).attr("tab_index");l(e)})}),t&&l(t)},Sparrow.win={config:{isInFrame:!1,showHead:!0,titleHeight:45,currentWindow:window,bgsound:$.url.resource+"/media/sound.wav",titleImg:$.url.resource+"/images/"+$.website.themes+"/panel.gif",closeBtnImg:$.url.resource+"/images/"+$.website.themes+"/panel.gif",OKBtnImg:$.url.resource+"/images/"+$.website.themes+"/panel.gif",smileImg:$.url.resource+"/images/"+$.website.themes+"/smile.gif",sadImg:$.url.resource+"/images/"+$.website.themes+"/sad.gif",lockImg:$.url.resource+"/images/"+$.website.themes+"/lock.gif",waitImg:$.url.resource+"/images/"+$.website.themes+"/loading.gif",askImg:$.url.resource+"/images/"+$.website.themes+"/smile.gif",tagArray:["select","object"],jalert:{height:"auto",width:"250px",closeCallBack:function(){}},dialog:{descContainer:null}},getWindow:function(){return this.config.isInFrame?window.parent:window},getScrollTop:function(){return this.getWindow().pageYOffset||this.getWindow().document.documentElement.scrollTop||this.getWindow().document.body.scrollTop},addSound:function(){$("+bgsound.sound.doc",null,this.getWindow().document).s.src=this.config.bgsound},addBackDiv:function(){var e=$("+div.backDiv.doc",null,this.getWindow().document),t=Math.max(this.getWindow().document.body.scrollHeight,this.getWindow().document.documentElement.scrollHeight);e.s.zIndex=1e3,e.opacity(80),e.s.style.position="absolute",e.s.style.width=e.doc.body.offsetWidth+"px",e.s.style.height=t+"px",e.s.style.left="0px",e.s.style.top="0px",e.s.style.backgroundColor="#000000"},addMsgDialog:function(e,t){e||(e=this.config.jalert.width),t||(t=this.config.jalert.height);var i=$("+div.dialog.doc",null,this.getWindow().document);i.s.className="modal",i.s.zIndex=1001,i.s.style.width=e,i.s.style.height=t},addPanel:function(e){var o=$("+div.dialog.doc",null,this.getWindow().document);o.s.zIndex=1001,!(o.s.style.cssText="position:absolute;text-align:center;font-size: 10pt;background:white;")!==this.config.showHead&&this.addTitle(),this.addRightClose();var n=$("+iframe.panel.dialog",null,o.doc);n.s.setAttribute("frameborder","0",0),n.s.scrolling="no",n.s.src=e,n.loadComplete(function(e){var t=parseInt(e.contentWindow.document.body.style.width,10),i=parseInt(e.contentWindow.document.body.style.height,10);n.s.style.width=t-4+"px",n.s.style.height=i-($.win.config.showHead?$.win.config.titleHeight:0)-5+"px",o.s.style.width=t+"px",o.s.style.height=i+"px",$("#dialog",null,o.doc).center(),!1!==$.win.config.showHead&&($("#divleft",null,o.doc).s.innerHTML=e.contentWindow.document.title)})},addTitle:function(e){if(!1!==this.config.showHead){$("+div.divtitle.dialog",null,this.getWindow().document).s.className="modal-header pure-g";var t=$("+div.divleft.divtitle",null,this.getWindow().document);t.css("textAlign","left"),t.s.className="drag-pp pure-u-23-24",t.s.onmousedown=function(e){$.event(e).drags()},t.s.onmouseup=function(e){$.event(e).move_end()},t.html(e||$.website.name+"提醒您:")}},addRightClose:function(){if(this.config.showHead){var e=$("+div.divright.divtitle",null,this.getWindow().document);e.s.className="pure-u-1-24",e.css("cursor","pointer"),e.html("×"),e.s.onclick=function(){$.win.closeClick()}}},addOK:function(){var e=$("+input.btnOK.divfooter",null,this.getWindow().document);e.s.id="btnOK",e.s.type="button",e.s.className="pure-button pure-button-primary",e.s.value="确定",e.s.onclick=function(){$.win.okClick()}},addClose:function(){var e=$("+input.btnclose.divfooter",null,this.getWindow().document);e.s.className="pure-button",e.attr("type","button"),e.s.value="关  闭",e.s.onclick=function(){$.win.closeClick()}},addMsgContent:function(){$("+div.divcontent.dialog",null,this.getWindow().document).s.className="modal-body"},addFooter:function(){$("+div.divfooter.dialog",null,this.getWindow().document).s.className="modal-footer"},okClick:function(){},closeClick:function(){$.showOrHiddenTag(this.config.tagArray,!0,this.getWindow().document),$("#dialog",null,this.getWindow().document).remove(),$("#backDiv",null,this.getWindow().document).remove(),$("#sound",null,this.getWindow().document).remove(),$.win.config.currentWindow.focus(),$.win.config.jalert.closeCallBack&&($.win.config.jalert.closeCallBack(),$.win.config.jalert.closeCallBack=null),$.win.ok=void 0}},Sparrow.alert=function(e,t,i,o,n){var r={};"object"==typeof e&&(e=(r=e).msg.decodeSplitKey(),t=r.type,i=r.title.decodeSplitKey(),r.url&&(o=r.url.decodeSplitKey()),r.wait_message&&(n=r.wait_message.decodeSplitKey())),$.win.addSound(),$.showOrHiddenTag($.win.config.tagArray,!1,$.win.getWindow().document),$.win.addBackDiv(),$.win.addMsgDialog(),$.win.addTitle(i),$.win.addMsgContent();var s=null;switch(t){case"smile":$.win.addFooter(),$.win.addRightClose(),$.win.addClose(),s=$.win.config.smileImg;break;case"sad":$.win.addFooter(),$.win.addRightClose(),$.win.addClose(),s=$.win.config.sadImg;break;case"lock":s=$.win.config.lockImg;break;case"wait":s=$.win.config.waitImg;break;case"ask":$.win.addFooter(),$.win.addRightClose(),$.win.addOK(),$.win.addClose(),s=$.win.config.askImg;break;case void 0:$.win.addFooter(),$.win.addRightClose(),$.win.addClose()}var a="";s&&(a='<br/><img align="absMiddle" src=\''+s+"'/>&nbsp;&nbsp;"),e&&(a+=e,$.isNullOrEmpty(o)||(a+=n.format(o)),$("#divcontent",null,$.win.getWindow().document).s.innerHTML=a,$.waitRedirect("timer")),$.showOrHiddenTag("select",!0,$.win.getWindow().document.getElementById("divcontent")),$("#dialog",null,$.win.getWindow().document).center()},Sparrow.window=function(e){e||(e={}),$.isNullOrEmpty(e.showHead)||($.win.config.showHead=e.showHead),$.isNullOrEmpty(e.inFrame)||($.win.config.isInFrame=e.inFrame),url=e.url,$.win.closeClick(),0!=e.cache&&(url=$.randomUrl(url)),url.indexOf("http://")<0&&(url=$.url.root+url),$.showOrHiddenTag($.win.config.tagArray,!1,$.win.getWindow().document),e.srcElement&&(e.srcElement.indexOf("#")<0&&(e.srcElement="#"+e.srcElement),$.win.config.toTopHeight=$(e.srcElement).getAbsoluteTop()-height/2),$.win.addBackDiv(),$.win.addPanel(url)},"function"==typeof define&&define.amd&&define("sparrow",[],function(){return Sparrow}),Sparrow.dialog=function(e){e||(e={}),$.showOrHiddenTag($.win.config.tagArray,!1,$.win.getWindow().document),$.win.addBackDiv(),$.win.addMsgDialog(e.width,e.height),$.win.addTitle(e.title),$.win.addMsgContent(),$.win.addOK(),$.win.addClose(),e.content&&($("#divcontent",null,$.win.getWindow().document).s.innerHTML=e.content),e.initialize&&e.initialize($("divcontent")),$("#dialog",null,$.win.getWindow().document).center()},Sparrow.gridView={keyType:"int",id:"grvManageList",resultCtrlId:"hdnGridResult",getTable:function(){return $(this.id)},init:function(){var e=$("#"+this.resultCtrlId);null!=e&&($.isNullOrEmpty(e.attr("gridViewId"))||(this.id=e.attr("gridViewId")),$.isNullOrEmpty(e.attr("keyType"))||(this.keyType=e.attr("keyType")))},getCellIndex:function(e){return e.parentNode.cellIndex},allCheckClick:function(e){for(var t=$("&"+this.id),i=0;i<t.length;i+=1){t[i].checked=e.checked}},recordCheckClick:function(e,t){if(!1!==e.checked){for(var i=!0,o=$("&"+this.id),n=0;n<o.length;n++)!1===o[n].checked&&(i=!1);i&&($(t).checked=!0)}else $(t).checked=!1},mustSelect:function(e){for(var t=[],i=$("&"+this.id),o=null,n=0;n<i.length;n+=1){var r=i[n];"input"===r.tagName.toLowerCase()&&r.checked&&(o=r.id,"string"===this.keyType?t.push("'"+o+"'"):t.push(o))}return 0===t.length?(lang.message.noSelectRecord?$.message(lang.message.noSelectRecord):$.message("please define 'lang.message.noSelectRecord'!"),!1):(1===t.length&&(t.pop(),t.push(o)),e?!!window.confirm(e)&&t:t)},onlyCheckedOne:function(e){for(var t=0,i=null,o=$("name."+this.id),n=1;n<o.length;n++){var r=o[n];r.checked&&(t+=1,i=r.id)}return 0===t?(lang.message.noSelectRecord?$.message(lang.message.noSelectRecord):$.message("please define lang.message.noSelectRecord!"),!1):1!==t?(lang.message.onlySelectOneRecord?$.message(lang.message.onlySelectOneRecord):$.message("please define lang.message.onlySelectOneRecord"),!1):!window.confirm(e)||i},submit:function(e,t,i){var o=i?this.onlyCheckedOne(t):this.mustSelect(t);if(o){if($(this.resultCtrlId).value=o,"return"===e)return!0;$.submit(e)}}},Sparrow.table=function(e){if(!(this instanceof Sparrow.table))return new Sparrow.table(src);e&&(this.id=e,this.t=$(e),this.body=t.getElementsByTagName("tbody")[0],this.tr=[])},Sparrow.table.prototype={_initCell:function(e,t,i){e.style.cssText=this.tr[t].td[i].cssText,e.className=this.tr[t].td[i].className,e.align=this.tr[t].td[i].align,e.innerHTML=this.tr[t].td[i].innerHTML,this.tr[t].td[i].colspan&&e.setAttribute("colspan",this.tr[t].td[i].colspan)},_initRow:function(e,t){e.style.cssText=table.tr[t].cssText,table.tr[t].className&&""!==table.tr[t].className&&(e.className=table.tr[t].className);for(var i=0;i<this.tr[t].td.length;i++){var o=e.insertCell(-1);this._initCell(o,t,i)}},init:function(){for(var e=0;e<this.tr.length;e++)this.body.appendChild(this._initRow(e));$(this.containerId).appendChild(this.t)},appendRow:function(){for(var e=0;e<this.tr.length;e++){var t=this.body.insertRow(-1);this._initRow(t,e)}},insertRow:function(e){for(var t=0;t<this.tr.length;t++){var i=this.body.insertRow(e);this._initRow(i,t)}},updateRow:function(e){for(var t=0;t<this.tr[0].td.length;t++)this.tr[0].td[t].innerHTML&&(this.body.rows[e].cells[t].innerHTML=this.tr[0].td[t].innerHTML)},removeRow:function(e){this.body.deleteRow(e)}},Sparrow.file={isShowProgress:!0,wit:null,clientFileName:null,uploadFrameId:null,uploadCallBack:function(e,t,i){console.info(e),console.info(i),this.clearStatus()},clearStatus:function(){window.clearInterval(this.wit),window.setTimeout(function(){var e=$("divStatus");$.file.isShowProgress&&null!=e&&document.body.removeChild(e)},1e3)},fileSerialNumber:null,validateUploadFile:function(e,t,i){$.file.checkFileType($.file.getFileName(e.value),["jpg","jpeg","gif","png"],"errorImgForumIco")&&$.file.uploadDelegate(t,i)},callbackValidate:function(e){return!!$.isNullOrEmpty(e.error)||($.alert(e.error,"sad"),$.file.clearStatus(),!1)},reset:function(){var e=$(this.uploadFrameId),t=e.src;e.src="about:blank",e.src=t},getUploadFrame:function(){return this.uploadFrameId?$(this.uploadFrameId):$("fileUpload")},getUploadFile:function(e){return e||(e=this.getUploadFrame()),e.contentWindow.document.getElementById("file_upload")},getUploadFileInfo:function(e){return e||(e=this.getUploadFrame()),e.contentWindow.document.getElementById("fileInfo")},getFileSerialNumber:function(){return this.fileSerialNumber},setFileSerialNumber:function(e){this.fileSerialNumber=e},getFullPath:function(e){if(!e)return"";if($.browser.ie){e.select();var t=document.frames[0].document.selection.createRange().text;return document.frames[0].document.selection.empty(),t}return $.browser.firefox&&e.files?e.files.item(0).getAsDataURL():e.value},getExtension:function(e){return(e=$.browser.getUrlWithoutParameter(e)).substring(e.lastIndexOf(".")).toLocaleLowerCase()},getFileName:function(e){return-1!==(e=$.browser.getUrlWithoutParameter(e)).indexOf("\\")?e.substring(e.lastIndexOf("\\")+1):-1!==e.indexOf("/")?e.substring(e.lastIndexOf("/")+1):e},checkFileType:function(e,t,i){for(var o=this.getExtension(e),n=!1,r=0;r<t.length;r+=1)if(t[r].toLocaleLowerCase()===o||"."+t[r].toLocaleLowerCase()===o){n=!0;break}if(n)return $.v.ok(i),n;var s=$("#"+i);return null!=s&&null!=s.source()&&(s.class("error"),s.html("!只支持:"+t+"格式")),$.message("文件格式不正确，只支持以下格式:\n"+t),n},uploadDelegate:function(e,t,i){if(!1!==this.isShowProgress&&$("divStatus"))return $.alert(this.clientFileName+"正在上传中,请稍侯...","sad"),!1;this.uploadFrameId=(t?t.obj:"null")+"."+e;var o=this.getUploadFrame();if(this.clientFileName=this.getUploadFile(o).value,""===this.clientFileName)return $.message("请选择上传文件!",i),!1;var n=this.getUploadFileInfo(o).value.split(".");if(this.setFileSerialNumber(n[2]),!1!==$.file.isShowProgress){if(!$("divStatus")){var r=$(o),s=$("+div");s.s.id="divStatus",s.s.style.cssText="width:260px;height:100px;position:absolute;color:#ffffff;background:#000000;font-size:10pt;border:#ccc 1px solid;text-align:left;",s.html("服务器正在加载文件信息..."),document.body.appendChild(s.s),s.s.style.top=r.getAbsoluteTop()-10+"px",s.s.style.left=r.getAbsoluteLeft()+"px",s.opacity(90)}this.wit=window.setInterval(function(){$.file.getStatus()},1e3)}o.contentWindow.document.forms[0].submit()},progressCallback:function(e){if(null!=e&&"loading"!==e.status&&this.callbackValidate(e)){var t=[],i=Math.ceil(parseFloat(e.readLength)/parseFloat(e.contentLength)*1e6)/1e4+"%";t.push("正在上传文件<br/><span class='highlight'>《"+$.file.getFileName($.file.clientFileName)+"》</span><br/>"),t.push("文件大小:"+e.humanReadableContentLength+"<br/>"),t.push("上传大小:"+e.humanReadableReadLength+"<br/>"),t.push("上传进度:"+i),$("#divStatus",!1).html(t.toString()),"100%"===i&&$.file.clearStatus()}},getStatus:function(){$("jsonp",$.url.upload+"/file-upload?file-serial-number="+this.getFileSerialNumber()+"&t="+Math.random()+"&callback=progressCallback","uploadProgress")},initImageUploadEvent:function(e,o){$.url.upload||(console.error("please config $.url.upload the default config is $.url.root ["+$.url.root+"]"),$.url.upload=$.url.root);var t=$("null."+e);null!=t&&(document.domain=$.browser.cookie.root_domain,o||(o="Cover"),t.src=$.url.upload+"/file-upload?path-key="+e+"&t="+Math.random(),$.file.uploadCallBack=function(e,t,i){console.info(i)},$.file.validateUploadFile=function(e,t,i){var n=o;"object"==typeof o&&(n=o[t]),$.file.checkFileType($.file.getFileName(e.value),["jpg","jpeg","gif","png"],"error"+n)&&($.file.uploadCallBack=function(e){if($.file.clearStatus(),e.fileUrl){var t=$("#div"+n);null!=t&&t.html("<a href='"+e.fileUrl+"' target='_blank'><img src='"+e.fileUrl+"'/></a>");var i=$("#hdn"+n);null!=i&&i.value(e.fileUrl);var o=$("#error"+n);null!=o&&null!=o.s&&(o.class("prompt"),o.html(""))}},$.file.uploadDelegate(t,i))})}},Sparrow.event=function(e){if(!(this instanceof Sparrow.event))return new Sparrow.event(e);e&&(this.originalEvent=e,this.type=e.type,this.e=window.event||this.originalEvent,this.srcElement=this.e.srcElement||this.e.target,this.toElement=this.e.toElement||this.e.relatedTarget)},Sparrow.event.prototype={dragapproved:!1,srcElement:null,eventX:null,eventY:null,srcLeftPos:null,srcRightPos:null,cancelBubble:function(){window.event?window.event.cancelBubble=!0:this.e.stopPropagation()},preventDefault:function(){this.e.preventDefault&&this.e.preventDefault(),window.event&&(window.event.returnValue=!1)},getAbsoluteTop:function(){return this.e.pageY?this.e.pageY:this.clientY?this.clientY+(document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop):null},getAbsoluteLeft:function(){return this.pageX?this.pageX:this.clientX?this.clientX+(document.documentElement.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft):null},move:function(){if(!this.dragapproved||null==this.srcElement)return!0;this.srcElement.style.left=this.srcLeftPos+this.clientX-this.eventX,this.srcElement.style.top=this.srcRightPos+this.clientY-this.eventY},move_end:function(){this.dragapproved=!1,this.srcElement.onmousemove=null},drags:function(){try{if(-1!==this.srcElement.className.indexOf("drag")){"drag-p"===this.srcElement.className?this.srcElement=this.srcElement.parentNode:"drag-pp"===this.srcElement.className?this.srcElement=this.srcElement.parentNode.parentNode:this.srcElement=null;var t=$(this.srcElement);this.dragapproved=!0,this.srcLeftPos=t.getAbsoluteLeft(),this.srcRightPos=t.getAbsoluteTop(),this.eventX=e.clientX,this.eventY=e.clientY,this.srcElement.onmousemove=this.move}else this.srcElement=null,this.dragapproved=!1,this.srcElement.onmousemove=null}catch(e){}}},Sparrow.prototype.mousewheel=function(t){var i,e="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],o=Array.prototype.slice,n=function(e){t&&(e=$.event(e),args=o.call(arguments,1),delta=0,deltaX=0,deltaY=0,absDelta=0,e.preventDefault(),"detail"in e.e&&(deltaY=-1*e.e.detail),"wheelDelta"in e.e&&(deltaY=e.e.wheelDelta),"wheelDeltaY"in e.e&&(deltaY=e.e.wheelDeltaY),"wheelDeltaX"in e.e&&(deltaX=-1*e.e.wheelDeltaX),"axis"in e.e&&e.e.axis===e.e.HORIZONTAL_AXIS&&(deltaX=-1*deltaY,deltaY=0),delta=0===deltaY?deltaX:deltaY,"deltaY"in e.e&&(deltaY=-1*e.e.deltaY,delta=deltaY),"deltaX"in e.e&&(deltaX=e.e.deltaX,0===deltaY&&(delta=-1*deltaX)),0===deltaY&&0===deltaX||(absDelta=Math.max(Math.abs(deltaY),Math.abs(deltaX)),(!i||absDelta<i)&&(i=absDelta,absDelta%120==0&&(i/=40)),absDelta%120==0&&(delta/=40,deltaX/=40,deltaY/=40),delta=Math[1<=delta?"floor":"ceil"](delta/i),deltaX=Math[1<=deltaX?"floor":"ceil"](deltaX/i),deltaY=Math[1<=deltaY?"floor":"ceil"](deltaY/i),e.e.deltaX=deltaX,e.e.deltaY=deltaY,e.e.deltaFactor=i,e.e.deltaMode=0,args.unshift(e.e,delta,deltaX,deltaY),t(args)))};if(this.s.addEventListener)for(var r=e.length;r;)this.s.addEventListener(e[--r],n,!1);else this.s.onmousewheel=n},Sparrow.prototype.addItem=function(e,t){if("SELECT"===this.s.tagName.toUpperCase()){$.isNullOrEmpty(t)&&(t=e);var i=new Option(e,t);this.existItem(i)||this.s.options.add(i)}},Sparrow.prototype.existItem=function(e){for(var t=!1,i=0;i<this.s.options.length;i++)e.value===this.s.options[i].value&&(t=!0);return t},Sparrow.prototype.addItemToSelect=function(e){for(var t=$(e),i=0;i<this.s.options.length;i+=1)if(srcSelect.options[i].selected){var o=this.s.options[i].value,n=this.s.options[i].innerHTML,r=new Option(n,o);t.existItem(this.s.options[i])||e.options.add(r)}},Sparrow.prototype.addAllItemToSelect=function(e){for(var t=$(e),i=0;i<srcSelect.options.length;i+=1){var o=srcSelect.options[i].innerHTML,n=srcSelect.options[i].value,r=new Option(o,n);t.existItem(srcSelect.options[i])||e.options.add(r)}},Sparrow.prototype.removeItem=function(e){"string"==typeof srcSelect&&(srcSelect=$(srcSelect));for(var t=!1,i=this.s.options.length-1;0<=i;i-=1)this.s.options[i].selected&&(this.s.options.remove(i),t=!0);!1!==e&&!1===t&&this.s.options.remove(0)},Sparrow.prototype.removeAll=function(){for(var e=this.s.options.length-1;0<=e;e-=1)this.s.options.remove(e)},Sparrow.prototype.upDown=function(e){if(!(this.s.selectedIndex<0)){if(e<0){if(0===this.s.selectedIndex)return}else if(this.s.selectedIndex===this.s.options.length-1)return;var t=this.s.options[this.s.selectedIndex],i=this.s.options[this.s.selectedIndex+e],o=t.text,n=t.value;t.text=i.text,t.value=i.value,i.text=o,i.value=n,this.s.selectedIndex+=e}},Sparrow.prototype.selectAll=function(){for(var e=0;e<this.s.options.length;e++)this.s.options[e].selected=!0},Sparrow.prototype.addJson=function(e,t,i){if("string"==typeof e&&(e=e.json()),null!=e&&0<e.length){for(var o in e)this.addItem(e[o][i],e[o][t]);return!0}},Sparrow.message=function(e,t){var i="div_sparrow_msg",o=$(i);if(o&&o.parentNode.removeChild(o),(o=$("+div."+i)).s.style.cssText="position:absolute;background-color:#cccccc;width:auto;padding:10px;text-align:left;",o.s.innerHTML=e,o.opacity(0),document.body.appendChild(o.s),t){var n=$(t);o.s.style.top=n.getAbsoluteTop()-o.s.offsetHeight+"px",o.s.style.left=n.getAbsoluteLeft()-(o.s.offsetWidth-t.offsetWidth)/2+"px"}else o.center();o.move_end=function(){this.s.parentNode.removeChild(this.s)},o.animation("{opacity:100}",30)},Sparrow.prototype.move=function(e){var a=e.json();console.log("move status ",a);var t=function(e,t,i,o,n){if(!$.isNullOrEmpty(i)){var r=parseInt(i,10)-parseInt(t,10),s=r*o;if(1<o){if(s=0<r?o:-o,Math.abs(r)<=1)return e.css(n,a.start,!1),!1}else s=r*o;if("function"==typeof n?n(e.s,s):e.css(n,s,!0),Math.abs(r)<=1)return!0}return!1},i=a.percent;i||(i=.05);var o=t(this,this.s.style.width,a.width,i,"width");o||(o=t(this,this.s.style.height,a.height,i,"height")),o||(o=t(this,this.s.style.left,a.left,i,"left")),o||(o=t(this,this.s.style.top,a.top,i,"top")),o||(o=t(this,this.opacity(),a.opacity,i,"opacity")),o&&($.isNullOrEmpty(a.width)||(this.s.style.width=a.width),$.isNullOrEmpty(a.height)||(this.s.style.height=a.height),$.isNullOrEmpty(a.left)||(this.s.style.left=a.left),$.isNullOrEmpty(a.top)||(this.s.style.top=a.top),$.isNullOrEmpty(a.opacity)||this.opacity(a.opacity),0===parseInt(a.height,10)&&(this.s.style.display="none"),this.stop(),this.move_end(),this.move_end=function(){})},Sparrow.prototype.move_end=function(){},Sparrow.prototype.stop=function(){window.clearInterval(this.interval.pop())},Sparrow.prototype.animation=function(e,t){t||(t=30),this.s.style.display="block",this.stop();var i="$('"+this.selector+"').move(\""+e+'");';console.log("animation"+i),this.interval.push(window.setInterval(i,t))},Sparrow.prototype.interlace=function(t){t||(t=["{width:'0px',height:'0px'}","{top:'0px',height:'{0}',width:'{1}',left:'0px'}".format(this.s.style.height,this.s.style.width),"{width:'{0}',height:'{1}'}".format(this.s.style.width,this.s.style.height),"{top:'{0}',height:'0px',width:'0px',left:'{1}'}".format(this.s.style.height,this.s.style.width)]);var e=this.selector.substring(1);$("!div."+e).each(function(e){this.style.position="absolute",0===e?(this.style.width=this.parentNode.style.width,this.style.height=this.parentNode.style.height):(this.style.width="0px",this.style.height="0px",this.style.display="none",this.style.left=this.parentNode.style.width,this.style.top=this.parentNode.style.height)}),this.s.style.position="relative",this.s.style.overflow="hidden",this.s.onmouseover=function(){$("!div."+this.id).each(function(e){$(this).animation(t[e],1)})},this.s.onmouseout=function(){$("!div."+this.id).each(function(e){$(this).animation(t[e+2],1)})}},Sparrow.prototype.show=function(){this.s.style.overflow="hidden","none"!==this.s.style.display&&0!==this.s.offsetHeight||(void 0===this.height&&(this.s.style.display="block",this.height=this.s.offsetHeight+"px",this.s.style.height="0"),this.animation("{height:'"+this.height+"'}",5))},Sparrow.prototype.hidden=function(){this.s&&(this.height||(this.height=this.s.offsetHeight+"px",this.s.style.height=this.height),0<this.s.offsetHeight&&this.animation("{height:'0px'}",5))},Sparrow.prototype.showHidden=function(e,t,i){e||(e=$(this.s.id+"_controlled")),t||(t={showText:"show",hiddenText:"hidden",showIco:"",hiddenIco:""}),i||(i={show:!0,hidden:!0}),e.style.overflow="hidden","none"===e.style.display||0===e.style.height?i.show&&("IMG"===this.s.tagName.toUpperCase()?(this.s.src=t.hiddenIco,this.s.alt=t.hiddenText):this.s.innerHTML=t.hiddenText,$(e).show()):i.hidden&&($(e).hidden(),"img"===this.s.tagName?(this.s.src=t.showIco,this.s.alt=t.showText):this.s.innerHTML=t.showText)},Sparrow.showOrHiddenTag=function(e,t,i){i||(i=document);for(var o=0;o<e.length;o++){var n=e[o],r=$("^"+n,null,i);null!==r&&0!==r.length&&r.each(function(){this.zIndex=-1,this.style.visibility=t?"visible":"hidden"})}},Sparrow.prototype.marque=function(e,t,i,o){var n=null;this.s.parentNode.style.position="relative",this.s.style.position="absolute";var r=this.s.parentNode.offsetHeight,s=this.s.offsetHeight;switch(e){case 0:if(s<=r)return;this.s.innerHTML+=this.s.innerHTML,o||(o=-3),n="{top:'"+(-s+"px")+"',start:"+o+",percent:"+t+"}"}this.animation(n,i)},Sparrow.prototype.progressbar=function(e,t){var i=$("+div");document.body.appendChild(i.s),t.style&&(i.s.style.cssText=t.style);var o=$("+div");i.s.appendChild(o.s),t.progressStyle&&(o.s.style.cssText=t.progressStyle),o.s.style.width="0px",o.it=window.setInterval(function(){e(o)},100),o.end=function(){window.clearInterval(o.it)},o.remove=function(){document.body.removeChild(o.s.parentNode)}},Sparrow.menu=function(e,t,i){this.config={current_menu:null,left_limit:-1,period:3,frameDiv:null,srcElement:null,width:300,position:{},container:null,parent:null,menu:[],list:[],children:[],brothers:[]},this.obj=e,this.menuLink=i,this.id="div"+this.obj.firstCharUpperCase(),this.position=t||"SIDE",$.global(e,this)},Sparrow.menu.prototype.side=function(){this.config.frameDiv=$("+div").s,this.config.frameDiv.onmouseover=function(e){$.event(e).cancelBubble()},document.body.appendChild(this.config.frameDiv),this.config.frameDiv.style.cssText=$.css.menu.frame.format(this.config.width,0,0);var e=[];e.push('<ul style="{0}">'.format($.css.menu.ul.format(this.config.width-2)));for(var t=0;t<this.config.menu.length;t++)e.push('<li style="{0}" {3}><a href="javascript:void(0);" onclick="{1}.itemClick({2});"  style="width:{4}px;display:inline-block;cursor:pointer"><span style="float:left">{5}</span><span  style="float:right;">{6}</span></a></li>'.format($.css.menu.li.format(this.config.width),this.obj,t,this.config.menu[t].more?'onmouseover="{0}.itemMore(this,{1});"'.format(this.obj,t):"",this.config.width,this.config.menu[t].text,this.config.menu[t].more?">>":""));e.push("</ul>"),this.config.frameDiv.innerHTML=e.join("")},Sparrow.menu.prototype.vertical=function(){if($(this.id)){var e=$("!div."+this.id),n=this.obj;e.each(function(e){var i=$.global(n),t=$("!a",this)[0];t.id=i.id+"_"+i.position+"_menu_"+e;var o=$("!ul",this)[0];o&&(o.id=t.id+"_child",i.config.position[o.id]=o.offsetHeight,o.style.display="none",o.style.height="0px",$(o).bind("onmouseover",function(e){$.event(e).cancelBubble()}),$(t).bind("onclick",function(e){$.event(e).cancelBubble();var t=$("#"+this.id+"_child");null==i.config.current_menu&&("block"===(i.config.current_menu=t).s.style.display?(t.move_end=function(){i.config.current_menu=null},t.animation("{height:'0px'}",i.config.period)):(t.s.style.display="block",t.move_end=function(){i.config.current_menu=null},t.animation("{height:'"+i.config.position[t.s.id]+"px'}",i.config.period)))}))});var t=$("#"+this.id);t.bind("onmouseover",function(e){$.event(e).cancelBubble()}),$("#"+this.menuLink).bind("onmouseover",function(e){$.event(e).cancelBubble(),t.css("marginLeft","0px")}),$(document).bind("onmouseover",function(){t.css("marginLeft","-150px")})}},Sparrow.menu.prototype.dispose=function(){this.config.frameDiv&&document.body.removeChild(this.config.frameDiv)},Sparrow.menu.prototype.hidden=function(){if(this.position===$.SIDE){if(this.config.frameDiv){this.config.frameDiv.style.display="none";for(var e=0;e<this.config.children.length;e++)this.config.children[e].hidden()}}else if(this.position===$.HORIZONTAL){var t=this;null!=this.config.current_menu&&($(this.config.current_menu.parentNode).stop(),$(this.config.current_menu.parentNode).move_end=function(){t.config.current_menu=null},$(this.config.current_menu.parentNode).animation("{height:'0px'}",this.config.period))}},Sparrow.menu.prototype.show=function(e,t){this.config.parent=t,this.config.srcElement=e;var i=0;this.config.container&&(i=this.config.container.scrollTop);var o=$(this.config.srcElement).getAbsoluteLeft();this.config.position===this.SIDE&&(o+=this.config.srcElement.offsetWidth);var n=$(this.config.srcElement).getAbsoluteTop()-i;this.config.frameDiv.style.left=o+"px",this.config.frameDiv.style.top=n-2+"px",this.config.frameDiv.style.display="block";for(var r=0;r<this.config.children.length;r++)this.config.children[r].hidden();for(r=0;r<this.config.brothers.length;r++)this.config.brothers[r].hidden()},Sparrow.menu.prototype.itemClick=function(e){alert("click:"+this.config.menu[e].text)},Sparrow.menu.prototype.itemMore=function(e,t){alert("more:"+this.config.menu[t].text)},Sparrow.menu.prototype.horizontal=function(){if($(this.id)){var e=$("!div."+this.id);this.config.menu=$("!li",e[0]),this.config.list=$("!ul",e[1]),this.config.left_limit=$("#"+this.id).getAbsoluteLeft(),null==this.config.position.height&&(this.config.position.height=30);var n=$.global(this.obj);$(document).bind("onmouseover",function(){n.hidden(this)}),this.config.menu.each(function(e){this.id=n.obj+"_"+n.position+"_menu_"+e;var t=$(n.config.list[e]);t.s.style.cssText="height:{0}px;overflow:hidden;width:{1}px;".format(t.s.offsetHeight,t.s.offsetWidth+10),t.s.id=this.id+"_child",t.bind("onmouseover",function(e){$.event(e).cancelBubble()}),$(this).bind("onmouseover",function(e){if((e=$.event(e)).cancelBubble(),"LI"===e.srcElement.tagName){var t=$(e.srcElement.id+"_child");if(null!=n.config.current_menu){if(t===n.config.current_menu)return;$(n.config.current_menu).stop()}(n.config.current_menu=t).parentNode.style.height="0";var i=$(n.id).offsetTop-$.win.getScrollTop();if(i<=0&&(i=0),t.parentNode.style.top=i+n.config.menu[0].offsetHeight-8+"px",0<t.getElementsByTagName("li").length){n.config.list.each(function(){this.style.display="none"}),t.style.display="block";var o=parseInt(e.srcElement.offsetLeft,10)-(parseInt(t.style.width,10)-e.srcElement.offsetWidth)/2;o<n.config.left_limit&&(o=n.config.left_limit),t.style.marginLeft=o+"px",$(t.parentNode).stop(),$(t.parentNode).animation("{height:'"+n.config.position.height+"px'}",n.config.period)}}})})}},Sparrow.menu.prototype.init=function(){this.position===$.SIDE?this.side():this.position===$.VERTICAL?this.vertical():this.position===$.HORIZONTAL&&this.horizontal()},Sparrow.datePicker=function(e){var t=Object();t["yyyy年MM月dd日"]=new RegExp("^(\\d{4})年(\\d{2})月(\\d{2})日$","ig"),t["yyyy-MM-dd"]=new RegExp("^(\\d{4})-(\\d{2})-(\\d{2})$","ig"),t["yyyy年MM月"]=new RegExp("^\\d{4}年\\d{2}月$","ig"),t["yyyy-MM"]=new RegExp("^\\d{4}-\\d{2}$","ig"),this.obj=e,this.currentDate=new Date,this.pickerDiv=null,this.config={format:t,srcElement:null,currentFMT:"yyyy-MM-dd",maxDaysOfMonth:[31,28,31,30,31,30,31,31,30,31,30,31],weekDay:["日","一","二","三","四","五","六"],month:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],minDate:null,allowNull:!1}},Sparrow.datePicker.prototype.isLeapYear=function(e){return 0==e%4&&(e%100!=0||e%400==0)},Sparrow.datePicker.prototype.getMaxDaysOfMonth=function(e,t){-1===t&&(t=11);var i=this.config.maxDaysOfMonth[t];return 1===t&&this.isLeapYear(e)&&(i+=1),i},Sparrow.datePicker.prototype.getFormatDate=function(e,t,i){if(void 0===t||void 0===i){var o=this.config.format[this.config.currentFMT],n=o.exec(this.config.srcElement.value);if(null==n&&(n=o.exec(this.config.srcElement.value)),null!=n){var r=n[2],s=n[3];t||(t=r-1),i||(i=s)}}return t=parseInt(t,10),(t+=1)<10&&(t="0"+t),(i=parseInt(i,10))<10&&(i="0"+i),this.config.currentFMT.replace("yyyy",e).replace("MM",t).replace("dd",i)},Sparrow.datePicker.prototype.init=function(e,t,i){if(!e){var o=this.currentDate;e=o.getFullYear(),t=o.getMonth(),i=o.getDate()}if(!this.pickerDiv){var n=$(this.config.srcElement);this.currentDate=new Date(e,t,i),this.pickerDiv=$("+div"),this.pickerDiv.s.id=this.obj,this.pickerDiv.s.style.cssText="position:absolute;display:none;text-align:center",this.pickerDiv.s.style.left=n.getAbsoluteLeft()+"px",this.pickerDiv.s.style.top=n.getAbsoluteTop()+this.config.srcElement.clientHeight+"px",this.pickerDiv.opacity(100),document.body.appendChild(this.pickerDiv.s),this.pickerDiv.s.onclick=function(e){$.event(e).cancelBubble()},this.config.srcElement.readOnly="readonly";var r=this.obj+".config.srcElement.onclick=function(e){$.event(e).cancelBubble();"+this.obj+".show();};"+this.obj+".config.srcElement.onchange=function(){"+this.obj+".validate();"+this.obj+".init();};";window.setTimeout(r,0)}var s=this.getMaxDaysOfMonth(e,t-1),a=this.getMaxDaysOfMonth(e,t),l=new Date(e,t,1).getDay(),c=s-(0===l?7:l)+1,d=[];d.push('<table class="pure-table pure-table-bordered">'),d.push("<tr>"),d.push('<td><a  href="javascript:void(0);" onclick="{0}.changeMonth(-1)">&lt;<a></td>'.format(this.obj)),d.push('<td colspan="3"><a onclick="{0}.initYear({1});" href="javascript:void(0)">{1}</a>年</td>'.format(this.obj,e)),d.push('<td colspan="2"><a onclick="{0}.initMonth({2},{3});" href="javascript:void(0);">{1}</a></td>'.format(this.obj,this.config.month[t],e,t)),d.push('<td><a  href="javascript:void(0);" onclick="{0}.changeMonth(1)">&gt;<a></td>'.format(this.obj)),d.push("</tr>"),d.push("<tr>");for(var h=0;h<7;h+=1)d.push("<td>{0}</td>".format(this.config.weekDay[h]));d.push("</tr>");var u=0;d.push("<tr>");for(var f=c;f<=s;f+=1)d.push('<td><a  style="color:#ccc;">{0}</a></td>'.format(f)),(u+=1)%7==0&&(d.push("</tr>"),d.push("<tr>"));for(var p=1;p<=a;p+=1)d.push('<td><a href="javascript:void(0);" onclick="{0}.changeDate({1},{2},{3});">{3}</a></td>'.format(this.obj,e,t,p)),(u+=1)%7==0&&(d.push("</tr>"),d.push("<tr>"));for(var g=7-u%7,m=1;m<=g;m+=1)d.push('<td><a  style="color:#ccc;">{0}</a></td>'.format(m)),(u+=1)%7==0&&(d.push("</tr>"),d.push("<tr>"));d.push("</tr>"),this.pickerDiv.s.innerHTML=d.join(""),this.config.srcElement.value=this.getFormatDate(e,t,i)},Sparrow.datePicker.prototype.show=function(){this.pickerDiv.s.style.display="block"},Sparrow.datePicker.prototype.hidden=function(){yyyy=this.currentDate.getFullYear(),MM=this.currentDate.getMonth(),dd=this.currentDate.getDate(),this.config.allowNull||""!==this.config.srcElement.value||(this.config.srcElement.value=this.getFormatDate(yyyy,MM,dd)),this.pickerDiv.s.style.display="none"},Sparrow.datePicker.prototype.initYear=function(e){var t=e-e%10;t<1900&&(t=1900);var i=t+10,o=[];o.push('<table class="pure-table pure-table-bordered">'),o.push("<tr>"),o.push('<td><a href="javascript:void(0);" onclick="{0}.initYear({1})">&lt;<a></td>'.format(this.obj,e-10)),o.push('<td colspan="2">{0}-{1}</td>'.format(t,i-1)),o.push('<td><a href="javascript:void(0);" onclick="{0}.initYear({1})">&gt;<a></td>'.format(this.obj,e<1900?1910:e+10)),o.push("</tr>"),o.push("<tr>");for(var n=0,r=t-1;r<i;r+=1)r===t-1||r===i?o.push('<td style="color:#ccc">{0}</td>'.format(r)):o.push('<td><a href="javascript:void(0);" onclick="{0}.initMonth({1})">{1}</a></td>'.format(this.obj,r)),++n%4==0&&o.push("</tr><tr>");o.push('<td style="color:#ccc">{0}</td>'.format(i)),o.push("</tr>"),o.push("</table>"),this.pickerDiv.s.innerHTML=o.join("")},Sparrow.datePicker.prototype.initMonth=function(e,t){t||(t=this.getCurrentDate().getMonth());var i=[];i.push('<table  class="pure-table pure-table-bordered">'),i.push("<tr>"),i.push('<td><a href="javascript:void(0);" onclick="{0}.initMonth({1},{2})">&lt;<a></td>'.format(this.obj,e-1,t)),i.push('<td style="text-align:center;" colspan="2"><a href="javascript:void(0);" onclick="{0}.initYear({1})">{1}</a></td>'.format(this.obj,e)),i.push('<td><a href="javascript:void(0);" onclick="{0}.initMonth({1},{2})">&gt;<a></td>'.format(this.obj,e+1,t)),i.push("</tr>"),i.push("<tr>");for(var o=0,n=0;n<12;n+=1)i.push('<td><a href="javascript:void(0);" onclick="{0}.init({1},{2},{3})">{4}</a></td>'.format(this.obj,e,n,this.currentDate.getDate(),this.config.month[n])),++o%4==0&&i.push("</tr><tr>");i.push("</tr>"),i.push("</table>"),this.pickerDiv.s.innerHTML=i.join(""),this.config.srcElement.value=this.getFormatDate(e,t)},Sparrow.datePicker.prototype.changeMonth=function(e){var t=this.getCurrentDate(),i=parseInt(t.getMonth(),10)+e,o=parseInt(t.getFullYear(),10),n=parseInt(t.getDate(),10);1===e&&12===i?(i=0,o+=1):-1===e&&-1===i&&(i=11,o-=1),this.config.srcElement.value=this.getFormatDate(o,i,n),this.init(o,i,n)},Sparrow.datePicker.prototype.changeDate=function(e,t,i){this.config.srcElement.value=this.getFormatDate(e,t,i),this.validate(e,t,i)&&(this.currentDate=new Date(e,t,i)),this.hidden()},Sparrow.datePicker.prototype.userValidate=null,Sparrow.datePicker.prototype.getCurrentDate=function(){var e=this.config.format[this.config.currentFMT],t=e.exec(this.config.srcElement.value);return null==t&&(t=e.exec(this.config.srcElement.value)),new Date(t[1],parseInt(t[2],10)-1,t[3])},Sparrow.datePicker.prototype.validate=function(e,t,i){var o=!0,n=null;if(-1===this.config.srcElement.value.search(this.config.format[this.config.currentFMT])){if(""===this.config.srcElement.value.trim()&&this.config.allowNull)return!0;$.message("请按【"+this.config.currentFMT+"】格式输入",this.config.srcElement),o=!1}else{if(!e){var r=this.getCurrentDate();e=r.getFullYear(),t=r.getMonth(),i=r.getDate()}if(e<1900||2099<e)$.m.show("年份超出范围！\n正确年份范围1900-2099",this.config.srcElement),o=!1;else if(t<0||12<t)$.m.show("月份超出范围!",this.config.srcElement),o=!1;else if(i<0||i>this.getMaxDaysOfMonth(e,t))$.m.show("日期范围超出!",this.config.srcElement),o=!1;else{if(n=new Date(e,t,i),null!=this.config.minDate){var s=new Date(this.config.minDate.getFullYear(),this.config.minDate.getMonth(),this.config.minDate.getDate());n<s&&(m.show("不允许小于"+this.getFormatDate(s.getFullYear(),s.getMonth(),s.getDate()),this.config.srcElement),o=!1)}this.userValidate&&(this.userValidate()||(o=!1))}}return o&&(this.currentDate=n),o},Sparrow.editor=function(e,t){this.obj=e,this.fullObjName=t?t+"."+e:e,this.frame=null,this.config={cover_key:"Cover",style:null,flash_thumbnail:!0,iframeId:null,titleCtrlId:"txtTitle",contentCtrlId:"hdnContent",wordCount:"spanWordCount",submitButtonId:"btnSubmit",interval:null,currentHtmlId:null,tempNodeAttribute:"i_temp_attribute",container:{id:null,maxWidth:900,minWidth:700},attach:{key:"thread",uploadedJson:"",uploadImgContainerId:e+"_uploadImgContainer",localUploadImgTabId:e+"_localUploadImgTab",index:1,uploadedIndex:0,currentUUID:null,actionUrl:null,fileUUID:e+"_fileUUID",iframeName:e+"_fileUpload",iframeId:e+".{0}",fileRemark:e+"_fileRemark",fileInfoId:e+"_fileInfo",tableId:e+"_tabAttach",formIndex:0,showImageInfo:!0,uploadingFileId:[],maxAllowCount:5},tool:{id:e+"_HtmlEditorToolBar",height:40,position:"top",icon:{backGroundColor:null,containerId:e+"_tdEditorToolBar",path:$.url.resource+"/images/sparrowEditor/"},convertHTML:{isConvert:!0,ctrlId:e+"_tdConvertHTMLID",ctrlWidth:50},adjust:{adjustable:!1,width:120},style:{simple:[2,3,4,13,14,15,16,21,22,23],comment:[21,23,22],list:[21,22,23]},toolBar:[{left:-394,top:-8,width:84,height:24,title:"字号",cmd:"fontsize",htmlFrameId:"font_size",htmlheight:315,htmlwidth:170},{left:-310,top:-8,width:82,height:24,title:"字体",cmd:"fontname",htmlFrameId:"font_family",htmlheight:360,htmlwidth:130},{left:2,top:-8,width:26,height:24,title:"加粗",cmd:"bold"},{left:-28,top:-7,width:26,height:24,title:"斜体",cmd:"italic"},{left:-56,top:-8,width:26,height:24,title:"下划线",cmd:"underline"},{left:-82,top:-8,width:26,height:24,title:"文字颜色",cmd:"forecolor",htmlFrameId:"FColor",htmlheight:308,htmlwidth:364},{left:-114,top:-8,width:26,height:24,title:"背景颜色",cmd:"BackColor",firefoxcmd:"hilitecolor",htmlFrameId:"HColor",htmlheight:308,htmlwidth:364},{split:'<img src="{0}icoBack.gif" style="background:url({0}ico.gif) -940px -8px;width:8px;height:24px;"/>'},{left:-144,top:-8,width:26,height:22,title:"左对齐",cmd:"justifyleft"},{left:-168,top:-8,width:26,height:22,title:"居中对齐",cmd:"justifycenter"},{left:-190,top:-8,width:26,height:22,title:"右对齐",cmd:"justifyright"},{left:-610,top:-8,width:92,height:22,title:"自动对齐",cmd:"justifyfull"},{split:'<img alt="" src="{0}icoBack.gif" style="background:url({0}ico.gif)-940px -8px;width:8px;height:24px;"/>'},{left:-562,top:-8,width:26,height:22,title:"编号",cmd:"InsertOrderedList"},{left:-588,top:-8,width:26,height:22,title:"项目符号",cmd:"InsertUnorderedList"},{left:-504,top:-8,width:26,height:22,title:"减少缩进",cmd:"outdent"},{left:-476,top:-8,width:26,height:22,title:"增加缩进",cmd:"indent"},{split:""},{left:-700,top:-7,width:100,height:22,title:"清除空格",cmd:"clearSpace"},{left:-536,top:-9,width:26,height:20,title:"插入横线",cmd:"inserthorizontalrule"},{left:-273,top:-3,width:34,height:34,title:"插入超链接",cmd:"hyperLink",htmlFrameId:"HyperLink",htmlheight:60,htmlwidth:400,keepStatus:!1},{left:-212,top:-3,width:34,height:34,title:"插入表情",cmd:"face",htmlFrameId:"face",htmlheight:280,htmlwidth:340},{left:-877,top:-3,width:32,height:34,title:"插入视频",cmd:"insertVideo",htmlFrameId:"video",htmlheight:120,htmlwidth:350},{left:-904,top:-3,width:34,height:34,title:"插入图片",cmd:"insertImage",htmlFrameId:"image",htmlheight:260,htmlwidth:520}],font_family:["宋体","黑体","隶书","楷体","幼圆","Arial","Impact","Georgia","Verdana","Courier New","Times New Roman"],font_size:[{size:1,name:"1|8pt"},{size:2,name:"2|10pt"},{size:3,name:"3|12pt"},{size:4,name:"4|14pt"},{size:5,name:"5|18pt"},{size:6,name:"6|24pt"},{size:7,name:"7|36pt"}],face:[{url:$.url.resource+"/images/sparrowEditor/face/01.gif",name:"呲牙"},{url:$.url.resource+"/images/sparrowEditor/face/02.gif",name:"不嘛"},{url:$.url.resource+"/images/sparrowEditor/face/03.gif",name:"哭泣"},{url:$.url.resource+"/images/sparrowEditor/face/04.gif",name:"嘟嘟"},{url:$.url.resource+"/images/sparrowEditor/face/05.gif",name:"嗯嗯"},{url:$.url.resource+"/images/sparrowEditor/face/06.gif",name:"思考下"},{url:$.url.resource+"/images/sparrowEditor/face/07.gif",name:"翻跟斗"},{url:$.url.resource+"/images/sparrowEditor/face/08.gif",name:"我靠"},{url:$.url.resource+"/images/sparrowEditor/face/09.gif",name:"扫射"},{url:$.url.resource+"/images/sparrowEditor/face/10.gif",name:"嘘!"},{url:$.url.resource+"/images/sparrowEditor/face/11.gif",name:"害羞"},{url:$.url.resource+"/images/sparrowEditor/face/12.gif",name:"眯眯"},{url:$.url.resource+"/images/sparrowEditor/face/13.gif",name:"求保佑"},{url:$.url.resource+"/images/sparrowEditor/face/14.gif",name:"晕"},{url:$.url.resource+"/images/sparrowEditor/face/15.gif",name:"来一拳"},{url:$.url.resource+"/images/sparrowEditor/face/16.gif",name:"胜利"},{url:$.url.resource+"/images/sparrowEditor/face/17.gif",name:"嚎叫"},{url:$.url.resource+"/images/sparrowEditor/face/18.gif",name:"BIBI"},{url:$.url.resource+"/images/sparrowEditor/face/19.gif",name:"哼哼"},{url:$.url.resource+"/images/sparrowEditor/face/20.gif",name:"冷汗"},{url:$.url.resource+"/images/sparrowEditor/face/21.gif",name:"泼墨"},{url:$.url.resource+"/images/sparrowEditor/face/22.gif",name:"吐血"},{url:$.url.resource+"/images/sparrowEditor/face/23.gif",name:"扣鼻子"},{url:$.url.resource+"/images/sparrowEditor/face/24.gif",name:"挠挠脸"},{url:$.url.resource+"/images/sparrowEditor/face/25.gif",name:"舔手指"},{url:$.url.resource+"/images/sparrowEditor/face/26.gif",name:"吃饭啦"},{url:$.url.resource+"/images/sparrowEditor/face/27.gif",name:"打哈欠"},{url:$.url.resource+"/images/sparrowEditor/face/28.gif",name:"拜拜"},{url:$.url.resource+"/images/sparrowEditor/face/29.gif",name:"抽一口"},{url:$.url.resource+"/images/sparrowEditor/face/30.gif",name:"杀死"}]}},this.attach={parentObject:null,setParentObject:function(e){this.parentObject=e},loadAttach:function(){var e=this.parentObject;$("#tab"+e.obj).tabs();var t=e.config.attach.uploadedJson.json();if(null!=t&&0<t.length){var i=$(e.config.attach.uploadImgContainerId);if(null==i)e.run("tool_23_"+e.obj);else if(""===i.innerHTML.trim())for(var o=t.length-1;0<=o;o--){var n=t[o].clientFileName,r=t[o].url;i.appendChild(getImgContainer(r,n,e))}}},collectFilePostInfo:function(){var e=this.parentObject;if($(e.config.attach.tableId)){for(var t=$("&"+e.config.attach.fileUUID),i=$("&"+e.config.attach.fileRemark),o=[],n=0;n<t.length;n++)t[n].value&&o.push(t[n].value+":"+i[n].value);return o.join()}return""},validate:function(e,t){return null==t||$.browser.isLogin()?$.v.getValidateResult(e,!1):($.user.login.dialog(t),!1)},_submit:function(){$(this.parentObject.config.attach.fileInfoId).value=this.parentObject.attach.collectFilePostInfo(),this.parentObject.config.attach.actionUrl?$.submit(this.parentObject.config.attach.actionUrl,this.parentObject.config.attach.formIndex):this.parentObject.config.attach.currentUUID?$.submit("update.do",this.parentObject.config.attach.formIndex):$.submit(null,this.parentObject.config.attach.formIndex)},submit:function(e,t){var i=this.parentObject;$(i.config.contentCtrlId).value=i.frame.contentWindow.document.body.innerHTML,this.validate(e,t)?this._submit():$(this.parentObject.config.submitButtonId).disabled=!1},insertEditor:function(e,t){var i=this.parentObject,o='<img title="'+e+'" src="'+t+'"/>';i.createTempNode("span"),i.getTempNode().innerHTML=o,i.removeElementById()},deleteOnServer:function(e,t){var i=this.parentObject;window.confirm($.message.deleteFile)&&$.ajax.json($.url.root+"/attach/delete.json","uuid="+fileUUID,function(e){i.attach.deleteImg($.ajax.srcElement),$.message("删除成功！")},t)},deleteImg:function(e){$(e.parentNode.parentNode.removeChild(e.parentNode)),$.file.wit&&window.clearInterval($.file.wit),$("divState")&&document.body.removeChild($("divState"))}}},Sparrow.editor.editorArray=[],Sparrow.editor.uploadUrl="http://upload.sparrowzoo.com",Sparrow.editor.prototype.$=function(e){return this.frame.contentWindow.document.getElementById(e)},Sparrow.editor.prototype.getTempNode=function(e){var t=this.$(this.config.tempNodeAttribute);if(t)return t;e=e?e.toLowerCase():$.browser.ie||$.browser.opera?"font":"span";for(var i=null,o=this.frame.contentWindow.document.getElementsByTagName(e),n=o.length-1;0<=n;n--){if("font"===e||"span"===e)i=$.browser.ie||$.browser.opera?o[n].face:o[n].style.fontFamily;else if("a"===e)try{i=o[n].href}catch(e){}if(i&&-1!==i.indexOf(this.config.tempNodeAttribute))return o[n].id=this.config.tempNodeAttribute,o[n]}},Sparrow.editor.prototype.replaceTagWithInnerHTML=function(e){if($.browser.firefox){var t=this.getRange();t.setStartBefore(e);var i=t.createContextualFragment(e.innerHTML);e.parentNode.replaceChild(i,e)}else e.outerHTML=e.innerHTML},Sparrow.editor.prototype.removeElementById=function(){var e=this.$(this.config.tempNodeAttribute);this.replaceTagWithInnerHTML(e)},Sparrow.editor.prototype.getBrief=function(){var e=null;return 300<(e=$.browser.ie?this.frame.contentWindow.document.body.innerText.substring(0,300):this.frame.contentWindow.document.body.textContent.length).length&&(e=e.substring(0,300)),e},Sparrow.editor.prototype.getEditorContent=function(){if(this.config.tool.convertHTML.isConvert){var e=document.getElementById(this.config.tool.convertHTML.ctrlId);"HTML"!==e.innerHTML&&(e.innerHTML="HTML",document.getElementById(this.config.tool.icon.containerId).style.display="block",$.browser.ie?this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.innerText:this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.textContent)}return this.clear(),"<br>"===this.frame.contentWindow.document.body.innerHTML||"<br/>"===this.frame.contentWindow.document.body.innerHTML?"":this.frame.contentWindow.document.body.innerHTML},Sparrow.editor.prototype.initContent=function(){var e=$(this.config.contentCtrlId);if(null!=e){var t=e.value;this.setEditorContent(decodeURIComponent(t))}this.attach.setParentObject(this),this.config.attach.uploadedJson=decodeURIComponent("")},Sparrow.editor.prototype.focus=function(){this.frame.contentWindow.document.body.focus()},Sparrow.editor.prototype.setEditorContent=function(e){$(this.config.contentCtrlId).value=e,null!=this.frame&&(this.frame.contentWindow.document.body.innerHTML=e,this.updateWordCount())},Sparrow.editor.prototype.setEditorText=function(e){this.frame.contentWindow.document.body.innerText=e,this.updateWordCount()},Sparrow.editor.prototype.getRange=function(){return this.frame.contentWindow.document.body.focus(),$.browser.ie?this.frame.contentWindow.document.selection.createRange():this.frame.contentWindow.getSelection().getRangeAt(0)},Sparrow.editor.prototype.m_over=function(e){this.config.tool.icon.backGroundColor=e.style.backgroundColor,e.style.backgroundColor="#595959",e.style.cursor="pointer"},Sparrow.editor.prototype.m_out=function(e){e.style.backgroundColor=this.config.tool.icon.backGroundColor},Sparrow.editor.prototype.m_down=function(e){var t=e.id.split("_")[1];e.style.background="url("+this.config.tool.icon.path+"ico.gif) "+(this.config.tool.toolBar[t].left+1)+"px "+(this.config.tool.toolBar[t].top+1)+"px"},Sparrow.editor.prototype.m_up=function(e){var t=e.id.split("_")[1];e.style.background="url("+this.config.tool.icon.path+"ico.gif) "+this.config.tool.toolBar[t].left+"px "+this.config.tool.toolBar[t].top+"px",this.run(e.id)},Sparrow.editor.prototype.clearTag=function(e){for(var t=this.frame.contentWindow.document.getElementsByTagName(e),i=t.length-1;0<=i;i--)""===t[i].innerHTML&&t[i].parentNode.removeChild(t[i])},Sparrow.editor.prototype.clear=function(){this.clearTag("span"),this.clearTag("font"),this.clearTag("div"),this.clearTag("p");try{this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.innerHTML.replace(/&nbsp;+/g," ").replace(/(<br>|<br\/>)+/g,"<br/>")}catch(e){}for(var e=this.getTempNode()||this.getTempNode("a");e;)"a"==e.tagName.toLowerCase()&&-1==e.href.indexOf(this.config.tempNodeAttribute)?e.removeAttribute("id"):this.removeElementById(),e=this.getTempNode()||this.getTempNode("a")},Sparrow.editor.prototype.createTempNode=function(e){e||(e="a");var t=this.getRange();if(""==($.browser.ie?t.text:t)){var i=document.createElement(e);"a"==e?i.href=this.config.tempNodeAttribute:i.id=this.config.tempNodeAttribute,$.browser.ie?(i.innerHTML=t.text,t.pasteHTML(i.outerHTML)):t.surroundContents(i)}else e&&"a"!=e.toLowerCase()?this.frame.contentWindow.document.execCommand("fontname",!1,this.config.tempNodeAttribute):this.frame.contentWindow.document.execCommand("createLink",!1,this.config.tempNodeAttribute)},Sparrow.editor.prototype.findTagNode=function(e){e=e.toLowerCase();var t=null,i=null;try{var o=this.getRange();if($.browser.ie)i=o.item?o.item(0):o.parentElement();else if(o.startContainer.getElementsByTagName){var n=o.startContainer.getElementsByTagName(e);i=0<n.length?n[0]:o.startContainer}else i=o.startContainer}catch(e){}if(i.nodeName.toLowerCase()===e)t=i;else for(;"body"!==i.nodeName.toLowerCase();){if(i.nodeName.toLowerCase()===e){t=i;break}i=i.parentNode}return t&&(t.id=this.config.tempNodeAttribute),t},Sparrow.editor.prototype.run=function(e){var t=$(e);key=t.id.split("_")[1],this.frame.contentWindow.focus(),0==key||1==key||5==key||6==key||20==key||21==key||22==key||23==key||24==key?(clearHtmlFrame(),this.show(t,key,this.config.tool.toolBar[key].htmlwidth,this.config.tool.toolBar[key].htmlheight)):18==key?(this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.innerHTML.replace(/&nbsp;+/g," ").replace(/(<br>|<br\/>)+/g,"<br/>"),this.clear()):this.frame.contentWindow.document.execCommand(this.config.tool.toolBar[key].cmd,!1,void 0),this.frame.contentWindow.focus()},Sparrow.editor.prototype.callBackRun=function(e,t){var i=(t=t||window.event).srcElement||t.target;switch(e){case 21:this.insertHyperLink();break;case 22:this.insertFace(i);break;case 23:if(0==this.insertVideo())return;break;default:var o=i.title,n=this.config.tool.toolBar[e].cmd;this.config.tool.toolBar[e].firefoxcmd&&(n=$.browser.ie?this.config.tool.toolBar[e].cmd:this.config.tool.toolBar[e].firefoxcmd),this.frame.contentWindow.document.execCommand(n,!1,o)}var r=document.getElementById(this.config.currentHtmlId);document.body.removeChild(r),this.config.currentHtmlId=null},Sparrow.editor.prototype.show=function(e,t,i,o){var n=$(e);this.config.currentHtmlId&&(document.getElementById(this.config.currentHtmlId).style.display="none",this.config.currentHtmlId=null);var r=this.obj+"_"+this.config.tool.toolBar[t].htmlFrameId,s=document.getElementById(r);s||((s=document.createElement("DIV")).id=r,document.body.appendChild(s)),s.style.cssText="display:block;position:absolute;width:"+i+"px;height:0px;border:#595959 1px solid;background:#ffffff; padding:1px;text-align:center;",s.onclick=function(e){$.event(e).cancelBubble()};var a=n.getAbsoluteLeft()-(i-e.offsetWidth)/2,l=$(e.parentNode).getAbsoluteLeft();a<l&&(a=l),s.style.left=a+"px",s.style.top=n.getAbsoluteTop()+e.offsetHeight+"px",this.config.interval=window.setInterval(this.fullObjName+".intervalShow("+t+","+o+")",10)},Sparrow.editor.prototype.intervalShow=function(e,t){var i=document.getElementById(this.obj+"_"+this.config.tool.toolBar[e].htmlFrameId),o=i.clientHeight+15;t<=o?(window.clearInterval(this.config.interval),""!=i.innerHTML.trim()&&0!=this.config.tool.toolBar[e].keepStatus||(i.innerHTML=this.getHtml(e)),20==e?$(this.obj+"_txtURL").focus():22==e?$(this.obj+"_txtVideo").focus():23==e&&(this.attach.setParentObject(this),this.attach.loadAttach(this.config.attach.key)),this.config.currentHtmlId=i.id):i.style.height=o+"px"},Sparrow.editor.prototype.getHtml=function(e){var t=[];switch(e){case 0:t.push('<ul style="list-style-type:none;text-align:left;margin:0;padding:0;">');for(var i=0;i<this.config.tool.font_size.length;i++)t.push('<li unselectable="on" onclick="'+this.fullObjName+".callBackRun("+e+',event);" style="border-bottom:#ccc 1px dotted;padding:5px;cursor:pointer;font-size:'+this.config.tool.font_size[i].name.split("|")[1]+';width:auto;" title="'+Math.round(this.config.tool.font_size[i].size)+'">'+this.config.tool.font_size[i].name+"</li>");t.push("</ul>");break;case 1:for(t.push('<ul style="line-height:25px; list-style-type:none;margin:0;padding:0;">'),i=0;i<this.config.tool.font_family.length;i++)t.push('<li unselectable="on" onclick="'+this.fullObjName+".callBackRun("+e+',event);" title="'+this.config.tool.font_family[i]+'" style="border:#ccc 1 dotted;padding:3px;cursor:pointer;font-family:'+this.config.tool.font_family[i]+'">'+this.config.tool.font_family[i]+"</li>");t.push("</ul>");break;case 5:case 6:var o=["00","33","66","99","cc","ff"],n=0;for(i=0;i<6;i+=1)for(var r=0;r<6;r+=1)for(var s=0;s<6;s+=1){var a="#"+o[i]+o[r]+o[s];t.push('<img src="'+this.config.tool.icon.path+'icoBack.gif" onclick="'+this.fullObjName+".callBackRun("+e+',event); " title="'+a+'" style="background:'+a+';width:20px;height:20px;cursor:pointer"/>'),(n+=1)%18==0&&t.push("<br/>")}break;case 20:var l=this.findTagNode("a"),c="",d=!1;null!=l?(c=l.href.substring(7),d=!0):this.createTempNode("a"),t.push('<label>链接地址</label><input class="pure-input-1" onkeyup="if(this.value.substring(0,7)!=\'http://\'){this.value=\'http://\'}" value="http://'+c+'" type="text" id="'+this.obj+'_txtURL" />  <input class="pure-button pure-button-primary" type="button" value="确定" id="ok" onclick="if(document.getElementById(\''+this.obj+"_txtURL').value=='http://'&&"+!d+"){alert('请输入正确的url地址');}else{"+this.fullObjName+'.callBackRun(21,event);}" />');break;case 21:this.createTempNode("span");var h=Math.ceil(this.config.tool.face.length/6);t.push('<table style="width:'+this.config.tool.toolBar[e].htmlwidth+'px; border-collapse:collapse;" id="divFace" cellpadding="1" cellspacing="0">');n=0;for(i=0;i<h;i++){for(t.push("<tr>"),r=0;r<6;r++)n<this.config.tool.face.length?t.push('<td><img style="cursor: pointer;" title="'+this.config.tool.face[n].name+'" src="'+this.config.tool.face[n].url+'" onclick="'+this.fullObjName+'.callBackRun(22,event);" /></td>'):t.push("<td></td>"),n++;t.push("</tr>")}t.push("</table>");break;case 22:this.createTempNode("span"),t.push('<label>FLASH视频URL</label><input class="pure-input-rounded" id="'+this.obj+'_txtVideo" type="text"/><br/><span id="'+this.obj+'_spanVideoErrorMessage"></span><br/>'),t.push('<input value="插入视频" class="pure-button pure-button-primary" type="button" onclick="'+this.fullObjName+'.callBackRun(23,event);"/>');break;case 23:this.createTempNode("span"),t.push('<div  id="tab'+this.obj+'" class="tab">'),t.push('<div class="pure-menu pure-menu-horizontal">'),t.push('<ul class="pure-menu-list" style="width: 100%;">'),t.push('<li class="pure-menu-item pure-menu-selected">'),t.push('<a target="_self" href="javascript:void(0);" class="pure-menu-link">'),t.push("<span>本地图片</span>"),t.push("</a>"),t.push("</li>"),t.push('<li class="pure-menu-item">'),t.push('<a target="_self" href="javascript:void(0);" class="pure-menu-link">'),t.push("<span>网络图片</span>"),t.push("</a>"),t.push("</li>"),t.push("</ul>"),t.push("</div>"),t.push('<div class="tab-content">'),t.push('<div id="'+this.config.attach.key+this.config.attach.localUploadImgTabId+'" class="block">'),t.push('<div style="width:100%;height:auto;overflow:hidden;padding:2px;" id="'+this.config.attach.uploadImgContainerId+'"></div>'),t.push('<iframe name="'+this.config.attach.iframeName+'" id="'+this.config.attach.iframeId.format(this.config.attach.key)+'" class="file-frame" frameborder="0"'),t.push(' src="'+$.editor.uploadUrl+"/file-upload?path-key="+this.config.attach.key+"&editor="+this.fullObjName+'"></iframe><br/>'),t.push("</div>"),t.push('<div class="none">'),t.push('图片URL:<input style="width:300px;" id="'+this.obj+'_txtImage" type="text"/><br/><span id="'+this.obj+'_spanImageErrorMessage"></span><br/>'),t.push('<input value="插入图片" type="button" onclick="'+this.fullObjName+'.insertImage();"/>'),t.push("</div>"),t.push("</div>"),t.push("</div>")}return t.join("")},Sparrow.editor.prototype.adjust=function(t,i){try{if("width"===t){var e=parseInt(i.value);e>this.config.container.maxWidth?(alert("编辑器最大宽度:"+this.config.container.maxWidth+"px"),i.value=this.config.container.maxWidth+"px"):e<this.config.container.minWidth&&(alert("编辑器最小宽度:"+this.config.container.minWidth+"px"),i.value=this.config.container.minWidth+"px"),document.getElementById(this.config.container.id).style.width=i.value;var o=parseInt(i.value)-this.config.tool.convertHTML.ctrlWidth;this.config.tool.adjust.adjustable&&(o-=this.config.tool.adjust.width),document.getElementById(this.config.tool.id).style.width=i.value,document.getElementById(this.config.tool.id).style.width=o}else document.getElementById(this.config.container.id).style.height=i.value}catch(e){i.value="width"===t?document.getElementById(this.config.container.id).style.width:document.getElementById(this.config.container.id).style.height}this.autoAdjust(document.getElementById(this.config.iframeId))},Sparrow.editor.prototype.autoAdjust=function(e){var t=parseInt(document.getElementById(this.config.container.id).style.height),i=document.getElementById(this.config.tool.id).clientHeight+10;e.style.height=t-i},Sparrow.editor.prototype.convertHTML=function(e){this.clear(),"HTML"===e.innerHTML?(e.innerHTML="返回",e.title="返回所见即所得模式",document.getElementById(this.config.tool.icon.containerId).style.display="none",$.browser.ie?this.frame.contentWindow.document.body.innerText=this.frame.contentWindow.document.body.innerHTML:this.frame.contentWindow.document.body.textContent=this.frame.contentWindow.document.body.innerHTML):(e.innerHTML="HTML",document.getElementById(this.config.tool.icon.containerId).style.display="block",$.browser.ie?this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.innerText:this.frame.contentWindow.document.body.innerHTML=this.frame.contentWindow.document.body.textContent)},Sparrow.editor.prototype.insertVideo=function(){var e=!1,t=document.getElementById(this.obj+"_txtVideo").value,i=$(this.obj+"_spanVideoErrorMessage");if(""===t.trim())i.className="error",i.innerHTML="请输入视频地址<br/>例:http://player.youku.com/player.php/sid/sparrow/v.swf";else if(-1===t.search(/^[http:\/\/][^<]*\.swf[^<]*/))i.className="error",i.innerHTML="请输入正确的视频地址。例:http://player.youku.com/player.php/sid/sparrow/v.swf";else{var o,n=this.getTempNode(),r=document.getElementById(this.obj+"_txtVideo").value,s=this;this.config.flash_thumbnail?$.ajax.json($.url.root+"/attach/getFlashThumbnail.json","parameter="+encodeURIComponent(r),function(e){o=e.message,n?(n.innerHTML=o,s.removeElementById()):s.frame.contentWindow.document.body.innerHTML+=o}):(o='<embed src="{0}" quality="high" wmode="opaque" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="500" height="500"/>'.format(r),n?(n.innerHTML=o,this.removeElementById()):this.frame.contentWindow.document.body.innerHTML+=o),e=!0}return e},Sparrow.editor.prototype.insertImage=function(){var t=document.getElementById(this.obj+"_txtImage").value,e=$(this.obj+"_spanImageErrorMessage");if(""===t.trim())e.className="error",e.innerHTML="请输入图片地址<br/>例:"+$.url.resource+"/img.jpg<br/>格式限制:gif|jpg|png";else if(-1==t.search(/^http:\/\/.*?\.(jpg|gif|png)$/))e.className="error",e.innerHTML="请输入图片地址<br/>例:"+$.url.resource+"/img.jpg<br/>格式限制:gif|jpg|png";else{var i=this;$.ajax.json($.url.root+"/attach/downloadInternetPic.json","imageUrl="+t,function(e){$(i.config.attach.uploadImgContainerId).appendChild(getImgContainer(e.message,t,i)),i.attach.insertEditor($.file.getFileName(t),e.message)})}},Sparrow.editor.prototype.insertFace=function(e){var t=this.getTempNode();if(t)return t.innerHTML='<img src="'+e.src+'"/>',$(this.config.titleCtrlId)&&""===$(this.config.titleCtrlId).value&&($(this.config.titleCtrlId).value=e.title),void this.removeElementById();this.frame.contentWindow.document.execCommand("insertImage",!1,e.src)},Sparrow.editor.prototype.insertHyperLink=function(){var e=this.getTempNode("a"),t=document.getElementById(this.obj+"_txtURL").value;e&&("http://"===t?window.confirm("您确认要取消链接吗?")&&this.removeElementById():(""===e.innerHTML&&(e.innerHTML=t),e.removeAttribute("id"),e.setAttribute("target","blank"),e.setAttribute("href",t)))},Sparrow.editor.prototype.initialize=function(e){$.global(this.obj,this),$.editor.editorArray.push(this),this.config.container.id=e;var t="iframe"+$.random();if(this.config.iframeId=t,document.getElementById(e).innerHTML="top"==this.config.tool.position?this.initTool()+this.initEditor(t):this.initEditor(t)+this.initTool(),this.frame=document.getElementById(t),this.frame.contentWindow.document.open(),this.frame.contentWindow.document.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'),this.frame.contentWindow.document.write('<html><body id="'+this.obj+'" style="width:100%;height:{0}px;" contenteditable="true"></body></html>'.format($(t).offsetHeight)),this.frame.contentWindow.document.close(),$.browser.ie)return this.frame.contentWindow.document.onclick=clearHtmlFrame,void(this.frame.contentWindow.document.onkeyup=this.updateWordCount);try{this.frame.contentWindow.document.addEventListener("click",clearHtmlFrame,!0),this.frame.contentWindow.document.addEventListener("keyup",this.updateWordCount,!0)}catch(e){}},Sparrow.editor.prototype.initTool=function(){var e=0,t=[],i=null;if(t.push('<div class="pure-u-18-24" id="'+this.config.tool.icon.containerId+'" style="text-align:left;">'),null!=this.config.style){"simple"===this.config.style?i=this.config.tool.style.simple:"comment"===this.config.style?i=this.config.tool.style.comment:"thread"===this.config.style&&(i=this.config.tool.style.list);for(var o=0;o<i.length;o++)e=i[o],void 0!==this.config.tool.toolBar[e].split?t.push(this.config.tool.toolBar[e].split.format(this.config.tool.icon.path)):(t.push('<img id="tool_'+e+"_"+this.obj+'" src="'+this.config.tool.icon.path+'icoBack.gif"'),t.push(' title="'+this.config.tool.toolBar[e].title),t.push('" style="background:url(\''+this.config.tool.icon.path+"ico.gif') "),t.push(this.config.tool.toolBar[e].left+"px "+this.config.tool.toolBar[e].top+"px;width:"+this.config.tool.toolBar[e].width+"px;height:"+this.config.tool.toolBar[e].height+'px"'),t.push(' onmouseover="'+this.fullObjName+'.m_over(this);" onmouseout="'+this.fullObjName+'.m_out(this);" onmousedown="'+this.fullObjName+'.m_down(this);" onmouseup="'+this.fullObjName+'.m_up(this);"'),t.push("/>"))}else for(var e in this.config.tool.toolBar)void 0!==this.config.tool.toolBar[e].split?t.push(this.config.tool.toolBar[e].split.format(this.config.tool.icon.path)):(t.push('<img id="tool_'+e+'" src="'+this.config.tool.icon.path+'icoBack.gif"'),t.push(' title="'+this.config.tool.toolBar[e].title),t.push('" style="background:url(\''+this.config.tool.icon.path+"ico.gif') "),t.push(this.config.tool.toolBar[e].left+"px "+this.config.tool.toolBar[e].top+"px;width:"+this.config.tool.toolBar[e].width+"px;height:"+this.config.tool.toolBar[e].height+'px"'),t.push(' onmouseover="'+this.fullObjName+'.m_over(this);" onmouseout="'+this.fullObjName+'.m_out(this);" onmousedown="'+this.fullObjName+'.m_down(this);" onmouseup="'+this.fullObjName+'.m_up(this);"'),t.push("/>"));if(t.push("</div>"),this.config.tool.convertHTML.isConvert&&t.push('<div align="center" id="'+this.config.tool.convertHTML.ctrlId+'" class="pure-u-2-24" " onclick="'+this.fullObjName+'.convertHTML(this);">HTML</div>'),this.config.tool.adjust.adjustable){var n=document.getElementById(this.config.container.id);t.push('<div align="center" title="在此调整编辑器大小。鼠标离开即生效。" class="pure-u-4-24 pure-form pure-form-aligned" '+this.config.tool.adjust.width+'px;"><input onblur="'+this.fullObjName+'.adjust(\'width\',this);" style="height: 30px;" placeholder="width" class="pure-input-rounded pure-input-1" type="text" value="'+n.style.width+'"/><input onblur="'+this.fullObjName+'.adjust(\'height\',this);" style="height: 30px;" placeholder="height" class="pure-input-rounded pure-input-1" type="text" value="'+n.style.height+'"/></div>')}return'<div class="pure-g tool-bar" id="'+this.config.tool.id+'" style="border-bottom:#ccc 1px solid; width:'+document.getElementById(this.config.container.id).style.width+';height:auto;">'+t.join("")+"</div>"},Sparrow.editor.prototype.initEditor=function(e){return document.domain=$.browser.cookie.root_domain,'<iframe onload="'+this.fullObjName+".autoAdjust(this);"+this.fullObjName+'.initContent();" class="'+e+'" id="'+e+'" name="'+e+'" style="background:#ffffff;width: 100%;height:'+(document.getElementById(this.config.container.id).offsetHeight-this.config.tool.height-2)+'px;scrollbar-face-color: #F7F5F4;" frameborder="0" marginheight="0" marginwidth="0" src="about:blank"></iframe>'},Sparrow.editor.prototype.updateWordCount=function(){var e=this.obj||this.body.id,t=$.global(e);$(t.config.wordCount)&&($(t.config.wordCount).innerHTML=t.frame.contentWindow.document.body.innerHTML.length)},$(document).bind("onclick",function(){clearHtmlFrame()}),Sparrow.editor.prototype.initImageUploadEvent=function(o){o||(o=this.config.cover_key),$.file.validateUploadFile=function(e,t,i){$.file.checkFileType($.file.getFileName(e.value),["jpg","jpeg","gif","png","zip"],"error"+o)&&($.file.uploadCallBack=function(e,t){$.file.clearStatus();var i=e.clientFileName;""!==i&&($(t.config.attach.uploadImgContainerId).appendChild(getImgContainer(e.fileUrl,i,t)),t.attach.insertEditor($.file.getFileName(i),e.fileUrl))},$.file.uploadDelegate(t,i))}},Sparrow.treeNode=function(e,t,i,o,n,r,s,a,l,c){this.id=e,this.pid=t,this.name=i,this.url=o,this.title=n,this.target=r,this.showCtrl=a||!0,this.businessEntity=l,this.childCount=s||0,this.icon=c,this.iconOpen=c,this._isOpened=!1,this._isSelected=!1,this._lastOfSameLevel=!1,this._addressIndex=0,this._parentNode,this._hasChild=0<s},Sparrow.tree=function(e,t){this.config={target:"_self",useFolderLinks:!0,useSelection:!0,useCookies:!0,useLines:!0,useIcons:!0,useRootIcon:!0,usePlusMinusIcons:!0,useMouseover:!0,useTreeIdInNodeClass:!1,useLevelInNodeClass:!1,useRadio:!1,useCheckbox:!1,treeNodeClass:null,reBuildTree:null,loadFloatTree:null,floatTreeId:null,descHiddenId:null,descTextBoxId:null,validate:null,validateConfig:null,isValue:!1,isdelay:!1,isclientDelay:!1,closeSameLevel:!1,inOrder:!1,showRootIco:!0,showOrder:!1,orderURL:null,treeFrameId:null,loadingString:"londing .....",imageDir:$.url.resource+"/images/treeimg",RESOURCE_TYPE:{1:"[系统菜单]",2:"[系统页面]",3:"[控件事件]"}},this.icon={root:this.config.imageDir+"/base.gif",folder:this.config.imageDir+"/folder.gif",folderOpen:this.config.imageDir+"/folderopen.gif",node:this.config.imageDir+"/page.gif",nolineNode:this.config.imageDir+"/nolinepage.gif",empty:this.config.imageDir+"/empty.gif",line:this.config.imageDir+"/line.gif",join:this.config.imageDir+"/join.gif",joinBottom:this.config.imageDir+"/joinbottom.gif",plus:this.config.imageDir+"/plus.gif",plusBottom:this.config.imageDir+"/plusbottom.gif",minus:this.config.imageDir+"/minus.gif",minusBottom:this.config.imageDir+"/minusbottom.gif",nlPlus:this.config.imageDir+"/nolines_plus.gif",nlMinus:this.config.imageDir+"/nolines_minus.gif"},this.interval=null,this.currentSelectId={},this.floatTreeFrameId=null,this.obj=e,this.parentName=t,this.fullObjName=t?t+"."+e:e,this.aNodes=[],this.aIndent=[],this.root=new Sparrow.treeNode(-1),this.selectedNodeIndex=null,this.selectedFound=!1,this.completed=!1},Sparrow.tree.prototype={resetIcon:function(){this.icon.root=this.config.imageDir+"/base.gif",this.icon.nolineroot=this.config.imageDir+"/nolinebase.gif",this.icon.folder=this.config.imageDir+"/folder.gif",this.icon.folderOpen=this.config.imageDir+"/folderopen.gif",this.icon.node=this.config.imageDir+"/page.gif",this.icon.nolineNode=this.config.imageDir+"/nolinepage.gif",this.icon.empty=this.config.imageDir+"/empty.gif",this.icon.line=this.config.imageDir+"/line.gif",this.icon.join=this.config.imageDir+"/join.gif",this.icon.joinBottom=this.config.imageDir+"/joinbottom.gif",this.icon.plus=this.config.imageDir+"/plus.gif",this.icon.plusBottom=this.config.imageDir+"/plusbottom.gif",this.icon.minus=this.config.imageDir+"/minus.gif",this.icon.minusBottom=this.config.imageDir+"/minusbottom.gif",this.icon.nlPlus=this.config.imageDir+"/nolines_plus.gif",this.icon.nlMinus=this.config.imageDir+"/nolines_minus.gif"},addBusinessEntity:function(e,t,i,o,n,r){this.aNodes[this.aNodes.length]=new Sparrow.treeNode(e,t,i,o,n,"_self",void 0,!0,r)},add:function(e,t,i,o,n,r,s,a,l,c){this.aNodes[this.aNodes.length]=new Sparrow.treeNode(e,t,i,o,n,r,s,a,l,c)},openAll:function(){this.oAll(!0)},closeAll:function(){this.oAll(!1)},toString:function(){var e='<div class="sparrow-tree">';return document.getElementById?(this.config.useCookies&&(this.selectedNodeIndex=this.getSelectedAi()),e+=this.addNode(this.root)):e+="Browser not supported.</div>",this.selectedFound||(this.selectedNodeIndex=null),this.completed=!0,e},deleteClick:function(){alert("deleteClick not defined!")},removeNode:function(e){e||(e=this.aNodes[this.getSelectedAi()]),this.aNodes.splice(e._addressIndex,1),this.clearSelectedNode(),$(this.config.treeFrameId).innerHTML=this.toString(),this.clearFloatFrame()},appendNode:function(e){this.aNodes.push(e),$(this.config.treeFrameId).innerHTML=this.toString()},updateNode:function(e,t){t||(t=this.aNodes[this.getSelectedAi()]),t.pid!=e.pid?(this.removeNode(t),this.appendNode(e)):this.aNodes[this.getSelectedAi()]=e,$(this.config.treeFrameId).innerHTML=this.toString()},showOrder:function(e){if(this.config.showOrder){var t=$("orderDiv");t&&document.body.removeChild(t);var i=$.event(e).srcElement,o=$(i,!1),n=i.id.substring(this.obj.length+1),r=this.aNodes[n];if(-1!=r.pid){t=$("+div.orderDiv"),document.body.appendChild(t.s),t.class("pure-menu pure-order-menu"),t.css("position","absolute"),t.html('<span class="pure-menu-heading pure-menu-link pure-order-menu-heading" onclick="{0}.delete_click({1});{0}.clearFloatFrame();" >删除</span><ul class="pure-menu-list"><li class="pure-menu-item"><a href="#" class="pure-menu-link">当前第<span id="currentOrderNo"></span>位</a></li><li class="pure-menu-item pure-menu-has-children"><a  id="hyperJump" class="pure-menu-link">你可以跳转至</a> <ul id="ulChildrenList" class="pure-menu-children"></ul></li></ul>'.format(this.fullObjName,n)),t.bind("onclick",function(e){$.event(e).cancelBubble()}),$("#hyperJump",!1).bind("onmouseover",function(){$("#ulChildrenList",!1).css("display","block")}),t.css("left",o.getAbsoluteLeft()+i.offsetWidth+"px"),t.css("top",o.getAbsoluteTop()+i.offsetHeight+"px");for(var s=r._parentNode,a=0,l=0,c="",d=0;d<this.aNodes.length;d++)if(this.aNodes[d].pid==s.id)if(this.aNodes[d].id!=r.id){if(a++,c+='<li class="pure-menu-item" onclick="{0}.order({1},{2})"><a href="#" class="pure-menu-link">第<span>{2}</span>位</a></li>'.format(this.fullObjName,n,a),this.aNodes[d]._lastOfSameLevel)break}else l=++a;$("#ulChildrenList",!1).html(c),$("#currentOrderNo",!1).html(l)}else this.clearFloatFrame()}},order:function(r,s){var a=this.aNodes[r],e=($("currentOrderNo").innerHTML,"id="+a.id+"&sort="+s),l=this,c=this.aNodes;$.ajax.json(this.config.orderURL,e,function(e){for(var t=(a=c[r])._parentNode,i=0,o=0,n=0;n<c.length;n++)if(c[n].pid==t.id&&++i==s){c[o=n];break}c.splice(r,1),c.splice(o,0,a),$("#"+l.config.treeFrameId).html(l),l.clearFloatFrame()})},addNode:function(e){var t="",i=0;for(this.config.inOrder&&(i=e._addressIndex);i<this.aNodes.length;i++)if(null!=this.aNodes[i]&&this.aNodes[i].pid==e.id){var o=this.aNodes[i];if((o._parentNode=e).childCount++,o._addressIndex=i,this.setCS(o),!o.target&&this.config.target&&(o.target=this.config.target),o._hasChild&&!o._io&&this.config.useCookies&&(o._isOpened=this.isOpen(o.id)),!this.config.useFolderLinks&&o._hasChild&&(o.url=null),this.config.useSelection&&o.id==this.getSelectedId()&&(o._isSelected=!0,this.selectedNodeIndex=i,this.selectedFound=!0),this.config.showRootIco?t+=this.node(o,i):this.node(o,i),o._lastOfSameLevel)break}return t},select:function(e,t){null!=this.current&&(this.current.className=$(this.current).attr("old")),$(e).attr("old",e.className),e.className="iTreeNodeSelect"+t,this.current=e},node:function(e,t){var i="";this.config.treeNodeClass?i+=this.config.treeNodeClass:this.config.useTreeIdInNodeClass&&(i+=this.obj.substring(0,1).toUpperCase()+this.obj.substring(1)),this.config.useLevelInNodeClass&&(i+=1<this.aIndent.length?3:this.aIndent.length+1);var o='<div onclick="'+this.fullObjName+".select(this,'"+i+"');\"";return(this.config.useRootIcon||e.pid!=this.root.id)&&(o+=' class="iTreeNode'+i+'"'),o+='id="node'+this.obj+t+'"  >'+this.indent(e,t),this.config.useIcons&&(this.config.useLines?(e.icon=this.root.id==e.pid?this.icon.root:e._hasChild?this.icon.folder:this.icon.node,e.iconOpen=this.root.id==e.pid?this.icon.root:e._hasChild?this.icon.folderOpen:this.icon.node):e.icon||(e.iconOpen=e.icon=e._hasChild?this.icon.nolinefolder:this.icon.nolinenode),(this.config.useRootIcon||e.pid!=this.root.id)&&(o+="<img "+(this.config.showOrder?' onmouseover="'+this.fullObjName+'.showOrder(event)"':"")+' id="i'+this.obj+t+'" src="'+(e._isOpened?e.iconOpen:e.icon)+'" alt="" align="absMiddle"/>'),(e.showCtrl&&-1!=e.pid||-1==e.pid&&1==this.userRootIcon)&&(this.config.useRadio&&(o+='<input style="line-height:15px;height:15px;border:0;" type="radio" name="iTreerdb" id="r{1}{0}" onclick="{1}.getRadioSelected({0});{1}.s({0});" value="{2}"/>'.format(t,this.fullObjName,e.id)),1==this.config.useCheckbox&&(o+='<input style="line-height:15px;height:15px;border:0;" type="checkbox" name="iTreecbx" id="c{1}{0}" onclick="{1}.selectCheckbox({0});" value="{2}"/>'.format(t,this.fullObjName,e.id)))),e.url?(o+='<a ondblclick="javascript:'+this.fullObjName+".dbs("+t+');" id="s'+this.obj+t+'" class="'+(this.config.useSelection&&e._isSelected?"nodeSel":"node")+'" href="'+e.url+'"',e.title&&(o+=' title="'+e.title+'"'),e.target&&(o+=' target="'+e.target+'"'),this.config.useSelection&&(e._hasChild&&this.config.useFolderLinks||!e._hasChild)&&(o+=' onclick="javascript: '+this.fullObjName+".s("+t+");"),o+=(this.config.usePlusMinusIcons?"":e._hasChild&&-1!=e._parentNode.id?this.fullObjName+".o("+t+")":"")+'">'):this.config.useFolderLinks&&e.url||!e._hasChild||e.pid==this.root.id||(o+='<a href="javascript: '+this.fullObjName+".o("+t+');" class="node">'),o+='<span id="ntext'+this.obj+t+'">'+e.name+"</span>",!e.url&&(this.config.useFolderLinks&&e.url||!e._hasChild)||(o+="</a>"),o+="</div>",e._hasChild&&(o+='<div id="d'+this.obj+t+'" class="clip" style="display:'+(this.root.id==e.pid||e._isOpened?"block":"none")+';">',this.config.isdelay||this.config.isclientDelay?(e._isOpened&&-1!=e.pid||-1==e.pid)&&(o+=this.addNode(e)):o+=this.addNode(e),o+="</div>"),this.aIndent.pop(),o},indent:function(e,t){var i="";if(this.root.id!=e.pid){for(var o=0;o<this.aIndent.length;o++)i+='<img src="'+(1==this.aIndent[o]&&this.config.useLines?this.icon.line:this.icon.empty)+'" alt="" />';e._lastOfSameLevel?this.aIndent.push(0):this.aIndent.push(1),this.config.usePlusMinusIcons?e._hasChild?(i+='<a href="javascript: '+this.fullObjName+".o("+t+');"><img id="j'+this.obj+t+'" src="',this.config.useLines?i+=e._isOpened?e._lastOfSameLevel&&this.config.useLines?this.icon.minusBottom:this.icon.minus:e._lastOfSameLevel&&this.config.useLines?this.icon.plusBottom:this.icon.plus:i+=e._isOpened?this.icon.nlMinus:this.icon.nlPlus,i+='"/></a>'):i+='<img id="j'+this.obj+t+'" src="'+(this.config.useLines?e._lastOfSameLevel?this.icon.joinBottom:this.icon.join:this.icon.empty)+'" alt="" />':i+='<img style="width:0;height:0;" id="j'+this.obj+t+'"/>'}return i},setCS:function(e){var t=null;e._hasChild=!1,e._lastOfSameLevel=!1;for(var i=0;i<this.aNodes.length;i++)0==this.config.isdelay&&null!=this.aNodes[i]&&this.aNodes[i].pid==e.id&&(e._hasChild=!0),null!=this.aNodes[i]&&this.aNodes[i].pid==e.pid&&(t=this.aNodes[i].id);t==e.id&&(e._lastOfSameLevel=!0)},getAllNameOfNode:function(e,t){e||(e=this.aNodes[this.getSelectedAi()]);for(var i=[];-1!=e.id&&!$.isNullOrEmpty(e.name);)-1!=e.name.indexOf(":")?i.push(e.name.split(":")[1]):i.push(e.name),e=e._parentNode?e._parentNode:this.aNodes[this.getAiById(e.pid)];return t=t||"  ",i.reverse(),i.join(t)},getSelectedAi:function(){return this.getAiById(this.getSelectedId())},getSelectedId:function(){return(1==this.config.useCookies?this.getCookie("currentSelect"+this.obj):this.currentSelectId["currentSelect"+this.obj])||null},clearSelectedNode:function(){var e=new Date,t=new Date(e.getTime()-864e5);this.setCookie("cs"+this.obj,"cookieValue",t),this.currentSelectId["currentSelect"+this.obj]=null},setCurrentSelectNode:function(e){this.config.useCookies?this.setCookie("currentSelect"+this.obj,e.id):this.currentSelectId["currentSelect"+this.obj]=e.id},s:function(e){if(this.config.useSelection){var t=this.aNodes[e];if(!t._hasChild||this.config.useFolderLinks){if(this.selectedNodeIndex!=e&&((this.selectedNodeIndex||0==this.selectedNodeIndex)&&(eOld=document.getElementById("s"+this.obj+this.selectedNodeIndex),this.aNodes[this.selectedNodeIndex]._isSelected=!1,eOld&&(eOld.className="node")),eNew=document.getElementById("s"+this.obj+e),eNew.className="nodeSel",this.selectedNodeIndex=e,t._isSelected=!0,this.setCurrentSelectNode(t)),document.getElementById("r"+this.obj+e)&&(document.getElementById("r"+this.obj+e).checked=!0,this.getRadioSelected(e)),document.getElementById("c"+this.obj+e)){var i=document.getElementById("c"+this.obj+e);i.checked=!i.checked,this.selectCheckbox(e)}this.config.closeSameLevel&&this.closeLevel(t)}}},delayOpen:function(e){var r=this,s=e,t=e._addressIndex;if(0==s._isOpened){var a=document.getElementById("d"+this.obj+t);if(null!=a&&""==a.innerHTML){var i="ay=true&nodeId="+s.id;$("exceptid").value&&(i+="&exceptid="+$("exceptid").value),ajax.req("POST",this.config.ajaxURL,function(e){if(""!=e.responseText){var t=e.responseText.json();openNodeCallBack(t);for(var i=s,o=[];-1!=i.pid;)o[o.length]=i._lastOfSameLevel?0:1,i=i._parentNode;for(var n=o.length-1;0<=n;n--)r.aIndent.push(o[n]);a.innerHTML=r.addNode(s);for(n=0;n<o.length;n++)r.aIndent.pop()}},!0,i)}}},clientDelayOpen:function(e,t){var i=e,o=e._addressIndex;if(0==i._isOpened||t){var n=document.getElementById("d"+this.obj+o);if(null!=n&&""==n.innerHTML||t){for(var r=i,s=[];r._parentNode.id!=this.root.id;)s[s.length]=r._lastOfSameLevel?0:1,r=r._parentNode;for(var a=s.length-1;0<=a;a--)this.aIndent.push(s[a]);n.innerHTML=this.addNode(i);for(a=0;a<s.length;a++)this.aIndent.pop()}}},o:function(e){var t=this.aNodes[e];this.config.isdelay&&this.delayOpen(t),this.config.isclientDelay&&this.clientDelayOpen(t),this.nodeStatus(!t._isOpened,e,t._lastOfSameLevel),t._isOpened=!t._isOpened,this.config.closeSameLevel&&this.closeLevel(t),this.config.useCookies&&this.updateCookie()},oAll:function(e){for(var t=0;t<this.aNodes.length;t++)null!=this.aNodes[t]&&this.aNodes[t]._hasChild&&this.aNodes[t].pid!=this.root.id&&(this.nodeStatus(e,t,this.aNodes[t]._lastOfSameLevel),this.aNodes[t]._isOpened=e);this.config.useCookies&&this.updateCookie()},getAiById:function(e){for(var t=0;t<this.aNodes.length;t++)if(null!=this.aNodes[t]&&this.aNodes[t].id==e)return t;return null},openTo:function(e,t){if(t||(e=this.getAiById(e)),null!=e){var i=this.aNodes[e];if(this.config.delay)for(var o=[];-1!=i._parentNode.pid;)o.push(i),i=i._parentNode;else{if(i.pid==this.root.id||!i._parentNode)return;i._isOpened=!0,this.completed&&i._hasChild&&this.nodeStatus(!0,i._addressIndex,i._lastOfSameLevel),this.openTo(i._parentNode._addressIndex,!0)}}},closeLevel:function(e){for(var t=0;t<this.aNodes.length;t++)null!=this.aNodes[t]&&this.aNodes[t].pid==e.pid&&this.aNodes[t].id!=e.id&&this.aNodes[t]._hasChild&&(this.nodeStatus(!1,t,this.aNodes[t]._lastOfSameLevel),this.aNodes[t]._isOpened=!1,this.closeAllChildren(this.aNodes[t]))},closeAllChildren:function(e){for(var t=0;t<this.aNodes.length;t++)null!=this.aNodes[t]&&this.aNodes[t].pid==e.id&&this.aNodes[t]._hasChild&&(this.aNodes[t]._isOpened&&this.nodeStatus(!1,t,this.aNodes[t]._lastOfSameLevel),this.aNodes[t]._isOpened=!1,this.closeAllChildren(this.aNodes[t]))},nodeStatus:function(e,t,i){eDiv=document.getElementById("d"+this.obj+t),eJoin=document.getElementById("j"+this.obj+t),this.config.usePlusMinusIcons?(eIcon=document.getElementById("i"+this.obj+t),this.config.useIcons&&(eIcon.src=e?this.aNodes[t].iconOpen:this.aNodes[t].icon),eJoin.src=this.config.useLines?e?i?this.icon.minusBottom:this.icon.minus:i?this.icon.plusBottom:this.icon.plus:e?this.icon.nlMinus:this.icon.nlPlus):eJoin.src=this.icon.empty,eDiv.style.display=e?"block":"none"},clearCookie:function(){var e=new Date,t=new Date(e.getTime()-864e5);this.setCookie("co"+this.obj,"cookieValue",t),this.setCookie("cs"+this.obj,"cookieValue",t)},setCookie:function(e,t,i,o,n,r){document.cookie=escape(e)+"="+escape(t)+(i?"; expires="+i.toGMTString():"")+(o?"; path="+o:"")+(n?"; domain="+n:"")+(r?"; secure":"")},getCookie:function(e){var t="",i=document.cookie.indexOf(escape(e)+"=");if(-1!=i){var o=i+(escape(e)+"=").length,n=document.cookie.indexOf(";",o);t=-1!=n?unescape(document.cookie.substring(o,n)):unescape(document.cookie.substring(o))}return t},updateCookie:function(){for(var e="",t=0;t<this.aNodes.length;t++)null!=this.aNodes[t]&&this.aNodes[t]._isOpened&&this.aNodes[t].pid!=this.root.id&&(e&&(e+="."),e+=this.aNodes[t].id);this.setCookie("currentOpen"+this.obj,e)},isOpen:function(e){for(var t=this.getCookie("currentOpen"+this.obj).split("."),i=0;i<t.length;i++)if(t[i]==e)return!0;return!1},getAllId:function(){for(var e=[],t=0;t<this.aNodes.length;t++)e.push(this.aNodes[t].id);return e},getAllParentNode:function(){var e=this.aNodes[this.getSelectedAi()],t=[];if(e)for(;-1!=e.id;)t.push(e.id),e=e._parentNode;else t.push(0);return t},selectChilds:function(e,t,i){pids=[];for(var o=0;o<i;o++)-1!=e.indexOf(this.aNodes[o].pid)&&0!=this.aNodes[o].showCtrl&&(document.getElementById("c"+this.obj+o).checked=t,pids.push(this.aNodes[o].id));0!=pids.length&&this.selectChilds(pids,t,i)},getRadioSelected:function(){return null},selectCheckbox:function(e){var t=this.aNodes[e],i=null;if(null==t.selectChild||1==t.selectChild){if(i=document.getElementById("c"+this.obj+e).checked)for(var o,n=t;-1!=n.id;)(o=document.getElementById("c"+this.obj+n._addressIndex))&&(o.checked=!0),n=n._parentNode;for(var r=this.aNodes.length,s=[],a=0;a<r;a++)a!=e&&null!=this.aNodes[a]&&this.aNodes[a].pid==t.id&&0!=this.aNodes[a].showCtrl&&(document.getElementById("c"+this.obj+a).checked=i,s.push(this.aNodes[a].id));0!=s.length&&this.selectChilds(s,i,r)}this.checkBoxClick&&this.checkBoxClick(t.id,i)},setChecked:function(e){"string"==typeof e&&(e=e.split(","));for(var t=document.getElementsByName("iTreecbx"),i=0;i<t.length;i++)-1!=e.indexOf(t[i].value)&&(t[i].checked=!0)},getAllCheckedTitle:function(){for(var e=[],t=document.getElementsByName("iTreecbx"),i=0;i<t.length;i++)1==t[i].checked&&(arrayIndex=t[i].id.replace("c"+this.obj,""),e.push(this.aNodes[arrayIndex].title));return e},getAllChecked:function(){for(var e=[],t=document.getElementsByName("iTreecbx"),i=0;i<t.length;i++)1==t[i].checked&&(arrayIndex=t[i].id.replace("c"+this.obj,""),e.push(this.aNodes[arrayIndex]));return e},getAllCheckedId:function(){for(var e=[],t=document.getElementsByName("iTreecbx"),i=0;i<t.length;i++)1==t[i].checked&&e.push(t[i].value);return e.join()},show:function(e,t,i){if(!this.floatTreeFrameId){this.config.reBuildTree&&this.config.reBuildTree(),""==$(this.config.floatTreeId).innerHTML.trim()&&void 0!==this.config.loadFloatTree&&this.config.loadFloatTree();var o=$.event(e).srcElement,n=$(o),r=document.createElement("DIV");r.id=this.config.floatTreeId+"Frame",r.style.cssText="position:absolute;width:"+t+"px;height:0px;border:#ccc 1px solid;background:#ffffff; padding:1px;text-align:left;overflow:auto;",r.innerHTML=this.config.loadingString,document.body.appendChild(r),r.onclick=function(e){$.event(e).cancelBubble()},r.style.left=n.getAbsoluteLeft()+1+"px",r.style.top=n.getAbsoluteTop()+o.offsetHeight+"px",this.interval=window.setInterval(this.fullObjName+".intervalShow("+i+")",10)}},intervalShow:function(e){var t=this.config.floatTreeId+"Frame",i=$(t).clientHeight+15;if(e<=i){if(this.floatTreeFrameId=t,$(this.config.floatTreeId)&&""!=$(this.config.floatTreeId).innerHTML){var o=$(this.config.floatTreeId);$(t).innerHTML="",o.style.display="block",$(t).appendChild(o),window.clearInterval(this.interval)}}else $(t).style.height=i+"px"},clearFloatFrame:function(){if(this.floatTreeFrameId){var e=$(this.floatTreeFrameId);if(!this.config.reBuildTree){var t=$(this.config.floatTreeId);t.style.display="none",document.body.appendChild(t)}document.body.removeChild(e),this.floatTreeFrameId=null,window.clearInterval(this.interval)}$("orderDiv")&&document.body.removeChild($("orderDiv"))},initResourceTree:function(e,t){t||(t=$.url.root+"/resource/load-all.json"),this.initCodeToolip(e,t);var o=this;this.config.loadFloatTree=function(){$.ajax.json(t,e,function(e){var t=e.data||e.message;o.aNodes=[],o.resetIcon(),o.config.usePlusMinusIcons=!1,o.config.useRootIcon=!1,o.add(t[0].parentId,-1,""),o.resetIcon();for(var i=0;i<t.length;i++)$.isNullOrEmpty(t[i].icoUrl)&&(t[i].icoUrl=$.DEFAULT_RESOURCE_ICO_URL),o.add(t[i].id,t[i].parentId,t[i].name,"javascript:"+o.fullObjName+".codeNodeClick("+(i+1)+");",t[i].name,void 0,void 0,void 0,t[i],t[i].icoUrl);$(o.config.floatTreeId).innerHTML=o})}},initCodeToolip:function(codePrefix,ajaxUrl){var htmlEvents="$('#'+{0}.config.descTextBoxId).bind('onchange',function(){if($({0}.config.descTextBoxId).value==''){$({0}.config.descHiddenId).value='';if(typeof({0}.config.valueTextBoxId)!='undefined'){$({0}.config.valueTextBoxId).value='';$({0}.config.valueTextBoxId).readOnly='readonly';}}});".format(this.fullObjName);eval(htmlEvents);var treeObject=this;if(null==$(treeObject.config.floatTreeId)){var floatTree=$("+div").s;floatTree.id=treeObject.config.floatTreeId,floatTree.className="floatTree",document.body.appendChild(floatTree)}ajaxUrl||(ajaxUrl=$.url.root+"/code/load.json"),this.dbs=function(e){var t=this.aNodes[e].businessEntity;if(null!=this.config.descHiddenId&&($(this.config.descHiddenId).value=t.code),null!=this.config.descTextBoxId){var i=$(this.config.descTextBoxId);"text"===i.type?i.value=this.getAllNameOfNode(this.aNodes[e],"/"):i.innerHTML=this.getAllNameOfNode(this.aNodes[e],"/")}null!=this.config.valueTextBoxId&&($(this.config.valueTextBoxId).value=t.value),this.codeNodeCallBack&&this.codeNodeCallBack(this.aNodes[e]),this.clearFloatFrame(),this.config.validate?this.config.validate():this.config.validateConfig&&$.v.isNull(this.config.validateConfig,i)},treeObject.config.loadFloatTree=function(){ajax.json(ajaxUrl,"loadOption="+codePrefix,function(e){var t=e.data||e.message;treeObject.aNodes=[],treeObject.resetIcon(),treeObject.config.usePlusMinusIcons=!1,treeObject.config.useRootIcon=!1,treeObject.add(t[0].parentId,-1,"");for(var i=0;i<t.length;i++)treeObject.add(t[i].id,t[i].parentId,t[i].name,"javascript:"+treeObject.fullObjName+".codeNodeClick("+(i+1)+");",t[i].code+"|"+t[i].name,void 0,void 0,void 0,t[i]);$(treeObject.config.floatTreeId).innerHTML=treeObject})}},codeNodeClick:function(e){0==this.aNodes[e].childCount&&this.dbs(e)}},Sparrow.dispatcher={builder:{id:"id",delegate:"delegate",api:"api",strategy:"strategy",eventName:"eventName"},commandAdapter:{},ctrlIdEventMap:{},eventRegistry:[],register:function(e){this.eventRegistry.push(e)},dispatcher:function(e,t){var i=t.id+"_"+t.value,o=this.commandAdapter[i],n=null;null!=o&&(n=o.delegate),null==n&&null!=(o=this.commandAdapter[t.id])&&(n=o.delegate),null!=o&&null!=n&&(o.api?$.ajax.json(o.api,o.parameter,n,t):n(e,t))},bind:function(){for(var e=0;e<this.eventRegistry.length;e++){var t=this.eventRegistry[e],i=t.strategy,o=t.eventName,n=t.id+(i?"_"+i:"");this.commandAdapter[n]=t,this.ctrlIdEventMap[t.id]=o||"onclick"}for(ctrlId in this.ctrlIdEventMap)$("#"+ctrlId).bind(this.ctrlIdEventMap[ctrlId],function(e){Sparrow.dispatcher.dispatcher(e,$.event(e).srcElement)})}},Sparrow.metricChart=function(e,t,i){this.container=e,this.chartId=t,this.config=i},Sparrow.metricChart.prototype.init=function(e){var t=document.getElementById(this.chartId);null==t&&((t=document.createElement("div")).id=this.chartId,t.style.height=this.config.height,this.container.appendChild(t));var i=e.init(t),o={title:{text:""},tooltip:{trigger:"axis"},legend:{data:[]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{feature:{saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:[]},yAxis:{type:"value"},series:[]};o.title.text=this.config.title,o.legend.data=this.config.legend,o.series=this.config.data,o.xAxis.data=this.config.x,i.setOption(o,!0),Sparrow.metricChart.containers,Sparrow.metricChart.charts[this.chartId]=i,Sparrow.metricChart.options[this.chartId]=o},Sparrow.metricChart.charts={},Sparrow.metricChart.options={},Sparrow.metricChart.changeType=function(e,t){for(var i=Sparrow.metricChart.charts[e],o=Sparrow.metricChart.options[e],n=0;n<o.series.length;n++)o.series[n].type=t;i.setOption(o,!0)},Sparrow.user={authorMap:null,author:null,login:{dialog:function(e,t){var i=$.url.passport+"/login-dialog?register=false&callback-ns="+e;$.isNullOrEmpty(t)||(i+="&parameter="+t),document.domain=$.browser.cookie.root_domain,$.window({url:i,showHead:!1})},ns_callback:{publish:"thread.publish",attention:"user.attention",cancel_attention:"user.attention.cancel",comment:"thread.comment",upload:"upload",like_thread:"thread.like"}},getZone:function(e){return $.url.root+"/zone-"+e},getAvatar:function(e){return e||$.DEFAULT_AVATOR_URL},editable:function(e){var t=$.browser.getUserId();return!(t<=0)&&e===t},initLoginBar:function(){if($("divAccount")){if($.browser.isLogin()){$("divAccount").style.display="block",$("divLogin").style.display="none";var e=$("hyperUser");return $(e).html($.browser.getUserName()),e.title=$.browser.getUserName(),void(e.href=$.user.getZone($.browser.getUserId()))}$("divAccount").style.display="none",$("divLogin").style.display="block"}},popup:function(e,t){var i=null==this.authorMap?this.author:this.authorMap[t],o=$("divUserInfo");null==o&&((o=$("+div.divUserInfo")).s.style.cssText="border: #ccc 1px solid; position: absolute; width:300px; height:120px; background: #ffffff;overflow: hidden;",o.s.onmouseover=function(e){console.log("user info  mouse over ..."),$.event(e).cancelBubble()},document.body.appendChild(o.s)),$("divUserInfo").style.top=$(e).getAbsoluteTop()-2+"px",$("divUserInfo").style.left=$(e).getAbsoluteLeft()-2+"px";var n=[];n.push('<table style="border: 0;background:#fff;" cellpadding="0" cellspacing="0">'),n.push("<tr>"),n.push('<td style="border: 0; width:60px;" valign="top">'),n.push('<a href="{0}" target="_blank"><img style="width:50px; height: 50px; border: 2px #EDEDED solid;" src="{1}" /></a>'.format(this.getZone(i.id),this.getAvatar(i.avatar))),n.push("</td>"),n.push('<td style="border: 0; width: 240px; line-height: 25px;text-align:left;">'),n.push('昵称:<a href="{2}" target="_blank"><span>{0}</span></a>{1}<br />'.format(i.name,"attention",this.getZone(i.id))),n.push("性别:<span>{0}</span><br />".format(i.gender)),i.createTime&&n.push("注册日期:<span>{0}</span><br />".format(i.createTime)),i.lastLoginTime&&n.push("最后登陆:<span>{0}</span><br />".format(i.lastLoginTime)),$.isNullOrEmpty(i.status)||n.push("状态：<span>{0}</span><br />".format(i.status)),$("divUserInfo").innerHTML=n.join(""),$("#divUserInfo").show(),document.onmouseover=function(e){$("#divUserInfo").hidden()}},json:function(e){var t=$(e);return null!=t&&(e=t.value.json()),e},initAuthor:function(e){this.author=this.json(e)},initAuthorMap:function(e){this.authorMap=this.json(e)},attention:function(){return!1}},Sparrow.share={config:{icon:$.url.resource+"/images/share.png",share:[{url:"http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?style=202&width=80&height=31&showcount=1&url={0}&title={1}&pics={2}&desc={3}&summary={4}&site="+encodeURIComponent($.browser.getCookie($.browser.cookie.website_name))+"&otype=share",position:{left:160,top:0},title:"分享到QQ空间"},{url:"http://service.weibo.com/share/share.php?appkey=318168823&url={0}&title={1}&pic={2}&ralateUid=3199233727",position:{left:0,top:0},title:"分享到新浪微博"}]},init:function(){for(var e=document.getElementsByName("share"),t=[],i=0;i<this.config.share.length;i++)t.push('<a target="_blank" style="height:32px;width:32px;display:inline-block;background:url({0}) {1}px {2}px;" title="{3}" href="{4}"></a>'.format(this.config.icon,this.config.share[i].position.left,this.config.share[i].position.top,this.config.share[i].title,this.config.share[i].url));shareTemplate=t.join("");for(var o=e.length-1;0<=o;o--){var n=e[o].value.json();e[o].parentNode.innerHTML=shareTemplate.format(encodeURIComponent(n.url),encodeURIComponent(n.title),encodeURIComponent(n.pic),encodeURIComponent(n.comment),encodeURIComponent(n.summary))}}},"function"==typeof define&&define.amd&&define("Sparrow",[],function(){return Sparrow}),noGlobal||(window.Sparrow=window.$=Sparrow),Sparrow});
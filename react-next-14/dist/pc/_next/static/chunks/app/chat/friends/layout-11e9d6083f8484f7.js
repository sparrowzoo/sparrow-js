(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8324],{99589:function(e,t,r){Promise.resolve().then(r.bind(r,42289))},66648:function(e,t,r){"use strict";r.d(t,{default:function(){return s.a}});var n=r(55601),s=r.n(n)},87138:function(e,t,r){"use strict";r.d(t,{default:function(){return s.a}});var n=r(231),s=r.n(n)},55601:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return c},getImageProps:function(){return a}});let n=r(99920),s=r(80497),i=r(38173),u=n._(r(21241));function a(e){let{props:t}=(0,s.getImgProps)(e,{defaultLoader:u.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}}let c=i.Image},42289:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var n=r(57437),s=r(2265),i=r(78411),u=r(87138),a=r(95189),c=r(91429);function o(e){let{qun:t}=e,r="".concat(a.Y4,"/chat/friends/group?groupId=").concat(t.qunId),s=t.avatar;return(0,n.jsxs)("div",{className:"flex items-center text-left",children:[(0,n.jsx)(u.default,{href:r,children:(0,n.jsx)(c.r,{className:"w-16 h-16 rounded-full mr-4",quality:40,src:s,alt:"Group head",width:50,height:50})}),(0,n.jsx)("div",{children:(0,n.jsxs)(u.default,{href:r,children:[(0,n.jsx)("strong",{children:t.qunName}),(0,n.jsx)("br",{}),(0,n.jsx)("span",{children:t.nationality})]})})]})}var l=r(21292),d=r(8713);function h(e){let{contact:t}=e,r="/avatar/".concat(t.userId,".jpg"),s=l.Z.create121Session(d.Z.getCurrentUser(),new d.Z(t.userId+"",d.Z.CATEGORY_REGISTER)).key(),i="".concat(a.Y4,"/chat/sessions/session?sessionKey=").concat(s);return(0,n.jsxs)("div",{className:"flex items-center text-left",children:[(0,n.jsx)(u.default,{href:i,children:(0,n.jsx)(c.r,{src:r,alt:"header",width:50,height:50,className:"w-16 h-16 rounded-full mr-4"})}),(0,n.jsx)("div",{children:(0,n.jsxs)(u.default,{href:i,children:[(0,n.jsxs)("strong",{children:[t.userName,"-",t.userId]}),(0,n.jsx)("br",{}),(0,n.jsx)("span",{children:t.nationality})]})})]})}function f(e){var t,r;let{children:a}=e,c=(0,s.useContext)(i.D).messageBroker,[l,d]=(0,s.useState)();return(0,s.useEffect)(()=>{c.getContactGroup().then(e=>{d(e)})},[c]),(0,n.jsxs)("div",{className:"flex flex-row",children:[(0,n.jsxs)("div",{className:"w-[20rem] flex flex-col p-2 gap-4 border-gray-300",children:[(0,n.jsx)("div",{className:"bg-cyan-500 text-white p-2 rounded-xl cursor-pointer",children:(0,n.jsx)(u.default,{href:"/chat",children:"联系人"})}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:null==l?void 0:null===(t=l.contacts)||void 0===t?void 0:t.map(e=>(0,n.jsx)(h,{contact:e},e.userId+""))}),(0,n.jsx)("div",{className:"bg-cyan-500 text-white p-2 rounded-xl cursor-pointer",children:(0,n.jsx)(u.default,{href:"/chat/friends/group",children:"群聊"})}),(0,n.jsx)("div",{className:"flex flex-col gap-2",children:null==l?void 0:null===(r=l.quns)||void 0===r?void 0:r.map(e=>(0,n.jsx)(o,{qun:e},e.qunId+""))})]}),(0,n.jsx)("div",{className:"flex-1 border-2 border-gray-300",children:a})]})}},95189:function(e,t,r){"use strict";r.d(t,{B1:function(){return u},Ee:function(){return n},Y4:function(){return c},Yo:function(){return o},_k:function(){return a},lg:function(){return s},oT:function(){return i}});let n="user_info",s="http://www.sparrowzoo.com",i="SESSION",u="sparrow-token",a="SESSION",c="http://www.sparrowzoo.com/react",o="ws://www.sparrowzoo.com/websocket"},32384:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});class n{static bytes2ArrayBuffer(e){let t=new Uint8Array(e.length);for(let r=0;r<t.length;r++)t[r]=e[r];return t}static str2Buffer(e){if("undefined"==typeof TextEncoder){let t,r=[];for(let n=0;n<e.length;n++)(t=e.charCodeAt(n))>=65536&&t<=1114111?(r.push(t>>18&7|240),r.push(t>>12&63|128),r.push(t>>6&63|128),r.push(63&t|128)):t>=2048&&t<=65535?(r.push(t>>12&15|224),r.push(t>>6&63|128),r.push(63&t|128)):t>=128&&t<=2047?(r.push(t>>6&31|192),r.push(63&t|128)):r.push(255&t);return n.bytes2ArrayBuffer(r)}return new TextEncoder().encode(e)}static number2Buffer(e){var t=[],r=length=4;do t[--r]=255&e,e>>=8;while(r);return n.bytes2ArrayBuffer(t)}static appendBytes(e,t,r){return e.set(t,r),r+t.byteLength}readString(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s="",i=n?2:1;for(let u=0;u<r;u+=i)s+=String.fromCharCode(n?e.getUint16(t+u,!0):e.getUint8(t+u));return s}}},91429:function(e,t,r){"use strict";r.d(t,{r:function(){return a}});var n=r(57437);r(2265);var s=r(66648),i=r(95189);function u(e){let t="".concat(e.src);return t.startsWith("http://")||(t="".concat(i.Y4,"/").concat(t)),(0,n.jsx)(s.default,{className:e.className,loader:e=>{let{src:t,width:r,quality:n}=e;return"".concat(t,"?w=").concat(r,"&q=").concat(n||75)},src:t,alt:e.alt,width:e.width,height:e.height,quality:e.quality||75})}function a(e){return(0,n.jsx)(u,{className:e.className,src:e.src,alt:e.alt,width:e.width,height:e.height,quality:e.quality||75})}},78411:function(e,t,r){"use strict";r.d(t,{D:function(){return i},t:function(){return s}});var n=r(2265);class s{static create(e){return new s(e)}newReference(){return new s(this.messageBroker)}closeWebSocket(){var e;null===(e=this.messageBroker)||void 0===e||e.closeWebSocket()}constructor(e){this.messageBroker=e}}let i=(0,n.createContext)(null)},17892:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});class n{}n.TEXT_MESSAGE=0,n.IMAGE_MESSAGE=1,n.CHAT_TYPE_1_TO_1=0,n.CHAT_TYPE_GROUP=1,n.HORIZON_LINE="-"},21292:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(17892),s=r(8713);class i{get chatType(){return this._chatType}set chatType(e){this._chatType=e}get id(){return this._id}set id(e){this._id=e}static create121Session(e,t){let r=new i;return r.chatType=n.Z.CHAT_TYPE_1_TO_1,r.id=r.generateKey(e,t),r}static createSession(e,t){let r=new i;return r.chatType=e,r.id=t,r}static parse(e){if(null==e)return null;let t=new i,r=parseInt(e.substring(0,1),10),n=e.substring(1);return t._chatType=r,t.id=n,t}static createGroupSession(e){let t=new i;return t.chatType=n.Z.CHAT_TYPE_GROUP,t.id=e,t}isGroup(){return this._chatType==n.Z.CHAT_TYPE_GROUP}isOne2One(){return this._chatType==n.Z.CHAT_TYPE_1_TO_1}getOppositeUser(){let e=s.Z.getCurrentUser();if(null==e||this._chatType===n.Z.CHAT_TYPE_GROUP)return null;let t=this.id.substring(0,1),r=this.id.substring(1,2),i=parseInt(this.id.substring(2,4),10),u=this.id.substring(4,4+i),a=this.id.substring(4+i),c=new s.Z(u,parseInt(t,10)),o=new s.Z(a,parseInt(r,10));return c.equals(e)?o:c}toBytes(){return new TextEncoder().encode(this._chatType+this.id)}key(){return this.chatType+this.id}generateKey(e,t){if(null==e||null==t)return"";let r=e,n=t;e.id<=t.id&&(r=t,n=e);let s=(r.id+"").length,i=s+"";return s<10&&(i="0"+s),r.category+""+n.category+i+r.id+n.id}}},8713:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(32384),s=r(95189);class i{get id(){return this._id}get category(){return this._category}static fromBytes(e,t){let r=e.buffer,n=e.getUint8(t);t+=1;let s=new Uint8Array(r.slice(t,t+n));return t+=n,{chatUser:new i(new TextDecoder().decode(s),e.getUint8(t)),offset:t+1}}static parse(e){let t=e.split("_");return 2!=t.length?null:new i(t[0],Number(t[1]))}static getCurrentUser(){let e=sessionStorage.getItem(s.Ee);if(!e)return null;let t=JSON.parse(e);return new i(t.userId,t.category)}getCategoryName(){return this._category==i.CATEGORY_VISITOR?"访客":this._category==i.CATEGORY_REGISTER?"注册用户":"未知"}key(){return this._id+"_"+this._category}equals(e){return null!=e&&this._id==e.id&&this._category==e.category}toBytes(){let e=n.Z.str2Buffer(this._id+""),t=new Uint8Array([this._category]),r=new Uint8Array(1+e.byteLength+1),s=e.byteLength,i=0;return i=n.Z.appendBytes(r,new Uint8Array([s]),i),i=n.Z.appendBytes(r,e,i),n.Z.appendBytes(r,t,i),r}constructor(e,t){this._id=e,this._category=t}}i.CATEGORY_VISITOR=0,i.CATEGORY_REGISTER=1}},function(e){e.O(0,[8173,231,2971,7023,1744],function(){return e(e.s=99589)}),_N_E=e.O()}]);
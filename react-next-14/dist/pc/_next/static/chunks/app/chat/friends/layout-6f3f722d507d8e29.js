(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8324],{99589:function(t,e,r){Promise.resolve().then(r.bind(r,64308))},66648:function(t,e,r){"use strict";r.d(e,{default:function(){return s.a}});var n=r(55601),s=r.n(n)},87138:function(t,e,r){"use strict";r.d(e,{default:function(){return s.a}});var n=r(231),s=r.n(n)},20357:function(t,e,r){"use strict";var n,s;t.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(s=r.g.process)?void 0:s.env)?r.g.process:r(88081)},88081:function(t){!function(){var e={229:function(t){var e,r,n,s=t.exports={};function i(){throw Error("setTimeout has not been defined")}function u(){throw Error("clearTimeout has not been defined")}function c(t){if(e===setTimeout)return setTimeout(t,0);if((e===i||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(r){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:i}catch(t){e=i}try{r="function"==typeof clearTimeout?clearTimeout:u}catch(t){r=u}}();var o=[],a=!1,l=-1;function d(){a&&n&&(a=!1,n.length?o=n.concat(o):l=-1,o.length&&h())}function h(){if(!a){var t=c(d);a=!0;for(var e=o.length;e;){for(n=o,o=[];++l<e;)n&&n[l].run();l=-1,e=o.length}n=null,a=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===u||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function f(t,e){this.fun=t,this.array=e}function p(){}s.nextTick=function(t){var e=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];o.push(new f(t,e)),1!==o.length||a||c(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=p,s.addListener=p,s.once=p,s.off=p,s.removeListener=p,s.removeAllListeners=p,s.emit=p,s.prependListener=p,s.prependOnceListener=p,s.listeners=function(t){return[]},s.binding=function(t){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(t){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},r={};function n(t){var s=r[t];if(void 0!==s)return s.exports;var i=r[t]={exports:{}},u=!0;try{e[t](i,i.exports,n),u=!1}finally{u&&delete r[t]}return i.exports}n.ab="//";var s=n(229);t.exports=s}()},55601:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t,e){for(var r in e)Object.defineProperty(t,r,{enumerable:!0,get:e[r]})}(e,{default:function(){return o},getImageProps:function(){return c}});let n=r(99920),s=r(80497),i=r(38173),u=n._(r(21241));function c(t){let{props:e}=(0,s.getImgProps)(t,{defaultLoader:u.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[t,r]of Object.entries(e))void 0===r&&delete e[t];return{props:e}}let o=i.Image},64308:function(t,e,r){"use strict";r.r(e),r.d(e,{default:function(){return y}});var n=r(57437),s=r(2265),i=r(78411),u=r(87138),c=r(95189),o=r(91429),a=r(21292),l=r(8713);function d(t){let{contact:e}=t,r="/avatar/".concat(e.userId,".jpg"),s=a.Z.create121Session(l.Z.getCurrentUser(),new l.Z(e.userId+"",l.Z.CATEGORY_REGISTER)).key(),i="".concat(c.Y4,"/chat/sessions/session?sessionKey=").concat(s);return(0,n.jsxs)("div",{className:"flex items-center text-left",children:[(0,n.jsx)(u.default,{href:i,children:(0,n.jsx)(o.r,{src:r,alt:"header",width:50,height:50,className:"w-16 h-16 rounded-full mr-4"})}),(0,n.jsx)("div",{children:(0,n.jsxs)(u.default,{href:i,children:[(0,n.jsxs)("strong",{children:[e.userName,"-",e.userId]}),(0,n.jsx)("br",{}),(0,n.jsx)("span",{children:e.nationality})]})})]})}var h=r(5166);function f(t){var e;return t.contacts?0===t.contacts.length?(0,n.jsx)("div",{className:"text-center text-gray-500",children:"快去加好友去"}):(0,n.jsx)("div",{className:"flex flex-col gap-2",children:null==t?void 0:null===(e=t.contacts)||void 0===e?void 0:e.map(t=>(0,n.jsx)(d,{contact:t},t.userId+""))}):(0,n.jsx)(h.Z,{})}function p(t){let{qun:e}=t,r="".concat(c.Y4,"/chat/friends/group?groupId=").concat(e.qunId),s=e.avatar;return(0,n.jsxs)("div",{className:"flex items-center text-left",children:[(0,n.jsx)(u.default,{href:r,children:(0,n.jsx)(o.r,{className:"w-16 h-16 rounded-full mr-4",quality:40,src:s,alt:"Group head",width:50,height:50})}),(0,n.jsx)("div",{children:(0,n.jsxs)(u.default,{href:r,children:[(0,n.jsx)("strong",{children:e.qunName}),(0,n.jsx)("br",{}),(0,n.jsx)("span",{children:e.nationality})]})})]})}function g(t){var e;return t.quns?0===t.quns.length?(0,n.jsx)("div",{className:"text-center text-gray-500",children:"暂无群组"}):(0,n.jsx)("div",{className:"flex flex-col gap-2",children:null==t?void 0:null===(e=t.quns)||void 0===e?void 0:e.map(t=>(0,n.jsx)(p,{qun:t},t.qunId+""))}):(0,n.jsx)(h.Z,{})}function y(t){let{children:e}=t,r=(0,s.useContext)(i.D).messageBroker,[c,o]=(0,s.useState)();return(0,s.useEffect)(()=>{r.getContactGroup().then(t=>{o(t)})},[r]),(0,n.jsxs)("div",{className:"flex flex-row",children:[(0,n.jsxs)("div",{className:"w-[20rem] flex flex-col p-2 gap-4 border-gray-300",children:[(0,n.jsx)("div",{className:"bg-cyan-500 text-white p-2 rounded-xl cursor-pointer",children:(0,n.jsx)(u.default,{href:"/chat",children:"联系人"})}),(0,n.jsx)(f,{contacts:null==c?void 0:c.contacts}),(0,n.jsx)("div",{className:"bg-cyan-500 text-white p-2 rounded-xl cursor-pointer",children:(0,n.jsx)(u.default,{href:"/chat/friends/group",children:"群聊"})}),(0,n.jsx)(g,{quns:null==c?void 0:c.quns})]}),(0,n.jsx)("div",{className:"flex-1 border-2 border-gray-300",children:e})]})}},5166:function(t,e,r){"use strict";r.d(e,{Z:function(){return u}});var n=r(57437);r(2265);var s=r(88978),i=r(81841);function u(){return(0,n.jsx)(s.Z,{animation:i.Z,size:56})}},95189:function(t,e,r){"use strict";r.d(e,{B1:function(){return c},Ee:function(){return s},Tb:function(){return a},Y4:function(){return o},Yo:function(){return d},ZE:function(){return l},lg:function(){return i},oT:function(){return u}});var n=r(20357);let s="user_info",i="http://www.sparrowzoo.com",u="SESSION",c="sparrow-token",o="http://www.sparrowzoo.com/react",a="http://passport.sparrowzoo.com/cros-storage";n.env.NEXT_PUBLIC_CAPTCHA_URL;let l="http://passport.sparrowzoo.com/sign-in",d="ws://www.sparrowzoo.com/websocket"},32384:function(t,e,r){"use strict";r.d(e,{Z:function(){return n}});class n{static bytes2ArrayBuffer(t){let e=new Uint8Array(t.length);for(let r=0;r<e.length;r++)e[r]=t[r];return e}static str2Buffer(t){if("undefined"==typeof TextEncoder){let e,r=[];for(let n=0;n<t.length;n++)(e=t.charCodeAt(n))>=65536&&e<=1114111?(r.push(e>>18&7|240),r.push(e>>12&63|128),r.push(e>>6&63|128),r.push(63&e|128)):e>=2048&&e<=65535?(r.push(e>>12&15|224),r.push(e>>6&63|128),r.push(63&e|128)):e>=128&&e<=2047?(r.push(e>>6&31|192),r.push(63&e|128)):r.push(255&e);return n.bytes2ArrayBuffer(r)}return new TextEncoder().encode(t)}static number2Buffer(t){var e=[],r=length=4;do e[--r]=255&t,t>>=8;while(r);return n.bytes2ArrayBuffer(e)}static appendBytes(t,e,r){return t.set(e,r),r+e.byteLength}readString(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s="",i=n?2:1;for(let u=0;u<r;u+=i)s+=String.fromCharCode(n?t.getUint16(e+u,!0):t.getUint8(e+u));return s}}},91429:function(t,e,r){"use strict";r.d(e,{r:function(){return c}});var n=r(57437);r(2265);var s=r(66648),i=r(95189);function u(t){let e="".concat(t.src);return e.startsWith("http://")||(e="".concat(i.Y4,"/").concat(e)),(0,n.jsx)(s.default,{className:t.className,loader:t=>{let{src:e,width:r,quality:n}=t;return"".concat(e,"?w=").concat(r,"&q=").concat(n||75)},src:e,alt:t.alt,width:t.width,height:t.height,quality:t.quality||75})}function c(t){return(0,n.jsx)(u,{className:t.className,src:t.src,alt:t.alt,width:t.width,height:t.height,quality:t.quality||75})}},78411:function(t,e,r){"use strict";r.d(e,{D:function(){return i},t:function(){return s}});var n=r(2265);class s{static create(t){return new s(t)}newReference(){return new s(this.messageBroker)}closeWebSocket(){var t;null===(t=this.messageBroker)||void 0===t||t.closeWebSocket()}constructor(t){this.messageBroker=t}}let i=(0,n.createContext)(null)},17892:function(t,e,r){"use strict";var n,s,i,u;r.d(e,{Cs:function(){return s},z_:function(){return n}}),(i=n||(n={}))[i.CHAT_1_TO_1=0]="CHAT_1_TO_1",i[i.GROUP=1]="GROUP",(u=s||(s={}))[u.TEXT_MESSAGE=0]="TEXT_MESSAGE",u[u.IMAGE_MESSAGE=1]="IMAGE_MESSAGE";class c{}c.HORIZON_LINE="-"},21292:function(t,e,r){"use strict";r.d(e,{Z:function(){return i}});var n=r(17892),s=r(8713);class i{get chatType(){return this._chatType}set chatType(t){this._chatType=t}get id(){return this._id}set id(t){this._id=t}static create121Session(t,e){let r=new i;return r.chatType=n.z_.CHAT_1_TO_1,r.id=r.generateKey(t,e),r}static createSession(t,e){let r=new i;return r.chatType=t,r.id=e,r}static parse(t){if(null==t)return null;let e=new i,r=parseInt(t.substring(0,1),10),n=t.substring(1);return e._chatType=r,e.id=n,e}static createGroupSession(t){let e=new i;return e.chatType=n.z_.GROUP,e.id=t,e}isGroup(){return this._chatType==n.z_.GROUP}isOne2One(){return this._chatType==n.z_.CHAT_1_TO_1}getOppositeUser(){let t=s.Z.getCurrentUser();if(null==t||this._chatType===n.z_.GROUP)return null;let e=this.id.substring(0,1),r=this.id.substring(1,2),i=parseInt(this.id.substring(2,4),10),u=this.id.substring(4,4+i),c=this.id.substring(4+i),o=new s.Z(u,parseInt(e,10)),a=new s.Z(c,parseInt(r,10));return o.equals(t)?a:o}toBytes(){return new TextEncoder().encode(this._chatType+this.id)}key(){return this.chatType+this.id}generateKey(t,e){if(null==t||null==e)return"";let r=t,n=e;t.id<=e.id&&(r=e,n=t);let s=(r.id+"").length,i=s+"";return s<10&&(i="0"+s),r.category+""+n.category+i+r.id+n.id}}},8713:function(t,e,r){"use strict";r.d(e,{Z:function(){return i}});var n=r(32384),s=r(95189);class i{get id(){return this._id}get category(){return this._category}static fromBytes(t,e){let r=t.buffer,n=t.getUint8(e);e+=1;let s=new Uint8Array(r.slice(e,e+n));return e+=n,{chatUser:new i(new TextDecoder().decode(s),t.getUint8(e)),offset:e+1}}static parse(t){let e=t.split("_");return 2!=e.length?null:new i(e[0],Number(e[1]))}static getCurrentUser(){let t=sessionStorage.getItem(s.Ee);if(!t)return null;let e=JSON.parse(t);return new i(e.userId,e.category)}getCategoryName(){return this._category==i.CATEGORY_VISITOR?"访客":this._category==i.CATEGORY_REGISTER?"注册用户":"未知"}key(){return this._id+"_"+this._category}equals(t){return null!=t&&this._id==t.id&&this._category==t.category}toBytes(){let t=n.Z.str2Buffer(this._id+""),e=new Uint8Array([this._category]),r=new Uint8Array(1+t.byteLength+1),s=t.byteLength,i=0;return i=n.Z.appendBytes(r,new Uint8Array([s]),i),i=n.Z.appendBytes(r,t,i),n.Z.appendBytes(r,e,i),r}constructor(t,e){this._id=t,this._category=e}}i.CATEGORY_VISITOR=0,i.CATEGORY_REGISTER=1}},function(t){t.O(0,[4705,8173,231,7145,2971,7023,1744],function(){return t(t.s=99589)}),_N_E=t.O()}]);
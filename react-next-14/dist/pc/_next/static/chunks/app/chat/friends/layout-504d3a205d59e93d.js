(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8324],{99589:function(e,t,r){Promise.resolve().then(r.bind(r,64308))},66648:function(e,t,r){"use strict";r.d(t,{default:function(){return s.a}});var n=r(55601),s=r.n(n)},87138:function(e,t,r){"use strict";r.d(t,{default:function(){return s.a}});var n=r(231),s=r.n(n)},20357:function(e,t,r){"use strict";var n,s;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(s=r.g.process)?void 0:s.env)?r.g.process:r(88081)},88081:function(e){!function(){var t={229:function(e){var t,r,n,s=e.exports={};function i(){throw Error("setTimeout has not been defined")}function u(){throw Error("clearTimeout has not been defined")}function c(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{r="function"==typeof clearTimeout?clearTimeout:u}catch(e){r=u}}();var o=[],a=!1,l=-1;function d(){a&&n&&(a=!1,n.length?o=n.concat(o):l=-1,o.length&&h())}function h(){if(!a){var e=c(d);a=!0;for(var t=o.length;t;){for(n=o,o=[];++l<t;)n&&n[l].run();l=-1,t=o.length}n=null,a=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===u||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function p(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];o.push(new f(e,t)),1!==o.length||a||c(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=p,s.addListener=p,s.once=p,s.off=p,s.removeListener=p,s.removeAllListeners=p,s.emit=p,s.prependListener=p,s.prependOnceListener=p,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var i=r[e]={exports:{}},u=!0;try{t[e](i,i.exports,n),u=!1}finally{u&&delete r[e]}return i.exports}n.ab="//";var s=n(229);e.exports=s}()},55601:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{default:function(){return o},getImageProps:function(){return c}});let n=r(99920),s=r(80497),i=r(38173),u=n._(r(21241));function c(e){let{props:t}=(0,s.getImgProps)(e,{defaultLoader:u.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,r]of Object.entries(t))void 0===r&&delete t[e];return{props:t}}let o=i.Image},64308:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var n=r(57437),s=r(2265),i=r(78411),u=r(87138),c=r(95189),o=r(91429),a=r(21292),l=r(8713);function d(e){let{contact:t}=e,r="/avatar/".concat(t.userId,".jpg"),s=a.Z.create121Session(l.Z.getCurrentUser(),new l.Z(t.userId+"",l.Z.CATEGORY_REGISTER)).key(),i="".concat(c.Y4,"/chat/sessions/session?sessionKey=").concat(s);return(0,n.jsxs)("div",{className:"flex items-center text-left",children:[(0,n.jsx)(u.default,{href:i,children:(0,n.jsx)(o.r,{src:r,alt:"header",width:50,height:50,className:"w-16 h-16 rounded-full mr-4"})}),(0,n.jsx)("div",{children:(0,n.jsxs)(u.default,{href:i,children:[(0,n.jsxs)("strong",{children:[t.userName,"-",t.userId]}),(0,n.jsx)("br",{}),(0,n.jsx)("span",{children:t.nationality})]})})]})}function h(e){var t;return e.contacts?(0,n.jsx)("div",{className:"flex flex-col gap-2",children:null==e?void 0:null===(t=e.contacts)||void 0===t?void 0:t.map(e=>(0,n.jsx)(d,{contact:e},e.userId+""))}):(0,n.jsx)("div",{children:"loading..."})}function f(e){let{qun:t}=e,r="".concat(c.Y4,"/chat/friends/group?groupId=").concat(t.qunId),s=t.avatar;return(0,n.jsxs)("div",{className:"flex items-center text-left",children:[(0,n.jsx)(u.default,{href:r,children:(0,n.jsx)(o.r,{className:"w-16 h-16 rounded-full mr-4",quality:40,src:s,alt:"Group head",width:50,height:50})}),(0,n.jsx)("div",{children:(0,n.jsxs)(u.default,{href:r,children:[(0,n.jsx)("strong",{children:t.qunName}),(0,n.jsx)("br",{}),(0,n.jsx)("span",{children:t.nationality})]})})]})}function p(e){var t;return e.quns?(0,n.jsx)("div",{className:"flex flex-col gap-2",children:null==e?void 0:null===(t=e.quns)||void 0===t?void 0:t.map(e=>(0,n.jsx)(f,{qun:e},e.qunId+""))}):(0,n.jsx)("div",{children:"loading..."})}function g(e){let{children:t}=e,r=(0,s.useContext)(i.D).messageBroker,[c,o]=(0,s.useState)();return(0,s.useEffect)(()=>{r.getContactGroup().then(e=>{o(e)})},[r]),(0,n.jsxs)("div",{className:"flex flex-row",children:[(0,n.jsxs)("div",{className:"w-[20rem] flex flex-col p-2 gap-4 border-gray-300",children:[(0,n.jsx)("div",{className:"bg-cyan-500 text-white p-2 rounded-xl cursor-pointer",children:(0,n.jsx)(u.default,{href:"/chat",children:"联系人"})}),(0,n.jsx)(h,{contacts:null==c?void 0:c.contacts}),(0,n.jsx)("div",{className:"bg-cyan-500 text-white p-2 rounded-xl cursor-pointer",children:(0,n.jsx)(u.default,{href:"/chat/friends/group",children:"群聊"})}),(0,n.jsx)(p,{quns:null==c?void 0:c.quns})]}),(0,n.jsx)("div",{className:"flex-1 border-2 border-gray-300",children:t})]})}},95189:function(e,t,r){"use strict";r.d(t,{B1:function(){return c},Ee:function(){return s},Tb:function(){return a},Y4:function(){return o},Yo:function(){return l},lg:function(){return i},oT:function(){return u}});var n=r(20357);let s="user_info",i="http://www.sparrowzoo.com",u="SESSION",c="sparrow-token",o="http://www.sparrowzoo.com/react",a=n.env.NEXT_PUBLIC_STORAGE_PROXY;n.env.NEXT_PUBLIC_CAPTCHA_URL;let l="ws://www.sparrowzoo.com/websocket"},32384:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});class n{static bytes2ArrayBuffer(e){let t=new Uint8Array(e.length);for(let r=0;r<t.length;r++)t[r]=e[r];return t}static str2Buffer(e){if("undefined"==typeof TextEncoder){let t,r=[];for(let n=0;n<e.length;n++)(t=e.charCodeAt(n))>=65536&&t<=1114111?(r.push(t>>18&7|240),r.push(t>>12&63|128),r.push(t>>6&63|128),r.push(63&t|128)):t>=2048&&t<=65535?(r.push(t>>12&15|224),r.push(t>>6&63|128),r.push(63&t|128)):t>=128&&t<=2047?(r.push(t>>6&31|192),r.push(63&t|128)):r.push(255&t);return n.bytes2ArrayBuffer(r)}return new TextEncoder().encode(e)}static number2Buffer(e){var t=[],r=length=4;do t[--r]=255&e,e>>=8;while(r);return n.bytes2ArrayBuffer(t)}static appendBytes(e,t,r){return e.set(t,r),r+t.byteLength}readString(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s="",i=n?2:1;for(let u=0;u<r;u+=i)s+=String.fromCharCode(n?e.getUint16(t+u,!0):e.getUint8(t+u));return s}}},91429:function(e,t,r){"use strict";r.d(t,{r:function(){return c}});var n=r(57437);r(2265);var s=r(66648),i=r(95189);function u(e){let t="".concat(e.src);return t.startsWith("http://")||(t="".concat(i.Y4,"/").concat(t)),(0,n.jsx)(s.default,{className:e.className,loader:e=>{let{src:t,width:r,quality:n}=e;return"".concat(t,"?w=").concat(r,"&q=").concat(n||75)},src:t,alt:e.alt,width:e.width,height:e.height,quality:e.quality||75})}function c(e){return(0,n.jsx)(u,{className:e.className,src:e.src,alt:e.alt,width:e.width,height:e.height,quality:e.quality||75})}},78411:function(e,t,r){"use strict";r.d(t,{D:function(){return i},t:function(){return s}});var n=r(2265);class s{static create(e){return new s(e)}newReference(){return new s(this.messageBroker)}closeWebSocket(){var e;null===(e=this.messageBroker)||void 0===e||e.closeWebSocket()}constructor(e){this.messageBroker=e}}let i=(0,n.createContext)(null)},17892:function(e,t,r){"use strict";var n,s,i,u;r.d(t,{Cs:function(){return s},z_:function(){return n}}),(i=n||(n={}))[i.CHAT_1_TO_1=0]="CHAT_1_TO_1",i[i.GROUP=1]="GROUP",(u=s||(s={}))[u.TEXT_MESSAGE=0]="TEXT_MESSAGE",u[u.IMAGE_MESSAGE=1]="IMAGE_MESSAGE";class c{}c.HORIZON_LINE="-"},21292:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(17892),s=r(8713);class i{get chatType(){return this._chatType}set chatType(e){this._chatType=e}get id(){return this._id}set id(e){this._id=e}static create121Session(e,t){let r=new i;return r.chatType=n.z_.CHAT_1_TO_1,r.id=r.generateKey(e,t),r}static createSession(e,t){let r=new i;return r.chatType=e,r.id=t,r}static parse(e){if(null==e)return null;let t=new i,r=parseInt(e.substring(0,1),10),n=e.substring(1);return t._chatType=r,t.id=n,t}static createGroupSession(e){let t=new i;return t.chatType=n.z_.GROUP,t.id=e,t}isGroup(){return this._chatType==n.z_.GROUP}isOne2One(){return this._chatType==n.z_.CHAT_1_TO_1}getOppositeUser(){let e=s.Z.getCurrentUser();if(null==e||this._chatType===n.z_.GROUP)return null;let t=this.id.substring(0,1),r=this.id.substring(1,2),i=parseInt(this.id.substring(2,4),10),u=this.id.substring(4,4+i),c=this.id.substring(4+i),o=new s.Z(u,parseInt(t,10)),a=new s.Z(c,parseInt(r,10));return o.equals(e)?a:o}toBytes(){return new TextEncoder().encode(this._chatType+this.id)}key(){return this.chatType+this.id}generateKey(e,t){if(null==e||null==t)return"";let r=e,n=t;e.id<=t.id&&(r=t,n=e);let s=(r.id+"").length,i=s+"";return s<10&&(i="0"+s),r.category+""+n.category+i+r.id+n.id}}},8713:function(e,t,r){"use strict";r.d(t,{Z:function(){return i}});var n=r(32384),s=r(95189);class i{get id(){return this._id}get category(){return this._category}static fromBytes(e,t){let r=e.buffer,n=e.getUint8(t);t+=1;let s=new Uint8Array(r.slice(t,t+n));return t+=n,{chatUser:new i(new TextDecoder().decode(s),e.getUint8(t)),offset:t+1}}static parse(e){let t=e.split("_");return 2!=t.length?null:new i(t[0],Number(t[1]))}static getCurrentUser(){let e=sessionStorage.getItem(s.Ee);if(!e)return null;let t=JSON.parse(e);return new i(t.userId,t.category)}getCategoryName(){return this._category==i.CATEGORY_VISITOR?"访客":this._category==i.CATEGORY_REGISTER?"注册用户":"未知"}key(){return this._id+"_"+this._category}equals(e){return null!=e&&this._id==e.id&&this._category==e.category}toBytes(){let e=n.Z.str2Buffer(this._id+""),t=new Uint8Array([this._category]),r=new Uint8Array(1+e.byteLength+1),s=e.byteLength,i=0;return i=n.Z.appendBytes(r,new Uint8Array([s]),i),i=n.Z.appendBytes(r,e,i),n.Z.appendBytes(r,t,i),r}constructor(e,t){this._id=e,this._category=t}}i.CATEGORY_VISITOR=0,i.CATEGORY_REGISTER=1}},function(e){e.O(0,[8173,231,2971,7023,1744],function(){return e(e.s=99589)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1471],{10687:function(e,t,o){Promise.resolve().then(o.bind(o,72159))},45753:function(e,t,o){"use strict";o.d(t,{Z:function(){return s}});var n=o(2265),r=o(99479);function s(){let[e,t]=(0,n.useState)();return(0,n.useEffect)(()=>(t(r.Z.getCrosStorage()),()=>{null==e||e.destroy()}),[]),e}},99479:function(e,t,o){"use strict";o.d(t,{Z:function(){return s}});var n=o(23531),r=o(95189);class s{static getCurrentStorage(){return new s(!1)}static getCrosStorage(){return new s}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.B1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:n.Z.AUTOMATIC;return(o=this.getStorageType(o),this.cros)?this.request({requestId:crypto.randomUUID(),command:n.w.SET,storage:o,key:t,value:e}):((o===n.Z.LOCAL?localStorage:sessionStorage).setItem(t,e),Promise.resolve(e))}get(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.B1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.Z.AUTOMATIC;return(t=this.getStorageType(t),this.cros)?this.request({requestId:crypto.randomUUID(),command:n.w.GET,storage:t,key:e}):Promise.resolve(("local"===t?localStorage:sessionStorage).getItem(e))}remove(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.B1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.Z.AUTOMATIC;if(t=this.getStorageType(t),!this.cros){let o=t===n.Z.LOCAL?localStorage:sessionStorage,r=o.getItem(e);return o.removeItem(e),Promise.resolve(r)}return this.request({requestId:crypto.randomUUID(),command:n.w.REMOVE,storage:t,key:e})}destroy(){document.body.removeChild(this.iframe)}async getToken(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.Z.AUTOMATIC,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=await this.get(r.B1,e);if(o)return o;if(t){let e=await t();return await this.setToken(e),e}return null}setToken(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.Z.AUTOMATIC;return this.set(e,r.B1,t)}removeToken(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.Z.AUTOMATIC;return this.remove(r.B1,e)}getStorageType(e){return e===n.Z.AUTOMATIC&&(e="SESSION"===r.oT?n.Z.SESSION:n.Z.LOCAL),e}request(e){return new Promise((t,o)=>{let n=r=>{var s;!this.iframeOrigin||(null===this||void 0===this?void 0:null===(s=this.iframeOrigin)||void 0===s?void 0:s.indexOf(r.origin))<0||r.data.requestId!==e.requestId||(window.removeEventListener("message",n),r.data.error?o(Error(r.data.error)):t(r.data.value))};window.addEventListener("message",n);let r=()=>{if(console.log("send request",this.loaded),this.loaded)try{var t;null===(t=this.iframe.contentWindow)||void 0===t||t.postMessage(e,this.iframeOrigin)}catch(e){setTimeout(r,1e3)}else setTimeout(r,1e3)};r()})}constructor(e=null){if(this.cros=!1,this.loaded=!1,!1===e||(this.cros=!!r.Tb,!1==this.cros))return;let t=document.createElement("iframe");t.src=r.Tb,t.style.display="none",this.iframe=t,console.log("append iframe "+r.Tb),t.addEventListener("load",()=>{console.log("iframe loaded"),this.loaded=!0}),document.body.appendChild(t),this.iframeOrigin=r.Tb}}},95189:function(e,t,o){"use strict";o.d(t,{B1:function(){return l},Ee:function(){return r},Tb:function(){return u},Y4:function(){return a},Yo:function(){return c},lg:function(){return s},oT:function(){return i}});var n=o(20357);let r="user_info",s="http://www.sparrowzoo.com",i="SESSION",l="sparrow-token",a="http://www.sparrowzoo.com/react",u=n.env.NEXT_PUBLIC_STORAGE_PROXY;n.env.NEXT_PUBLIC_CAPTCHA_URL;let c="ws://www.sparrowzoo.com/websocket"},28773:function(e,t,o){"use strict";o.d(t,{Z:function(){return i}});var n=o(95189),r=o(94962),s=o(99479);class i{static async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.Z.getCurrentStorage(),o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e=n.lg+e;let i=null;t&&(i=await (null==t?void 0:t.getToken().then(e=>e)));let l={method:"GET",headers:{"Content-Type":"application/json",Authorization:i}};return o&&(l.credentials="include"),new Promise((t,o)=>{fetch(e,l).then(async e=>{let n=await e.json();"0"!=n.code?(r.ZP.error(null==n?void 0:n.message),o(n)):t(n)}).catch(e=>{r.ZP.error(e.message),o(e)})})}static async post(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.Z.getCurrentStorage(),i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e=n.lg+e;let l=null;o&&(l=await o.getToken().then(e=>e));let a={method:"POST",headers:{"Content-Type":"application/json",Authorization:l},body:t};return i&&(a.credentials="include"),new Promise((t,o)=>{fetch(e,a).then(async e=>{let n=await e.json();"0"!=n.code?(r.ZP.error(null==n?void 0:n.message),o(n)):t(n)}).catch(e=>{r.ZP.error(e.message),o(e)})})}}},23531:function(e,t,o){"use strict";var n,r,s,i;o.d(t,{Z:function(){return r},w:function(){return n}}),(s=n||(n={})).GET="get",s.SET="set",s.REMOVE="remove",(i=r||(r={})).LOCAL="local",i.SESSION="session",i.AUTOMATIC="automatic"},72159:function(e,t,o){"use strict";o.d(t,{default:function(){return l}});var n=o(57437),r=o(2265),s=o(28773),i=o(45753);function l(){let e=(0,i.Z)(),[t,o]=(0,r.useState)("");return(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"登录"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("input",{className:"text-red-700",onChange:e=>o(e.target.value),type:"text",placeholder:"用户名"}),(0,n.jsx)("button",{onClick:()=>{console.log(t),console.log("login",t),s.Z.post("/chat/v2/login.json",JSON.stringify({id:t,category:1})).then(t=>{null==e||e.setToken(t.data),console.log(JSON.stringify(t))})},children:"登录"}),(0,n.jsx)("button",{onClick:()=>{console.log(t),console.log("login",t),s.Z.post("/chat/v2/long-login.json",t).then(t=>{null==e||e.setToken(t.data),console.log(JSON.stringify(t))})},children:"Long UserId登录"})]})]})}}},function(e){e.O(0,[6090,2971,7023,1744],function(){return e(e.s=10687)}),_N_E=e.O()}]);
(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8426],{91769:function(e,t,r){Promise.resolve().then(r.bind(r,71409))},16463:function(e,t,r){"use strict";var n=r(71169);r.o(n,"useSearchParams")&&r.d(t,{useSearchParams:function(){return n.useSearchParams}})},20357:function(e,t,r){"use strict";var n,o;e.exports=(null==(n=r.g.process)?void 0:n.env)&&"object"==typeof(null==(o=r.g.process)?void 0:o.env)?r.g.process:r(88081)},88081:function(e){!function(){var t={229:function(e){var t,r,n,o=e.exports={};function s(){throw Error("setTimeout has not been defined")}function c(){throw Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===s||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(r){try{return t.call(null,e,0)}catch(r){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:s}catch(e){t=s}try{r="function"==typeof clearTimeout?clearTimeout:c}catch(e){r=c}}();var u=[],a=!1,l=-1;function f(){a&&n&&(a=!1,n.length?u=n.concat(u):l=-1,u.length&&d())}function d(){if(!a){var e=i(f);a=!0;for(var t=u.length;t;){for(n=u,u=[];++l<t;)n&&n[l].run();l=-1,t=u.length}n=null,a=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===c||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function h(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new h(e,t)),1!==u.length||a||i(d)},h.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},r={};function n(e){var o=r[e];if(void 0!==o)return o.exports;var s=r[e]={exports:{}},c=!0;try{t[e](s,s.exports,n),c=!1}finally{c&&delete r[e]}return s.exports}n.ab="//";var o=n(229);e.exports=o}()},71409:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var n=r(57437),o=r(2265),s=r(16463),c=r(95189);function i(e){let{sender:t,content:r,sendTime:o,align:s}=e.message,i="".concat(c.Y4,"/avatar/").concat(t.id,".jpg");return(0,n.jsxs)("div",{className:"flex flex-col ".concat("left"===s?"items-start":"items-end"),children:[(0,n.jsxs)("div",{className:"flex flex-row  p-4 bg-gray-100 rounded-lg",children:[(0,n.jsx)("img",{className:" w-8 h-8 rounded-full mr-4",src:i}),(0,n.jsxs)("strong",{className:"flex-1 text-gray-900",children:["sender: ",t.id," @",o]})]}),(0,n.jsx)("p",{className:"text-gray-600",children:r})]})}var u=r(78411);function a(){let e=(0,s.useSearchParams)(),t=null==e?void 0:e.get("sessionKey"),[r,c]=(0,o.useState)(""),[a,l]=(0,o.useState)(),[f,d]=(0,o.useState)(0),h=(0,o.useRef)(null),m=(0,o.useContext)(u.D);async function v(){let e=m.messageBroker,n=e.webSocket;e.sendMessage(t,r),l(await e.getMessageList(t)),d(n.txid),c("")}return((0,o.useEffect)(()=>{if(console.log("sessionKey changed to: ",t),!t)return;let e=m.messageBroker;e.getMessageList(t).then(t=>{l(t),d(null==e?void 0:e.webSocket.increaseTxid())})},[t,m]),(0,o.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})},[f]),a)?(0,n.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,n.jsx)("div",{children:(0,n.jsxs)("h2",{children:["Welcome to: ",t]})}),(0,n.jsxs)("div",{className:"overflow-y-scroll h-[25rem] p-4 border-2 border-red-700",children:[a.map(e=>(0,n.jsx)(i,{message:e},e.messageId)),(0,n.jsx)("div",{className:"h-[0px] h-[0px]",ref:h})]}),(0,n.jsx)("textarea",{value:r,onKeyDown:e=>{"Enter"===e.code&&v()},onChange:e=>c(e.target.value),className:"w-full flex-1"}),(0,n.jsx)("button",{onClick:e=>v(),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Send"})]}):(console.log("messageList is undefined"),(0,n.jsx)("div",{children:"Loading..."}))}function l(){return(0,n.jsx)(o.Suspense,{children:(0,n.jsx)(a,{})})}},95189:function(e,t,r){"use strict";r.d(t,{B1:function(){return i},Ee:function(){return o},Tb:function(){return a},Y4:function(){return u},Yo:function(){return l},lg:function(){return s},oT:function(){return c}});var n=r(20357);let o="user_info",s="http://www.sparrowzoo.com",c="SESSION",i="sparrow-token",u="http://www.sparrowzoo.com/react",a=n.env.NEXT_PUBLIC_STORAGE_PROXY;n.env.NEXT_PUBLIC_CAPTCHA_URL;let l="ws://www.sparrowzoo.com/websocket"},78411:function(e,t,r){"use strict";r.d(t,{D:function(){return s},t:function(){return o}});var n=r(2265);class o{static create(e){return new o(e)}newReference(){return new o(this.messageBroker)}closeWebSocket(){var e;null===(e=this.messageBroker)||void 0===e||e.closeWebSocket()}constructor(e){this.messageBroker=e}}let s=(0,n.createContext)(null)}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=91769)}),_N_E=e.O()}]);
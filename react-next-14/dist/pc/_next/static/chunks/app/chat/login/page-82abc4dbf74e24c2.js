(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1471],{38021:function(e,t,n){Promise.resolve().then(n.bind(n,72159))},45753:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var o=n(2265),r=n(57417);function s(){let[e,t]=(0,o.useState)();return(0,o.useEffect)(()=>(t(r.Z.getCrosStorage()),()=>{null==e||e.destroy()}),[]),e}},57417:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var o=n(23531),r=n(95189);class s{static randomUUID(){let e="";for(let t=0;t<36;t++)[8,13,18,23].includes(t)?e+="-":e+="0123456789abcdef"[Math.floor(16*Math.random())];return e}}class i{static getCurrentStorage(){return new i(!1)}static getCrosStorage(){return new i}set(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.B1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o.Z.AUTOMATIC;return(n=this.getStorageType(n),this.cros)?this.request({requestId:s.randomUUID(),command:o.w.SET,storage:n,key:t,value:e}):((n===o.Z.LOCAL?localStorage:sessionStorage).setItem(t,e),Promise.resolve(e))}get(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.B1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.Z.AUTOMATIC;return(t=this.getStorageType(t),this.cros)?this.request({requestId:s.randomUUID(),command:o.w.GET,storage:t,key:e}):Promise.resolve(("local"===t?localStorage:sessionStorage).getItem(e))}remove(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.B1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.Z.AUTOMATIC;if(t=this.getStorageType(t),!this.cros){let n=t===o.Z.LOCAL?localStorage:sessionStorage,r=n.getItem(e);return n.removeItem(e),Promise.resolve(r)}return this.request({requestId:s.randomUUID(),command:o.w.REMOVE,storage:t,key:e})}destroy(){this.cros&&document.body.removeChild(this.iframe)}async getToken(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.Z.AUTOMATIC,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=await this.get(r.B1,e);if(n)return n;if(t){let e=await t();return await this.setToken(e),e}return null}setToken(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.Z.AUTOMATIC;return this.set(e,r.B1,t)}removeToken(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.Z.AUTOMATIC;return this.remove(r.B1,e)}getStorageType(e){return e===o.Z.AUTOMATIC&&(e="SESSION"===r.oT?o.Z.SESSION:o.Z.LOCAL),e}request(e){return new Promise((t,n)=>{let o=r=>{var s;!this.iframeOrigin||(null===this||void 0===this?void 0:null===(s=this.iframeOrigin)||void 0===s?void 0:s.indexOf(r.origin))<0||r.data.requestId!==e.requestId||(window.removeEventListener("message",o),r.data.error?n(Error(r.data.error)):t(r.data.value))};window.addEventListener("message",o);let r=()=>{if(console.log("send request",this.loaded),!this.loaded){setTimeout(r,1e3);return}try{var t;null===(t=this.iframe.contentWindow)||void 0===t||t.postMessage(e,this.iframeOrigin)}catch(e){setTimeout(r,1e3)}};r()})}constructor(e=null){if(this.cros=!1,this.loaded=!1,!1===e||(this.cros=!!r.Tb,!1==this.cros))return;let t=document.createElement("iframe");t.src=r.Tb,t.src=t.src+"?"+function(){let e=window.location.href,t=e.indexOf("?");return -1===t?e:e.substring(0,t)}(),t.style.display="none",this.iframe=t,console.log("append iframe "+r.Tb);let n=e=>{var t;!this.iframeOrigin||(null===this||void 0===this?void 0:null===(t=this.iframeOrigin)||void 0===t?void 0:t.indexOf(e.origin))<0||(this.loaded=!0,window.removeEventListener("message",n))};window.addEventListener("message",n),document.body.appendChild(t),this.iframeOrigin=r.Tb}}},95189:function(e,t,n){"use strict";n.d(t,{B1:function(){return a},Ee:function(){return r},Tb:function(){return u},Y4:function(){return l},Yo:function(){return d},ZE:function(){return c},lg:function(){return s},oT:function(){return i}});var o=n(20357);let r="user_info",s="http://www.sparrowzoo.com",i="SESSION",a="sparrow-token",l="http://www.sparrowzoo.com/react",u="http://passport.sparrowzoo.com/cros-storage";o.env.NEXT_PUBLIC_CAPTCHA_URL;let c="http://passport.sparrowzoo.com/sign-in",d="ws://www.sparrowzoo.com/websocket"},28773:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var o=n(95189),r=n(94962),s=n(57417);class i{static async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s.Z.getCurrentStorage(),n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e=o.lg+e;let i=null;t&&(i=await (null==t?void 0:t.getToken().then(e=>e)));let a={method:"GET",headers:{"Content-Type":"application/json",Authorization:i}};return n&&(a.credentials="include"),new Promise((t,n)=>{fetch(e,a).then(async e=>{let o=await e.json();"0"!=o.code?(r.ZP.error(null==o?void 0:o.message),n(o)):t(o)}).catch(e=>{r.ZP.error(e.message),n(e)})})}static async post(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:s.Z.getCurrentStorage(),i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e=o.lg+e;let a=null;n&&(a=await n.getToken().then(e=>e));let l={method:"POST",headers:{"Content-Type":"application/json",Authorization:a},body:t};return i&&(l.credentials="include"),new Promise((t,n)=>{fetch(e,l).then(async e=>{let o=await e.json();"0"!=o.code?(r.ZP.error(null==o?void 0:o.message),n(o)):t(o)}).catch(e=>{r.ZP.error(e.message),n(e)})})}}},23531:function(e,t,n){"use strict";var o,r,s,i;n.d(t,{Z:function(){return r},w:function(){return o}}),(s=o||(o={})).GET="get",s.SET="set",s.REMOVE="remove",s.INIT="init",(i=r||(r={})).LOCAL="local",i.SESSION="session",i.AUTOMATIC="automatic"},72159:function(e,t,n){"use strict";n.d(t,{default:function(){return a}});var o=n(57437),r=n(2265),s=n(28773),i=n(45753);function a(){let e=(0,i.Z)(),[t,n]=(0,r.useState)("");return(0,o.jsxs)("div",{children:[(0,o.jsx)("h2",{children:"登录"}),(0,o.jsxs)("div",{children:[(0,o.jsx)("input",{className:"text-red-700",onChange:e=>n(e.target.value),type:"text",placeholder:"用户名"}),(0,o.jsx)("button",{onClick:()=>{console.log(t),console.log("login",t),s.Z.post("/chat/v2/login.json",JSON.stringify({id:t,category:1})).then(t=>{null==e||e.setToken(t.data),console.log(JSON.stringify(t))})},children:"登录"}),(0,o.jsx)("button",{onClick:()=>{console.log(t),console.log("login",t),s.Z.post("/chat/v2/long-login.json",t).then(t=>{null==e||e.setToken(t.data),console.log(JSON.stringify(t))})},children:"Long UserId登录"})]})]})}}},function(e){e.O(0,[6090,2971,7023,1744],function(){return e(e.s=38021)}),_N_E=e.O()}]);
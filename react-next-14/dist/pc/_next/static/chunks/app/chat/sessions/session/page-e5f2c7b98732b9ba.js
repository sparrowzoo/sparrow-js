(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8426],{91769:function(e,s,t){Promise.resolve().then(t.bind(t,71409))},16463:function(e,s,t){"use strict";var n=t(71169);t.o(n,"useSearchParams")&&t.d(s,{useSearchParams:function(){return n.useSearchParams}})},71409:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return i}});var n=t(57437),r=t(2265),o=t(16463),c=t(95189);function a(e){let{sender:s,content:t,sendTime:r,align:o}=e.message,a="".concat(c.Y4,"/avatar/").concat(s.id,".jpg");return(0,n.jsxs)("div",{className:"flex flex-col ".concat("left"===o?"items-start":"items-end"),children:[(0,n.jsxs)("div",{className:"flex flex-row  p-4 bg-gray-100 rounded-lg",children:[(0,n.jsx)("img",{className:" w-8 h-8 rounded-full mr-4",src:a}),(0,n.jsxs)("strong",{className:"flex-1 text-gray-900",children:["sender: ",s.id," @",r]})]}),(0,n.jsx)("p",{className:"text-gray-600",children:t})]})}var l=t(78411);function u(){let e=(0,o.useSearchParams)(),s=null==e?void 0:e.get("sessionKey"),[t,c]=(0,r.useState)(""),[u,i]=(0,r.useState)(),[d,f]=(0,r.useState)(0),h=(0,r.useRef)(null),m=(0,r.useContext)(l.D);async function x(){let e=m.messageBroker,n=e.webSocket;e.sendMessage(s,t),i(await e.getMessageList(s)),f(n.txid),c("")}return((0,r.useEffect)(()=>{if(console.log("sessionKey changed to: ",s),!s)return;let e=m.messageBroker;e.getMessageList(s).then(s=>{i(s),f(null==e?void 0:e.webSocket.increaseTxid())})},[s,m]),(0,r.useEffect)(()=>{var e;null===(e=h.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"end"})},[d]),u)?(0,n.jsxs)("div",{className:"flex flex-col w-full h-full",children:[(0,n.jsx)("div",{children:(0,n.jsxs)("h2",{children:["Welcome to: ",s]})}),(0,n.jsxs)("div",{className:"overflow-y-scroll h-[25rem] p-4 border-2 border-red-700",children:[u.map(e=>(0,n.jsx)(a,{message:e},e.messageId)),(0,n.jsx)("div",{className:"h-[0px] h-[0px]",ref:h})]}),(0,n.jsx)("textarea",{value:t,onKeyDown:e=>{"Enter"===e.code&&x()},onChange:e=>c(e.target.value),className:"w-full flex-1"}),(0,n.jsx)("button",{onClick:e=>x(),className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Send"})]}):(console.log("messageList is undefined"),(0,n.jsx)("div",{children:"Loading..."}))}function i(){return(0,n.jsx)(r.Suspense,{children:(0,n.jsx)(u,{})})}},95189:function(e,s,t){"use strict";t.d(s,{B1:function(){return c},Ee:function(){return n},Y4:function(){return l},Yo:function(){return u},_k:function(){return a},lg:function(){return r},oT:function(){return o}});let n="user_info",r="http://www.sparrowzoo.com",o="SESSION",c="sparrow-token",a="SESSION",l="http://www.sparrowzoo.com/react",u="ws://www.sparrowzoo.com/websocket"},78411:function(e,s,t){"use strict";t.d(s,{D:function(){return o},t:function(){return r}});var n=t(2265);class r{static create(e){return new r(e)}newReference(){return new r(this.messageBroker)}closeWebSocket(){var e;null===(e=this.messageBroker)||void 0===e||e.closeWebSocket()}constructor(e){this.messageBroker=e}}let o=(0,n.createContext)(null)}},function(e){e.O(0,[2971,7023,1744],function(){return e(e.s=91769)}),_N_E=e.O()}]);